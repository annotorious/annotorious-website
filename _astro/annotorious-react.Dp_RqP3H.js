import{r as W,R as mn}from"./index.Cn5qh0VW.js";var ze={exports:{}},qt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gn=W,yn=Symbol.for("react.element"),wn=Symbol.for("react.fragment"),$n=Object.prototype.hasOwnProperty,vn=gn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,bn={key:!0,ref:!0,__self:!0,__source:!0};function qe(t,e,n){var o,r={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(o in e)$n.call(e,o)&&!bn.hasOwnProperty(o)&&(r[o]=e[o]);if(t&&t.defaultProps)for(o in e=t.defaultProps,e)r[o]===void 0&&(r[o]=e[o]);return{$$typeof:yn,type:t,key:i,ref:a,props:r,_owner:vn.current}}qt.Fragment=wn;qt.jsx=qe;qt.jsxs=qe;ze.exports=qt;var Fr=ze.exports,Ke={exports:{}},Bt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var we;function xn(){if(we)return Bt;we=1;var t=mn,e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,r=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function a(s,l,c){var d,u={},p=null,h=null;c!==void 0&&(p=""+c),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(h=l.ref);for(d in l)o.call(l,d)&&!i.hasOwnProperty(d)&&(u[d]=l[d]);if(s&&s.defaultProps)for(d in l=s.defaultProps,l)u[d]===void 0&&(u[d]=l[d]);return{$$typeof:e,type:s,key:p,ref:h,props:u,_owner:r.current}}return Bt.Fragment=n,Bt.jsx=a,Bt.jsxs=a,Bt}Ke.exports=xn();var An=Ke.exports,En=[];for(var Wt=0;Wt<256;++Wt)En.push((Wt+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Sn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Tn=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=Sn[n[t]&63];return e};Tn();const We=W.createContext({anno:void 0,setAnno:void 0,annotations:[],selection:{selected:[]}}),zr=W.forwardRef((t,e)=>{const[n,o]=W.useState(null),[r,i]=W.useState([]),[a,s]=W.useState({selected:[]});return W.useImperativeHandle(e,()=>n),W.useEffect(()=>{if(n){const{selection:l,store:c}=n.state;c.all().length>0&&i(c.all());const d=()=>i(()=>c.all());c.observe(d);let u;const p=l.subscribe(({selected:h,...m})=>{u&&c.unobserve(u);const v=(h||[]).map(({id:S,editable:g})=>({annotation:c.getAnnotation(S),editable:g}));s({selected:v,...m}),u=S=>{const{updated:g}=S.changes;s(w=>({...w,selected:w.selected.map(({annotation:y,editable:$})=>{const k=g.find(P=>P.oldValue.id===y.id);return k?{annotation:k.newValue,editable:$}:{annotation:y,editable:$}})}))},c.observe(u,{annotations:h.map(({id:S})=>S)})});return()=>{c.unobserve(d),p()}}},[n]),An.jsx(We.Provider,{value:{anno:n,setAnno:o,annotations:r,selection:a},children:t.children})}),qr=()=>{const{anno:t}=W.useContext(We);return t};var _n=Object.defineProperty,On=(t,e,n)=>e in t?_n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$e=(t,e,n)=>On(t,typeof e!="symbol"?e+"":e,n);function j(){}function le(t,e){for(const n in e)t[n]=e[n];return t}function Je(t){return t()}function ve(){return Object.create(null)}function ft(t){t.forEach(Je)}function F(t){return typeof t=="function"}function K(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Ln(t){return Object.keys(t).length===0}function Qe(t,...e){if(t==null){for(const o of e)o(void 0);return j}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Jt(t,e,n){t.$$.on_destroy.push(Qe(e,n))}function Bn(t,e,n,o){if(t){const r=Ze(t,e,n,o);return t[0](r)}}function Ze(t,e,n,o){return t[1]&&o?le(n.ctx.slice(),t[1](o(e))):n.ctx}function Yn(t,e,n,o){if(t[2]&&o){const r=t[2](o(n));if(e.dirty===void 0)return r;if(typeof r=="object"){const i=[],a=Math.max(e.dirty.length,r.length);for(let s=0;s<a;s+=1)i[s]=e.dirty[s]|r[s];return i}return e.dirty|r}return e.dirty}function In(t,e,n,o,r,i){if(r){const a=Ze(e,n,o,i);t.p(a,r)}}function Mn(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let o=0;o<n;o++)e[o]=-1;return e}return-1}function be(t){const e={};for(const n in t)n[0]!=="$"&&(e[n]=t[n]);return e}function Ft(t){return t??""}const Rn=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ut(t,e){t.appendChild(e)}function L(t,e,n){t.insertBefore(e,n||null)}function O(t){t.parentNode&&t.parentNode.removeChild(t)}function he(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function N(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function tn(t){return document.createTextNode(t)}function rt(){return tn(" ")}function st(){return tn("")}function H(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function f(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function kn(t){return Array.from(t.childNodes)}function pt(t,e,n){t.classList.toggle(e,!!n)}function Cn(t,e,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:o})}let Ct;function kt(t){Ct=t}function en(){if(!Ct)throw new Error("Function called outside component initialization");return Ct}function Nt(t){en().$$.on_mount.push(t)}function Tt(){const t=en();return(e,n,{cancelable:o=!1}={})=>{const r=t.$$.callbacks[e];if(r){const i=Cn(e,n,{cancelable:o});return r.slice().forEach(a=>{a.call(t,i)}),!i.defaultPrevented}return!0}}function ht(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(o=>o.call(this,e))}const xt=[],zt=[];let Et=[];const xe=[],Nn=Promise.resolve();let ce=!1;function Pn(){ce||(ce=!0,Nn.then(nn))}function de(t){Et.push(t)}const Qt=new Set;let wt=0;function nn(){if(wt!==0)return;const t=Ct;do{try{for(;wt<xt.length;){const e=xt[wt];wt++,kt(e),Vn(e.$$)}}catch(e){throw xt.length=0,wt=0,e}for(kt(null),xt.length=0,wt=0;zt.length;)zt.pop()();for(let e=0;e<Et.length;e+=1){const n=Et[e];Qt.has(n)||(Qt.add(n),n())}Et.length=0}while(xt.length);for(;xe.length;)xe.pop()();ce=!1,Qt.clear(),kt(t)}function Vn(t){if(t.fragment!==null){t.update(),ft(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(de)}}function Dn(t){const e=[],n=[];Et.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),Et=e}const Ht=new Set;let mt;function it(){mt={r:0,c:[],p:mt}}function at(){mt.r||ft(mt.c),mt=mt.p}function Y(t,e){t&&t.i&&(Ht.delete(t),t.i(e))}function C(t,e,n,o){if(t&&t.o){if(Ht.has(t))return;Ht.add(t),mt.c.push(()=>{Ht.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}else o&&o()}function St(t){return t?.length!==void 0?t:Array.from(t)}function et(t){t&&t.c()}function Z(t,e,n){const{fragment:o,after_update:r}=t.$$;o&&o.m(e,n),de(()=>{const i=t.$$.on_mount.map(Je).filter(F);t.$$.on_destroy?t.$$.on_destroy.push(...i):ft(i),t.$$.on_mount=[]}),r.forEach(de)}function tt(t,e){const n=t.$$;n.fragment!==null&&(Dn(n.after_update),ft(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Un(t,e){t.$$.dirty[0]===-1&&(xt.push(t),Pn(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function nt(t,e,n,o,r,i,a=null,s=[-1]){const l=Ct;kt(t);const c=t.$$={fragment:null,ctx:[],props:i,update:j,not_equal:r,bound:ve(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:ve(),dirty:s,skip_bound:!1,root:e.target||l.$$.root};a&&a(c.root);let d=!1;if(c.ctx=n?n(t,e.props||{},(u,p,...h)=>{const m=h.length?h[0]:p;return c.ctx&&r(c.ctx[u],c.ctx[u]=m)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](m),d&&Un(t,u)),p}):[],c.update(),d=!0,ft(c.before_update),c.fragment=o?o(c.ctx):!1,e.target){if(e.hydrate){const u=kn(e.target);c.fragment&&c.fragment.l(u),u.forEach(O)}else c.fragment&&c.fragment.c();e.intro&&Y(t.$$.fragment),Z(t,e.target,e.anchor),nn()}kt(l)}class ot{constructor(){$e(this,"$$"),$e(this,"$$set")}$destroy(){tt(this,1),this.$destroy=j}$on(e,n){if(!F(n))return j;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(e){this.$$set&&!Ln(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Xn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Xn);var J=(t=>(t.ELLIPSE="ELLIPSE",t.POLYGON="POLYGON",t.RECTANGLE="RECTANGLE",t))(J||{});const pe={},me=(t,e)=>pe[t]=e,ue=t=>pe[t.type].area(t),jn=(t,e,n)=>pe[t.type].intersects(t,e,n),fe=t=>{let e=1/0,n=1/0,o=-1/0,r=-1/0;return t.forEach(([i,a])=>{e=Math.min(e,i),n=Math.min(n,a),o=Math.max(o,i),r=Math.max(r,a)}),{minX:e,minY:n,maxX:o,maxY:r}},Gn={area:t=>Math.PI*t.geometry.rx*t.geometry.ry,intersects:(t,e,n)=>{const{cx:o,cy:r,rx:i,ry:a}=t.geometry,s=0,l=Math.cos(s),c=Math.sin(s),d=e-o,u=n-r,p=l*d+c*u,h=c*d-l*u;return p*p/(i*i)+h*h/(a*a)<=1}};me(J.ELLIPSE,Gn);const Hn={area:t=>{const{points:e}=t.geometry;let n=0,o=e.length-1;for(let r=0;r<e.length;r++)n+=(e[o][0]+e[r][0])*(e[o][1]-e[r][1]),o=r;return Math.abs(.5*n)},intersects:(t,e,n)=>{const{points:o}=t.geometry;let r=!1;for(let i=0,a=o.length-1;i<o.length;a=i++){const s=o[i][0],l=o[i][1],c=o[a][0],d=o[a][1];l>n!=d>n&&e<(c-s)*(n-l)/(d-l)+s&&(r=!r)}return r}};me(J.POLYGON,Hn);const Fn={area:t=>t.geometry.w*t.geometry.h,intersects:(t,e,n)=>e>=t.geometry.x&&e<=t.geometry.x+t.geometry.w&&n>=t.geometry.y&&n<=t.geometry.y+t.geometry.h};me(J.RECTANGLE,Fn);var z=[];for(var Zt=0;Zt<256;++Zt)z.push((Zt+256).toString(16).slice(1));function zn(t,e=0){return(z[t[e+0]]+z[t[e+1]]+z[t[e+2]]+z[t[e+3]]+"-"+z[t[e+4]]+z[t[e+5]]+"-"+z[t[e+6]]+z[t[e+7]]+"-"+z[t[e+8]]+z[t[e+9]]+"-"+z[t[e+10]]+z[t[e+11]]+z[t[e+12]]+z[t[e+13]]+z[t[e+14]]+z[t[e+15]]).toLowerCase()}var Xt,qn=new Uint8Array(16);function Kn(){if(!Xt&&(Xt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Xt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xt(qn)}var Wn=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Ae={randomUUID:Wn};function Jn(t,e,n){if(Ae.randomUUID&&!e&&!t)return Ae.randomUUID();t=t||{};var o=t.random||(t.rng||Kn)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,zn(o)}var Ee=Object.prototype.hasOwnProperty;function gt(t,e){var n,o;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((o=t.length)===e.length)for(;o--&&gt(t[o],e[o]););return o===-1}if(!n||typeof t=="object"){o=0;for(n in t)if(Ee.call(t,n)&&++o&&!Ee.call(e,n)||!(n in e)||!gt(t[n],e[n]))return!1;return Object.keys(e).length===o}}return t!==t&&e!==e}function te(){}function Qn(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}const $t=[];function ge(t,e=te){let n;const o=new Set;function r(s){if(Qn(t,s)&&(t=s,n)){const l=!$t.length;for(const c of o)c[1](),$t.push(c,t);if(l){for(let c=0;c<$t.length;c+=2)$t[c][0]($t[c+1]);$t.length=0}}}function i(s){r(s(t))}function a(s,l=te){const c=[s,l];return o.add(c),o.size===1&&(n=e(r,i)||te),s(t),()=>{o.delete(c),o.size===0&&n&&(n(),n=null)}}return{set:r,update:i,subscribe:a}}const Zn=t=>{const{subscribe:e,set:n}=ge();let o;return e(r=>o=r),t.observe(({changes:r})=>{if(o){(r.deleted||[]).some(a=>a.id===o)&&n(void 0);const i=(r.updated||[]).find(({oldValue:a})=>a.id===o);i&&n(i.newValue.id)}}),{get current(){return o},subscribe:e,set:n}};var on=(t=>(t.EDIT="EDIT",t.SELECT="SELECT",t.NONE="NONE",t))(on||{});const ee={selected:[]},to=(t,e="EDIT")=>{const{subscribe:n,set:o}=ge(ee);let r=e,i=ee;n(h=>i=h);const a=()=>o(ee),s=()=>{var h;return((h=i.selected)==null?void 0:h.length)===0},l=h=>{if(s())return!1;const m=typeof h=="string"?h:h.id;return i.selected.some(v=>v.id===m)},c=(h,m)=>{const v=t.getAnnotation(h);if(!v){console.warn("Invalid selection: "+h);return}switch(Se(v,r)){case"EDIT":o({selected:[{id:h,editable:!0}],event:m});break;case"SELECT":o({selected:[{id:h}],event:m});break;default:o({selected:[],event:m})}},d=(h,m)=>{const v=Array.isArray(h)?h:[h],S=v.map(g=>t.getAnnotation(g)).filter(g=>!!g);o({selected:S.map(g=>{const w=m===void 0?Se(g,r)==="EDIT":m;return{id:g.id,editable:w}})}),S.length!==v.length&&console.warn("Invalid selection",h)},u=h=>{if(s())return!1;const{selected:m}=i;m.some(({id:v})=>h.includes(v))&&o({selected:m.filter(({id:v})=>!h.includes(v))})},p=h=>r=h;return t.observe(({changes:h})=>u((h.deleted||[]).map(m=>m.id))),{get event(){return i?i.event:null},get selected(){return i?[...i.selected]:null},clear:a,isEmpty:s,isSelected:l,setSelected:d,setUserSelectAction:p,subscribe:n,userSelect:c}},Se=(t,e)=>typeof e=="function"?e(t):e||"EDIT";var eo=[];for(var ne=0;ne<256;++ne)eo.push((ne+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const no=(t,e)=>{const n=new Set(t.bodies.map(o=>o.id));return e.bodies.filter(o=>!n.has(o.id))},oo=(t,e)=>{const n=new Set(e.bodies.map(o=>o.id));return t.bodies.filter(o=>!n.has(o.id))},ro=(t,e)=>e.bodies.map(n=>{const o=t.bodies.find(r=>r.id===n.id);return{newBody:n,oldBody:o&&!gt(o,n)?o:void 0}}).filter(({oldBody:n})=>n).map(({oldBody:n,newBody:o})=>({oldBody:n,newBody:o})),io=(t,e)=>!gt(t.target,e.target),rn=(t,e)=>{const n=no(t,e),o=oo(t,e),r=ro(t,e);return{oldValue:t,newValue:e,bodiesCreated:n.length>0?n:void 0,bodiesDeleted:o.length>0?o:void 0,bodiesUpdated:r.length>0?r:void 0,targetUpdated:io(t,e)?{oldTarget:t.target,newTarget:e.target}:void 0}};var X=(t=>(t.LOCAL="LOCAL",t.REMOTE="REMOTE",t))(X||{});const ao=(t,e)=>{var n,o;const{changes:r,origin:i}=e;if(!(!t.options.origin||t.options.origin===i))return!1;if(t.options.ignore){const{ignore:a}=t.options,s=l=>l&&l.length>0;if(!(s(r.created)||s(r.deleted))){const l=(n=r.updated)==null?void 0:n.some(d=>s(d.bodiesCreated)||s(d.bodiesDeleted)||s(d.bodiesUpdated)),c=(o=r.updated)==null?void 0:o.some(d=>d.targetUpdated);if(a==="BODY_ONLY"&&l&&!c||a==="TARGET_ONLY"&&c&&!l)return!1}}if(t.options.annotations){const a=new Set([...(r.created||[]).map(s=>s.id),...(r.deleted||[]).map(s=>s.id),...(r.updated||[]).map(({oldValue:s})=>s.id)]);return!!(Array.isArray(t.options.annotations)?t.options.annotations:[t.options.annotations]).find(s=>a.has(s))}else return!0},so=(t,e)=>{const n=new Set((t.created||[]).map(u=>u.id)),o=new Set((t.updated||[]).map(({newValue:u})=>u.id)),r=new Set((e.created||[]).map(u=>u.id)),i=new Set((e.deleted||[]).map(u=>u.id)),a=new Set((e.updated||[]).map(({oldValue:u})=>u.id)),s=new Set((e.updated||[]).filter(({oldValue:u})=>n.has(u.id)||o.has(u.id)).map(({oldValue:u})=>u.id)),l=[...(t.created||[]).filter(u=>!i.has(u.id)).map(u=>a.has(u.id)?e.updated.find(({oldValue:p})=>p.id===u.id).newValue:u),...e.created||[]],c=[...(t.deleted||[]).filter(u=>!r.has(u.id)),...(e.deleted||[]).filter(u=>!n.has(u.id))],d=[...(t.updated||[]).filter(({newValue:u})=>!i.has(u.id)).map(u=>{const{oldValue:p,newValue:h}=u;if(a.has(h.id)){const m=e.updated.find(v=>v.oldValue.id===h.id).newValue;return rn(p,m)}else return u}),...(e.updated||[]).filter(({oldValue:u})=>!s.has(u.id))];return{created:l,deleted:c,updated:d}},lo=t=>t.id!==void 0,co=()=>{const t=new Map,e=new Map,n=[],o=(b,x={})=>n.push({onChange:b,options:x}),r=b=>{const x=n.findIndex(A=>A.onChange==b);x>-1&&n.splice(x,1)},i=(b,x)=>{const A={origin:b,changes:{created:x.created||[],updated:x.updated||[],deleted:x.deleted||[]},state:[...t.values()]};n.forEach(E=>{ao(E,A)&&E.onChange(A)})},a=(b,x=X.LOCAL)=>{if(t.get(b.id))throw Error(`Cannot add annotation ${b.id} - exists already`);t.set(b.id,b),b.bodies.forEach(A=>e.set(A.id,b.id)),i(x,{created:[b]})},s=(b,x)=>{const A=typeof b=="string"?x:b,E=typeof b=="string"?b:b.id,M=t.get(E);if(M){const V=rn(M,A);return E===A.id?t.set(E,A):(t.delete(E),t.set(A.id,A)),M.bodies.forEach(Q=>e.delete(Q.id)),A.bodies.forEach(Q=>e.set(Q.id,A.id)),V}else console.warn(`Cannot update annotation ${E} - does not exist`)},l=(b,x=X.LOCAL,A=X.LOCAL)=>{const E=lo(x)?A:x,M=s(b,x);M&&i(E,{updated:[M]})},c=(b,x=X.LOCAL)=>{const A=b.reduce((E,M)=>{const V=s(M);return V?[...E,V]:E},[]);A.length>0&&i(x,{updated:A})},d=(b,x=X.LOCAL)=>{const A=t.get(b.annotation);if(A){const E={...A,bodies:[...A.bodies,b]};t.set(A.id,E),e.set(b.id,E.id),i(x,{updated:[{oldValue:A,newValue:E,bodiesCreated:[b]}]})}else console.warn(`Attempt to add body to missing annotation: ${b.annotation}`)},u=()=>[...t.values()],p=(b=X.LOCAL)=>{const x=[...t.values()];t.clear(),e.clear(),i(b,{deleted:x})},h=(b,x=!0,A=X.LOCAL)=>{if(x){const E=[...t.values()];t.clear(),e.clear(),b.forEach(M=>{t.set(M.id,M),M.bodies.forEach(V=>e.set(V.id,M.id))}),i(A,{created:b,deleted:E})}else{const E=b.reduce((M,V)=>{const Q=t.get(V.id);return Q?[...M,Q]:M},[]);if(E.length>0)throw Error(`Bulk insert would overwrite the following annotations: ${E.map(M=>M.id).join(", ")}`);b.forEach(M=>{t.set(M.id,M),M.bodies.forEach(V=>e.set(V.id,M.id))}),i(A,{created:b})}},m=b=>{const x=typeof b=="string"?b:b.id,A=t.get(x);if(A)return t.delete(x),A.bodies.forEach(E=>e.delete(E.id)),A;console.warn(`Attempt to delete missing annotation: ${x}`)},v=(b,x=X.LOCAL)=>{const A=m(b);A&&i(x,{deleted:[A]})},S=(b,x=X.LOCAL)=>{const A=b.reduce((E,M)=>{const V=m(M);return V?[...E,V]:E},[]);A.length>0&&i(x,{deleted:A})},g=b=>{const x=t.get(b.annotation);if(x){const A=x.bodies.find(E=>E.id===b.id);if(A){e.delete(A.id);const E={...x,bodies:x.bodies.filter(M=>M.id!==b.id)};return t.set(x.id,E),{oldValue:x,newValue:E,bodiesDeleted:[A]}}else console.warn(`Attempt to delete missing body ${b.id} from annotation ${b.annotation}`)}else console.warn(`Attempt to delete body from missing annotation ${b.annotation}`)},w=(b,x=X.LOCAL)=>{const A=g(b);A&&i(x,{updated:[A]})},y=(b,x=X.LOCAL)=>{const A=b.map(E=>g(E)).filter(Boolean);A.length>0&&i(x,{updated:A})},$=b=>{const x=t.get(b);return x?{...x}:void 0},k=b=>{const x=e.get(b);if(x){const A=$(x).bodies.find(E=>E.id===b);if(A)return A;console.error(`Store integrity error: body ${b} in index, but not in annotation`)}else console.warn(`Attempt to retrieve missing body: ${b}`)},P=(b,x)=>{if(b.annotation!==x.annotation)throw"Annotation integrity violation: annotation ID must be the same when updating bodies";const A=t.get(b.annotation);if(A){const E=A.bodies.find(V=>V.id===b.id),M={...A,bodies:A.bodies.map(V=>V.id===E.id?x:V)};return t.set(A.id,M),E.id!==x.id&&(e.delete(E.id),e.set(x.id,M.id)),{oldValue:A,newValue:M,bodiesUpdated:[{oldBody:E,newBody:x}]}}else console.warn(`Attempt to add body to missing annotation ${b.annotation}`)},D=(b,x,A=X.LOCAL)=>{const E=P(b,x);E&&i(A,{updated:[E]})},U=(b,x=X.LOCAL)=>{const A=b.map(E=>P({id:E.id,annotation:E.annotation},E)).filter(Boolean);i(x,{updated:A})},I=b=>{const x=t.get(b.annotation);if(x){const A={...x,target:{...x.target,...b}};return t.set(x.id,A),{oldValue:x,newValue:A,targetUpdated:{oldTarget:x.target,newTarget:b}}}else console.warn(`Attempt to update target on missing annotation: ${b.annotation}`)};return{addAnnotation:a,addBody:d,all:u,bulkAddAnnotation:h,bulkDeleteAnnotation:S,bulkDeleteBodies:y,bulkUpdateAnnotation:c,bulkUpdateBodies:U,bulkUpdateTargets:(b,x=X.LOCAL)=>{const A=b.map(E=>I(E)).filter(Boolean);A.length>0&&i(x,{updated:A})},clear:p,deleteAnnotation:v,deleteBody:w,getAnnotation:$,getBody:k,observe:o,unobserve:r,updateAnnotation:l,updateBody:D,updateTarget:(b,x=X.LOCAL)=>{const A=I(b);A&&i(x,{updated:[A]})}}},uo=t=>({...t,subscribe:e=>{const n=o=>e(o.state);return t.observe(n),e(t.all()),()=>t.unobserve(n)}});let fo=()=>({emit(t,...e){for(let n=0,o=this.events[t]||[],r=o.length;n<r;n++)o[n](...e)},events:{},on(t,e){var n;return((n=this.events)[t]||(n[t]=[])).push(e),()=>{var o;this.events[t]=(o=this.events[t])==null?void 0:o.filter(r=>e!==r)}}});const ho=250,po=t=>{const e=fo(),n=[];let o=-1,r=!1,i=0;const a=h=>{if(!r){const{changes:m}=h,v=performance.now();if(v-i>ho)n.splice(o+1),n.push(m),o=n.length-1;else{const S=n.length-1;n[S]=so(n[S],m)}i=v}r=!1};t.observe(a,{origin:X.LOCAL});const s=h=>h&&h.length>0&&t.bulkDeleteAnnotation(h),l=h=>h&&h.length>0&&t.bulkAddAnnotation(h,!1),c=h=>h&&h.length>0&&t.bulkUpdateAnnotation(h.map(({oldValue:m})=>m)),d=h=>h&&h.length>0&&t.bulkUpdateAnnotation(h.map(({newValue:m})=>m)),u=h=>h&&h.length>0&&t.bulkAddAnnotation(h,!1),p=h=>h&&h.length>0&&t.bulkDeleteAnnotation(h);return{canRedo:()=>n.length-1>o,canUndo:()=>o>-1,destroy:()=>t.unobserve(a),on:(h,m)=>e.on(h,m),redo:()=>{if(n.length-1>o){r=!0;const{created:h,updated:m,deleted:v}=n[o+1];l(h),d(m),p(v),e.emit("redo",n[o+1]),o+=1}},undo:()=>{if(o>-1){r=!0;const{created:h,updated:m,deleted:v}=n[o];s(h),c(m),u(v),e.emit("undo",n[o]),o-=1}}}},mo=()=>{const{subscribe:t,set:e}=ge([]);return{subscribe:t,set:e}},go=(t,e,n,o)=>{const{store:r,selection:i,hover:a,viewport:s}=t,l=new Map;let c=[],d,u;const p=(g,w)=>{l.has(g)?l.get(g).push(w):l.set(g,[w])},h=(g,w)=>{const y=l.get(g);if(y){const $=y.indexOf(w);$!==-1&&y.splice($,1)}},m=(g,w,y)=>{l.has(g)&&setTimeout(()=>{l.get(g).forEach($=>{if(n){const k=Array.isArray(w)?w.map(D=>n.serialize(D)):n.serialize(w),P=y?y instanceof PointerEvent?y:n.serialize(y):void 0;$(k,P)}else $(w,y)})},1)},v=()=>{const{selected:g}=i,w=(g||[]).map(({id:y})=>r.getAnnotation(y));w.forEach(y=>{const $=c.find(k=>k.id===y.id);(!$||!gt($,y))&&m("updateAnnotation",y,$)}),c=c.map(y=>w.find(({id:$})=>$===y.id)||y)};i.subscribe(({selected:g})=>{if(!(c.length===0&&g.length===0)){if(c.length===0&&g.length>0)c=g.map(({id:w})=>r.getAnnotation(w));else if(c.length>0&&g.length===0)c.forEach(w=>{const y=r.getAnnotation(w.id);y&&!gt(y,w)&&m("updateAnnotation",y,w)}),c=[];else{const w=new Set(c.map($=>$.id)),y=new Set(g.map(({id:$})=>$));c.filter($=>!y.has($.id)).forEach($=>{const k=r.getAnnotation($.id);k&&!gt(k,$)&&m("updateAnnotation",k,$)}),c=[...c.filter($=>y.has($.id)),...g.filter(({id:$})=>!w.has($)).map(({id:$})=>r.getAnnotation($))]}m("selectionChanged",c)}}),a.subscribe(g=>{!d&&g?m("mouseEnterAnnotation",r.getAnnotation(g)):d&&!g?m("mouseLeaveAnnotation",r.getAnnotation(d)):d&&g&&(m("mouseLeaveAnnotation",r.getAnnotation(d)),m("mouseEnterAnnotation",r.getAnnotation(g))),d=g}),s?.subscribe(g=>m("viewportIntersect",g.map(w=>r.getAnnotation(w)))),r.observe(g=>{o&&(u&&clearTimeout(u),u=setTimeout(v,1e3));const{created:w,deleted:y}=g.changes;(w||[]).forEach($=>m("createAnnotation",$)),(y||[]).forEach($=>m("deleteAnnotation",$)),(g.changes.updated||[]).filter($=>[...$.bodiesCreated||[],...$.bodiesDeleted||[],...$.bodiesUpdated||[]].length>0).forEach(({oldValue:$,newValue:k})=>{const P=c.find(D=>D.id===$.id)||$;c=c.map(D=>D.id===$.id?k:D),m("updateAnnotation",k,P)})},{origin:X.LOCAL}),r.observe(g=>{if(c){const w=new Set(c.map($=>$.id)),y=(g.changes.updated||[]).filter(({newValue:$})=>w.has($.id)).map(({newValue:$})=>$);y.length>0&&(c=c.map($=>y.find(k=>k.id===$.id)||$))}},{origin:X.REMOTE});const S=g=>w=>{const{updated:y}=w;g?(y||[]).forEach($=>m("updateAnnotation",$.oldValue,$.newValue)):(y||[]).forEach($=>m("updateAnnotation",$.newValue,$.oldValue))};return e.on("undo",S(!0)),e.on("redo",S(!1)),{on:p,off:h,emit:m}},yo=t=>e=>e.reduce((n,o)=>{const{parsed:r,error:i}=t.parse(o);return i?{parsed:n.parsed,failed:[...n.failed,o]}:r?{parsed:[...n.parsed,r],failed:n.failed}:{...n}},{parsed:[],failed:[]}),wo=(t,e,n)=>{const{store:o,selection:r}=t,i=g=>{if(n){const{parsed:w,error:y}=n.parse(g);w?o.addAnnotation(w,X.REMOTE):console.error(y)}else o.addAnnotation(g,X.REMOTE)},a=()=>r.clear(),s=()=>o.clear(),l=g=>{const w=o.getAnnotation(g);return n&&w?n.serialize(w):w},c=()=>n?o.all().map(n.serialize):o.all(),d=()=>{var g;const w=(((g=r.selected)==null?void 0:g.map(y=>y.id))||[]).map(y=>o.getAnnotation(y)).filter(Boolean);return n?w.map(n.serialize):w},u=(g,w=!0)=>fetch(g).then(y=>y.json()).then(y=>(h(y,w),y)),p=g=>{if(typeof g=="string"){const w=o.getAnnotation(g);if(o.deleteAnnotation(g),w)return n?n.serialize(w):w}else{const w=n?n.parse(g).parsed:g;if(w)return o.deleteAnnotation(w),g}},h=(g,w=!0)=>{if(n){const{parsed:y,failed:$}=yo(n)(g);$.length>0&&console.warn(`Discarded ${$.length} invalid annotations`,$),o.bulkAddAnnotation(y,w,X.REMOTE)}else o.bulkAddAnnotation(g,w,X.REMOTE)},m=(g,w)=>{g?r.setSelected(g,w):r.clear()},v=g=>{r.clear(),r.setUserSelectAction(g)},S=g=>{if(n){const w=n.parse(g).parsed,y=n.serialize(o.getAnnotation(w.id));return o.updateAnnotation(w),y}else{const w=o.getAnnotation(g.id);return o.updateAnnotation(g),w}};return{addAnnotation:i,cancelSelected:a,canRedo:e.canRedo,canUndo:e.canUndo,clearAnnotations:s,getAnnotationById:l,getAnnotations:c,getSelected:d,loadAnnotations:u,redo:e.redo,removeAnnotation:p,setAnnotations:h,setSelected:m,setUserSelectAction:v,undo:e.undo,updateAnnotation:S}},$o="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let vo=t=>crypto.getRandomValues(new Uint8Array(t)),bo=(t,e,n)=>{let o=(2<<Math.log(t.length-1)/Math.LN2)-1,r=-~(1.6*o*e/t.length);return(i=e)=>{let a="";for(;;){let s=n(r),l=r;for(;l--;)if(a+=t[s[l]&o]||"",a.length===i)return a}}},xo=(t,e=21)=>bo(t,e,vo),Ao=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=$o[n[t]&63];return e};const Eo=()=>({isGuest:!0,id:xo("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",20)()});Ao();function Te(t,e,n){const o=t.slice();return o[10]=e[n],o[12]=n,o}function _e(t){let e,n;return e=new It({props:{x:t[10][0],y:t[10][1],scale:t[3]}}),e.$on("pointerdown",function(){F(t[9](`HANDLE-${t[12]}`))&&t[9](`HANDLE-${t[12]}`).apply(this,arguments)}),{c(){et(e.$$.fragment)},m(o,r){Z(e,o,r),n=!0},p(o,r){t=o;const i={};r&16&&(i.x=t[10][0]),r&16&&(i.y=t[10][1]),r&8&&(i.scale=t[3]),e.$set(i)},i(o){n||(Y(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){tt(e,o)}}}function So(t){let e,n,o,r,i,a,s,l,c,d,u,p=St(t[4].points),h=[];for(let v=0;v<p.length;v+=1)h[v]=_e(Te(t,p,v));const m=v=>C(h[v],1,1,()=>{h[v]=null});return{c(){e=N("polygon"),r=rt(),i=N("polygon"),s=rt();for(let v=0;v<h.length;v+=1)h[v].c();l=st(),f(e,"class","a9s-outer"),f(e,"style",n=t[1]?"display:none;":void 0),f(e,"points",o=t[4].points.map(Oe).join(" ")),f(i,"class","a9s-inner a9s-shape-handle"),f(i,"style",t[1]),f(i,"points",a=t[4].points.map(Le).join(" "))},m(v,S){L(v,e,S),L(v,r,S),L(v,i,S),L(v,s,S);for(let g=0;g<h.length;g+=1)h[g]&&h[g].m(v,S);L(v,l,S),c=!0,d||(u=[H(e,"pointerdown",function(){F(t[9]("SHAPE"))&&t[9]("SHAPE").apply(this,arguments)}),H(i,"pointerdown",function(){F(t[9]("SHAPE"))&&t[9]("SHAPE").apply(this,arguments)})],d=!0)},p(v,S){if(t=v,(!c||S&2&&n!==(n=t[1]?"display:none;":void 0))&&f(e,"style",n),(!c||S&16&&o!==(o=t[4].points.map(Oe).join(" ")))&&f(e,"points",o),(!c||S&2)&&f(i,"style",t[1]),(!c||S&16&&a!==(a=t[4].points.map(Le).join(" ")))&&f(i,"points",a),S&536){p=St(t[4].points);let g;for(g=0;g<p.length;g+=1){const w=Te(t,p,g);h[g]?(h[g].p(w,S),Y(h[g],1)):(h[g]=_e(w),h[g].c(),Y(h[g],1),h[g].m(l.parentNode,l))}for(it(),g=p.length;g<h.length;g+=1)m(g);at()}},i(v){if(!c){for(let S=0;S<p.length;S+=1)Y(h[S]);c=!0}},o(v){h=h.filter(Boolean);for(let S=0;S<h.length;S+=1)C(h[S]);c=!1},d(v){v&&(O(e),O(r),O(i),O(s),O(l)),he(h,v),d=!1,ft(u)}}}function To(t){let e,n;return e=new sn({props:{shape:t[0],transform:t[2],editor:t[5],$$slots:{default:[So,({grab:o})=>({9:o}),({grab:o})=>o?512:0]},$$scope:{ctx:t}}}),e.$on("change",t[6]),e.$on("grab",t[7]),e.$on("release",t[8]),{c(){et(e.$$.fragment)},m(o,r){Z(e,o,r),n=!0},p(o,[r]){const i={};r&1&&(i.shape=o[0]),r&4&&(i.transform=o[2]),r&8730&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){n||(Y(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){tt(e,o)}}}const Oe=t=>t.join(","),Le=t=>t.join(",");function _o(t,e,n){let o,{shape:r}=e,{computedStyle:i}=e,{transform:a}=e,{viewportScale:s=1}=e;const l=(p,h,m)=>{let v;const S=p.geometry;h==="SHAPE"?v=S.points.map(([w,y])=>[w+m[0],y+m[1]]):v=S.points.map(([w,y],$)=>h===`HANDLE-${$}`?[w+m[0],y+m[1]]:[w,y]);const g=fe(v);return{...p,geometry:{points:v,bounds:g}}};function c(p){ht.call(this,t,p)}function d(p){ht.call(this,t,p)}function u(p){ht.call(this,t,p)}return t.$$set=p=>{"shape"in p&&n(0,r=p.shape),"computedStyle"in p&&n(1,i=p.computedStyle),"transform"in p&&n(2,a=p.transform),"viewportScale"in p&&n(3,s=p.viewportScale)},t.$$.update=()=>{t.$$.dirty&1&&n(4,o=r.geometry)},[r,i,a,s,o,l,c,d,u]}class Oo extends ot{constructor(e){super(),nt(this,e,_o,To,K,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}const oe=(t,e)=>{const n=Math.abs(e[0]-t[0]),o=Math.abs(e[1]-t[1]);return Math.sqrt(Math.pow(n,2)+Math.pow(o,2))},vt=[];function Lo(t,e=j){let n;const o=new Set;function r(s){if(K(t,s)&&(t=s,n)){const l=!vt.length;for(const c of o)c[1](),vt.push(c,t);if(l){for(let c=0;c<vt.length;c+=2)vt[c][0](vt[c+1]);vt.length=0}}}function i(s){r(s(t))}function a(s,l=j){const c=[s,l];return o.add(c),o.size===1&&(n=e(r,i)||j),s(t),()=>{o.delete(c),o.size===0&&n&&(n(),n=null)}}return{set:r,update:i,subscribe:a}}const Bo=(t,e)=>{const{naturalWidth:n,naturalHeight:o}=t;if(!n&&!o){const{width:r,height:i}=t;e.setAttribute("viewBox",`0 0 ${r} ${i}`),t.addEventListener("load",a=>{const s=a.target;e.setAttribute("viewBox",`0 0 ${s.naturalWidth} ${s.naturalHeight}`)})}else e.setAttribute("viewBox",`0 0 ${n} ${o}`)},Yo=(t,e)=>{Bo(t,e);const{subscribe:n,set:o}=Lo(1);let r;return window.ResizeObserver&&(r=new ResizeObserver(()=>{const i=e.getBoundingClientRect(),{width:a,height:s}=e.viewBox.baseVal,l=Math.max(i.width/a,i.height/s);o(l)}),r.observe(e.parentElement)),{destroy:()=>{r&&r.disconnect()},subscribe:n}},Io="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;function Mo(t){let e,n,o,r,i,a;return{c(){e=N("rect"),f(e,"class",n=Ft(`a9s-handle ${t[8].class||""}`.trim())+" svelte-1sgkh33"),f(e,"x",o=t[0]-t[5]/2),f(e,"y",r=t[1]-t[5]/2),f(e,"width",t[5]),f(e,"height",t[5])},m(s,l){L(s,e,l),i||(a=H(e,"pointerdown",t[11]),i=!0)},p(s,l){l&256&&n!==(n=Ft(`a9s-handle ${s[8].class||""}`.trim())+" svelte-1sgkh33")&&f(e,"class",n),l&33&&o!==(o=s[0]-s[5]/2)&&f(e,"x",o),l&34&&r!==(r=s[1]-s[5]/2)&&f(e,"y",r),l&32&&f(e,"width",s[5]),l&32&&f(e,"height",s[5])},d(s){s&&O(e),i=!1,a()}}}function Ro(t){let e,n,o,r,i,a,s,l,c;return{c(){e=N("g"),n=N("circle"),r=N("rect"),f(n,"cx",t[0]),f(n,"cy",t[1]),f(n,"r",o=t[3]/t[2]),f(n,"class","a9s-touch-halo svelte-1sgkh33"),pt(n,"touched",t[4]),f(r,"class",i=Ft(`a9s-handle ${t[8].class||""}`.trim())+" svelte-1sgkh33"),f(r,"x",a=t[0]-t[5]/2),f(r,"y",s=t[1]-t[5]/2),f(r,"width",t[5]),f(r,"height",t[5]),f(e,"class","a9s-touch-handle")},m(d,u){L(d,e,u),ut(e,n),ut(e,r),l||(c=[H(n,"pointerdown",t[10]),H(n,"pointerdown",t[6]),H(n,"pointerup",t[7]),H(r,"pointerdown",t[9]),H(r,"pointerdown",t[6]),H(r,"pointerup",t[7])],l=!0)},p(d,u){u&1&&f(n,"cx",d[0]),u&2&&f(n,"cy",d[1]),u&12&&o!==(o=d[3]/d[2])&&f(n,"r",o),u&16&&pt(n,"touched",d[4]),u&256&&i!==(i=Ft(`a9s-handle ${d[8].class||""}`.trim())+" svelte-1sgkh33")&&f(r,"class",i),u&33&&a!==(a=d[0]-d[5]/2)&&f(r,"x",a),u&34&&s!==(s=d[1]-d[5]/2)&&f(r,"y",s),u&32&&f(r,"width",d[5]),u&32&&f(r,"height",d[5])},d(d){d&&O(e),l=!1,ft(c)}}}function ko(t){let e;function n(r,i){return Io?Ro:Mo}let o=n()(t);return{c(){o.c(),e=st()},m(r,i){o.m(r,i),L(r,e,i)},p(r,[i]){o.p(r,i)},i:j,o:j,d(r){r&&O(e),o.d(r)}}}function Co(t,e,n){let o,{x:r}=e,{y:i}=e,{scale:a}=e,{radius:s=30}=e,l=!1;const c=m=>{m.pointerType==="touch"&&n(4,l=!0)},d=()=>n(4,l=!1);function u(m){ht.call(this,t,m)}function p(m){ht.call(this,t,m)}function h(m){ht.call(this,t,m)}return t.$$set=m=>{n(8,e=le(le({},e),be(m))),"x"in m&&n(0,r=m.x),"y"in m&&n(1,i=m.y),"scale"in m&&n(2,a=m.scale),"radius"in m&&n(3,s=m.radius)},t.$$.update=()=>{t.$$.dirty&4&&n(5,o=10/a)},e=be(e),[r,i,a,s,l,o,c,d,e,u,p,h]}class It extends ot{constructor(e){super(),nt(this,e,Co,ko,K,{x:0,y:1,scale:2,radius:3})}}function No(t){let e,n,o,r,i,a,s,l,c,d,u,p,h,m,v,S,g,w,y,$,k,P,D,U,I,b,x,A,E,M,V,Q,_t,lt,Ot,ct,Lt,dt,_,G,B,q,yt;return lt=new It({props:{class:"a9s-corner-handle-topleft",x:t[4].x,y:t[4].y,scale:t[3]}}),lt.$on("pointerdown",function(){F(t[9]("TOP_LEFT"))&&t[9]("TOP_LEFT").apply(this,arguments)}),ct=new It({props:{class:"a9s-corner-handle-topright",x:t[4].x+t[4].w,y:t[4].y,scale:t[3]}}),ct.$on("pointerdown",function(){F(t[9]("TOP_RIGHT"))&&t[9]("TOP_RIGHT").apply(this,arguments)}),dt=new It({props:{class:"a9s-corner-handle-bottomright",x:t[4].x+t[4].w,y:t[4].y+t[4].h,scale:t[3]}}),dt.$on("pointerdown",function(){F(t[9]("BOTTOM_RIGHT"))&&t[9]("BOTTOM_RIGHT").apply(this,arguments)}),G=new It({props:{class:"a9s-corner-handle-bottomleft",x:t[4].x,y:t[4].y+t[4].h,scale:t[3]}}),G.$on("pointerdown",function(){F(t[9]("BOTTOM_LEFT"))&&t[9]("BOTTOM_LEFT").apply(this,arguments)}),{c(){e=N("rect"),s=rt(),l=N("rect"),h=rt(),m=N("rect"),w=rt(),y=N("rect"),D=rt(),U=N("rect"),A=rt(),E=N("rect"),_t=rt(),et(lt.$$.fragment),Ot=rt(),et(ct.$$.fragment),Lt=rt(),et(dt.$$.fragment),_=rt(),et(G.$$.fragment),f(e,"class","a9s-outer"),f(e,"style",n=t[1]?"display:none;":void 0),f(e,"x",o=t[4].x),f(e,"y",r=t[4].y),f(e,"width",i=t[4].w),f(e,"height",a=t[4].h),f(l,"class","a9s-inner a9s-shape-handle"),f(l,"style",t[1]),f(l,"x",c=t[4].x),f(l,"y",d=t[4].y),f(l,"width",u=t[4].w),f(l,"height",p=t[4].h),f(m,"class","a9s-edge-handle a9s-edge-handle-top"),f(m,"x",v=t[4].x),f(m,"y",S=t[4].y),f(m,"height",1),f(m,"width",g=t[4].w),f(y,"class","a9s-edge-handle a9s-edge-handle-right"),f(y,"x",$=t[4].x+t[4].w),f(y,"y",k=t[4].y),f(y,"height",P=t[4].h),f(y,"width",1),f(U,"class","a9s-edge-handle a9s-edge-handle-bottom"),f(U,"x",I=t[4].x),f(U,"y",b=t[4].y+t[4].h),f(U,"height",1),f(U,"width",x=t[4].w),f(E,"class","a9s-edge-handle a9s-edge-handle-left"),f(E,"x",M=t[4].x),f(E,"y",V=t[4].y),f(E,"height",Q=t[4].h),f(E,"width",1)},m(R,T){L(R,e,T),L(R,s,T),L(R,l,T),L(R,h,T),L(R,m,T),L(R,w,T),L(R,y,T),L(R,D,T),L(R,U,T),L(R,A,T),L(R,E,T),L(R,_t,T),Z(lt,R,T),L(R,Ot,T),Z(ct,R,T),L(R,Lt,T),Z(dt,R,T),L(R,_,T),Z(G,R,T),B=!0,q||(yt=[H(e,"pointerdown",function(){F(t[9]("SHAPE"))&&t[9]("SHAPE").apply(this,arguments)}),H(l,"pointerdown",function(){F(t[9]("SHAPE"))&&t[9]("SHAPE").apply(this,arguments)}),H(m,"pointerdown",function(){F(t[9]("TOP"))&&t[9]("TOP").apply(this,arguments)}),H(y,"pointerdown",function(){F(t[9]("RIGHT"))&&t[9]("RIGHT").apply(this,arguments)}),H(U,"pointerdown",function(){F(t[9]("BOTTOM"))&&t[9]("BOTTOM").apply(this,arguments)}),H(E,"pointerdown",function(){F(t[9]("LEFT"))&&t[9]("LEFT").apply(this,arguments)})],q=!0)},p(R,T){t=R,(!B||T&2&&n!==(n=t[1]?"display:none;":void 0))&&f(e,"style",n),(!B||T&16&&o!==(o=t[4].x))&&f(e,"x",o),(!B||T&16&&r!==(r=t[4].y))&&f(e,"y",r),(!B||T&16&&i!==(i=t[4].w))&&f(e,"width",i),(!B||T&16&&a!==(a=t[4].h))&&f(e,"height",a),(!B||T&2)&&f(l,"style",t[1]),(!B||T&16&&c!==(c=t[4].x))&&f(l,"x",c),(!B||T&16&&d!==(d=t[4].y))&&f(l,"y",d),(!B||T&16&&u!==(u=t[4].w))&&f(l,"width",u),(!B||T&16&&p!==(p=t[4].h))&&f(l,"height",p),(!B||T&16&&v!==(v=t[4].x))&&f(m,"x",v),(!B||T&16&&S!==(S=t[4].y))&&f(m,"y",S),(!B||T&16&&g!==(g=t[4].w))&&f(m,"width",g),(!B||T&16&&$!==($=t[4].x+t[4].w))&&f(y,"x",$),(!B||T&16&&k!==(k=t[4].y))&&f(y,"y",k),(!B||T&16&&P!==(P=t[4].h))&&f(y,"height",P),(!B||T&16&&I!==(I=t[4].x))&&f(U,"x",I),(!B||T&16&&b!==(b=t[4].y+t[4].h))&&f(U,"y",b),(!B||T&16&&x!==(x=t[4].w))&&f(U,"width",x),(!B||T&16&&M!==(M=t[4].x))&&f(E,"x",M),(!B||T&16&&V!==(V=t[4].y))&&f(E,"y",V),(!B||T&16&&Q!==(Q=t[4].h))&&f(E,"height",Q);const Pt={};T&16&&(Pt.x=t[4].x),T&16&&(Pt.y=t[4].y),T&8&&(Pt.scale=t[3]),lt.$set(Pt);const Vt={};T&16&&(Vt.x=t[4].x+t[4].w),T&16&&(Vt.y=t[4].y),T&8&&(Vt.scale=t[3]),ct.$set(Vt);const Dt={};T&16&&(Dt.x=t[4].x+t[4].w),T&16&&(Dt.y=t[4].y+t[4].h),T&8&&(Dt.scale=t[3]),dt.$set(Dt);const Ut={};T&16&&(Ut.x=t[4].x),T&16&&(Ut.y=t[4].y+t[4].h),T&8&&(Ut.scale=t[3]),G.$set(Ut)},i(R){B||(Y(lt.$$.fragment,R),Y(ct.$$.fragment,R),Y(dt.$$.fragment,R),Y(G.$$.fragment,R),B=!0)},o(R){C(lt.$$.fragment,R),C(ct.$$.fragment,R),C(dt.$$.fragment,R),C(G.$$.fragment,R),B=!1},d(R){R&&(O(e),O(s),O(l),O(h),O(m),O(w),O(y),O(D),O(U),O(A),O(E),O(_t),O(Ot),O(Lt),O(_)),tt(lt,R),tt(ct,R),tt(dt,R),tt(G,R),q=!1,ft(yt)}}}function Po(t){let e,n;return e=new sn({props:{shape:t[0],transform:t[2],editor:t[5],$$slots:{default:[No,({grab:o})=>({9:o}),({grab:o})=>o?512:0]},$$scope:{ctx:t}}}),e.$on("grab",t[6]),e.$on("change",t[7]),e.$on("release",t[8]),{c(){et(e.$$.fragment)},m(o,r){Z(e,o,r),n=!0},p(o,[r]){const i={};r&1&&(i.shape=o[0]),r&4&&(i.transform=o[2]),r&1562&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){n||(Y(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){tt(e,o)}}}function Vo(t,e,n){let o,{shape:r}=e,{computedStyle:i}=e,{transform:a}=e,{viewportScale:s=1}=e;const l=(p,h,m)=>{const v=p.geometry.bounds;let[S,g]=[v.minX,v.minY],[w,y]=[v.maxX,v.maxY];const[$,k]=m;if(h==="SHAPE")S+=$,w+=$,g+=k,y+=k;else{switch(h){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{g+=k;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{y+=k;break}}switch(h){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{S+=$;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{w+=$;break}}}const P=Math.min(S,w),D=Math.min(g,y),U=Math.abs(w-S),I=Math.abs(y-g);return{...p,geometry:{x:P,y:D,w:U,h:I,bounds:{minX:P,minY:D,maxX:P+U,maxY:D+I}}}};function c(p){ht.call(this,t,p)}function d(p){ht.call(this,t,p)}function u(p){ht.call(this,t,p)}return t.$$set=p=>{"shape"in p&&n(0,r=p.shape),"computedStyle"in p&&n(1,i=p.computedStyle),"transform"in p&&n(2,a=p.transform),"viewportScale"in p&&n(3,s=p.viewportScale)},t.$$.update=()=>{t.$$.dirty&1&&n(4,o=r.geometry)},[r,i,a,s,o,l,c,d,u]}class Do extends ot{constructor(e){super(),nt(this,e,Vo,Po,K,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}const an=new Map([[J.RECTANGLE,Do],[J.POLYGON,Oo]]),Uo=t=>an.get(t.type),Xo=(t,e)=>an.set(t,e),jo=t=>({}),Be=t=>({grab:t[0]});function Go(t){let e,n,o,r;const i=t[7].default,a=Bn(i,t,t[6],Be);return{c(){e=N("g"),a&&a.c(),f(e,"class","a9s-annotation selected")},m(s,l){L(s,e,l),a&&a.m(e,null),n=!0,o||(r=[H(e,"pointerup",t[2]),H(e,"pointermove",t[1])],o=!0)},p(s,[l]){a&&a.p&&(!n||l&64)&&In(a,i,s,s[6],n?Yn(i,s[6],l,jo):Mn(s[6]),Be)},i(s){n||(Y(a,s),n=!0)},o(s){C(a,s),n=!1},d(s){s&&O(e),a&&a.d(s),o=!1,ft(r)}}}function Ho(t,e,n){let{$$slots:o={},$$scope:r}=e;const i=Tt();let{shape:a}=e,{editor:s}=e,{transform:l}=e,c,d,u;const p=v=>S=>{c=v,d=l.elementToImage(S.offsetX,S.offsetY),u=a,S.target.setPointerCapture(S.pointerId),i("grab",S)},h=v=>{if(c){const[S,g]=l.elementToImage(v.offsetX,v.offsetY),w=[S-d[0],g-d[1]];n(3,a=s(u,c,w)),i("change",a)}},m=v=>{v.target.releasePointerCapture(v.pointerId),c=void 0,u=a,i("release",v)};return t.$$set=v=>{"shape"in v&&n(3,a=v.shape),"editor"in v&&n(4,s=v.editor),"transform"in v&&n(5,l=v.transform),"$$scope"in v&&n(6,r=v.$$scope)},[p,h,m,a,s,l,r,o]}class sn extends ot{constructor(e){super(),nt(this,e,Ho,Go,K,{shape:3,editor:4,transform:5})}}const Kt=(t,e)=>{const n=typeof e=="function"?e(t):e;if(n){const{fill:o,fillOpacity:r}=n;let i="";return o&&(i+=`fill:${o};stroke:${o};`),i+=`fill-opacity:${r||"0.25"};`,i}};function Fo(t,e,n){let o;const r=Tt();let{annotation:i}=e,{editor:a}=e,{style:s}=e,{target:l}=e,{transform:c}=e,{viewportScale:d}=e,u;return Nt(()=>(n(6,u=new a({target:l,props:{shape:i.target.selector,computedStyle:o,transform:c,viewportScale:d}})),u.$on("change",p=>{u.$$set({shape:p.detail}),r("change",p.detail)}),u.$on("grab",p=>r("grab",p.detail)),u.$on("release",p=>r("release",p.detail)),()=>{u.$destroy()})),t.$$set=p=>{"annotation"in p&&n(0,i=p.annotation),"editor"in p&&n(1,a=p.editor),"style"in p&&n(2,s=p.style),"target"in p&&n(3,l=p.target),"transform"in p&&n(4,c=p.transform),"viewportScale"in p&&n(5,d=p.viewportScale)},t.$$.update=()=>{t.$$.dirty&5&&(o=Kt(i,s)),t.$$.dirty&65&&i&&u?.$set({shape:i.target.selector}),t.$$.dirty&80&&u&&u.$set({transform:c}),t.$$.dirty&96&&u&&u.$set({viewportScale:d})},[i,a,s,l,c,d,u]}class zo extends ot{constructor(e){super(),nt(this,e,Fo,null,K,{annotation:0,editor:1,style:2,target:3,transform:4,viewportScale:5})}}function qo(t,e,n){const o=Tt();let{drawingMode:r}=e,{target:i}=e,{tool:a}=e,{transform:s}=e,{viewportScale:l}=e,c;return Nt(()=>{const d=i.closest("svg"),u=[],p=(h,m,v)=>{d?.addEventListener(h,m,v),u.push(()=>d?.removeEventListener(h,m,v))};return n(5,c=new a({target:i,props:{addEventListener:p,drawingMode:r,transform:s,viewportScale:l}})),c.$on("create",h=>o("create",h.detail)),()=>{u.forEach(h=>h()),c.$destroy()}}),t.$$set=d=>{"drawingMode"in d&&n(0,r=d.drawingMode),"target"in d&&n(1,i=d.target),"tool"in d&&n(2,a=d.tool),"transform"in d&&n(3,s=d.transform),"viewportScale"in d&&n(4,l=d.viewportScale)},t.$$.update=()=>{t.$$.dirty&40&&c&&c.$set({transform:s}),t.$$.dirty&48&&c&&c.$set({viewportScale:l})},[r,i,a,s,l,c]}class Ko extends ot{constructor(e){super(),nt(this,e,qo,null,K,{drawingMode:0,target:1,tool:2,transform:3,viewportScale:4})}}function Ye(t){let e,n;return{c(){e=N("rect"),n=N("rect"),f(e,"class","a9s-outer"),f(e,"x",t[1]),f(e,"y",t[2]),f(e,"width",t[3]),f(e,"height",t[4]),f(n,"class","a9s-inner"),f(n,"x",t[1]),f(n,"y",t[2]),f(n,"width",t[3]),f(n,"height",t[4])},m(o,r){L(o,e,r),L(o,n,r)},p(o,r){r&2&&f(e,"x",o[1]),r&4&&f(e,"y",o[2]),r&8&&f(e,"width",o[3]),r&16&&f(e,"height",o[4]),r&2&&f(n,"x",o[1]),r&4&&f(n,"y",o[2]),r&8&&f(n,"width",o[3]),r&16&&f(n,"height",o[4])},d(o){o&&(O(e),O(n))}}}function Wo(t){let e,n=t[0]&&Ye(t);return{c(){e=N("g"),n&&n.c(),f(e,"class","a9s-annotation a9s-rubberband")},m(o,r){L(o,e,r),n&&n.m(e,null)},p(o,[r]){o[0]?n?n.p(o,r):(n=Ye(o),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},i:j,o:j,d(o){o&&O(e),n&&n.d()}}}function Jo(t,e,n){const o=Tt();let{addEventListener:r}=e,{drawingMode:i}=e,{transform:a}=e,s,l,c,d,u,p,h;const m=w=>{const y=w;s=performance.now(),i==="drag"&&(n(0,l=a.elementToImage(y.offsetX,y.offsetY)),c=l,n(1,d=l[0]),n(2,u=l[1]),n(3,p=1),n(4,h=1))},v=w=>{const y=w;l&&(c=a.elementToImage(y.offsetX,y.offsetY),n(1,d=Math.min(c[0],l[0])),n(2,u=Math.min(c[1],l[1])),n(3,p=Math.abs(c[0]-l[0])),n(4,h=Math.abs(c[1]-l[1])))},S=w=>{const y=w,$=performance.now()-s;if(i==="click"){if($>300)return;l?g():(n(0,l=a.elementToImage(y.offsetX,y.offsetY)),c=l,n(1,d=l[0]),n(2,u=l[1]),n(3,p=1),n(4,h=1))}else l&&($>300||p*h>100?(y.stopPropagation(),g()):(n(0,l=void 0),c=void 0))},g=()=>{if(p*h>15){const w={type:J.RECTANGLE,geometry:{bounds:{minX:d,minY:u,maxX:d+p,maxY:u+h},x:d,y:u,w:p,h}};o("create",w)}n(0,l=void 0),c=void 0};return Nt(()=>{r("pointerdown",m),r("pointermove",v),r("pointerup",S,!0)}),t.$$set=w=>{"addEventListener"in w&&n(5,r=w.addEventListener),"drawingMode"in w&&n(6,i=w.drawingMode),"transform"in w&&n(7,a=w.transform)},[l,d,u,p,h,r,i,a]}class Qo extends ot{constructor(e){super(),nt(this,e,Jo,Wo,K,{addEventListener:5,drawingMode:6,transform:7})}}function re(t){const e=t.slice(),n=(e[2]?e[0]:[...e[0],e[1]]).map(o=>o.join(",")).join(" ");return e[16]=n,e}function Ie(t){let e,n,o,r,i,a=t[2]&&Me(t);return{c(){e=N("polygon"),o=N("polygon"),a&&a.c(),i=st(),f(e,"class","a9s-outer"),f(e,"points",n=t[16]),f(o,"class","a9s-inner"),f(o,"points",r=t[16])},m(s,l){L(s,e,l),L(s,o,l),a&&a.m(s,l),L(s,i,l)},p(s,l){l&7&&n!==(n=s[16])&&f(e,"points",n),l&7&&r!==(r=s[16])&&f(o,"points",r),s[2]?a?a.p(s,l):(a=Me(s),a.c(),a.m(i.parentNode,i)):a&&(a.d(1),a=null)},d(s){s&&(O(e),O(o),O(i)),a&&a.d(s)}}}function Me(t){let e,n,o;return{c(){e=N("rect"),f(e,"class","a9s-corner-handle"),f(e,"x",n=t[0][0][0]-t[3]/2),f(e,"y",o=t[0][0][1]-t[3]/2),f(e,"height",t[3]),f(e,"width",t[3])},m(r,i){L(r,e,i)},p(r,i){i&9&&n!==(n=r[0][0][0]-r[3]/2)&&f(e,"x",n),i&9&&o!==(o=r[0][0][1]-r[3]/2)&&f(e,"y",o),i&8&&f(e,"height",r[3]),i&8&&f(e,"width",r[3])},d(r){r&&O(e)}}}function Zo(t){let e,n=t[1]&&Ie(re(t));return{c(){e=N("g"),n&&n.c(),f(e,"class","a9s-annotation a9s-rubberband")},m(o,r){L(o,e,r),n&&n.m(e,null)},p(o,[r]){o[1]?n?n.p(re(o),r):(n=Ie(re(o)),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},i:j,o:j,d(o){o&&O(e),n&&n.d()}}}const tr=20,er=1500;function nr(t,e,n){let o;const r=Tt();let{addEventListener:i}=e,{drawingMode:a}=e,{transform:s}=e,{viewportScale:l=1}=e,c,d=[],u,p,h=!1;const m=y=>{const $=y,{timeStamp:k,offsetX:P,offsetY:D}=$;if(c={timeStamp:k,offsetX:P,offsetY:D},a==="drag"&&d.length===0){const U=s.elementToImage($.offsetX,$.offsetY);d.push(U),n(1,u=U)}},v=y=>{const $=y;if(p&&clearTimeout(p),d.length>0){if(n(1,u=s.elementToImage($.offsetX,$.offsetY)),d.length>2){const k=oe(u,d[0])*l;n(2,h=k<tr)}$.pointerType==="touch"&&(p=setTimeout(()=>{g()},er))}},S=y=>{const $=y;if(p&&clearTimeout(p),a==="click"){const k=$.timeStamp-c.timeStamp,P=oe([c.offsetX,c.offsetY],[$.offsetX,$.offsetY]);if(k>300||P>15)return;if(h)w();else if(d.length===0){const D=s.elementToImage($.offsetX,$.offsetY);d.push(D),n(1,u=D)}else d.push(u)}else{if(d.length===1&&oe(d[0],u)<=4){n(0,d=[]),n(1,u=void 0);return}$.stopImmediatePropagation(),h?w():d.push(u)}},g=()=>{if(!u)return;const y=[...d,u],$={type:J.POLYGON,geometry:{bounds:fe(y),points:y}};ue($)>4&&(n(0,d=[]),n(1,u=void 0),r("create",$))},w=()=>{const y={type:J.POLYGON,geometry:{bounds:fe(d),points:[...d]}};n(0,d=[]),n(1,u=void 0),r("create",y)};return Nt(()=>{i("pointerdown",m,!0),i("pointermove",v),i("pointerup",S,!0),i("dblclick",g,!0)}),t.$$set=y=>{"addEventListener"in y&&n(4,i=y.addEventListener),"drawingMode"in y&&n(5,a=y.drawingMode),"transform"in y&&n(6,s=y.transform),"viewportScale"in y&&n(7,l=y.viewportScale)},t.$$.update=()=>{t.$$.dirty&128&&n(3,o=10/l)},[d,u,h,o,i,a,s,l]}class or extends ot{constructor(e){super(),nt(this,e,nr,Zo,K,{addEventListener:4,drawingMode:5,transform:6,viewportScale:7})}}const ye=new Map([["rectangle",{tool:Qo}],["polygon",{tool:or}]]),ln=()=>[...ye.keys()],cn=t=>ye.get(t),rr=(t,e,n)=>ye.set(t,{tool:e,opts:n});function ir(t){let e,n,o,r,i;return{c(){e=N("g"),n=N("ellipse"),r=N("ellipse"),f(n,"class","a9s-outer"),f(n,"style",o=t[1]?"display:none;":void 0),f(n,"cx",t[2]),f(n,"cy",t[3]),f(n,"rx",t[4]),f(n,"ry",t[5]),f(r,"class","a9s-inner"),f(r,"style",t[1]),f(r,"cx",t[2]),f(r,"cy",t[3]),f(r,"rx",t[4]),f(r,"ry",t[5]),f(e,"data-id",i=t[0].id)},m(a,s){L(a,e,s),ut(e,n),ut(e,r)},p(a,[s]){s&2&&o!==(o=a[1]?"display:none;":void 0)&&f(n,"style",o),s&2&&f(r,"style",a[1]),s&1&&i!==(i=a[0].id)&&f(e,"data-id",i)},i:j,o:j,d(a){a&&O(e)}}}function ar(t,e,n){let o,{annotation:r}=e,{geom:i}=e,{style:a}=e;const{cx:s,cy:l,rx:c,ry:d}=i;return t.$$set=u=>{"annotation"in u&&n(0,r=u.annotation),"geom"in u&&n(6,i=u.geom),"style"in u&&n(7,a=u.style)},t.$$.update=()=>{t.$$.dirty&129&&n(1,o=Kt(r,a))},[r,o,s,l,c,d,i,a]}class sr extends ot{constructor(e){super(),nt(this,e,ar,ir,K,{annotation:0,geom:6,style:7})}}function lr(t){let e,n,o,r,i;return{c(){e=N("g"),n=N("polygon"),r=N("polygon"),f(n,"class","a9s-outer"),f(n,"style",o=t[1]?"display:none;":void 0),f(n,"points",t[2].map(cr).join(" ")),f(r,"class","a9s-inner"),f(r,"style",t[1]),f(r,"points",t[2].map(dr).join(" ")),f(e,"data-id",i=t[0].id)},m(a,s){L(a,e,s),ut(e,n),ut(e,r)},p(a,[s]){s&2&&o!==(o=a[1]?"display:none;":void 0)&&f(n,"style",o),s&2&&f(r,"style",a[1]),s&1&&i!==(i=a[0].id)&&f(e,"data-id",i)},i:j,o:j,d(a){a&&O(e)}}}const cr=t=>t.join(","),dr=t=>t.join(",");function ur(t,e,n){let o,{annotation:r}=e,{geom:i}=e,{style:a}=e;const{points:s}=i;return t.$$set=l=>{"annotation"in l&&n(0,r=l.annotation),"geom"in l&&n(3,i=l.geom),"style"in l&&n(4,a=l.style)},t.$$.update=()=>{t.$$.dirty&17&&n(1,o=Kt(r,a))},[r,o,s,i,a]}class fr extends ot{constructor(e){super(),nt(this,e,ur,lr,K,{annotation:0,geom:3,style:4})}}function hr(t){let e,n,o,r,i;return{c(){e=N("g"),n=N("rect"),r=N("rect"),f(n,"class","a9s-outer"),f(n,"style",o=t[5]?"display:none;":void 0),f(n,"x",t[4]),f(n,"y",t[3]),f(n,"width",t[2]),f(n,"height",t[1]),f(r,"class","a9s-inner"),f(r,"style",t[5]),f(r,"x",t[4]),f(r,"y",t[3]),f(r,"width",t[2]),f(r,"height",t[1]),f(e,"data-id",i=t[0].id)},m(a,s){L(a,e,s),ut(e,n),ut(e,r)},p(a,[s]){s&32&&o!==(o=a[5]?"display:none;":void 0)&&f(n,"style",o),s&16&&f(n,"x",a[4]),s&8&&f(n,"y",a[3]),s&4&&f(n,"width",a[2]),s&2&&f(n,"height",a[1]),s&32&&f(r,"style",a[5]),s&16&&f(r,"x",a[4]),s&8&&f(r,"y",a[3]),s&4&&f(r,"width",a[2]),s&2&&f(r,"height",a[1]),s&1&&i!==(i=a[0].id)&&f(e,"data-id",i)},i:j,o:j,d(a){a&&O(e)}}}function pr(t,e,n){let o,r,i,a,s,{annotation:l}=e,{geom:c}=e,{style:d}=e;return t.$$set=u=>{"annotation"in u&&n(0,l=u.annotation),"geom"in u&&n(6,c=u.geom),"style"in u&&n(7,d=u.style)},t.$$.update=()=>{t.$$.dirty&129&&n(5,o=Kt(l,d)),t.$$.dirty&64&&n(4,{x:r,y:i,w:a,h:s}=c,r,(n(3,i),n(6,c)),(n(2,a),n(6,c)),(n(1,s),n(6,c)))},[l,s,a,i,r,o,c,d]}class mr extends ot{constructor(e){super(),nt(this,e,pr,hr,K,{annotation:0,geom:6,style:7})}}const gr=t=>({elementToImage:(e,n)=>{const o=t.getBoundingClientRect(),r=t.createSVGPoint();r.x=e+o.x,r.y=n+o.y;const{x:i,y:a}=r.matrixTransform(t.getScreenCTM().inverse());return[i,a]}}),yr=250,wr=(t,e)=>{const n=Tt();let o;return{onPointerDown:()=>o=performance.now(),onPointerUp:r=>{if(performance.now()-o<yr){const{x:i,y:a}=dn(r,t),s=e.getAt(i,a);s?n("click",{originalEvent:r,annotation:s}):n("click",{originalEvent:r})}}}},dn=(t,e)=>{const n=e.createSVGPoint(),o=e.getBoundingClientRect(),r=t.clientX-o.x,i=t.clientY-o.y,{left:a,top:s}=e.getBoundingClientRect();return n.x=r+a,n.y=i+s,n.matrixTransform(e.getScreenCTM().inverse())},{Boolean:un}=Rn;function Re(t,e,n){const o=t.slice();o[34]=e[n];const r=o[23](o[34].target.selector);return o[35]=r,o}function ke(t,e,n){const o=t.slice();return o[38]=e[n],o}function ie(t){const e=t.slice(),n=e[38].target.selector;return e[41]=n,e}function Ce(t){let e=t[38].id,n,o,r=Ne(t);return{c(){r.c(),n=st()},m(i,a){r.m(i,a),L(i,n,a),o=!0},p(i,a){a[0]&32768&&K(e,e=i[38].id)?(it(),C(r,1,1,j),at(),r=Ne(i),r.c(),Y(r,1),r.m(n.parentNode,n)):r.p(i,a)},i(i){o||(Y(r),o=!0)},o(i){C(r),o=!1},d(i){i&&O(n),r.d(i)}}}function $r(t){let e,n;return e=new fr({props:{annotation:t[38],geom:t[41].geometry,style:t[1]}}),{c(){et(e.$$.fragment)},m(o,r){Z(e,o,r),n=!0},p(o,r){const i={};r[0]&32768&&(i.annotation=o[38]),r[0]&32768&&(i.geom=o[41].geometry),r[0]&2&&(i.style=o[1]),e.$set(i)},i(o){n||(Y(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){tt(e,o)}}}function vr(t){let e,n;return e=new mr({props:{annotation:t[38],geom:t[41].geometry,style:t[1]}}),{c(){et(e.$$.fragment)},m(o,r){Z(e,o,r),n=!0},p(o,r){const i={};r[0]&32768&&(i.annotation=o[38]),r[0]&32768&&(i.geom=o[41].geometry),r[0]&2&&(i.style=o[1]),e.$set(i)},i(o){n||(Y(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){tt(e,o)}}}function br(t){var e;let n,o;return n=new sr({props:{annotation:t[38],geom:(e=t[41])==null?void 0:e.geometry,style:t[1]}}),{c(){et(n.$$.fragment)},m(r,i){Z(n,r,i),o=!0},p(r,i){var a;const s={};i[0]&32768&&(s.annotation=r[38]),i[0]&32768&&(s.geom=(a=r[41])==null?void 0:a.geometry),i[0]&2&&(s.style=r[1]),n.$set(s)},i(r){o||(Y(n.$$.fragment,r),o=!0)},o(r){C(n.$$.fragment,r),o=!1},d(r){tt(n,r)}}}function Ne(t){let e,n,o,r;const i=[br,vr,$r],a=[];function s(l,c){var d,u,p;return((d=l[41])==null?void 0:d.type)===J.ELLIPSE?0:((u=l[41])==null?void 0:u.type)===J.RECTANGLE?1:((p=l[41])==null?void 0:p.type)===J.POLYGON?2:-1}return~(e=s(t))&&(n=a[e]=i[e](t)),{c(){n&&n.c(),o=st()},m(l,c){~e&&a[e].m(l,c),L(l,o,c),r=!0},p(l,c){let d=e;e=s(l),e===d?~e&&a[e].p(l,c):(n&&(it(),C(a[d],1,1,()=>{a[d]=null}),at()),~e?(n=a[e],n?n.p(l,c):(n=a[e]=i[e](l),n.c()),Y(n,1),n.m(o.parentNode,o)):n=null)},i(l){r||(Y(n),r=!0)},o(l){C(n),r=!1},d(l){l&&O(o),~e&&a[e].d(l)}}}function Pe(t){let e=!t[8](t[38]),n,o,r=e&&Ce(ie(t));return{c(){r&&r.c(),n=st()},m(i,a){r&&r.m(i,a),L(i,n,a),o=!0},p(i,a){a[0]&33024&&(e=!i[8](i[38])),e?r?(r.p(ie(i),a),a[0]&33024&&Y(r,1)):(r=Ce(ie(i)),r.c(),Y(r,1),r.m(n.parentNode,n)):r&&(it(),C(r,1,1,()=>{r=null}),at())},i(i){o||(Y(r),o=!0)},o(i){C(r),o=!1},d(i){i&&O(n),r&&r.d(i)}}}function Ve(t){let e,n,o,r;const i=[Ar,xr],a=[];function s(l,c){return l[7]?0:l[13]&&l[0]?1:-1}return~(e=s(t))&&(n=a[e]=i[e](t)),{c(){n&&n.c(),o=st()},m(l,c){~e&&a[e].m(l,c),L(l,o,c),r=!0},p(l,c){let d=e;e=s(l),e===d?~e&&a[e].p(l,c):(n&&(it(),C(a[d],1,1,()=>{a[d]=null}),at()),~e?(n=a[e],n?n.p(l,c):(n=a[e]=i[e](l),n.c()),Y(n,1),n.m(o.parentNode,o)):n=null)},i(l){r||(Y(n),r=!0)},o(l){C(n),r=!1},d(l){l&&O(o),~e&&a[e].d(l)}}}function xr(t){let e=t[2],n,o,r=De(t);return{c(){r.c(),n=st()},m(i,a){r.m(i,a),L(i,n,a),o=!0},p(i,a){a[0]&4&&K(e,e=i[2])?(it(),C(r,1,1,j),at(),r=De(i),r.c(),Y(r,1),r.m(n.parentNode,n)):r.p(i,a)},i(i){o||(Y(r),o=!0)},o(i){C(r),o=!1},d(i){i&&O(n),r.d(i)}}}function Ar(t){let e,n,o=St(t[7]),r=[];for(let a=0;a<o.length;a+=1)r[a]=je(Re(t,o,a));const i=a=>C(r[a],1,1,()=>{r[a]=null});return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=st()},m(a,s){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(a,s);L(a,e,s),n=!0},p(a,s){if(s[0]&10553506){o=St(a[7]);let l;for(l=0;l<o.length;l+=1){const c=Re(a,o,l);r[l]?(r[l].p(c,s),Y(r[l],1)):(r[l]=je(c),r[l].c(),Y(r[l],1),r[l].m(e.parentNode,e))}for(it(),l=o.length;l<r.length;l+=1)i(l);at()}},i(a){if(!n){for(let s=0;s<o.length;s+=1)Y(r[s]);n=!0}},o(a){r=r.filter(un);for(let s=0;s<r.length;s+=1)C(r[s]);n=!1},d(a){a&&O(e),he(r,a)}}}function De(t){let e,n;return e=new Ko({props:{target:t[5],tool:t[13],drawingMode:t[12],transform:t[11],viewportScale:t[16]}}),e.$on("create",t[20]),{c(){et(e.$$.fragment)},m(o,r){Z(e,o,r),n=!0},p(o,r){const i={};r[0]&32&&(i.target=o[5]),r[0]&8192&&(i.tool=o[13]),r[0]&4096&&(i.drawingMode=o[12]),r[0]&2048&&(i.transform=o[11]),r[0]&65536&&(i.viewportScale=o[16]),e.$set(i)},i(o){n||(Y(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){tt(e,o)}}}function Ue(t){let e=t[34].id,n,o,r=Xe(t);return{c(){r.c(),n=st()},m(i,a){r.m(i,a),L(i,n,a),o=!0},p(i,a){a[0]&128&&K(e,e=i[34].id)?(it(),C(r,1,1,j),at(),r=Xe(i),r.c(),Y(r,1),r.m(n.parentNode,n)):r.p(i,a)},i(i){o||(Y(r),o=!0)},o(i){C(r),o=!1},d(i){i&&O(n),r.d(i)}}}function Xe(t){let e,n;return e=new zo({props:{target:t[5],editor:t[23](t[34].target.selector),annotation:t[34],style:t[1],transform:t[11],viewportScale:t[16]}}),e.$on("change",function(){F(t[21](t[34]))&&t[21](t[34]).apply(this,arguments)}),{c(){et(e.$$.fragment)},m(o,r){Z(e,o,r),n=!0},p(o,r){t=o;const i={};r[0]&32&&(i.target=t[5]),r[0]&128&&(i.editor=t[23](t[34].target.selector)),r[0]&128&&(i.annotation=t[34]),r[0]&2&&(i.style=t[1]),r[0]&2048&&(i.transform=t[11]),r[0]&65536&&(i.viewportScale=t[16]),e.$set(i)},i(o){n||(Y(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){tt(e,o)}}}function je(t){let e,n,o=t[35]&&Ue(t);return{c(){o&&o.c(),e=st()},m(r,i){o&&o.m(r,i),L(r,e,i),n=!0},p(r,i){r[35]?o?(o.p(r,i),i[0]&128&&Y(o,1)):(o=Ue(r),o.c(),Y(o,1),o.m(e.parentNode,e)):o&&(it(),C(o,1,1,()=>{o=null}),at())},i(r){n||(Y(o),n=!0)},o(r){C(o),n=!1},d(r){r&&O(e),o&&o.d(r)}}}function Er(t){let e,n,o,r,i,a,s=St(t[15]),l=[];for(let u=0;u<s.length;u+=1)l[u]=Pe(ke(t,s,u));const c=u=>C(l[u],1,1,()=>{l[u]=null});let d=t[5]&&Ve(t);return{c(){e=N("svg"),n=N("g");for(let u=0;u<l.length;u+=1)l[u].c();o=N("g"),d&&d.c(),f(o,"class","drawing"),f(e,"class","a9s-annotationlayer"),pt(e,"drawing",t[13]),pt(e,"hidden",!t[3]),pt(e,"hover",t[14])},m(u,p){L(u,e,p),ut(e,n);for(let h=0;h<l.length;h+=1)l[h]&&l[h].m(n,null);ut(e,o),d&&d.m(o,null),t[30](o),t[31](e),r=!0,i||(a=[H(e,"pointerup",function(){F(t[9])&&t[9].apply(this,arguments)}),H(e,"pointerdown",function(){F(t[10])&&t[10].apply(this,arguments)}),H(e,"pointermove",t[22])],i=!0)},p(u,p){if(t=u,p[0]&33026){s=St(t[15]);let h;for(h=0;h<s.length;h+=1){const m=ke(t,s,h);l[h]?(l[h].p(m,p),Y(l[h],1)):(l[h]=Pe(m),l[h].c(),Y(l[h],1),l[h].m(n,null))}for(it(),h=s.length;h<l.length;h+=1)c(h);at()}t[5]?d?(d.p(t,p),p[0]&32&&Y(d,1)):(d=Ve(t),d.c(),Y(d,1),d.m(o,null)):d&&(it(),C(d,1,1,()=>{d=null}),at()),(!r||p[0]&8192)&&pt(e,"drawing",t[13]),(!r||p[0]&8)&&pt(e,"hidden",!t[3]),(!r||p[0]&16384)&&pt(e,"hover",t[14])},i(u){if(!r){for(let p=0;p<s.length;p+=1)Y(l[p]);Y(d),r=!0}},o(u){l=l.filter(un);for(let p=0;p<l.length;p+=1)C(l[p]);C(d),r=!1},d(u){u&&O(e),he(l,u),d&&d.d(),t[30](null),t[31](null),i=!1,ft(a)}}}function Sr(t,e,n){let o,r,i,a,s,l,c,d,u,p,h,m=j,v=()=>(m(),m=Qe(b,_=>n(16,h=_)),b);t.$$.on_destroy.push(()=>m());let{drawingEnabled:S}=e,{image:g}=e,{preferredDrawingMode:w}=e,{state:y}=e,{style:$=void 0}=e,{toolName:k=ln()[0]}=e,{user:P}=e,{visible:D=!0}=e,U,I,b;Nt(()=>v(n(6,b=Yo(g,I))));const{hover:x,selection:A,store:E}=y;Jt(t,x,_=>n(14,d=_)),Jt(t,A,_=>n(29,u=_)),Jt(t,E,_=>n(15,p=_));let M,V;const Q=_=>{M&&E.unobserve(M);const G=_.filter(({editable:B})=>B).map(({id:B})=>B);G.length>0?(n(7,V=G.map(B=>E.getAnnotation(B)).filter(Boolean)),M=B=>{const{updated:q}=B.changes;n(7,V=q?.map(yt=>yt.newValue))},E.observe(M,{annotations:G})):n(7,V=void 0)},_t=_=>{const G=Jn(),B={id:G,bodies:[],target:{annotation:G,selector:_.detail,creator:P,created:new Date}};E.addAnnotation(B),A.setSelected(B.id)},lt=_=>G=>{var B;const{target:q}=_,yt=10*60*1e3,R=((B=q.creator)==null?void 0:B.id)!==P.id||!q.created||new Date().getTime()-q.created.getTime()>yt;E.updateTarget({...q,selector:G.detail,created:R?q.created:new Date,updated:R?new Date:void 0,updatedBy:R?P:void 0})},Ot=_=>{const{x:G,y:B}=dn(_,I),q=E.getAt(G,B);q?d!==q.id&&x.set(q.id):x.set(void 0)},ct=_=>Uo(_);function Lt(_){zt[_?"unshift":"push"](()=>{U=_,n(5,U)})}function dt(_){zt[_?"unshift":"push"](()=>{I=_,n(4,I)})}return t.$$set=_=>{"drawingEnabled"in _&&n(0,S=_.drawingEnabled),"image"in _&&n(24,g=_.image),"preferredDrawingMode"in _&&n(25,w=_.preferredDrawingMode),"state"in _&&n(26,y=_.state),"style"in _&&n(1,$=_.style),"toolName"in _&&n(2,k=_.toolName),"user"in _&&n(27,P=_.user),"visible"in _&&n(3,D=_.visible)},t.$$.update=()=>{t.$$.dirty[0]&4&&n(13,{tool:o,opts:r}=cn(k)||{tool:void 0,opts:void 0},o,(n(28,r),n(2,k))),t.$$.dirty[0]&301989888&&n(12,i=r?.drawingMode||w),t.$$.dirty[0]&16&&n(11,a=gr(I)),t.$$.dirty[0]&16&&n(10,{onPointerDown:s,onPointerUp:l}=wr(I,E),s,(n(9,l),n(4,I))),t.$$.dirty[0]&536870912&&n(8,c=_=>u.selected.find(G=>G.id===_.id&&G.editable)),t.$$.dirty[0]&536870912&&Q(u.selected)},[S,$,k,D,I,U,b,V,c,l,s,a,i,o,d,p,h,x,A,E,_t,lt,Ot,ct,g,w,y,P,r,u,Lt,dt]}class Tr extends ot{constructor(e){super(),nt(this,e,Sr,Er,K,{drawingEnabled:0,image:24,preferredDrawingMode:25,state:26,style:1,toolName:2,user:27,visible:3},null,[-1,-1])}}function _r(t,e,n,o,r){fn(t,e,n||0,o||t.length-1,r||Or)}function fn(t,e,n,o,r){for(;o>n;){if(o-n>600){var i=o-n+1,a=e-n+1,s=Math.log(i),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(i-l)/i)*(a-i/2<0?-1:1),d=Math.max(n,Math.floor(e-a*l/i+c)),u=Math.min(o,Math.floor(e+(i-a)*l/i+c));fn(t,e,d,u,r)}var p=t[e],h=n,m=o;for(Yt(t,n,e),r(t[o],p)>0&&Yt(t,n,o);h<m;){for(Yt(t,h,m),h++,m--;r(t[h],p)<0;)h++;for(;r(t[m],p)>0;)m--}r(t[n],p)===0?Yt(t,n,m):(m++,Yt(t,m,o)),m<=e&&(n=m+1),e<=m&&(o=m-1)}}function Yt(t,e,n){var o=t[e];t[e]=t[n],t[n]=o}function Or(t,e){return t<e?-1:t>e?1:0}class Lr{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let n=this.data;const o=[];if(!Gt(e,n))return o;const r=this.toBBox,i=[];for(;n;){for(let a=0;a<n.children.length;a++){const s=n.children[a],l=n.leaf?r(s):s;Gt(e,l)&&(n.leaf?o.push(s):se(e,l)?this._all(s,o):i.push(s))}n=i.pop()}return o}collides(e){let n=this.data;if(!Gt(e,n))return!1;const o=[];for(;n;){for(let r=0;r<n.children.length;r++){const i=n.children[r],a=n.leaf?this.toBBox(i):i;if(Gt(e,a)){if(n.leaf||se(e,a))return!0;o.push(i)}}n=o.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let o=0;o<e.length;o++)this.insert(e[o]);return this}let n=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){const o=this.data;this.data=n,n=o}this._insert(n,this.data.height-n.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=At([]),this}remove(e,n){if(!e)return this;let o=this.data;const r=this.toBBox(e),i=[],a=[];let s,l,c;for(;o||i.length;){if(o||(o=i.pop(),l=i[i.length-1],s=a.pop(),c=!0),o.leaf){const d=Br(e,o.children,n);if(d!==-1)return o.children.splice(d,1),i.push(o),this._condense(i),this}!c&&!o.leaf&&se(o,r)?(i.push(o),a.push(s),s=0,l=o,o=o.children[0]):l?(s++,o=l.children[s],c=!1):o=null}return this}toBBox(e){return e}compareMinX(e,n){return e.minX-n.minX}compareMinY(e,n){return e.minY-n.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,n){const o=[];for(;e;)e.leaf?n.push(...e.children):o.push(...e.children),e=o.pop();return n}_build(e,n,o,r){const i=o-n+1;let a=this._maxEntries,s;if(i<=a)return s=At(e.slice(n,o+1)),bt(s,this.toBBox),s;r||(r=Math.ceil(Math.log(i)/Math.log(a)),a=Math.ceil(i/Math.pow(a,r-1))),s=At([]),s.leaf=!1,s.height=r;const l=Math.ceil(i/a),c=l*Math.ceil(Math.sqrt(a));Ge(e,n,o,c,this.compareMinX);for(let d=n;d<=o;d+=c){const u=Math.min(d+c-1,o);Ge(e,d,u,l,this.compareMinY);for(let p=d;p<=u;p+=l){const h=Math.min(p+l-1,u);s.children.push(this._build(e,p,h,r-1))}}return bt(s,this.toBBox),s}_chooseSubtree(e,n,o,r){for(;r.push(n),!(n.leaf||r.length-1===o);){let i=1/0,a=1/0,s;for(let l=0;l<n.children.length;l++){const c=n.children[l],d=ae(c),u=Mr(e,c)-d;u<a?(a=u,i=d<i?d:i,s=c):u===a&&d<i&&(i=d,s=c)}n=s||n.children[0]}return n}_insert(e,n,o){const r=o?e:this.toBBox(e),i=[],a=this._chooseSubtree(r,this.data,n,i);for(a.children.push(e),Rt(a,r);n>=0&&i[n].children.length>this._maxEntries;)this._split(i,n),n--;this._adjustParentBBoxes(r,i,n)}_split(e,n){const o=e[n],r=o.children.length,i=this._minEntries;this._chooseSplitAxis(o,i,r);const a=this._chooseSplitIndex(o,i,r),s=At(o.children.splice(a,o.children.length-a));s.height=o.height,s.leaf=o.leaf,bt(o,this.toBBox),bt(s,this.toBBox),n?e[n-1].children.push(s):this._splitRoot(o,s)}_splitRoot(e,n){this.data=At([e,n]),this.data.height=e.height+1,this.data.leaf=!1,bt(this.data,this.toBBox)}_chooseSplitIndex(e,n,o){let r,i=1/0,a=1/0;for(let s=n;s<=o-n;s++){const l=Mt(e,0,s,this.toBBox),c=Mt(e,s,o,this.toBBox),d=Rr(l,c),u=ae(l)+ae(c);d<i?(i=d,r=s,a=u<a?u:a):d===i&&u<a&&(a=u,r=s)}return r||o-n}_chooseSplitAxis(e,n,o){const r=e.leaf?this.compareMinX:Yr,i=e.leaf?this.compareMinY:Ir,a=this._allDistMargin(e,n,o,r),s=this._allDistMargin(e,n,o,i);a<s&&e.children.sort(r)}_allDistMargin(e,n,o,r){e.children.sort(r);const i=this.toBBox,a=Mt(e,0,n,i),s=Mt(e,o-n,o,i);let l=jt(a)+jt(s);for(let c=n;c<o-n;c++){const d=e.children[c];Rt(a,e.leaf?i(d):d),l+=jt(a)}for(let c=o-n-1;c>=n;c--){const d=e.children[c];Rt(s,e.leaf?i(d):d),l+=jt(s)}return l}_adjustParentBBoxes(e,n,o){for(let r=o;r>=0;r--)Rt(n[r],e)}_condense(e){for(let n=e.length-1,o;n>=0;n--)e[n].children.length===0?n>0?(o=e[n-1].children,o.splice(o.indexOf(e[n]),1)):this.clear():bt(e[n],this.toBBox)}}function Br(t,e,n){if(!n)return e.indexOf(t);for(let o=0;o<e.length;o++)if(n(t,e[o]))return o;return-1}function bt(t,e){Mt(t,0,t.children.length,e,t)}function Mt(t,e,n,o,r){r||(r=At(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let i=e;i<n;i++){const a=t.children[i];Rt(r,t.leaf?o(a):a)}return r}function Rt(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Yr(t,e){return t.minX-e.minX}function Ir(t,e){return t.minY-e.minY}function ae(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function jt(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Mr(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function Rr(t,e){const n=Math.max(t.minX,e.minX),o=Math.max(t.minY,e.minY),r=Math.min(t.maxX,e.maxX),i=Math.min(t.maxY,e.maxY);return Math.max(0,r-n)*Math.max(0,i-o)}function se(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Gt(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function At(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ge(t,e,n,o,r){const i=[e,n];for(;i.length;){if(n=i.pop(),e=i.pop(),n-e<=o)continue;const a=e+Math.ceil((n-e)/o/2)*o;_r(t,a,e,n,r),i.push(e,a,a,n)}}const kr=()=>{const t=new Lr,e=new Map,n=()=>[...e.values()],o=()=>{t.clear(),e.clear()},r=a=>{const{minX:s,minY:l,maxX:c,maxY:d}=a.selector.geometry.bounds,u={minX:s,minY:l,maxX:c,maxY:d,target:a};t.insert(u),e.set(a.annotation,u)},i=a=>{const s=e.get(a.annotation);s&&t.remove(s),e.delete(a.annotation)};return{all:n,clear:o,getAt:(a,s)=>{const l=t.search({minX:a,minY:s,maxX:a,maxY:s}).map(c=>c.target).filter(c=>c.selector.type===J.RECTANGLE||jn(c.selector,a,s));if(l.length>0)return l.sort((c,d)=>ue(c.selector)-ue(d.selector)),l[0]},getIntersecting:(a,s,l,c)=>t.search({minX:a,minY:s,maxX:a+l,maxY:s+c}).map(d=>d.target),insert:r,remove:i,set:(a,s=!0)=>{s&&o();const l=a.reduce((c,d)=>{var u,p;if((p=(u=d.selector)==null?void 0:u.geometry)!=null&&p.bounds){const{minX:h,minY:m,maxX:v,maxY:S}=d.selector.geometry.bounds;return[...c,{minX:h,minY:m,maxX:v,maxY:S,target:d}]}else return c},[]);l.forEach(c=>e.set(c.target.annotation,c)),t.load(l)},size:()=>t.all().length,update:(a,s)=>{i(a),r(s)}}},Cr=t=>{const e=co(),n=kr(),o=to(e,t.userSelectAction),r=Zn(e),i=mo();return e.observe(({changes:a})=>{n.set((a.created||[]).map(s=>s.target),!1),(a.deleted||[]).forEach(s=>n.remove(s.target)),(a.updated||[]).forEach(({oldValue:s,newValue:l})=>n.update(s.target,l.target))}),{store:{...e,getAt:(a,s)=>{const l=n.getAt(a,s);return l?e.getAnnotation(l.annotation):void 0},getIntersecting:(a,s,l,c)=>n.getIntersecting(a,s,l,c).map(d=>e.getAnnotation(d.annotation))},selection:o,hover:r,viewport:i}},Nr=t=>{const e=Cr(t);return{...e,store:uo(e.store)}},Pr=t=>{let e,n;if(t.nodeName==="CANVAS")e=t,n=e.getContext("2d",{willReadFrequently:!0});else{const r=t;e=document.createElement("canvas"),e.width=r.width,e.height=r.height,n=e.getContext("2d",{willReadFrequently:!0}),n.drawImage(r,0,0,r.width,r.height)}let o=0;for(let r=1;r<10;r++)for(let i=1;i<10;i++){const a=Math.round(i*e.width/10),s=Math.round(r*e.height/10),l=n.getImageData(a,s,1,1).data,c=(.299*l[0]+.587*l[1]+.114*l[2])/255;o+=c}return o/81},Vr=t=>{const e=Pr(t),n=e>.6?"dark":"light";return console.log(`[Annotorious] Image brightness: ${e.toFixed(1)}. Setting ${n} theme.`),n},He=(t,e,n)=>e.setAttribute("data-theme",n==="auto"?Vr(t):n),Dr=(t,e)=>({...t,drawingEnabled:t.drawingEnabled===void 0?e.drawingEnabled:t.drawingEnabled,drawingMode:t.drawingMode||e.drawingMode,userSelectAction:t.userSelectAction||e.userSelectAction,theme:t.theme||e.theme}),Fe=navigator.userAgent.indexOf("Mac OS X")!==-1,Ur=(t,e)=>{const n=document,o=a=>{const s=a;s.key==="z"&&s.ctrlKey?t.undo():s.key==="y"&&s.ctrlKey&&t.redo()},r=a=>{const s=a;s.key==="z"&&s.metaKey&&(s.shiftKey?t.redo():t.undo())},i=()=>{Fe?n.removeEventListener("keydown",r):n.removeEventListener("keydown",o)};return Fe?n.addEventListener("keydown",r):n.addEventListener("keydown",o),{destroy:i}},Kr=(t,e={})=>{if(!t)throw"Missing argument: image";const n=typeof t=="string"?document.getElementById(t):t,o=Dr(e,{drawingEnabled:!0,drawingMode:"drag",userSelectAction:on.EDIT,theme:"light"}),r=Nr(o),{selection:i,store:a}=r,s=po(a),l=go(r,s,o.adapter,o.autoSave),c=document.createElement("DIV");c.style.position="relative",c.style.display="inline-block",n.style.display="block",n.parentNode.insertBefore(c,n),c.appendChild(n);const d=Ur(s);let u=Eo();He(n,c,o.theme);const p=new Tr({target:c,props:{drawingEnabled:!!o.drawingEnabled,image:n,preferredDrawingMode:o.drawingMode,state:r,style:o.style,user:u}});p.$on("click",I=>{const{originalEvent:b,annotation:x}=I.detail;x?i.userSelect(x.id,b):i.isEmpty()||i.clear()});const h=wo(r,s,o.adapter),m=()=>{p.$destroy(),c.parentNode.insertBefore(n,c),c.parentNode.removeChild(c),d.destroy(),s.destroy()},v=()=>u,S=(I,b,x)=>rr(I,b,x),g=(I,b)=>Xo(I,b),w=I=>{if(!cn(I))throw`No drawing tool named ${I}`;p.$set({toolName:I})},y=I=>p.$set({drawingEnabled:I}),$=I=>{console.warn("Filter not implemented yet")},k=I=>p.$set({style:I}),P=I=>He(n,c,I),D=I=>{u=I,p.$set({user:I})},U=I=>p.$set({visible:I});return{...h,destroy:m,getUser:v,listDrawingTools:ln,on:l.on,off:l.off,registerDrawingTool:S,registerShapeEditor:g,setDrawingEnabled:y,setDrawingTool:w,setFilter:$,setStyle:k,setTheme:P,setUser:D,setVisible:U,element:c,state:r}},Wr=J;/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xr=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),hn=(...t)=>t.filter((e,n,o)=>!!e&&o.indexOf(e)===n).join(" ");/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var jr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=W.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:o,className:r="",children:i,iconNode:a,...s},l)=>W.createElement("svg",{ref:l,...jr,width:e,height:e,stroke:t,strokeWidth:o?Number(n)*24/Number(e):n,className:hn("lucide",r),...s},[...a.map(([c,d])=>W.createElement(c,d)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=(t,e)=>{const n=W.forwardRef(({className:o,...r},i)=>W.createElement(Gr,{ref:i,iconNode:e,className:hn(`lucide-${Xr(t)}`,o),...r}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=pn("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qr=pn("TriangleRight",[["path",{d:"M22 18a2 2 0 0 1-2 2H3c-1.1 0-1.3-.6-.4-1.3L20.4 4.3c.9-.7 1.6-.4 1.6.7Z",key:"183wce"}]]);export{zr as K,qr as L,Kr as R,Jr as S,Qr as T,pn as a,Wr as b,We as c,Fr as j,An as m};
