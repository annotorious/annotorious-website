import{b as td,c as id,m as Zh,a as sd,j as dt,K as nd,L as rd,S as od,T as ad}from"./annotorious-react.CjWEFx98.js";import{c as ld,g as hd,r as st}from"./index.Cn5qh0VW.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ud=td("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]);var Kh={exports:{}};(function(n){//! openseadragon 4.1.1
//! Built on 2024-04-01
//! Git commit: v4.1.1-0-f90d9814
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function e(t){return new e.Viewer(t)}(function(t){t.version={versionStr:"4.1.1",major:parseInt("4",10),minor:parseInt("1",10),revision:parseInt("1",10)};var i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object AsyncFunction]":"function","[object Promise]":"promise","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},s=Object.prototype.toString,r=Object.prototype.hasOwnProperty;t.isFunction=function(a){return t.type(a)==="function"},t.isArray=Array.isArray||function(a){return t.type(a)==="array"},t.isWindow=function(a){return a&&typeof a=="object"&&"setInterval"in a},t.type=function(a){return a==null?String(a):i[s.call(a)]||"object"},t.isPlainObject=function(a){if(!a||e.type(a)!=="object"||a.nodeType||t.isWindow(a)||a.constructor&&!r.call(a,"constructor")&&!r.call(a.constructor.prototype,"isPrototypeOf"))return!1;var o;for(var l in a)o=l;return o===void 0||r.call(a,o)},t.isEmptyObject=function(a){for(var o in a)return!1;return!0},t.freezeObject=function(a){return Object.freeze?t.freezeObject=Object.freeze:t.freezeObject=function(o){return o},t.freezeObject(a)},t.supportsCanvas=function(){var a=document.createElement("canvas");return!!(t.isFunction(a.getContext)&&a.getContext("2d"))}(),t.isCanvasTainted=function(a){var o=!1;try{a.getContext("2d").getImageData(0,0,1,1)}catch{o=!0}return o},t.supportsAddEventListener=function(){return!!(document.documentElement.addEventListener&&document.addEventListener)}(),t.supportsRemoveEventListener=function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)}(),t.supportsEventListenerOptions=function(){var a=0;if(t.supportsAddEventListener)try{var o={get capture(){return a++,!1},get once(){return a++,!1},get passive(){return a++,!1}};window.addEventListener("test",null,o),window.removeEventListener("test",null,o)}catch{a=0}return a>=3}(),t.getCurrentPixelDensityRatio=function(){if(t.supportsCanvas){var a=document.createElement("canvas").getContext("2d"),o=window.devicePixelRatio||1,l=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;return Math.max(o,1)/l}else return 1},t.pixelDensityRatio=t.getCurrentPixelDensityRatio()})(e),function(t){t.extend=function(){var l,h,u,c,d,f,p=arguments[0]||{},m=arguments.length,v=!1,g=1;for(typeof p=="boolean"&&(v=p,p=arguments[1]||{},g=2),typeof p!="object"&&!e.isFunction(p)&&(p={}),m===g&&(p=this,--g);g<m;g++)if(l=arguments[g],l!==null||l!==void 0)for(h in l){var T=Object.getOwnPropertyDescriptor(l,h);if(T!==void 0){if(T.get||T.set){Object.defineProperty(p,h,T);continue}c=T.value}else{t.console.warn('Could not copy inherited property "'+h+'".');continue}p!==c&&(v&&c&&(e.isPlainObject(c)||(d=e.isArray(c)))?(u=p[h],d?(d=!1,f=u&&e.isArray(u)?u:[]):f=u&&e.isPlainObject(u)?u:{},p[h]=e.extend(v,f,c)):c!==void 0&&(p[h]=c))}return p};var i=function(){if(typeof navigator!="object")return!1;var l=navigator.userAgent;return typeof l!="string"?!1:l.indexOf("iPhone")!==-1||l.indexOf("iPad")!==-1||l.indexOf("iPod")!==-1};t.extend(t,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!1,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerDblClickDrag:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:i(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorElement:null,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,tileRetryMax:0,tileRetryDelay:2500,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},SIGNAL:"----seadragon----",delegate:function(l,h){return function(){var u=arguments;return u===void 0&&(u=[]),h.apply(l,u)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(l){return t._viewers.get(this.getElement(l))},getElement:function(l){return typeof l=="string"&&(l=document.getElementById(l)),l},getElementPosition:function(l){var h=new t.Point,u,c;for(l=t.getElement(l),u=t.getElementStyle(l).position==="fixed",c=o(l,u);c;)h.x+=l.offsetLeft,h.y+=l.offsetTop,u&&(h=h.plus(t.getPageScroll())),l=c,u=t.getElementStyle(l).position==="fixed",c=o(l,u);return h},getElementOffset:function(l){l=t.getElement(l);var h=l&&l.ownerDocument,u,c,d={top:0,left:0};return h?(u=h.documentElement,typeof l.getBoundingClientRect<"u"&&(d=l.getBoundingClientRect()),c=h===h.window?h:h.nodeType===9?h.defaultView||h.parentWindow:!1,new t.Point(d.left+(c.pageXOffset||u.scrollLeft)-(u.clientLeft||0),d.top+(c.pageYOffset||u.scrollTop)-(u.clientTop||0))):new t.Point},getElementSize:function(l){return l=t.getElement(l),new t.Point(l.clientWidth,l.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(l){return l=t.getElement(l),l.currentStyle}:function(l){return l=t.getElement(l),window.getComputedStyle(l,"")},getCssPropertyWithVendorPrefix:function(l){var h={};return t.getCssPropertyWithVendorPrefix=function(u){if(h[u]!==void 0)return h[u];var c=document.createElement("div").style,d=null;if(c[u]!==void 0)d=u;else for(var f=["Webkit","Moz","MS","O","webkit","moz","ms","o"],p=t.capitalizeFirstLetter(u),m=0;m<f.length;m++){var v=f[m]+p;if(c[v]!==void 0){d=v;break}}return h[u]=d,d},t.getCssPropertyWithVendorPrefix(l)},capitalizeFirstLetter:function(l){return l.charAt(0).toUpperCase()+l.slice(1)},positiveModulo:function(l,h){var u=l%h;return u<0&&(u+=h),u},pointInElement:function(l,h){l=t.getElement(l);var u=t.getElementOffset(l),c=t.getElementSize(l);return h.x>=u.x&&h.x<u.x+c.x&&h.y<u.y+c.y&&h.y>=u.y},getMousePosition:function(l){if(typeof l.pageX=="number")t.getMousePosition=function(h){var u=new t.Point;return u.x=h.pageX,u.y=h.pageY,u};else if(typeof l.clientX=="number")t.getMousePosition=function(h){var u=new t.Point;return u.x=h.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,u.y=h.clientY+document.body.scrollTop+document.documentElement.scrollTop,u};else throw new Error("Unknown event mouse position, no known technique.");return t.getMousePosition(l)},getPageScroll:function(){var l=document.documentElement||{},h=document.body||{};if(typeof window.pageXOffset=="number")t.getPageScroll=function(){return new t.Point(window.pageXOffset,window.pageYOffset)};else if(h.scrollLeft||h.scrollTop)t.getPageScroll=function(){return new t.Point(document.body.scrollLeft,document.body.scrollTop)};else if(l.scrollLeft||l.scrollTop)t.getPageScroll=function(){return new t.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new t.Point(0,0);return t.getPageScroll()},setPageScroll:function(l){if(typeof window.scrollTo<"u")t.setPageScroll=function(c){window.scrollTo(c.x,c.y)};else{var h=t.getPageScroll();if(h.x===l.x&&h.y===l.y)return;document.body.scrollLeft=l.x,document.body.scrollTop=l.y;var u=t.getPageScroll();if(u.x!==h.x&&u.y!==h.y){t.setPageScroll=function(c){document.body.scrollLeft=c.x,document.body.scrollTop=c.y};return}if(document.documentElement.scrollLeft=l.x,document.documentElement.scrollTop=l.y,u=t.getPageScroll(),u.x!==h.x&&u.y!==h.y){t.setPageScroll=function(c){document.documentElement.scrollLeft=c.x,document.documentElement.scrollTop=c.y};return}t.setPageScroll=function(c){}}t.setPageScroll(l)},getWindowSize:function(){var l=document.documentElement||{},h=document.body||{};if(typeof window.innerWidth=="number")t.getWindowSize=function(){return new t.Point(window.innerWidth,window.innerHeight)};else if(l.clientWidth||l.clientHeight)t.getWindowSize=function(){return new t.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(h.clientWidth||h.clientHeight)t.getWindowSize=function(){return new t.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return t.getWindowSize()},makeCenteredNode:function(l){l=t.getElement(l);var h=[t.makeNeutralElement("div"),t.makeNeutralElement("div"),t.makeNeutralElement("div")];return t.extend(h[0].style,{display:"table",height:"100%",width:"100%"}),t.extend(h[1].style,{display:"table-row"}),t.extend(h[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),h[0].appendChild(h[1]),h[1].appendChild(h[2]),h[2].appendChild(l),h[0]},makeNeutralElement:function(l){var h=document.createElement(l),u=h.style;return u.background="transparent none",u.border="none",u.margin="0px",u.padding="0px",u.position="static",h},now:function(){return Date.now?t.now=Date.now:t.now=function(){return new Date().getTime()},t.now()},makeTransparentImage:function(l){var h=t.makeNeutralElement("img");return h.src=l,h},setElementOpacity:function(l,h,u){var c,d;l=t.getElement(l),u&&!t.Browser.alpha&&(h=Math.round(h)),t.Browser.opacity?l.style.opacity=h<1?h:"":h<1?(c=Math.round(100*h),d="alpha(opacity="+c+")",l.style.filter=d):l.style.filter=""},setElementTouchActionNone:function(l){l=t.getElement(l),typeof l.style.touchAction<"u"?l.style.touchAction="none":typeof l.style.msTouchAction<"u"&&(l.style.msTouchAction="none")},setElementPointerEvents:function(l,h){l=t.getElement(l),typeof l.style<"u"&&typeof l.style.pointerEvents<"u"&&(l.style.pointerEvents=h)},setElementPointerEventsNone:function(l){t.setElementPointerEvents(l,"none")},addClass:function(l,h){l=t.getElement(l),l.className?(" "+l.className+" ").indexOf(" "+h+" ")===-1&&(l.className+=" "+h):l.className=h},indexOf:function(l,h,u){return Array.prototype.indexOf?this.indexOf=function(c,d,f){return c.indexOf(d,f)}:this.indexOf=function(c,d,f){var p,m=f||0,v;if(!c)throw new TypeError;if(v=c.length,v===0||m>=v)return-1;for(m<0&&(m=v-Math.abs(m)),p=m;p<v;p++)if(c[p]===d)return p;return-1},this.indexOf(l,h,u)},removeClass:function(l,h){var u,c=[],d;for(l=t.getElement(l),u=l.className.split(/\s+/),d=0;d<u.length;d++)u[d]&&u[d]!==h&&c.push(u[d]);l.className=c.join(" ")},normalizeEventListenerOptions:function(l){var h;return typeof l<"u"?typeof l=="boolean"?h=t.supportsEventListenerOptions?{capture:l}:l:h=t.supportsEventListenerOptions?l:typeof l.capture<"u"?l.capture:!1:h=t.supportsEventListenerOptions?{capture:!1}:!1,h},addEvent:function(){if(t.supportsAddEventListener)return function(l,h,u,c){c=t.normalizeEventListenerOptions(c),l=t.getElement(l),l.addEventListener(h,u,c)};if(document.documentElement.attachEvent&&document.attachEvent)return function(l,h,u){l=t.getElement(l),l.attachEvent("on"+h,u)};throw new Error("No known event model.")}(),removeEvent:function(){if(t.supportsRemoveEventListener)return function(l,h,u,c){c=t.normalizeEventListenerOptions(c),l=t.getElement(l),l.removeEventListener(h,u,c)};if(document.documentElement.detachEvent&&document.detachEvent)return function(l,h,u){l=t.getElement(l),l.detachEvent("on"+h,u)};throw new Error("No known event model.")}(),cancelEvent:function(l){l.preventDefault()},eventIsCanceled:function(l){return l.defaultPrevented},stopEvent:function(l){l.stopPropagation()},createCallback:function(l,h){var u=[],c;for(c=2;c<arguments.length;c++)u.push(arguments[c]);return function(){var d=u.concat([]),f;for(f=0;f<arguments.length;f++)d.push(arguments[f]);return h.apply(l,d)}},getUrlParameter:function(l){var h=a[l];return h||null},getUrlProtocol:function(l){var h=l.match(/^([a-z]+:)\/\//i);return h===null?window.location.protocol:h[1].toLowerCase()},createAjaxRequest:function(l){var h;try{h=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{h=!1}if(h)window.XMLHttpRequest?t.createAjaxRequest=function(u){return u?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:t.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)t.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return t.createAjaxRequest(l)},makeAjaxRequest:function(l,h,u){var c,d,f,p;t.isPlainObject(l)&&(h=l.success,u=l.error,c=l.withCredentials,d=l.headers,f=l.responseType||null,p=l.postData||null,l=l.url);var m=t.getUrlProtocol(l),v=t.createAjaxRequest(m==="file:");if(!t.isFunction(h))throw new Error("makeAjaxRequest requires a success callback");v.onreadystatechange=function(){v.readyState===4&&(v.onreadystatechange=function(){},v.status>=200&&v.status<300||v.status===0&&m!=="http:"&&m!=="https:"?h(v):t.isFunction(u)?u(v):t.console.error("AJAX request returned %d: %s",v.status,l))};var g=p?"POST":"GET";try{if(v.open(g,l,!0),f&&(v.responseType=f),d)for(var T in d)Object.prototype.hasOwnProperty.call(d,T)&&d[T]&&v.setRequestHeader(T,d[T]);c&&(v.withCredentials=!0),v.send(p)}catch(w){t.console.error("%s while making AJAX request: %s",w.name,w.message),v.onreadystatechange=function(){},t.isFunction(u)&&u(v,w)}return v},jsonp:function(l){var h,u=l.url,c=document.head||document.getElementsByTagName("head")[0]||document.documentElement,d=l.callbackName||"openseadragon"+t.now(),f=window[d],p="$1"+d+"$2",m=l.param||"callback",v=l.callback;u=u.replace(/(=)\?(&|$)|\?\?/i,p),u+=(/\?/.test(u)?"&":"?")+m+"="+d,window[d]=function(g){if(f)window[d]=f;else try{delete window[d]}catch{}v&&t.isFunction(v)&&v(g)},h=document.createElement("script"),(l.async!==void 0||l.async!==!1)&&(h.async="async"),l.scriptCharset&&(h.charset=l.scriptCharset),h.src=u,h.onload=h.onreadystatechange=function(g,T){(T||!h.readyState||/loaded|complete/.test(h.readyState))&&(h.onload=h.onreadystatechange=null,c&&h.parentNode&&c.removeChild(h),h=void 0)},c.insertBefore(h,c.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(l){if(window.DOMParser)t.parseXml=function(h){var u=null,c;return c=new DOMParser,u=c.parseFromString(h,"text/xml"),u};else if(window.ActiveXObject)t.parseXml=function(h){var u=null;return u=new ActiveXObject("Microsoft.XMLDOM"),u.async=!1,u.loadXML(h),u};else throw new Error("Browser doesn't support XML DOM.");return t.parseXml(l)},parseJSON:function(l){return t.parseJSON=window.JSON.parse,t.parseJSON(l)},imageFormatSupported:function(l){return l=l||"",!!r[l.toLowerCase()]},setImageFormatsSupported:function(l){t.extend(r,l)}});var s=function(l){};t.console=window.console||{log:s,debug:s,info:s,warn:s,error:s,assert:s},t.Browser={vendor:t.BROWSERS.UNKNOWN,version:0,alpha:!0};var r={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},a={};(function(){var l=navigator.appVersion,h=navigator.userAgent,u;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(h.substring(h.indexOf("MSIE")+5,h.indexOf(";",h.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(h.indexOf("Edge")>=0?(t.Browser.vendor=t.BROWSERS.EDGE,t.Browser.version=parseFloat(h.substring(h.indexOf("Edge")+5))):h.indexOf("Edg")>=0?(t.Browser.vendor=t.BROWSERS.CHROMEEDGE,t.Browser.version=parseFloat(h.substring(h.indexOf("Edg")+4))):h.indexOf("Firefox")>=0?(t.Browser.vendor=t.BROWSERS.FIREFOX,t.Browser.version=parseFloat(h.substring(h.indexOf("Firefox")+8))):h.indexOf("Safari")>=0?(t.Browser.vendor=h.indexOf("Chrome")>=0?t.BROWSERS.CHROME:t.BROWSERS.SAFARI,t.Browser.version=parseFloat(h.substring(h.substring(0,h.indexOf("Safari")).lastIndexOf("/")+1,h.indexOf("Safari")))):(u=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),u.exec(h)!==null&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":t.Browser.vendor=t.BROWSERS.OPERA,t.Browser.version=parseFloat(l);break}var c=window.location.search.substring(1),d=c.split("&"),f,p,m;for(m=0;m<d.length;m++)if(f=d[m],p=f.indexOf("="),p>0){var v=f.substring(0,p),g=f.substring(p+1);try{a[v]=decodeURIComponent(g)}catch{t.console.error("Ignoring malformed URL parameter: %s=%s",v,g)}}t.Browser.alpha=!(t.Browser.vendor===t.BROWSERS.CHROME&&t.Browser.version<2),t.Browser.opacity=!0,t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version<11&&t.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")})(),function(l){var h=l.requestAnimationFrame||l.mozRequestAnimationFrame||l.webkitRequestAnimationFrame||l.msRequestAnimationFrame,u=l.cancelAnimationFrame||l.mozCancelAnimationFrame||l.webkitCancelAnimationFrame||l.msCancelAnimationFrame;if(h&&u)t.requestAnimationFrame=function(){return h.apply(l,arguments)},t.cancelAnimationFrame=function(){return u.apply(l,arguments)};else{var c=[],d=[],f=0,p;t.requestAnimationFrame=function(m){return c.push([++f,m]),p||(p=setInterval(function(){if(c.length){var v=t.now(),g=d;for(d=c,c=g;d.length;)d.shift()[1](v)}else clearInterval(p),p=void 0},1e3/50)),f},t.cancelAnimationFrame=function(m){var v,g;for(v=0,g=c.length;v<g;v+=1)if(c[v][0]===m){c.splice(v,1);return}for(v=0,g=d.length;v<g;v+=1)if(d[v][0]===m){d.splice(v,1);return}}}}(window);function o(l,h){return h&&l!==document.body?document.body:l.offsetParent}}(e),function(t,i){n.exports?n.exports=i():t.OpenSeadragon=i()}(ld,function(){return e}),function(t){var i={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.fullscreenElement},i.requestFullScreen=function(s){return s.requestFullscreen()},i.exitFullScreen=function(){document.exitFullscreen()},i.fullScreenEventName="fullscreenchange",i.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.msFullscreenElement},i.requestFullScreen=function(s){return s.msRequestFullscreen()},i.exitFullScreen=function(){document.msExitFullscreen()},i.fullScreenEventName="MSFullscreenChange",i.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitFullscreenElement},i.requestFullScreen=function(s){return s.webkitRequestFullscreen()},i.exitFullScreen=function(){document.webkitExitFullscreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},i.requestFullScreen=function(s){return s.webkitRequestFullScreen()},i.exitFullScreen=function(){document.webkitCancelFullScreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.mozFullScreenElement},i.requestFullScreen=function(s){return s.mozRequestFullScreen()},i.exitFullScreen=function(){document.mozCancelFullScreen()},i.fullScreenEventName="mozfullscreenchange",i.fullScreenErrorEventName="mozfullscreenerror"),i.isFullScreen=function(){return i.getFullScreenElement()!==null},i.cancelFullScreen=function(){t.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),i.exitFullScreen()},t.extend(t,i)}(e),function(t){t.EventSource=function(){this.events={}},t.EventSource.prototype={addOnceHandler:function(i,s,r,a,o){var l=this;a=a||1;var h=0,u=function(c){return h++,h===a&&l.removeHandler(i,u),s(c)};this.addHandler(i,u,r,o)},addHandler:function(i,s,r,a){var o=this.events[i];if(o||(this.events[i]=o=[]),s&&t.isFunction(s)){var l=o.length,h={handler:s,userData:r||null,priority:a||0};for(o[l]=h;l>0&&o[l-1].priority<o[l].priority;)o[l]=o[l-1],o[l-1]=h,l--}},removeHandler:function(i,s){var r=this.events[i],a=[],o;if(r&&t.isArray(r)){for(o=0;o<r.length;o++)r[o].handler!==s&&a.push(r[o]);this.events[i]=a}},numberOfHandlers:function(i){var s=this.events[i];return s?s.length:0},removeAllHandlers:function(i){if(i)this.events[i]=[];else for(var s in this.events)this.events[s]=[]},getHandler:function(i){var s=this.events[i];return!s||!s.length?null:(s=s.length===1?[s[0]]:Array.apply(null,s),function(r,a){var o,l=s.length;for(o=0;o<l;o++)s[o]&&(a.eventSource=r,a.userData=s[o].userData,s[o].handler(a))})},raiseEvent:function(i,s){var r=this.getHandler(i);if(r)return r(this,s||{})}}}(e),function(t){var i={};t.MouseTracker=function(_){var x=arguments;t.isPlainObject(_)||(_={element:x[0],clickTimeThreshold:x[1],clickDistThreshold:x[2]}),this.hash=Math.random(),this.element=t.getElement(_.element),this.clickTimeThreshold=_.clickTimeThreshold||t.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=_.clickDistThreshold||t.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=_.dblClickTimeThreshold||t.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=_.dblClickDistThreshold||t.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=_.userData||null,this.stopDelay=_.stopDelay||50,this.preProcessEventHandler=_.preProcessEventHandler||null,this.contextMenuHandler=_.contextMenuHandler||null,this.enterHandler=_.enterHandler||null,this.leaveHandler=_.leaveHandler||null,this.exitHandler=_.exitHandler||null,this.overHandler=_.overHandler||null,this.outHandler=_.outHandler||null,this.pressHandler=_.pressHandler||null,this.nonPrimaryPressHandler=_.nonPrimaryPressHandler||null,this.releaseHandler=_.releaseHandler||null,this.nonPrimaryReleaseHandler=_.nonPrimaryReleaseHandler||null,this.moveHandler=_.moveHandler||null,this.scrollHandler=_.scrollHandler||null,this.clickHandler=_.clickHandler||null,this.dblClickHandler=_.dblClickHandler||null,this.dragHandler=_.dragHandler||null,this.dragEndHandler=_.dragEndHandler||null,this.pinchHandler=_.pinchHandler||null,this.stopHandler=_.stopHandler||null,this.keyDownHandler=_.keyDownHandler||null,this.keyUpHandler=_.keyUpHandler||null,this.keyHandler=_.keyHandler||null,this.focusHandler=_.focusHandler||null,this.blurHandler=_.blurHandler||null;var b=this;i[this.hash]={click:function(A){w(b,A)},dblclick:function(A){E(b,A)},keydown:function(A){P(b,A)},keyup:function(A){C(b,A)},keypress:function(A){D(b,A)},focus:function(A){B(b,A)},blur:function(A){H(b,A)},contextmenu:function(A){I(b,A)},wheel:function(A){N(b,A)},mousewheel:function(A){M(b,A)},DOMMouseScroll:function(A){M(b,A)},MozMousePixelScroll:function(A){M(b,A)},losecapture:function(A){F(b,A)},mouseenter:function(A){J(b,A)},mouseleave:function(A){ye(b,A)},mouseover:function(A){he(b,A)},mouseout:function(A){Re(b,A)},mousedown:function(A){Me(b,A)},mouseup:function(A){re(b,A)},mousemove:function(A){we(b,A)},touchstart:function(A){L(b,A)},touchend:function(A){Z(b,A)},touchmove:function(A){V(b,A)},touchcancel:function(A){q(b,A)},gesturestart:function(A){pe(b,A)},gesturechange:function(A){G(b,A)},gotpointercapture:function(A){Y(b,A)},lostpointercapture:function(A){de(b,A)},pointerenter:function(A){J(b,A)},pointerleave:function(A){ye(b,A)},pointerover:function(A){he(b,A)},pointerout:function(A){Re(b,A)},pointerdown:function(A){Me(b,A)},pointerup:function(A){re(b,A)},pointermove:function(A){we(b,A)},pointercancel:function(A){ot(b,A)},pointerupcaptured:function(A){$(b,A)},pointermovecaptured:function(A){Pe(b,A)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,t.MouseTracker.havePointerEvents&&t.setElementPointerEvents(this.element,"auto"),this.exitHandler&&t.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),_.startDisabled||this.setTracking(!0)},t.MouseTracker.prototype={destroy:function(){l(this),this.element=null,i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(_){return _?o(this):l(this),this},getActivePointersListByType:function(_){var x=i[this.hash],b,A=x.activePointersLists.length,U;for(b=0;b<A;b++)if(x.activePointersLists[b].type===_)return x.activePointersLists[b];return U=new t.MouseTracker.GesturePointList(_),x.activePointersLists.push(U),U},getActivePointerCount:function(){var _=i[this.hash],x,b=_.activePointersLists.length,A=0;for(x=0;x<b;x++)A+=_.activePointersLists[x].getLength();return A},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var s=function(){try{return window.self!==window.top}catch{return!0}}();function r(_){try{return _.addEventListener&&_.removeEventListener}catch{return!1}}t.MouseTracker.gesturePointVelocityTracker=function(){var _=[],x=0,b=0,A=function(Ie,ue){return Ie.hash.toString()+ue.type+ue.id.toString()},U=function(){var Ie,ue=_.length,lt,Xe,Yi=t.now(),Ha,Ga,za;for(Ha=Yi-b,b=Yi,Ie=0;Ie<ue;Ie++)lt=_[Ie],Xe=lt.gPoint,Xe.direction=Math.atan2(Xe.currentPos.y-lt.lastPos.y,Xe.currentPos.x-lt.lastPos.x),Ga=lt.lastPos.distanceTo(Xe.currentPos),lt.lastPos=Xe.currentPos,za=1e3*Ga/(Ha+1),Xe.speed=.75*za+.25*Xe.speed},W=function(Ie,ue){var lt=A(Ie,ue);_.push({guid:lt,gPoint:ue,lastPos:ue.currentPos}),_.length===1&&(b=t.now(),x=window.setInterval(U,50))},le=function(Ie,ue){var lt=A(Ie,ue),Xe,Yi=_.length;for(Xe=0;Xe<Yi;Xe++)if(_[Xe].guid===lt){_.splice(Xe,1),Yi--,Yi===0&&window.clearInterval(x);break}};return{addPoint:W,removePoint:le}}(),t.MouseTracker.captureElement=document,t.MouseTracker.wheelEventName=t.Browser.vendor===t.BROWSERS.IE&&t.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",t.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",t.MouseTracker.wheelEventName],t.MouseTracker.wheelEventName==="DOMMouseScroll"&&t.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),t.MouseTracker.havePointerCapture=function(){var _=document.createElement("div");return t.isFunction(_.setPointerCapture)&&t.isFunction(_.releasePointerCapture)}(),t.MouseTracker.havePointerCapture&&t.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(t.MouseTracker.havePointerEvents=!1,t.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),t.MouseTracker.mousePointerId="legacy-mouse",t.MouseTracker.havePointerCapture=function(){var _=document.createElement("div");return t.isFunction(_.setCapture)&&t.isFunction(_.releaseCapture)}(),t.MouseTracker.havePointerCapture&&t.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&t.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&t.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),t.MouseTracker.GesturePointList=function(_){this._gPoints=[],this.type=_,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},t.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(_){return this._gPoints.push(_)},removeById:function(_){var x,b=this._gPoints.length;for(x=0;x<b;x++)if(this._gPoints[x].id===_){this._gPoints.splice(x,1);break}return this._gPoints.length},getByIndex:function(_){return _<this._gPoints.length?this._gPoints[_]:null},getById:function(_){var x,b=this._gPoints.length;for(x=0;x<b;x++)if(this._gPoints[x].id===_)return this._gPoints[x];return null},getPrimary:function(_){var x,b=this._gPoints.length;for(x=0;x<b;x++)if(this._gPoints[x].isPrimary)return this._gPoints[x];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(t.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function a(_){var x=i[_.hash],b,A,U,W,le,Ie=x.activePointersLists.length;for(b=0;b<Ie;b++)if(U=x.activePointersLists[b],U.getLength()>0){for(le=[],W=U.asArray(),A=0;A<W.length;A++)le.push(W[A]);for(A=0;A<le.length;A++)ct(_,U,le[A])}for(b=0;b<Ie;b++)x.activePointersLists.pop();x.sentDragEvent=!1}function o(_){var x=i[_.hash],b,A;if(!x.tracking){for(A=0;A<t.MouseTracker.subscribeEvents.length;A++)b=t.MouseTracker.subscribeEvents[A],t.addEvent(_.element,b,x[b],b===t.MouseTracker.wheelEventName?{passive:!1,capture:!1}:!1);a(_),x.tracking=!0}}function l(_){var x=i[_.hash],b,A;if(x.tracking){for(A=0;A<t.MouseTracker.subscribeEvents.length;A++)b=t.MouseTracker.subscribeEvents[A],t.removeEvent(_.element,b,x[b],!1);a(_),x.tracking=!1}}function h(_,x){var b=i[_.hash];if(x==="pointerevent")return{upName:"pointerup",upHandler:b.pointerupcaptured,moveName:"pointermove",moveHandler:b.pointermovecaptured};if(x==="mouse")return{upName:"pointerup",upHandler:b.pointerupcaptured,moveName:"pointermove",moveHandler:b.pointermovecaptured};if(x==="touch")return{upName:"touchend",upHandler:b.touchendcaptured,moveName:"touchmove",moveHandler:b.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function u(_,x){var b;if(t.MouseTracker.havePointerCapture)if(t.MouseTracker.havePointerEvents)try{_.element.setPointerCapture(x.id)}catch{t.console.warn("setPointerCapture() called on invalid pointer ID");return}else _.element.setCapture(!0);else b=h(_,t.MouseTracker.havePointerEvents?"pointerevent":x.type),s&&r(window.top)&&t.addEvent(window.top,b.upName,b.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,b.upName,b.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,b.moveName,b.moveHandler,!0);O(_,x,!0)}function c(_,x){var b,A,U;if(t.MouseTracker.havePointerCapture)if(t.MouseTracker.havePointerEvents){if(A=_.getActivePointersListByType(x.type),U=A.getById(x.id),!U||!U.captured)return;try{_.element.releasePointerCapture(x.id)}catch{}}else _.element.releaseCapture();else b=h(_,t.MouseTracker.havePointerEvents?"pointerevent":x.type),s&&r(window.top)&&t.removeEvent(window.top,b.upName,b.upHandler,!0),t.removeEvent(t.MouseTracker.captureElement,b.moveName,b.moveHandler,!0),t.removeEvent(t.MouseTracker.captureElement,b.upName,b.upHandler,!0);O(_,x,!1)}function d(_){return t.MouseTracker.havePointerEvents?_.pointerId:t.MouseTracker.mousePointerId}function f(_){return t.MouseTracker.havePointerEvents?_.pointerType||(t.Browser.vendor===t.BROWSERS.IE?"mouse":""):"mouse"}function p(_){return t.MouseTracker.havePointerEvents?_.isPrimary:!0}function m(_){return t.getMousePosition(_)}function v(_,x){return g(m(_),x)}function g(_,x){var b=t.getElementOffset(x);return _.minus(b)}function T(_,x){return new t.Point((_.x+x.x)/2,(_.y+x.y)/2)}function w(_,x){var b={originalEvent:x,eventType:"click",pointerType:"mouse",isEmulated:!1};S(_,b),b.preventDefault&&!b.defaultPrevented&&t.cancelEvent(x),b.stopPropagation&&t.stopEvent(x)}function E(_,x){var b={originalEvent:x,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};S(_,b),b.preventDefault&&!b.defaultPrevented&&t.cancelEvent(x),b.stopPropagation&&t.stopEvent(x)}function P(_,x){var b=null,A={originalEvent:x,eventType:"keydown",pointerType:"",isEmulated:!1};S(_,A),_.keyDownHandler&&!A.preventGesture&&!A.defaultPrevented&&(b={eventSource:_,keyCode:x.keyCode?x.keyCode:x.charCode,ctrl:x.ctrlKey,shift:x.shiftKey,alt:x.altKey,meta:x.metaKey,originalEvent:x,preventDefault:A.preventDefault||A.defaultPrevented,userData:_.userData},_.keyDownHandler(b)),(b&&b.preventDefault||A.preventDefault&&!A.defaultPrevented)&&t.cancelEvent(x),A.stopPropagation&&t.stopEvent(x)}function C(_,x){var b=null,A={originalEvent:x,eventType:"keyup",pointerType:"",isEmulated:!1};S(_,A),_.keyUpHandler&&!A.preventGesture&&!A.defaultPrevented&&(b={eventSource:_,keyCode:x.keyCode?x.keyCode:x.charCode,ctrl:x.ctrlKey,shift:x.shiftKey,alt:x.altKey,meta:x.metaKey,originalEvent:x,preventDefault:A.preventDefault||A.defaultPrevented,userData:_.userData},_.keyUpHandler(b)),(b&&b.preventDefault||A.preventDefault&&!A.defaultPrevented)&&t.cancelEvent(x),A.stopPropagation&&t.stopEvent(x)}function D(_,x){var b=null,A={originalEvent:x,eventType:"keypress",pointerType:"",isEmulated:!1};S(_,A),_.keyHandler&&!A.preventGesture&&!A.defaultPrevented&&(b={eventSource:_,keyCode:x.keyCode?x.keyCode:x.charCode,ctrl:x.ctrlKey,shift:x.shiftKey,alt:x.altKey,meta:x.metaKey,originalEvent:x,preventDefault:A.preventDefault||A.defaultPrevented,userData:_.userData},_.keyHandler(b)),(b&&b.preventDefault||A.preventDefault&&!A.defaultPrevented)&&t.cancelEvent(x),A.stopPropagation&&t.stopEvent(x)}function B(_,x){var b={originalEvent:x,eventType:"focus",pointerType:"",isEmulated:!1};S(_,b),_.focusHandler&&!b.preventGesture&&_.focusHandler({eventSource:_,originalEvent:x,userData:_.userData})}function H(_,x){var b={originalEvent:x,eventType:"blur",pointerType:"",isEmulated:!1};S(_,b),_.blurHandler&&!b.preventGesture&&_.blurHandler({eventSource:_,originalEvent:x,userData:_.userData})}function I(_,x){var b=null,A={originalEvent:x,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};S(_,A),_.contextMenuHandler&&!A.preventGesture&&!A.defaultPrevented&&(b={eventSource:_,position:g(m(x),_.element),originalEvent:A.originalEvent,preventDefault:A.preventDefault||A.defaultPrevented,userData:_.userData},_.contextMenuHandler(b)),(b&&b.preventDefault||A.preventDefault&&!A.defaultPrevented)&&t.cancelEvent(x),A.stopPropagation&&t.stopEvent(x)}function N(_,x){R(_,x,x)}function M(_,x){var b={target:x.target||x.srcElement,type:"wheel",shiftKey:x.shiftKey||!1,clientX:x.clientX,clientY:x.clientY,pageX:x.pageX?x.pageX:x.clientX,pageY:x.pageY?x.pageY:x.clientY,deltaMode:x.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};t.MouseTracker.wheelEventName==="mousewheel"?b.deltaY=-x.wheelDelta/t.DEFAULT_SETTINGS.pixelsPerWheelLine:b.deltaY=x.detail,R(_,b,x)}function R(_,x,b){var A=0,U,W=null;A=x.deltaY<0?1:-1,U={originalEvent:x,eventType:"wheel",pointerType:"mouse",isEmulated:x!==b},S(_,U),_.scrollHandler&&!U.preventGesture&&!U.defaultPrevented&&(W={eventSource:_,pointerType:"mouse",position:v(x,_.element),scroll:A,shift:x.shiftKey,isTouchEvent:!1,originalEvent:b,preventDefault:U.preventDefault||U.defaultPrevented,userData:_.userData},_.scrollHandler(W)),U.stopPropagation&&t.stopEvent(b),(W&&W.preventDefault||U.preventDefault&&!U.defaultPrevented)&&t.cancelEvent(b)}function F(_,x){var b={id:t.MouseTracker.mousePointerId,type:"mouse"},A={originalEvent:x,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};S(_,A),x.target===_.element&&O(_,b,!1),A.stopPropagation&&t.stopEvent(x)}function L(_,x){var b,A,U=x.changedTouches.length,W,le=_.getActivePointersListByType("touch");b=t.now(),le.getLength()>x.touches.length-U&&t.console.warn("Tracked touch contact count doesn't match event.touches.length");var Ie={originalEvent:x,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(S(_,Ie),A=0;A<U;A++)W={id:x.changedTouches[A].identifier,type:"touch",isPrimary:le.getLength()===0,currentPos:m(x.changedTouches[A]),currentTime:b},X(_,Ie,W),Se(_,Ie,W,0),O(_,W,!0);Ie.preventDefault&&!Ie.defaultPrevented&&t.cancelEvent(x),Ie.stopPropagation&&t.stopEvent(x)}function Z(_,x){var b,A,U=x.changedTouches.length,W;b=t.now();var le={originalEvent:x,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(S(_,le),A=0;A<U;A++)W={id:x.changedTouches[A].identifier,type:"touch",currentPos:m(x.changedTouches[A]),currentTime:b},Be(_,le,W,0),O(_,W,!1),z(_,le,W);le.preventDefault&&!le.defaultPrevented&&t.cancelEvent(x),le.stopPropagation&&t.stopEvent(x)}function V(_,x){var b,A,U=x.changedTouches.length,W;b=t.now();var le={originalEvent:x,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(S(_,le),A=0;A<U;A++)W={id:x.changedTouches[A].identifier,type:"touch",currentPos:m(x.changedTouches[A]),currentTime:b},Le(_,le,W);le.preventDefault&&!le.defaultPrevented&&t.cancelEvent(x),le.stopPropagation&&t.stopEvent(x)}function q(_,x){var b=x.changedTouches.length,A,U,W={originalEvent:x,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(S(_,W),A=0;A<b;A++)U={id:x.changedTouches[A].identifier,type:"touch"},me(_,W,U);W.stopPropagation&&t.stopEvent(x)}function pe(_,x){return t.eventIsCanceled(x)||x.preventDefault(),!1}function G(_,x){return t.eventIsCanceled(x)||x.preventDefault(),!1}function Y(_,x){var b={originalEvent:x,eventType:"gotpointercapture",pointerType:f(x),isEmulated:!1};S(_,b),x.target===_.element&&O(_,{id:x.pointerId,type:f(x)},!0),b.stopPropagation&&t.stopEvent(x)}function de(_,x){var b={originalEvent:x,eventType:"lostpointercapture",pointerType:f(x),isEmulated:!1};S(_,b),x.target===_.element&&O(_,{id:x.pointerId,type:f(x)},!1),b.stopPropagation&&t.stopEvent(x)}function J(_,x){var b={id:d(x),type:f(x),isPrimary:p(x),currentPos:m(x),currentTime:t.now()},A={originalEvent:x,eventType:"pointerenter",pointerType:b.type,isEmulated:!1};S(_,A),X(_,A,b)}function ye(_,x){var b={id:d(x),type:f(x),isPrimary:p(x),currentPos:m(x),currentTime:t.now()},A={originalEvent:x,eventType:"pointerleave",pointerType:b.type,isEmulated:!1};S(_,A),z(_,A,b)}function he(_,x){var b={id:d(x),type:f(x),isPrimary:p(x),currentPos:m(x),currentTime:t.now()},A={originalEvent:x,eventType:"pointerover",pointerType:b.type,isEmulated:!1};S(_,A),ae(_,A,b),A.preventDefault&&!A.defaultPrevented&&t.cancelEvent(x),A.stopPropagation&&t.stopEvent(x)}function Re(_,x){var b={id:d(x),type:f(x),isPrimary:p(x),currentPos:m(x),currentTime:t.now()},A={originalEvent:x,eventType:"pointerout",pointerType:b.type,isEmulated:!1};S(_,A),Q(_,A,b),A.preventDefault&&!A.defaultPrevented&&t.cancelEvent(x),A.stopPropagation&&t.stopEvent(x)}function Me(_,x){var b={id:d(x),type:f(x),isPrimary:p(x),currentPos:m(x),currentTime:t.now()},A=t.MouseTracker.havePointerEvents&&b.type==="touch"&&t.Browser.vendor!==t.BROWSERS.IE,U={originalEvent:x,eventType:"pointerdown",pointerType:b.type,isEmulated:!1};S(_,U),Se(_,U,b,x.button),U.preventDefault&&!U.defaultPrevented&&t.cancelEvent(x),U.stopPropagation&&t.stopEvent(x),U.shouldCapture&&(A?O(_,b,!0):u(_,b))}function re(_,x){De(_,x)}function $(_,x){var b=_.getActivePointersListByType(f(x));b.getById(x.pointerId)&&De(_,x),t.stopEvent(x)}function De(_,x){var b;b={id:d(x),type:f(x),isPrimary:p(x),currentPos:m(x),currentTime:t.now()};var A={originalEvent:x,eventType:"pointerup",pointerType:b.type,isEmulated:!1};S(_,A),Be(_,A,b,x.button),A.preventDefault&&!A.defaultPrevented&&t.cancelEvent(x),A.stopPropagation&&t.stopEvent(x),A.shouldReleaseCapture&&(x.target===_.element?c(_,b):O(_,b,!1))}function we(_,x){Ce(_,x)}function Pe(_,x){var b=_.getActivePointersListByType(f(x));b.getById(x.pointerId)&&Ce(_,x),t.stopEvent(x)}function Ce(_,x){var b={id:d(x),type:f(x),isPrimary:p(x),currentPos:m(x),currentTime:t.now()},A={originalEvent:x,eventType:"pointermove",pointerType:b.type,isEmulated:!1};S(_,A),Le(_,A,b),A.preventDefault&&!A.defaultPrevented&&t.cancelEvent(x),A.stopPropagation&&t.stopEvent(x)}function ot(_,x){var b={id:x.pointerId,type:f(x)},A={originalEvent:x,eventType:"pointercancel",pointerType:b.type,isEmulated:!1};S(_,A),me(_,A,b),A.stopPropagation&&t.stopEvent(x)}function et(_,x){return x.speed=0,x.direction=0,x.contactPos=x.currentPos,x.contactTime=x.currentTime,x.lastPos=x.currentPos,x.lastTime=x.currentTime,_.add(x)}function ct(_,x,b){var A,U=x.getById(b.id);return U?(U.captured&&(t.console.warn("stopTrackingPointer() called on captured pointer"),c(_,U)),x.removeContact(),A=x.removeById(b.id)):A=x.getLength(),A}function y(_,x){switch(x.eventType){case"pointermove":x.isStoppable=!0,x.isCancelable=!0,x.preventDefault=!1,x.preventGesture=!_.hasGestureHandlers,x.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":x.isStoppable=!0,x.isCancelable=!0,x.preventDefault=!1,x.preventGesture=!1,x.stopPropagation=!1;break;case"pointerdown":x.isStoppable=!0,x.isCancelable=!0,x.preventDefault=!1,x.preventGesture=!_.hasGestureHandlers,x.stopPropagation=!1;break;case"pointerup":x.isStoppable=!0,x.isCancelable=!0,x.preventDefault=!1,x.preventGesture=!_.hasGestureHandlers,x.stopPropagation=!1;break;case"wheel":x.isStoppable=!0,x.isCancelable=!0,x.preventDefault=!1,x.preventGesture=!_.hasScrollHandler,x.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":x.isStoppable=!0,x.isCancelable=!1,x.preventDefault=!1,x.preventGesture=!1,x.stopPropagation=!1;break;case"click":x.isStoppable=!0,x.isCancelable=!0,x.preventDefault=!!_.clickHandler,x.preventGesture=!1,x.stopPropagation=!1;break;case"dblclick":x.isStoppable=!0,x.isCancelable=!0,x.preventDefault=!!_.dblClickHandler,x.preventGesture=!1,x.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:x.isStoppable=!1,x.isCancelable=!1,x.preventDefault=!1,x.preventGesture=!1,x.stopPropagation=!1;break}}function S(_,x){x.eventSource=_,x.eventPhase=x.originalEvent&&typeof x.originalEvent.eventPhase<"u"?x.originalEvent.eventPhase:0,x.defaultPrevented=t.eventIsCanceled(x.originalEvent),x.shouldCapture=!1,x.shouldReleaseCapture=!1,x.userData=_.userData,y(_,x),_.preProcessEventHandler&&_.preProcessEventHandler(x)}function O(_,x,b){var A=_.getActivePointersListByType(x.type),U=A.getById(x.id);U?b&&!U.captured?(U.captured=!0,A.captureCount++):!b&&U.captured&&(U.captured=!1,A.captureCount--,A.captureCount<0&&(A.captureCount=0,t.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):t.console.warn("updatePointerCaptured() called on untracked pointer")}function X(_,x,b){var A=_.getActivePointersListByType(b.type),U;U=A.getById(b.id),U?(U.insideElement=!0,U.lastPos=U.currentPos,U.lastTime=U.currentTime,U.currentPos=b.currentPos,U.currentTime=b.currentTime,b=U):(b.captured=!1,b.insideElementPressed=!1,b.insideElement=!0,et(A,b)),_.enterHandler&&_.enterHandler({eventSource:_,pointerType:b.type,position:g(b.currentPos,_.element),buttons:A.buttons,pointers:_.getActivePointerCount(),insideElementPressed:b.insideElementPressed,buttonDownAny:A.buttons!==0,isTouchEvent:b.type==="touch",originalEvent:x.originalEvent,userData:_.userData})}function z(_,x,b){var A=_.getActivePointersListByType(b.type),U,W;U=A.getById(b.id),U?(U.captured?(U.insideElement=!1,U.lastPos=U.currentPos,U.lastTime=U.currentTime,U.currentPos=b.currentPos,U.currentTime=b.currentTime):ct(_,A,U),b=U):(b.captured=!1,b.insideElementPressed=!1),(_.leaveHandler||_.exitHandler)&&(W={eventSource:_,pointerType:b.type,position:b.currentPos&&g(b.currentPos,_.element),buttons:A.buttons,pointers:_.getActivePointerCount(),insideElementPressed:b.insideElementPressed,buttonDownAny:A.buttons!==0,isTouchEvent:b.type==="touch",originalEvent:x.originalEvent,userData:_.userData},_.leaveHandler&&_.leaveHandler(W),_.exitHandler&&_.exitHandler(W))}function ae(_,x,b){var A,U;A=_.getActivePointersListByType(b.type),U=A.getById(b.id),U?b=U:(b.captured=!1,b.insideElementPressed=!1),_.overHandler&&_.overHandler({eventSource:_,pointerType:b.type,position:g(b.currentPos,_.element),buttons:A.buttons,pointers:_.getActivePointerCount(),insideElementPressed:b.insideElementPressed,buttonDownAny:A.buttons!==0,isTouchEvent:b.type==="touch",originalEvent:x.originalEvent,userData:_.userData})}function Q(_,x,b){var A,U;A=_.getActivePointersListByType(b.type),U=A.getById(b.id),U?b=U:(b.captured=!1,b.insideElementPressed=!1),_.outHandler&&_.outHandler({eventSource:_,pointerType:b.type,position:b.currentPos&&g(b.currentPos,_.element),buttons:A.buttons,pointers:_.getActivePointerCount(),insideElementPressed:b.insideElementPressed,buttonDownAny:A.buttons!==0,isTouchEvent:b.type==="touch",originalEvent:x.originalEvent,userData:_.userData})}function Se(_,x,b,A){var U=i[_.hash],W=_.getActivePointersListByType(b.type),le;if(typeof x.originalEvent.buttons<"u"?W.buttons=x.originalEvent.buttons:A===0?W.buttons|=1:A===1?W.buttons|=4:A===2?W.buttons|=2:A===3?W.buttons|=8:A===4?W.buttons|=16:A===5&&(W.buttons|=32),A!==0){x.shouldCapture=!1,x.shouldReleaseCapture=!1,_.nonPrimaryPressHandler&&!x.preventGesture&&!x.defaultPrevented&&(x.preventDefault=!0,_.nonPrimaryPressHandler({eventSource:_,pointerType:b.type,position:g(b.currentPos,_.element),button:A,buttons:W.buttons,isTouchEvent:b.type==="touch",originalEvent:x.originalEvent,userData:_.userData}));return}le=W.getById(b.id),le?(le.insideElementPressed=!0,le.insideElement=!0,le.originalTarget=x.originalEvent.target,le.contactPos=b.currentPos,le.contactTime=b.currentTime,le.lastPos=le.currentPos,le.lastTime=le.currentTime,le.currentPos=b.currentPos,le.currentTime=b.currentTime,b=le):(b.captured=!1,b.insideElementPressed=!0,b.insideElement=!0,b.originalTarget=x.originalEvent.target,et(W,b)),W.addContact(),!x.preventGesture&&!x.defaultPrevented?(x.shouldCapture=!0,x.shouldReleaseCapture=!1,x.preventDefault=!0,(_.dragHandler||_.dragEndHandler||_.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.addPoint(_,b),W.contacts===1?_.pressHandler&&!x.preventGesture&&_.pressHandler({eventSource:_,pointerType:b.type,position:g(b.contactPos,_.element),buttons:W.buttons,isTouchEvent:b.type==="touch",originalEvent:x.originalEvent,userData:_.userData}):W.contacts===2&&_.pinchHandler&&b.type==="touch"&&(U.pinchGPoints=W.asArray(),U.lastPinchDist=U.currentPinchDist=U.pinchGPoints[0].currentPos.distanceTo(U.pinchGPoints[1].currentPos),U.lastPinchCenter=U.currentPinchCenter=T(U.pinchGPoints[0].currentPos,U.pinchGPoints[1].currentPos))):(x.shouldCapture=!1,x.shouldReleaseCapture=!1)}function Be(_,x,b,A){var U=i[_.hash],W=_.getActivePointersListByType(b.type),le,Ie,ue,lt=!1,Xe;if(typeof x.originalEvent.buttons<"u"?W.buttons=x.originalEvent.buttons:A===0?W.buttons^=-2:A===1?W.buttons^=-5:A===2?W.buttons^=-3:A===3?W.buttons^=-9:A===4?W.buttons^=-17:A===5&&(W.buttons^=-33),x.shouldCapture=!1,A!==0){x.shouldReleaseCapture=!1,_.nonPrimaryReleaseHandler&&!x.preventGesture&&!x.defaultPrevented&&(x.preventDefault=!0,_.nonPrimaryReleaseHandler({eventSource:_,pointerType:b.type,position:g(b.currentPos,_.element),button:A,buttons:W.buttons,isTouchEvent:b.type==="touch",originalEvent:x.originalEvent,userData:_.userData}));return}ue=W.getById(b.id),ue?(W.removeContact(),ue.captured&&(lt=!0),ue.lastPos=ue.currentPos,ue.lastTime=ue.currentTime,ue.currentPos=b.currentPos,ue.currentTime=b.currentTime,ue.insideElement||ct(_,W,ue),le=ue.currentPos,Ie=ue.currentTime):(b.captured=!1,b.insideElementPressed=!1,b.insideElement=!0,et(W,b),ue=b),!x.preventGesture&&!x.defaultPrevented&&(lt?(x.shouldReleaseCapture=!0,x.preventDefault=!0,(_.dragHandler||_.dragEndHandler||_.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.removePoint(_,ue),W.contacts===0?(_.releaseHandler&&le&&_.releaseHandler({eventSource:_,pointerType:ue.type,position:g(le,_.element),buttons:W.buttons,insideElementPressed:ue.insideElementPressed,insideElementReleased:ue.insideElement,isTouchEvent:ue.type==="touch",originalEvent:x.originalEvent,userData:_.userData}),_.dragEndHandler&&U.sentDragEvent&&_.dragEndHandler({eventSource:_,pointerType:ue.type,position:g(ue.currentPos,_.element),speed:ue.speed,direction:ue.direction,shift:x.originalEvent.shiftKey,isTouchEvent:ue.type==="touch",originalEvent:x.originalEvent,userData:_.userData}),U.sentDragEvent=!1,(_.clickHandler||_.dblClickHandler)&&ue.insideElement&&(Xe=Ie-ue.contactTime<=_.clickTimeThreshold&&ue.contactPos.distanceTo(le)<=_.clickDistThreshold,_.clickHandler&&_.clickHandler({eventSource:_,pointerType:ue.type,position:g(ue.currentPos,_.element),quick:Xe,shift:x.originalEvent.shiftKey,isTouchEvent:ue.type==="touch",originalEvent:x.originalEvent,originalTarget:ue.originalTarget,userData:_.userData}),_.dblClickHandler&&Xe&&(W.clicks++,W.clicks===1?(U.lastClickPos=le,U.dblClickTimeOut=setTimeout(function(){W.clicks=0},_.dblClickTimeThreshold)):W.clicks===2&&(clearTimeout(U.dblClickTimeOut),W.clicks=0,U.lastClickPos.distanceTo(le)<=_.dblClickDistThreshold&&_.dblClickHandler({eventSource:_,pointerType:ue.type,position:g(ue.currentPos,_.element),shift:x.originalEvent.shiftKey,isTouchEvent:ue.type==="touch",originalEvent:x.originalEvent,userData:_.userData}),U.lastClickPos=null)))):W.contacts===2&&_.pinchHandler&&ue.type==="touch"&&(U.pinchGPoints=W.asArray(),U.lastPinchDist=U.currentPinchDist=U.pinchGPoints[0].currentPos.distanceTo(U.pinchGPoints[1].currentPos),U.lastPinchCenter=U.currentPinchCenter=T(U.pinchGPoints[0].currentPos,U.pinchGPoints[1].currentPos))):(x.shouldReleaseCapture=!1,_.releaseHandler&&le&&(_.releaseHandler({eventSource:_,pointerType:ue.type,position:g(le,_.element),buttons:W.buttons,insideElementPressed:ue.insideElementPressed,insideElementReleased:ue.insideElement,isTouchEvent:ue.type==="touch",originalEvent:x.originalEvent,userData:_.userData}),x.preventDefault=!0)))}function Le(_,x,b){var A=i[_.hash],U=_.getActivePointersListByType(b.type),W,le,Ie;if(typeof x.originalEvent.buttons<"u"&&(U.buttons=x.originalEvent.buttons),W=U.getById(b.id),W)W.lastPos=W.currentPos,W.lastTime=W.currentTime,W.currentPos=b.currentPos,W.currentTime=b.currentTime;else return;x.shouldCapture=!1,x.shouldReleaseCapture=!1,_.stopHandler&&b.type==="mouse"&&(clearTimeout(_.stopTimeOut),_.stopTimeOut=setTimeout(function(){Ge(_,x.originalEvent,b.type)},_.stopDelay)),U.contacts===0?_.moveHandler&&_.moveHandler({eventSource:_,pointerType:b.type,position:g(b.currentPos,_.element),buttons:U.buttons,isTouchEvent:b.type==="touch",originalEvent:x.originalEvent,userData:_.userData}):U.contacts===1?(_.moveHandler&&(W=U.asArray()[0],_.moveHandler({eventSource:_,pointerType:W.type,position:g(W.currentPos,_.element),buttons:U.buttons,isTouchEvent:W.type==="touch",originalEvent:x.originalEvent,userData:_.userData})),_.dragHandler&&!x.preventGesture&&!x.defaultPrevented&&(W=U.asArray()[0],Ie=W.currentPos.minus(W.lastPos),_.dragHandler({eventSource:_,pointerType:W.type,position:g(W.currentPos,_.element),buttons:U.buttons,delta:Ie,speed:W.speed,direction:W.direction,shift:x.originalEvent.shiftKey,isTouchEvent:W.type==="touch",originalEvent:x.originalEvent,userData:_.userData}),x.preventDefault=!0,A.sentDragEvent=!0)):U.contacts===2&&(_.moveHandler&&(le=U.asArray(),_.moveHandler({eventSource:_,pointerType:le[0].type,position:g(T(le[0].currentPos,le[1].currentPos),_.element),buttons:U.buttons,isTouchEvent:le[0].type==="touch",originalEvent:x.originalEvent,userData:_.userData})),_.pinchHandler&&b.type==="touch"&&!x.preventGesture&&!x.defaultPrevented&&(Ie=A.pinchGPoints[0].currentPos.distanceTo(A.pinchGPoints[1].currentPos),Ie!==A.currentPinchDist&&(A.lastPinchDist=A.currentPinchDist,A.currentPinchDist=Ie,A.lastPinchCenter=A.currentPinchCenter,A.currentPinchCenter=T(A.pinchGPoints[0].currentPos,A.pinchGPoints[1].currentPos),_.pinchHandler({eventSource:_,pointerType:"touch",gesturePoints:A.pinchGPoints,lastCenter:g(A.lastPinchCenter,_.element),center:g(A.currentPinchCenter,_.element),lastDistance:A.lastPinchDist,distance:A.currentPinchDist,shift:x.originalEvent.shiftKey,originalEvent:x.originalEvent,userData:_.userData}),x.preventDefault=!0)))}function me(_,x,b){var A=_.getActivePointersListByType(b.type),U;U=A.getById(b.id),U&&ct(_,A,U)}function Ge(_,x,b){_.stopHandler&&_.stopHandler({eventSource:_,pointerType:b,position:v(x,_.element),buttons:_.getActivePointersListByType(b).buttons,isTouchEvent:b==="touch",originalEvent:x,userData:_.userData})}}(e),function(t){t.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},t.Control=function(i,s,r){var a=i.parentNode;typeof s=="number"&&(t.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),s={anchor:s}),s.attachToViewer=typeof s.attachToViewer>"u"?!0:s.attachToViewer,this.autoFade=typeof s.autoFade>"u"?!0:s.autoFade,this.element=i,this.anchor=s.anchor,this.container=r,this.anchor===t.ControlAnchor.ABSOLUTE?(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof s.top=="number"?s.top+"px":s.top,this.wrapper.style.left=typeof s.left=="number"?s.left+"px":s.left,this.wrapper.style.height=typeof s.height=="number"?s.height+"px":s.height,this.wrapper.style.width=typeof s.width=="number"?s.width+"px":s.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===t.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),s.attachToViewer?this.anchor===t.ControlAnchor.TOP_RIGHT||this.anchor===t.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):a.appendChild(this.wrapper)},t.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==t.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(i){this.wrapper.style.display=i?this.anchor===t.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(i){this.element[t.SIGNAL]&&t.Browser.vendor===t.BROWSERS.IE?t.setElementOpacity(this.element,i,!0):t.setElementOpacity(this.wrapper,i,!0)}}}(e),function(t){t.ControlDock=function(s){var r=["topleft","topright","bottomright","bottomleft"],a,o;for(t.extend(!0,this,{id:"controldock-"+t.now()+"-"+Math.floor(Math.random()*1e6),container:t.makeNeutralElement("div"),controls:[]},s),this.container.onsubmit=function(){return!1},this.element&&(this.element=t.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),o=0;o<r.length;o++)a=r[o],this.controls[a]=t.makeNeutralElement("div"),this.controls[a].style.position="absolute",a.match("left")&&(this.controls[a].style.left="0px"),a.match("right")&&(this.controls[a].style.right="0px"),a.match("top")&&(this.controls[a].style.top="0px"),a.match("bottom")&&(this.controls[a].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},t.ControlDock.prototype={addControl:function(s,r){s=t.getElement(s);var a=null;if(!(i(this,s)>=0)){switch(r.anchor){case t.ControlAnchor.TOP_RIGHT:a=this.controls.topright,s.style.position="relative",s.style.paddingRight="0px",s.style.paddingTop="0px";break;case t.ControlAnchor.BOTTOM_RIGHT:a=this.controls.bottomright,s.style.position="relative",s.style.paddingRight="0px",s.style.paddingBottom="0px";break;case t.ControlAnchor.BOTTOM_LEFT:a=this.controls.bottomleft,s.style.position="relative",s.style.paddingLeft="0px",s.style.paddingBottom="0px";break;case t.ControlAnchor.TOP_LEFT:a=this.controls.topleft,s.style.position="relative",s.style.paddingLeft="0px",s.style.paddingTop="0px";break;case t.ControlAnchor.ABSOLUTE:a=this.container,s.style.margin="0px",s.style.padding="0px";break;default:case t.ControlAnchor.NONE:a=this.container,s.style.margin="0px",s.style.padding="0px";break}this.controls.push(new t.Control(s,r,a)),s.style.display="inline-block"}},removeControl:function(s){s=t.getElement(s);var r=i(this,s);return r>=0&&(this.controls[r].destroy(),this.controls.splice(r,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var s;for(s=this.controls.length-1;s>=0;s--)if(this.controls[s].isVisible())return!0;return!1},setControlsEnabled:function(s){var r;for(r=this.controls.length-1;r>=0;r--)this.controls[r].setVisible(s);return this}};function i(s,r){var a=s.controls,o;for(o=a.length-1;o>=0;o--)if(a[o].element===r)return o;return-1}}(e),function(t){t.Placement=t.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(e),function(t){var i={},s=1;t.Viewer=function(y){var S=arguments,O=this,X;if(t.isPlainObject(y)||(y={id:S[0],xmlPath:S.length>1?S[1]:void 0,prefixUrl:S.length>2?S[2]:void 0,controls:S.length>3?S[3]:void 0,overlays:S.length>4?S[4]:void 0}),y.config&&(t.extend(!0,y,y.config),delete y.config),t.extend(!0,this,{id:y.id,hash:y.hash||s++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttonGroup:null,profiler:null},t.DEFAULT_SETTINGS,y),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof i[this.hash]<"u"&&t.console.warn("Hash "+this.hash+" has already been used."),i[this.hash]={fsBoundsDelta:new t.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,needsResize:!1,forceResize:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null,lastClickTime:null,draggingToZoom:!1},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=t.now(),t.EventSource.call(this),this.addHandler("open-failed",function(z){var ae=t.getString("Errors.OpenFailed",z.eventSource,z.message);O._showMessage(ae)}),t.ControlDock.call(this,y),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=t.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(z){z.width="100%",z.height="100%",z.overflow="hidden",z.position="absolute",z.top="0px",z.left="0px"}(this.canvas.style),t.setElementTouchActionNone(this.canvas),y.tabIndex!==""&&(this.canvas.tabIndex=y.tabIndex===void 0?0:y.tabIndex),this.container.className="openseadragon-container",function(z){z.width="100%",z.height="100%",z.position="relative",z.overflow="hidden",z.left="0px",z.top="0px",z.textAlign="left"}(this.container.style),t.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new t.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:t.delegate(this,v),keyDownHandler:t.delegate(this,g),keyHandler:t.delegate(this,T),clickHandler:t.delegate(this,w),dblClickHandler:t.delegate(this,E),dragHandler:t.delegate(this,P),dragEndHandler:t.delegate(this,C),enterHandler:t.delegate(this,D),leaveHandler:t.delegate(this,B),pressHandler:t.delegate(this,H),releaseHandler:t.delegate(this,I),nonPrimaryPressHandler:t.delegate(this,N),nonPrimaryReleaseHandler:t.delegate(this,M),scrollHandler:t.delegate(this,Z),pinchHandler:t.delegate(this,R),focusHandler:t.delegate(this,F),blurHandler:t.delegate(this,L)}),this.outerTracker=new t.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:t.delegate(this,V),leaveHandler:t.delegate(this,q)}),this.toolbar&&(this.toolbar=new t.ControlDock({element:this.toolbar})),this.bindStandardControls(),i[this.hash].prevContainerSize=r(this.container),window.ResizeObserver?(this._autoResizePolling=!1,this._resizeObserver=new ResizeObserver(function(){i[O.hash].needsResize=!0}),this._resizeObserver.observe(this.container,{})):this._autoResizePolling=!0,this.world=new t.World({viewer:this}),this.world.addHandler("add-item",function(z){O.source=O.world.getItemAt(0).source,i[O.hash].forceRedraw=!0,O._updateRequestId||(O._updateRequestId=h(O,pe))}),this.world.addHandler("remove-item",function(z){O.world.getItemCount()?O.source=O.world.getItemAt(0).source:O.source=null,i[O.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(z){O.viewport&&O.viewport._setContentBounds(O.world.getHomeBounds(),O.world.getContentFactor())}),this.world.addHandler("item-index-change",function(z){O.source=O.world.getItemAt(0).source}),this.viewport=new t.Viewport({containerSize:i[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new t.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:y.timeout,tileRetryMax:this.tileRetryMax,tileRetryDelay:this.tileRetryDelay}),this.tileCache=new t.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new t.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=t.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(X=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(X,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(X=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(X,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new t.Navigator({element:this.navigatorElement,id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy,animationTime:this.animationTime})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),X=0;X<this.customControls.length;X++)this.addControl(this.customControls[X].id,{anchor:this.customControls[X].anchor});t.requestAnimationFrame(function(){c(O)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),t._viewers.set(this.element,this)},t.extend(t.Viewer.prototype,t.EventSource.prototype,t.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(y){return t.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(y)},openTileSource:function(y){return t.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(y)},get buttons(){return t.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(y,S){var O=this;if(this.close(),!y)return this;if(this.sequenceMode&&t.isArray(y))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof S<"u"&&!isNaN(S)&&(this.initialPage=S),this.tileSources=y,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(t.isArray(y)||(y=[y]),!y.length)return this;this._opening=!0;for(var X=y.length,z=0,ae=0,Q,Se=function(){if(z+ae===X)if(z){(O._firstOpen||!O.preserveViewport)&&(O.viewport.goHome(!0),O.viewport.update()),O._firstOpen=!1;var me=y[0];if(me.tileSource&&(me=me.tileSource),O.overlays&&!O.preserveOverlays)for(var Ge=0;Ge<O.overlays.length;Ge++)O.currentOverlays[Ge]=o(O,O.overlays[Ge]);O._drawOverlays(),O._opening=!1,O.raiseEvent("open",{source:me})}else O._opening=!1,O.raiseEvent("open-failed",Q)},Be=function(me){(!t.isPlainObject(me)||!me.tileSource)&&(me={tileSource:me}),me.index!==void 0&&(t.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete me.index),me.collectionImmediately===void 0&&(me.collectionImmediately=!0);var Ge=me.success;me.success=function(x){if(z++,me.tileSource.overlays)for(var b=0;b<me.tileSource.overlays.length;b++)O.addOverlay(me.tileSource.overlays[b]);Ge&&Ge(x),Se()};var _=me.error;me.error=function(x){ae++,Q||(Q=x),_&&_(x),Se()},O.addTiledImage(me)},Le=0;Le<y.length;Le++)Be(y[Le]);return this},close:function(){return i[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),i[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(i[this.hash]){if(this.raiseEvent("before-destroy"),this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this._resizeObserver&&this._resizeObserver.disconnect(),this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(t.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),i[this.navigator.hash]=null,delete i[this.navigator.hash],this.navigator=null),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),i[this.hash]=null,delete i[this.hash],this.canvas=null,this.container=null,t._viewers.delete(this.element),this.element=null,this.raiseEvent("destroy"),this.removeAllHandlers()}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(y){return this.innerTracker.setTracking(y),this.outerTracker.setTracking(y),this.raiseEvent("mouse-enabled",{enabled:y}),this},areControlsEnabled:function(){var y=this.controls.length,S;for(S=0;S<this.controls.length;S++)y=y&&this.controls[S].isVisible();return y},setControlsEnabled:function(y){return y?f(this):c(this),this.raiseEvent("controls-enabled",{enabled:y}),this},setDebugMode:function(y){for(var S=0;S<this.world.getItemCount();S++)this.world.getItemAt(S).debugMode=y;this.debugMode=y,this.forceRedraw()},setAjaxHeaders:function(y,S){if(y===null&&(y={}),!t.isPlainObject(y)){console.error("[Viewer.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}if(S===void 0&&(S=!0),this.ajaxHeaders=y,S){for(var O=0;O<this.world.getItemCount();O++)this.world.getItemAt(O)._updateAjaxHeaders(!0);if(this.navigator&&this.navigator.setAjaxHeaders(this.ajaxHeaders,!0),this.referenceStrip&&this.referenceStrip.miniViewers)for(var X in this.referenceStrip.miniViewers)this.referenceStrip.miniViewers[X].setAjaxHeaders(this.ajaxHeaders,!0)}},addButton:function(y){this.buttonGroup.addButton(y)},isFullPage:function(){return i[this.hash].fullPage},setFullPage:function(y){var S=document.body,O=S.style,X=document.documentElement.style,z=this,ae,Q;if(y===this.isFullPage())return this;var Se={fullPage:y,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",Se),Se.preventDefaultAction)return this;if(y){for(this.elementSize=t.getElementSize(this.element),this.pageScroll=t.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=O.margin,this.docMargin=X.margin,O.margin="0",X.margin="0",this.bodyPadding=O.padding,this.docPadding=X.padding,O.padding="0",X.padding="0",this.bodyWidth=O.width,this.docWidth=X.width,O.width="100%",X.width="100%",this.bodyHeight=O.height,this.docHeight=X.height,O.height="100%",X.height="100%",this.bodyDisplay=O.display,O.display="block",this.previousBody=[],i[this.hash].prevElementParent=this.element.parentNode,i[this.hash].prevNextSibling=this.element.nextSibling,i[this.hash].prevElementWidth=this.element.style.width,i[this.hash].prevElementHeight=this.element.style.height,ae=S.childNodes.length,Q=0;Q<ae;Q++)this.previousBody.push(S.childNodes[0]),S.removeChild(S.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,S.appendChild(this.toolbar.element),t.addClass(this.toolbar.element,"fullpage")),t.addClass(this.element,"fullpage"),S.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=t.getElementSize(this.element).y-t.getElementSize(this.toolbar.element).y+"px"),i[this.hash].fullPage=!0,t.delegate(this,V)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,O.margin=this.bodyMargin,X.margin=this.docMargin,O.padding=this.bodyPadding,X.padding=this.docPadding,O.width=this.bodyWidth,X.width=this.docWidth,O.height=this.bodyHeight,X.height=this.docHeight,O.display=this.bodyDisplay,S.removeChild(this.element),ae=this.previousBody.length,Q=0;Q<ae;Q++)S.appendChild(this.previousBody.shift());t.removeClass(this.element,"fullpage"),i[this.hash].prevElementParent.insertBefore(this.element,i[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(S.removeChild(this.toolbar.element),t.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=i[this.hash].prevElementWidth,this.element.style.height=i[this.hash].prevElementHeight;var Be=0,Le=function(){t.setPageScroll(z.pageScroll);var me=t.getPageScroll();Be++,Be<10&&(me.x!==z.pageScroll.x||me.y!==z.pageScroll.y)&&t.requestAnimationFrame(Le)};t.requestAnimationFrame(Le),i[this.hash].fullPage=!1,t.delegate(this,q)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:y}),this},setFullScreen:function(y){var S=this;if(!t.supportsFullScreen)return this.setFullPage(y);if(t.isFullScreen()===y)return this;var O={fullScreen:y,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",O),O.preventDefaultAction)return this;if(y){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var X=function(){var z=t.isFullScreen();z||(t.removeEvent(document,t.fullScreenEventName,X),t.removeEvent(document,t.fullScreenErrorEventName,X),S.setFullPage(!1),S.isFullPage()&&(S.element.style.width=S.fullPageStyleWidth,S.element.style.height=S.fullPageStyleHeight)),S.navigator&&S.viewport&&setTimeout(function(){S.navigator.update(S.viewport)}),S.raiseEvent("full-screen",{fullScreen:z})};t.addEvent(document,t.fullScreenEventName,X),t.addEvent(document,t.fullScreenErrorEventName,X),t.requestFullScreen(document.body)}else t.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},isFullScreen:function(){return t.isFullScreen()&&this.isFullPage()},setVisible:function(y){return this.container.style.visibility=y?"":"hidden",this.raiseEvent("visible",{visible:y}),this},addTiledImage:function(y){t.console.assert(y,"[Viewer.addTiledImage] options is required"),t.console.assert(y.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),t.console.assert(!y.replace||y.index>-1&&y.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var S=this;y.replace&&(y.replaceItem=S.world.getItemAt(y.index)),this._hideMessage(),y.placeholderFillStyle===void 0&&(y.placeholderFillStyle=this.placeholderFillStyle),y.opacity===void 0&&(y.opacity=this.opacity),y.preload===void 0&&(y.preload=this.preload),y.compositeOperation===void 0&&(y.compositeOperation=this.compositeOperation),y.crossOriginPolicy===void 0&&(y.crossOriginPolicy=y.tileSource.crossOriginPolicy!==void 0?y.tileSource.crossOriginPolicy:this.crossOriginPolicy),y.ajaxWithCredentials===void 0&&(y.ajaxWithCredentials=this.ajaxWithCredentials),y.loadTilesWithAjax===void 0&&(y.loadTilesWithAjax=this.loadTilesWithAjax),t.isPlainObject(y.ajaxHeaders)||(y.ajaxHeaders={});var O={options:y};function X(Q){for(var Se=0;Se<S._loadQueue.length;Se++)if(S._loadQueue[Se]===O){S._loadQueue.splice(Se,1);break}S._loadQueue.length===0&&z(O),S.raiseEvent("add-item-failed",Q),y.error&&y.error(Q)}function z(Q){S.collectionMode&&(S.world.arrange({immediately:Q.options.collectionImmediately,rows:S.collectionRows,columns:S.collectionColumns,layout:S.collectionLayout,tileSize:S.collectionTileSize,tileMargin:S.collectionTileMargin}),S.world.setAutoRefigureSizes(!0))}if(t.isArray(y.tileSource)){setTimeout(function(){X({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:y.tileSource,options:y})});return}this._loadQueue.push(O);function ae(){for(var Q,Se,Be;S._loadQueue.length&&(Q=S._loadQueue[0],!!Q.tileSource);){if(S._loadQueue.splice(0,1),Q.options.replace){var Le=S.world.getIndexOfItem(Q.options.replaceItem);Le!==-1&&(Q.options.index=Le),S.world.removeItem(Q.options.replaceItem)}Se=new t.TiledImage({viewer:S,source:Q.tileSource,viewport:S.viewport,drawer:S.drawer,tileCache:S.tileCache,imageLoader:S.imageLoader,x:Q.options.x,y:Q.options.y,width:Q.options.width,height:Q.options.height,fitBounds:Q.options.fitBounds,fitBoundsPlacement:Q.options.fitBoundsPlacement,clip:Q.options.clip,placeholderFillStyle:Q.options.placeholderFillStyle,opacity:Q.options.opacity,preload:Q.options.preload,degrees:Q.options.degrees,flipped:Q.options.flipped,compositeOperation:Q.options.compositeOperation,springStiffness:S.springStiffness,animationTime:S.animationTime,minZoomImageRatio:S.minZoomImageRatio,wrapHorizontal:S.wrapHorizontal,wrapVertical:S.wrapVertical,immediateRender:S.immediateRender,blendTime:S.blendTime,alwaysBlend:S.alwaysBlend,minPixelRatio:S.minPixelRatio,smoothTileEdgesMinZoom:S.smoothTileEdgesMinZoom,iOSDevice:S.iOSDevice,crossOriginPolicy:Q.options.crossOriginPolicy,ajaxWithCredentials:Q.options.ajaxWithCredentials,loadTilesWithAjax:Q.options.loadTilesWithAjax,ajaxHeaders:Q.options.ajaxHeaders,debugMode:S.debugMode,subPixelRoundingForTransparency:S.subPixelRoundingForTransparency}),S.collectionMode&&S.world.setAutoRefigureSizes(!1),S.navigator&&(Be=t.extend({},Q.options,{replace:!1,originalTiledImage:Se,tileSource:Q.tileSource}),S.navigator.addTiledImage(Be)),S.world.addItem(Se,{index:Q.options.index}),S._loadQueue.length===0&&z(Q),S.world.getItemCount()===1&&!S.preserveViewport&&S.viewport.goHome(!0),Q.options.success&&Q.options.success({item:Se})}}a(this,y.tileSource,y,function(Q){O.tileSource=Q,ae()},function(Q){Q.options=y,X(Q),ae()})},addSimpleImage:function(y){t.console.assert(y,"[Viewer.addSimpleImage] options is required"),t.console.assert(y.url,"[Viewer.addSimpleImage] options.url is required");var S=t.extend({},y,{tileSource:{type:"image",url:y.url}});delete S.url,this.addTiledImage(S)},addLayer:function(y){var S=this;t.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var O=t.extend({},y,{success:function(X){S.raiseEvent("add-layer",{options:y,drawer:X.item})},error:function(X){S.raiseEvent("add-layer-failed",X)}});return this.addTiledImage(O),this},getLayerAtLevel:function(y){return t.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(y)},getLevelOfLayer:function(y){return t.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(y)},getLayersCount:function(){return t.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(y,S){return t.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(y,S)},removeLayer:function(y){return t.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(y)},forceRedraw:function(){return i[this.hash].forceRedraw=!0,this},forceResize:function(){i[this.hash].needsResize=!0,i[this.hash].forceResize=!0},bindSequenceControls:function(){var y=t.delegate(this,p),S=t.delegate(this,m),O=t.delegate(this,this.goToNextPage),X=t.delegate(this,this.goToPreviousPage),z=this.navImages,ae=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(ae=!1),this.previousButton=new t.Button({element:this.previousButton?t.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.PreviousPage"),srcRest:J(this.prefixUrl,z.previous.REST),srcGroup:J(this.prefixUrl,z.previous.GROUP),srcHover:J(this.prefixUrl,z.previous.HOVER),srcDown:J(this.prefixUrl,z.previous.DOWN),onRelease:X,onFocus:y,onBlur:S}),this.nextButton=new t.Button({element:this.nextButton?t.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.NextPage"),srcRest:J(this.prefixUrl,z.next.REST),srcGroup:J(this.prefixUrl,z.next.GROUP),srcHover:J(this.prefixUrl,z.next.HOVER),srcDown:J(this.prefixUrl,z.next.DOWN),onRelease:O,onFocus:y,onBlur:S}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),ae&&(this.paging=new t.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:t.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var y=t.delegate(this,ye),S=t.delegate(this,Re),O=t.delegate(this,$),X=t.delegate(this,he),z=t.delegate(this,De),ae=t.delegate(this,Pe),Q=t.delegate(this,Ce),Se=t.delegate(this,ot),Be=t.delegate(this,et),Le=t.delegate(this,ct),me=t.delegate(this,p),Ge=t.delegate(this,m),_=this.navImages,x=[],b=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(b=!1),this.showZoomControl&&(x.push(this.zoomInButton=new t.Button({element:this.zoomInButton?t.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomIn"),srcRest:J(this.prefixUrl,_.zoomIn.REST),srcGroup:J(this.prefixUrl,_.zoomIn.GROUP),srcHover:J(this.prefixUrl,_.zoomIn.HOVER),srcDown:J(this.prefixUrl,_.zoomIn.DOWN),onPress:y,onRelease:S,onClick:O,onEnter:y,onExit:S,onFocus:me,onBlur:Ge})),x.push(this.zoomOutButton=new t.Button({element:this.zoomOutButton?t.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomOut"),srcRest:J(this.prefixUrl,_.zoomOut.REST),srcGroup:J(this.prefixUrl,_.zoomOut.GROUP),srcHover:J(this.prefixUrl,_.zoomOut.HOVER),srcDown:J(this.prefixUrl,_.zoomOut.DOWN),onPress:X,onRelease:S,onClick:z,onEnter:X,onExit:S,onFocus:me,onBlur:Ge}))),this.showHomeControl&&x.push(this.homeButton=new t.Button({element:this.homeButton?t.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Home"),srcRest:J(this.prefixUrl,_.home.REST),srcGroup:J(this.prefixUrl,_.home.GROUP),srcHover:J(this.prefixUrl,_.home.HOVER),srcDown:J(this.prefixUrl,_.home.DOWN),onRelease:ae,onFocus:me,onBlur:Ge})),this.showFullPageControl&&x.push(this.fullPageButton=new t.Button({element:this.fullPageButton?t.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.FullPage"),srcRest:J(this.prefixUrl,_.fullpage.REST),srcGroup:J(this.prefixUrl,_.fullpage.GROUP),srcHover:J(this.prefixUrl,_.fullpage.HOVER),srcDown:J(this.prefixUrl,_.fullpage.DOWN),onRelease:Q,onFocus:me,onBlur:Ge})),this.showRotationControl&&(x.push(this.rotateLeftButton=new t.Button({element:this.rotateLeftButton?t.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateLeft"),srcRest:J(this.prefixUrl,_.rotateleft.REST),srcGroup:J(this.prefixUrl,_.rotateleft.GROUP),srcHover:J(this.prefixUrl,_.rotateleft.HOVER),srcDown:J(this.prefixUrl,_.rotateleft.DOWN),onRelease:Se,onFocus:me,onBlur:Ge})),x.push(this.rotateRightButton=new t.Button({element:this.rotateRightButton?t.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateRight"),srcRest:J(this.prefixUrl,_.rotateright.REST),srcGroup:J(this.prefixUrl,_.rotateright.GROUP),srcHover:J(this.prefixUrl,_.rotateright.HOVER),srcDown:J(this.prefixUrl,_.rotateright.DOWN),onRelease:Be,onFocus:me,onBlur:Ge}))),this.showFlipControl&&x.push(this.flipButton=new t.Button({element:this.flipButton?t.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Flip"),srcRest:J(this.prefixUrl,_.flip.REST),srcGroup:J(this.prefixUrl,_.flip.GROUP),srcHover:J(this.prefixUrl,_.flip.HOVER),srcDown:J(this.prefixUrl,_.flip.DOWN),onRelease:Le,onFocus:me,onBlur:Ge})),b?(this.buttonGroup=new t.ButtonGroup({buttons:x,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",t.delegate(this,we)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT})):this.customButtons=x),this},currentPage:function(){return this._sequenceIndex},goToPage:function(y){return this.tileSources&&y>=0&&y<this.tileSources.length&&(this._sequenceIndex=y,this._updateSequenceButtons(y),this.open(this.tileSources[y]),this.referenceStrip&&this.referenceStrip.setFocus(y),this.raiseEvent("page",{page:y})),this},addOverlay:function(y,S,O,X){var z;if(t.isPlainObject(y)?z=y:z={element:y,location:S,placement:O,onDraw:X},y=t.getElement(z.element),l(this.currentOverlays,y)>=0)return this;var ae=o(this,z);return this.currentOverlays.push(ae),ae.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:y,location:z.location,placement:z.placement}),this},updateOverlay:function(y,S,O){var X;return y=t.getElement(y),X=l(this.currentOverlays,y),X>=0&&(this.currentOverlays[X].update(S,O),i[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:y,location:S,placement:O})),this},removeOverlay:function(y){var S;return y=t.getElement(y),S=l(this.currentOverlays,y),S>=0&&(this.currentOverlays[S].destroy(),this.currentOverlays.splice(S,1),i[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:y})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return i[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(y){var S;return y=t.getElement(y),S=l(this.currentOverlays,y),S>=0?this.currentOverlays[S]:null},_updateSequenceButtons:function(y){this.nextButton&&(!this.tileSources||this.tileSources.length-1===y?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(y>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(y){this._hideMessage();var S=t.makeNeutralElement("div");S.appendChild(document.createTextNode(y)),this.messageDiv=t.makeCenteredNode(S),t.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var y=this.messageDiv;y&&(y.parentNode.removeChild(y),delete this.messageDiv)},gestureSettingsByDeviceType:function(y){switch(y){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var y,S=this.currentOverlays.length;for(y=0;y<S;y++)this.currentOverlays[y].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new t.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else t.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),t.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){t.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var y=t.pixelDensityRatio,S=t.getCurrentPixelDensityRatio();y!==S&&(t.pixelDensityRatio=S,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var y=this._sequenceIndex-1;this.navPrevNextWrap&&y<0&&(y+=this.tileSources.length),this.goToPage(y)},goToNextPage:function(){var y=this._sequenceIndex+1;this.navPrevNextWrap&&y>=this.tileSources.length&&(y=0),this.goToPage(y)},isAnimating:function(){return i[this.hash].animating}});function r(y){return y=t.getElement(y),new t.Point(y.clientWidth===0?1:y.clientWidth,y.clientHeight===0?1:y.clientHeight)}function a(y,S,O,X,z){var ae=y;if(t.type(S)==="string"){if(S.match(/^\s*<.*>\s*$/))S=t.parseXml(S);else if(S.match(/^\s*[{[].*[}\]]\s*$/))try{var Q=t.parseJSON(S);S=Q}catch{}}function Se(Be,Le){Be.ready?X(Be):(Be.addHandler("ready",function(){X(Be)}),Be.addHandler("open-failed",function(me){z({message:me.message,source:Le})}))}setTimeout(function(){if(t.type(S)==="string")S=new t.TileSource({url:S,crossOriginPolicy:O.crossOriginPolicy!==void 0?O.crossOriginPolicy:y.crossOriginPolicy,ajaxWithCredentials:y.ajaxWithCredentials,ajaxHeaders:O.ajaxHeaders?O.ajaxHeaders:y.ajaxHeaders,splitHashDataForPost:y.splitHashDataForPost,useCanvas:y.useCanvas,success:function(Ge){X(Ge.tileSource)}}),S.addHandler("open-failed",function(Ge){z(Ge)});else if(t.isPlainObject(S)||S.nodeType)if(S.crossOriginPolicy===void 0&&(O.crossOriginPolicy!==void 0||y.crossOriginPolicy!==void 0)&&(S.crossOriginPolicy=O.crossOriginPolicy!==void 0?O.crossOriginPolicy:y.crossOriginPolicy),S.ajaxWithCredentials===void 0&&(S.ajaxWithCredentials=y.ajaxWithCredentials),S.useCanvas===void 0&&(S.useCanvas=y.useCanvas),t.isFunction(S.getTileUrl)){var Be=new t.TileSource(S);Be.getTileUrl=S.getTileUrl,X(Be)}else{var Le=t.TileSource.determineType(ae,S);if(!Le){z({message:"Unable to load TileSource",source:S});return}var me=Le.prototype.configure.apply(ae,[S]);Se(new Le(me),S)}else Se(S,S)})}function o(y,S){if(S instanceof t.Overlay)return S;var O=null;if(S.element)O=t.getElement(S.element);else{var X=S.id?S.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);O=t.getElement(S.id),O||(O=document.createElement("a"),O.href="#/overlay/"+X),O.id=X,t.addClass(O,S.className?S.className:"openseadragon-overlay")}var z=S.location,ae=S.width,Q=S.height;if(!z){var Se=S.x,Be=S.y;if(S.px!==void 0){var Le=y.viewport.imageToViewportRectangle(new t.Rect(S.px,S.py,ae||0,Q||0));Se=Le.x,Be=Le.y,ae=ae!==void 0?Le.width:void 0,Q=Q!==void 0?Le.height:void 0}z=new t.Point(Se,Be)}var me=S.placement;return me&&t.type(me)==="string"&&(me=t.Placement[S.placement.toUpperCase()]),new t.Overlay({element:O,location:z,placement:me,onDraw:S.onDraw,checkResize:S.checkResize,width:ae,height:Q,rotationMode:S.rotationMode})}function l(y,S){var O;for(O=y.length-1;O>=0;O--)if(y[O].element===S)return O;return-1}function h(y,S){return t.requestAnimationFrame(function(){S(y)})}function u(y){t.requestAnimationFrame(function(){d(y)})}function c(y){y.autoHideControls&&(y.controlsShouldFade=!0,y.controlsFadeBeginTime=t.now()+y.controlsFadeDelay,window.setTimeout(function(){u(y)},y.controlsFadeDelay))}function d(y){var S,O,X,z;if(y.controlsShouldFade){for(S=t.now(),O=S-y.controlsFadeBeginTime,X=1-O/y.controlsFadeLength,X=Math.min(1,X),X=Math.max(0,X),z=y.controls.length-1;z>=0;z--)y.controls[z].autoFade&&y.controls[z].setOpacity(X);X>0&&u(y)}}function f(y){var S;for(y.controlsShouldFade=!1,S=y.controls.length-1;S>=0;S--)y.controls[S].setOpacity(1)}function p(){f(this)}function m(){c(this)}function v(y){var S={tracker:y.eventSource,position:y.position,originalEvent:y.originalEvent,preventDefault:y.preventDefault};this.raiseEvent("canvas-contextmenu",S),y.preventDefault=S.preventDefault}function g(y){var S={originalEvent:y.originalEvent,preventDefaultAction:!1,preventVerticalPan:y.preventVerticalPan||!this.panVertical,preventHorizontalPan:y.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",S),!S.preventDefaultAction&&!y.ctrl&&!y.alt&&!y.meta)switch(y.keyCode){case 38:S.preventVerticalPan||(y.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 40:S.preventVerticalPan||(y.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 37:S.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 39:S.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 187:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),y.preventDefault=!0;break;case 189:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),y.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),y.preventDefault=!0;break;case 87:S.preventVerticalPan||(y.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 83:S.preventVerticalPan||(y.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 65:S.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 68:S.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 82:y.shift?this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement),this.viewport.applyConstraints(),y.preventDefault=!0;break;case 70:this.viewport.toggleFlip(),y.preventDefault=!0;break;case 74:this.goToPreviousPage();break;case 75:this.goToNextPage();break;default:y.preventDefault=!1;break}else y.preventDefault=!1}function T(y){var S={originalEvent:y.originalEvent};this.raiseEvent("canvas-key-press",S)}function w(y){var S,O=document.activeElement===this.canvas;O||this.canvas.focus(),this.viewport.flipped&&(y.position.x=this.viewport.getContainerSize().x-y.position.x);var X={tracker:y.eventSource,position:y.position,quick:y.quick,shift:y.shift,originalEvent:y.originalEvent,originalTarget:y.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",X),!X.preventDefaultAction&&this.viewport&&y.quick&&(S=this.gestureSettingsByDeviceType(y.pointerType),S.clickToZoom===!0&&(this.viewport.zoomBy(y.shift?1/this.zoomPerClick:this.zoomPerClick,S.zoomToRefPoint?this.viewport.pointFromPixel(y.position,!0):null),this.viewport.applyConstraints()),S.dblClickDragToZoom&&(i[this.hash].draggingToZoom===!0?(i[this.hash].lastClickTime=null,i[this.hash].draggingToZoom=!1):i[this.hash].lastClickTime=t.now()))}function E(y){var S,O={tracker:y.eventSource,position:y.position,shift:y.shift,originalEvent:y.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",O),!O.preventDefaultAction&&this.viewport&&(S=this.gestureSettingsByDeviceType(y.pointerType),S.dblClickToZoom&&(this.viewport.zoomBy(y.shift?1/this.zoomPerClick:this.zoomPerClick,S.zoomToRefPoint?this.viewport.pointFromPixel(y.position,!0):null),this.viewport.applyConstraints()))}function P(y){var S,O={tracker:y.eventSource,pointerType:y.pointerType,position:y.position,delta:y.delta,speed:y.speed,direction:y.direction,shift:y.shift,originalEvent:y.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",O),S=this.gestureSettingsByDeviceType(y.pointerType),!O.preventDefaultAction&&this.viewport){if(S.dblClickDragToZoom&&i[this.hash].draggingToZoom){var X=Math.pow(this.zoomPerDblClickDrag,y.delta.y/50);this.viewport.zoomBy(X)}else if(S.dragToPan&&!i[this.hash].draggingToZoom){if(this.panHorizontal||(y.delta.x=0),this.panVertical||(y.delta.y=0),this.viewport.flipped&&(y.delta.x=-y.delta.x),this.constrainDuringPan){var z=this.viewport.deltaPointsFromPixels(y.delta.negate());this.viewport.centerSpringX.target.value+=z.x,this.viewport.centerSpringY.target.value+=z.y;var ae=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=z.x,this.viewport.centerSpringY.target.value-=z.y,ae.xConstrained&&(y.delta.x=0),ae.yConstrained&&(y.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(y.delta.negate()),S.flickEnabled&&!this.constrainDuringPan)}}}function C(y){var S,O={tracker:y.eventSource,pointerType:y.pointerType,position:y.position,speed:y.speed,direction:y.direction,shift:y.shift,originalEvent:y.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",O),S=this.gestureSettingsByDeviceType(y.pointerType),!O.preventDefaultAction&&this.viewport){if(!i[this.hash].draggingToZoom&&S.flickEnabled&&y.speed>=S.flickMinSpeed){var X=0;this.panHorizontal&&(X=S.flickMomentum*y.speed*Math.cos(y.direction));var z=0;this.panVertical&&(z=S.flickMomentum*y.speed*Math.sin(y.direction));var ae=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),Q=this.viewport.pointFromPixel(new t.Point(ae.x-X,ae.y-z));this.viewport.panTo(Q,!1)}this.viewport.applyConstraints()}S.dblClickDragToZoom&&i[this.hash].draggingToZoom===!0&&(i[this.hash].draggingToZoom=!1)}function D(y){this.raiseEvent("canvas-enter",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,buttons:y.buttons,pointers:y.pointers,insideElementPressed:y.insideElementPressed,buttonDownAny:y.buttonDownAny,originalEvent:y.originalEvent})}function B(y){this.raiseEvent("canvas-exit",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,buttons:y.buttons,pointers:y.pointers,insideElementPressed:y.insideElementPressed,buttonDownAny:y.buttonDownAny,originalEvent:y.originalEvent})}function H(y){var S;if(this.raiseEvent("canvas-press",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,insideElementPressed:y.insideElementPressed,insideElementReleased:y.insideElementReleased,originalEvent:y.originalEvent}),S=this.gestureSettingsByDeviceType(y.pointerType),S.dblClickDragToZoom){var O=i[this.hash].lastClickTime,X=t.now();if(O===null)return;X-O<this.dblClickTimeThreshold&&(i[this.hash].draggingToZoom=!0),i[this.hash].lastClickTime=null}}function I(y){this.raiseEvent("canvas-release",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,insideElementPressed:y.insideElementPressed,insideElementReleased:y.insideElementReleased,originalEvent:y.originalEvent})}function N(y){this.raiseEvent("canvas-nonprimary-press",{tracker:y.eventSource,position:y.position,pointerType:y.pointerType,button:y.button,buttons:y.buttons,originalEvent:y.originalEvent})}function M(y){this.raiseEvent("canvas-nonprimary-release",{tracker:y.eventSource,position:y.position,pointerType:y.pointerType,button:y.button,buttons:y.buttons,originalEvent:y.originalEvent})}function R(y){var S,O,X,z,ae={tracker:y.eventSource,pointerType:y.pointerType,gesturePoints:y.gesturePoints,lastCenter:y.lastCenter,center:y.center,lastDistance:y.lastDistance,distance:y.distance,shift:y.shift,originalEvent:y.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",ae),this.viewport&&(S=this.gestureSettingsByDeviceType(y.pointerType),S.pinchToZoom&&(!ae.preventDefaultPanAction||!ae.preventDefaultZoomAction)&&(O=this.viewport.pointFromPixel(y.center,!0),S.zoomToRefPoint&&!ae.preventDefaultPanAction&&(X=this.viewport.pointFromPixel(y.lastCenter,!0),z=X.minus(O),this.panHorizontal||(z.x=0),this.panVertical||(z.y=0),this.viewport.panBy(z,!0)),ae.preventDefaultZoomAction||this.viewport.zoomBy(y.distance/y.lastDistance,O,!0),this.viewport.applyConstraints()),S.pinchRotate&&!ae.preventDefaultRotateAction)){var Q=Math.atan2(y.gesturePoints[0].currentPos.y-y.gesturePoints[1].currentPos.y,y.gesturePoints[0].currentPos.x-y.gesturePoints[1].currentPos.x),Se=Math.atan2(y.gesturePoints[0].lastPos.y-y.gesturePoints[1].lastPos.y,y.gesturePoints[0].lastPos.x-y.gesturePoints[1].lastPos.x);O=this.viewport.pointFromPixel(y.center,!0),this.viewport.rotateTo(this.viewport.getRotation(!0)+(Q-Se)*(180/Math.PI),O,!0)}}function F(y){this.raiseEvent("canvas-focus",{tracker:y.eventSource,originalEvent:y.originalEvent})}function L(y){this.raiseEvent("canvas-blur",{tracker:y.eventSource,originalEvent:y.originalEvent})}function Z(y){var S,O,X,z,ae;z=t.now(),ae=z-this._lastScrollTime,ae>this.minScrollDeltaTime?(this._lastScrollTime=z,S={tracker:y.eventSource,position:y.position,scroll:y.scroll,shift:y.shift,originalEvent:y.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",S),!S.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(y.position.x=this.viewport.getContainerSize().x-y.position.x),O=this.gestureSettingsByDeviceType(y.pointerType),O.scrollToZoom&&(X=Math.pow(this.zoomPerScroll,y.scroll),this.viewport.zoomBy(X,O.zoomToRefPoint?this.viewport.pointFromPixel(y.position,!0):null),this.viewport.applyConstraints())),y.preventDefault=S.preventDefault):y.preventDefault=!0}function V(y){i[this.hash].mouseInside=!0,f(this),this.raiseEvent("container-enter",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,buttons:y.buttons,pointers:y.pointers,insideElementPressed:y.insideElementPressed,buttonDownAny:y.buttonDownAny,originalEvent:y.originalEvent})}function q(y){y.pointers<1&&(i[this.hash].mouseInside=!1,i[this.hash].animating||c(this)),this.raiseEvent("container-exit",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,buttons:y.buttons,pointers:y.pointers,insideElementPressed:y.insideElementPressed,buttonDownAny:y.buttonDownAny,originalEvent:y.originalEvent})}function pe(y){Y(y),y.isOpen()?y._updateRequestId=h(y,pe):y._updateRequestId=!1}function G(y,S){var O=y.viewport,X=O.getZoom(),z=O.getCenter();O.resize(S,y.preserveImageSizeOnResize),O.panTo(z,!0);var ae;if(y.preserveImageSizeOnResize)ae=i[y.hash].prevContainerSize.x/S.x;else{var Q=new t.Point(0,0),Se=new t.Point(i[y.hash].prevContainerSize.x,i[y.hash].prevContainerSize.y).distanceTo(Q),Be=new t.Point(S.x,S.y).distanceTo(Q);ae=Be/Se*i[y.hash].prevContainerSize.x/S.x}O.zoomTo(X*ae,null,!0),i[y.hash].prevContainerSize=S,i[y.hash].forceRedraw=!0,i[y.hash].needsResize=!1,i[y.hash].forceResize=!1}function Y(y){if(!(y._opening||!i[y.hash])){if(y.autoResize||i[y.hash].forceResize){var S;if(y._autoResizePolling){S=r(y.container);var O=i[y.hash].prevContainerSize;S.equals(O)||(i[y.hash].needsResize=!0)}i[y.hash].needsResize&&G(y,S||r(y.container))}var X=y.viewport.update(),z=y.world.update()||X;X&&y.raiseEvent("viewport-change"),y.referenceStrip&&(z=y.referenceStrip.update(y.viewport)||z);var ae=i[y.hash].animating;!ae&&z&&(y.raiseEvent("animation-start"),f(y));var Q=ae&&!z;Q&&(i[y.hash].animating=!1),(z||Q||i[y.hash].forceRedraw||y.world.needsDraw())&&(de(y),y._drawOverlays(),y.navigator&&y.navigator.update(y.viewport),i[y.hash].forceRedraw=!1,z&&y.raiseEvent("animation")),Q&&(y.raiseEvent("animation-finish"),i[y.hash].mouseInside||c(y)),i[y.hash].animating=z}}function de(y){y.imageLoader.clear(),y.drawer.clear(),y.world.draw(),y.raiseEvent("update-viewport",{})}function J(y,S){return y?y+S:S}function ye(){i[this.hash].lastZoomTime=t.now(),i[this.hash].zoomFactor=this.zoomPerSecond,i[this.hash].zooming=!0,Me(this)}function he(){i[this.hash].lastZoomTime=t.now(),i[this.hash].zoomFactor=1/this.zoomPerSecond,i[this.hash].zooming=!0,Me(this)}function Re(){i[this.hash].zooming=!1}function Me(y){t.requestAnimationFrame(t.delegate(y,re))}function re(){var y,S,O;i[this.hash].zooming&&this.viewport&&(y=t.now(),S=y-i[this.hash].lastZoomTime,O=Math.pow(i[this.hash].zoomFactor,S/1e3),this.viewport.zoomBy(O),this.viewport.applyConstraints(),i[this.hash].lastZoomTime=y,Me(this))}function $(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function De(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function we(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function Pe(){this.viewport&&this.viewport.goHome()}function Ce(){this.isFullPage()&&!t.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function ot(){if(this.viewport){var y=this.viewport.getRotation();this.viewport.flipped?y+=this.rotationIncrement:y-=this.rotationIncrement,this.viewport.setRotation(y)}}function et(){if(this.viewport){var y=this.viewport.getRotation();this.viewport.flipped?y-=this.rotationIncrement:y+=this.rotationIncrement,this.viewport.setRotation(y)}}function ct(){this.viewport.toggleFlip()}}(e),function(t){t.Navigator=function(h){var u=h.viewer,c=this,d,f;h.element||h.id?(h.element?(h.id&&t.console.warn("Given option.id for Navigator was ignored since option.element was provided and is being used instead."),h.element.id?h.id=h.element.id:h.id="navigator-"+t.now(),this.element=h.element):this.element=document.getElementById(h.id),h.controlOptions={anchor:t.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(h.id="navigator-"+t.now(),this.element=t.makeNeutralElement("div"),h.controlOptions={anchor:t.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:h.autoFade},h.position&&(h.position==="BOTTOM_RIGHT"?h.controlOptions.anchor=t.ControlAnchor.BOTTOM_RIGHT:h.position==="BOTTOM_LEFT"?h.controlOptions.anchor=t.ControlAnchor.BOTTOM_LEFT:h.position==="TOP_RIGHT"?h.controlOptions.anchor=t.ControlAnchor.TOP_RIGHT:h.position==="TOP_LEFT"?h.controlOptions.anchor=t.ControlAnchor.TOP_LEFT:h.position==="ABSOLUTE"&&(h.controlOptions.anchor=t.ControlAnchor.ABSOLUTE,h.controlOptions.top=h.top,h.controlOptions.left=h.left,h.controlOptions.height=h.height,h.controlOptions.width=h.width))),this.element.id=h.id,this.element.className+=" navigator",h=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.navigatorSizeRatio},h,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:h.animationTime,autoResize:!1,minZoomImageRatio:1,background:h.background,opacity:h.opacity,borderColor:h.borderColor,displayRegionColor:h.displayRegionColor}),h.minPixelRatio=this.minPixelRatio=u.minPixelRatio,t.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new t.Point(1,1),this.totalBorderWidths=new t.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),h.controlOptions.anchor!==t.ControlAnchor.NONE&&function(v,g){v.margin="0px",v.border=g+"px solid "+h.borderColor,v.padding="0px",v.background=h.background,v.opacity=h.opacity,v.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=t.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(v,g){v.position="relative",v.top="0px",v.left="0px",v.fontSize="0px",v.overflow="hidden",v.border=g+"px solid "+h.displayRegionColor,v.margin="0px",v.padding="0px",v.background="transparent",v.float="left",v.cssFloat="left",v.styleFloat="left",v.zIndex=999999999,v.cursor="default",v.boxSizing="content-box"}(this.displayRegion.style,this.borderWidth),t.setElementPointerEventsNone(this.displayRegion),t.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=t.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",t.setElementPointerEventsNone(this.displayRegionContainer),t.setElementTouchActionNone(this.displayRegionContainer),u.addControl(this.element,h.controlOptions),this._resizeWithViewer=h.controlOptions.anchor!==t.ControlAnchor.ABSOLUTE&&h.controlOptions.anchor!==t.ControlAnchor.NONE,h.width&&h.height?(this.setWidth(h.width),this.setHeight(h.height)):this._resizeWithViewer&&(d=t.getElementSize(u.element),this.element.style.height=Math.round(d.y*h.sizeRatio)+"px",this.element.style.width=Math.round(d.x*h.sizeRatio)+"px",this.oldViewerSize=d,f=t.getElementSize(this.element),this.elementArea=f.x*f.y),this.oldContainerSize=new t.Point(0,0),t.Viewer.apply(this,[h]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function p(v,g){o(c.displayRegionContainer,v),o(c.displayRegion,-v),c.viewport.setRotation(v,g)}if(h.navigatorRotate){var m=h.viewer.viewport?h.viewer.viewport.getRotation():h.viewer.degrees||0;p(m,!0),h.viewer.addHandler("rotate",function(v){p(v.degrees,v.immediately)})}this.innerTracker.destroy(),this.innerTracker=new t.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:t.delegate(this,s),clickHandler:t.delegate(this,i),releaseHandler:t.delegate(this,r),scrollHandler:t.delegate(this,a),preProcessEventHandler:function(v){v.eventType==="wheel"&&(v.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",t.setElementPointerEventsNone(this.canvas),t.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){c.viewport&&c.viewport.goHome(!0)}),u.world.addHandler("item-index-change",function(v){window.setTimeout(function(){var g=c.world.getItemAt(v.previousIndex);c.world.setItemIndex(g,v.newIndex)},1)}),u.world.addHandler("remove-item",function(v){var g=v.item,T=c._getMatchingItem(g);T&&c.world.removeItem(T)}),this.update(u.viewport)},t.extend(t.Navigator.prototype,t.EventSource.prototype,t.Viewer.prototype,{updateSize:function(){if(this.viewport){var h=new t.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);h.equals(this.oldContainerSize)||(this.viewport.resize(h,!0),this.viewport.goHome(!0),this.oldContainerSize=h,this.drawer.clear(),this.world.draw())}},setWidth:function(h){this.width=h,this.element.style.width=typeof h=="number"?h+"px":h,this._resizeWithViewer=!1,this.updateSize()},setHeight:function(h){this.height=h,this.element.style.height=typeof h=="number"?h+"px":h,this._resizeWithViewer=!1,this.updateSize()},setFlip:function(h){return this.viewport.setFlip(h),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(h){l(this.displayRegion,h),l(this.canvas,h),l(this.element,h)},update:function(h){var u,c,d,f,p,m;if(u=t.getElementSize(this.viewer.element),this._resizeWithViewer&&u.x&&u.y&&!u.equals(this.oldViewerSize)&&(this.oldViewerSize=u,this.maintainSizeRatio||!this.elementArea?(c=u.x*this.sizeRatio,d=u.y*this.sizeRatio):(c=Math.sqrt(this.elementArea*(u.x/u.y)),d=this.elementArea/c),this.element.style.width=Math.round(c)+"px",this.element.style.height=Math.round(d)+"px",this.elementArea||(this.elementArea=c*d),this.updateSize()),h&&this.viewport){if(f=h.getBoundsNoRotate(!0),p=this.viewport.pixelFromPointNoRotate(f.getTopLeft(),!1),m=this.viewport.pixelFromPointNoRotate(f.getBottomRight(),!1).minus(this.totalBorderWidths),!this.navigatorRotate){var v=h.getRotation(!0);o(this.displayRegion,-v)}var g=this.displayRegion.style;g.display=this.world.getItemCount()?"block":"none",g.top=p.y.toFixed(2)+"px",g.left=p.x.toFixed(2)+"px";var T=m.x-p.x,w=m.y-p.y;g.width=Math.round(Math.max(T,0))+"px",g.height=Math.round(Math.max(w,0))+"px"}},addTiledImage:function(h){var u=this,c=h.originalTiledImage;delete h.original;var d=t.extend({},h,{success:function(f){var p=f.item;p._originalForNavigator=c,u._matchBounds(p,c,!0),u._matchOpacity(p,c),u._matchCompositeOperation(p,c);function m(){u._matchBounds(p,c)}function v(){u._matchOpacity(p,c)}function g(){u._matchCompositeOperation(p,c)}c.addHandler("bounds-change",m),c.addHandler("clip-change",m),c.addHandler("opacity-change",v),c.addHandler("composite-operation-change",g)}});return t.Viewer.prototype.addTiledImage.apply(this,[d])},destroy:function(){return t.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(h){for(var u=this.world.getItemCount(),c,d=0;d<u;d++)if(c=this.world.getItemAt(d),c._originalForNavigator===h)return c;return null},_matchBounds:function(h,u,c){var d=u.getBoundsNoRotate();h.setPosition(d.getTopLeft(),c),h.setWidth(d.width,c),h.setRotation(u.getRotation(),c),h.setClip(u.getClip()),h.setFlip(u.getFlip())},_matchOpacity:function(h,u){h.setOpacity(u.opacity)},_matchCompositeOperation:function(h,u){h.setCompositeOperation(u.compositeOperation)}});function i(h){var u={tracker:h.eventSource,position:h.position,quick:h.quick,shift:h.shift,originalEvent:h.originalEvent,preventDefaultAction:!1};if(this.viewer.raiseEvent("navigator-click",u),!u.preventDefaultAction&&h.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(h.position.x=this.viewport.getContainerSize().x-h.position.x);var c=this.viewport.pointFromPixel(h.position);this.panVertical?this.panHorizontal||(c.x=this.viewer.viewport.getCenter(!0).x):c.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(c),this.viewer.viewport.applyConstraints()}}function s(h){var u={tracker:h.eventSource,position:h.position,delta:h.delta,speed:h.speed,direction:h.direction,shift:h.shift,originalEvent:h.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",u),!u.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(h.delta.x=0),this.panVertical||(h.delta.y=0),this.viewer.viewport.flipped&&(h.delta.x=-h.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(h.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function r(h){h.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function a(h){var u={tracker:h.eventSource,position:h.position,scroll:h.scroll,shift:h.shift,originalEvent:h.originalEvent,preventDefault:h.preventDefault};this.viewer.raiseEvent("navigator-scroll",u),h.preventDefault=u.preventDefault}function o(h,u){l(h,"rotate("+u+"deg)")}function l(h,u){h.style.webkitTransform=u,h.style.mozTransform=u,h.style.msTransform=u,h.style.oTransform=u,h.style.transform=u}}(e),function(t){var i={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};t.extend(t,{getString:function(s){var r=s.split("."),a=null,o=arguments,l=i,h;for(h=0;h<r.length-1;h++)l=l[r[h]]||{};return a=l[r[h]],typeof a!="string"&&(t.console.error("Untranslated source string:",s),a=""),a.replace(/\{\d+\}/g,function(u){var c=parseInt(u.match(/\d+/),10)+1;return c<o.length?o[c]:""})},setString:function(s,r){var a=s.split("."),o=i,l;for(l=0;l<a.length-1;l++)o[a[l]]||(o[a[l]]={}),o=o[a[l]];o[a[l]]=r}})}(e),function(t){t.Point=function(i,s){this.x=typeof i=="number"?i:0,this.y=typeof s=="number"?s:0},t.Point.prototype={clone:function(){return new t.Point(this.x,this.y)},plus:function(i){return new t.Point(this.x+i.x,this.y+i.y)},minus:function(i){return new t.Point(this.x-i.x,this.y-i.y)},times:function(i){return new t.Point(this.x*i,this.y*i)},divide:function(i){return new t.Point(this.x/i,this.y/i)},negate:function(){return new t.Point(-this.x,-this.y)},distanceTo:function(i){return Math.sqrt(Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2))},squaredDistanceTo:function(i){return Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2)},apply:function(i){return new t.Point(i(this.x),i(this.y))},equals:function(i){return i instanceof t.Point&&this.x===i.x&&this.y===i.y},rotate:function(i,s){s=s||new t.Point(0,0);var r,a;if(i%90===0){var o=t.positiveModulo(i,360);switch(o){case 0:r=1,a=0;break;case 90:r=0,a=1;break;case 180:r=-1,a=0;break;case 270:r=0,a=-1;break}}else{var l=i*Math.PI/180;r=Math.cos(l),a=Math.sin(l)}var h=r*(this.x-s.x)-a*(this.y-s.y)+s.x,u=a*(this.x-s.x)+r*(this.y-s.y)+s.y;return new t.Point(h,u)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(e),function(t){t.TileSource=function(s,r,a,o,l,h){var u=this,c=arguments,d,f;if(t.isPlainObject(s)?d=s:d={width:c[0],height:c[1],tileSize:c[2],tileOverlap:c[3],minLevel:c[4],maxLevel:c[5]},t.EventSource.call(this),t.extend(!0,this,d),!this.success){for(f=0;f<arguments.length;f++)if(t.isFunction(arguments[f])){this.success=arguments[f];break}}this.success&&this.addHandler("ready",function(p){u.success(p)}),t.type(arguments[0])==="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new t.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=d.width&&d.height?d.width/d.height:1,this.dimensions=new t.Point(d.width,d.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=d.tileOverlap?d.tileOverlap:0,this.minLevel=d.minLevel?d.minLevel:0,this.maxLevel=d.maxLevel!==void 0&&d.maxLevel!==null?d.maxLevel:d.width&&d.height?Math.ceil(Math.log(Math.max(d.width,d.height))/Math.log(2)):0,this.success&&t.isFunction(this.success)&&this.success(this))},t.TileSource.prototype={getTileSize:function(s){return t.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(s){return this._tileWidth?this._tileWidth:this.getTileSize(s)},getTileHeight:function(s){return this._tileHeight?this._tileHeight:this.getTileSize(s)},setMaxLevel:function(s){this.maxLevel=s,this._memoizeLevelScale()},getLevelScale:function(s){return this._memoizeLevelScale(),this.getLevelScale(s)},_memoizeLevelScale:function(){var s={},r;for(r=0;r<=this.maxLevel;r++)s[r]=1/Math.pow(2,this.maxLevel-r);this.getLevelScale=function(a){return s[a]}},getNumTiles:function(s){var r=this.getLevelScale(s),a=Math.ceil(r*this.dimensions.x/this.getTileWidth(s)),o=Math.ceil(r*this.dimensions.y/this.getTileHeight(s));return new t.Point(a,o)},getPixelRatio:function(s){var r=this.dimensions.times(this.getLevelScale(s)),a=1/r.x*t.pixelDensityRatio,o=1/r.y*t.pixelDensityRatio;return new t.Point(a,o)},getClosestLevel:function(){var s,r;for(s=this.minLevel+1;s<=this.maxLevel&&(r=this.getNumTiles(s),!(r.x>1||r.y>1));s++);return s-1},getTileAtPoint:function(s,r){var a=r.x>=0&&r.x<=1&&r.y>=0&&r.y<=1/this.aspectRatio;t.console.assert(a,"[TileSource.getTileAtPoint] must be called with a valid point.");var o=this.dimensions.x*this.getLevelScale(s),l=r.x*o,h=r.y*o,u=Math.floor(l/this.getTileWidth(s)),c=Math.floor(h/this.getTileHeight(s));r.x>=1&&(u=this.getNumTiles(s).x-1);var d=1e-15;return r.y>=1/this.aspectRatio-d&&(c=this.getNumTiles(s).y-1),new t.Point(u,c)},getTileBounds:function(s,r,a,o){var l=this.dimensions.times(this.getLevelScale(s)),h=this.getTileWidth(s),u=this.getTileHeight(s),c=r===0?0:h*r-this.tileOverlap,d=a===0?0:u*a-this.tileOverlap,f=h+(r===0?1:2)*this.tileOverlap,p=u+(a===0?1:2)*this.tileOverlap,m=1/l.x;return f=Math.min(f,l.x-c),p=Math.min(p,l.y-d),o?new t.Rect(0,0,f,p):new t.Rect(c*m,d*m,f*m,p*m)},getImageInfo:function(s){var r=this,a,o,l,h,u,c,d;s&&(u=s.split("/"),c=u[u.length-1],d=c.lastIndexOf("."),d>-1&&(u[u.length-1]=c.slice(0,d)));var f=null;if(this.splitHashDataForPost){var p=s.indexOf("#");p!==-1&&(f=s.substring(p+1),s=s.substr(0,p))}o=function(m){typeof m=="string"&&(m=t.parseXml(m));var v=t.TileSource.determineType(r,m,s);if(!v){r.raiseEvent("open-failed",{message:"Unable to load TileSource",source:s});return}h=v.prototype.configure.apply(r,[m,s,f]),h.ajaxWithCredentials===void 0&&(h.ajaxWithCredentials=r.ajaxWithCredentials),l=new v(h),r.ready=!0,r.raiseEvent("ready",{tileSource:l})},s.match(/\.js$/)?(a=s.split("/").pop().replace(".js",""),t.jsonp({url:s,async:!1,callbackName:a,callback:o})):t.makeAjaxRequest({url:s,postData:f,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(m){var v=i(m);o(v)},error:function(m,v){var g;try{g="HTTP "+m.status+" attempting to load TileSource: "+s}catch{var T;typeof v>"u"||!v.toString?T="Unknown error":T=v.toString(),g=T+" attempting to load TileSource: "+s}t.console.error(g),r.raiseEvent("open-failed",{message:g,source:s,postData:f})}})},supports:function(s,r){return!1},configure:function(s,r,a){throw new Error("Method not implemented.")},getTileUrl:function(s,r,a){throw new Error("Method not implemented.")},getTilePostData:function(s,r,a){return null},getTileAjaxHeaders:function(s,r,a){return{}},getTileHashKey:function(s,r,a,o,l,h){function u(c){return l?c+"+"+JSON.stringify(l):c}return u(typeof o!="string"?s+"/"+r+"_"+a:o)},tileExists:function(s,r,a){var o=this.getNumTiles(s);return s>=this.minLevel&&s<=this.maxLevel&&r>=0&&a>=0&&r<o.x&&a<o.y},hasTransparency:function(s,r,a,o){return!!s||r.match(".png")},downloadTileStart:function(s){var r=s.userData,a=new Image;r.image=a,r.request=null;var o=function(l){if(!a){s.finish(null,r.request,"Image load failed: undefined Image instance.");return}a.onload=a.onerror=a.onabort=null,s.finish(l?null:a,r.request,l)};a.onload=function(){o()},a.onabort=a.onerror=function(){o("Image load aborted.")},s.loadWithAjax?r.request=t.makeAjaxRequest({url:s.src,withCredentials:s.ajaxWithCredentials,headers:s.ajaxHeaders,responseType:"arraybuffer",postData:s.postData,success:function(l){var h;try{h=new window.Blob([l.response])}catch(d){var u=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(d.name==="TypeError"&&u){var c=new u;c.append(l.response),h=c.getBlob()}}h.size===0?o("Empty image response."):a.src=(window.URL||window.webkitURL).createObjectURL(h)},error:function(l){o("Image load aborted - XHR error")}}):(s.crossOriginPolicy!==!1&&(a.crossOrigin=s.crossOriginPolicy),a.src=s.src)},downloadTileAbort:function(s){s.userData.request&&s.userData.request.abort();var r=s.userData.image;s.userData.image&&(r.onload=r.onerror=r.onabort=null)},createTileCache:function(s,r,a){s._data=r},destroyTileCache:function(s){s._data=null,s._renderedContext=null},getTileCacheData:function(s){return s._data},getTileCacheDataAsImage:function(s){return s._data},getTileCacheDataAsContext2D:function(s){if(!s._renderedContext){var r=document.createElement("canvas");r.width=s._data.width,r.height=s._data.height,s._renderedContext=r.getContext("2d"),s._renderedContext.drawImage(s._data,0,0),s._data=null}return s._renderedContext}},t.extend(!0,t.TileSource.prototype,t.EventSource.prototype);function i(s){var r=s.responseText,a=s.status,o,l;if(s){if(s.status!==200&&s.status!==0)throw a=s.status,o=a===404?"Not Found":s.statusText,new Error(t.getString("Errors.Status",a,o))}else throw new Error(t.getString("Errors.Security"));if(r.match(/^\s*<.*/))try{l=s.responseXML&&s.responseXML.documentElement?s.responseXML:t.parseXml(r)}catch{l=s.responseText}else if(r.match(/\s*[{[].*/))try{l=t.parseJSON(r)}catch{l=r}else l=r;return l}t.TileSource.determineType=function(s,r,a){var o;for(o in e)if(o.match(/.+TileSource$/)&&t.isFunction(e[o])&&t.isFunction(e[o].prototype.supports)&&e[o].prototype.supports.call(s,r,a))return e[o];return t.console.error("No TileSource was able to open %s %s",a,r),null}}(e),function(t){t.DziTileSource=function(r,a,o,l,h,u,c,d,f){var p,m,v,g;if(t.isPlainObject(r)?g=r:g={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=g.tilesUrl,this.fileFormat=g.fileFormat,this.displayRects=g.displayRects,this.displayRects)for(p=this.displayRects.length-1;p>=0;p--)for(m=this.displayRects[p],v=m.minLevel;v<=m.maxLevel;v++)this._levelRects[v]||(this._levelRects[v]=[]),this._levelRects[v].push(m);t.TileSource.apply(this,[g])},t.extend(t.DziTileSource.prototype,t.TileSource.prototype,{supports:function(r,a){var o;return r.Image?o=r.Image.xmlns:r.documentElement&&(r.documentElement.localName==="Image"||r.documentElement.tagName==="Image")&&(o=r.documentElement.namespaceURI),o=(o||"").toLowerCase(),o.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||o.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(r,a,o){var l;return t.isPlainObject(r)?l=s(this,r):l=i(this,r),a&&!l.tilesUrl&&(l.tilesUrl=a.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),a.search(/\.(dzi|xml|js)\?/)!==-1?l.queryParams=a.match(/\?.*/):l.queryParams=""),l},getTileUrl:function(r,a,o){return[this.tilesUrl,r,"/",a,"_",o,".",this.fileFormat,this.queryParams].join("")},tileExists:function(r,a,o){var l=this._levelRects[r],h,u,c,d,f,p,m;if(this.minLevel&&r<this.minLevel||this.maxLevel&&r>this.maxLevel)return!1;if(!l||!l.length)return!0;for(m=l.length-1;m>=0;m--)if(h=l[m],!(r<h.minLevel||r>h.maxLevel)&&(u=this.getLevelScale(r),c=h.x*u,d=h.y*u,f=c+h.width*u,p=d+h.height*u,c=Math.floor(c/this._tileWidth),d=Math.floor(d/this._tileWidth),f=Math.ceil(f/this._tileWidth),p=Math.ceil(p/this._tileWidth),c<=a&&a<f&&d<=o&&o<p))return!0;return!1}});function i(r,a){if(!a||!a.documentElement)throw new Error(t.getString("Errors.Xml"));var o=a.documentElement,l=o.localName||o.tagName,h=a.documentElement.namespaceURI,u=null,c=[],d,f,p,m,v;if(l==="Image")try{if(m=o.getElementsByTagName("Size")[0],m===void 0&&(m=o.getElementsByTagNameNS(h,"Size")[0]),u={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:o.getAttribute("Url"),Format:o.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(o.getAttribute("Overlap"),10),TileSize:parseInt(o.getAttribute("TileSize"),10),Size:{Height:parseInt(m.getAttribute("Height"),10),Width:parseInt(m.getAttribute("Width"),10)}}},!t.imageFormatSupported(u.Image.Format))throw new Error(t.getString("Errors.ImageFormat",u.Image.Format.toUpperCase()));for(d=o.getElementsByTagName("DisplayRect"),d===void 0&&(d=o.getElementsByTagNameNS(h,"DisplayRect")[0]),v=0;v<d.length;v++)f=d[v],p=f.getElementsByTagName("Rect")[0],p===void 0&&(p=f.getElementsByTagNameNS(h,"Rect")[0]),c.push({Rect:{X:parseInt(p.getAttribute("X"),10),Y:parseInt(p.getAttribute("Y"),10),Width:parseInt(p.getAttribute("Width"),10),Height:parseInt(p.getAttribute("Height"),10),MinLevel:parseInt(f.getAttribute("MinLevel"),10),MaxLevel:parseInt(f.getAttribute("MaxLevel"),10)}});return c.length&&(u.Image.DisplayRect=c),s(r,u)}catch(w){throw w instanceof Error?w:new Error(t.getString("Errors.Dzi"))}else{if(l==="Collection")throw new Error(t.getString("Errors.Dzc"));if(l==="Error"){var g=o.getElementsByTagName("Message")[0],T=g.firstChild.nodeValue;throw new Error(T)}}throw new Error(t.getString("Errors.Dzi"))}function s(r,a){var o=a.Image,l=o.Url,h=o.Format,u=o.Size,c=o.DisplayRect||[],d=parseInt(u.Width,10),f=parseInt(u.Height,10),p=parseInt(o.TileSize,10),m=parseInt(o.Overlap,10),v=[],g,T;for(T=0;T<c.length;T++)g=c[T].Rect,v.push(new t.DisplayRect(parseInt(g.X,10),parseInt(g.Y,10),parseInt(g.Width,10),parseInt(g.Height,10),parseInt(g.MinLevel,10),parseInt(g.MaxLevel,10)));return t.extend(!0,{width:d,height:f,tileSize:p,tileOverlap:m,minLevel:null,maxLevel:null,tilesUrl:l,fileFormat:h,displayRects:v},a)}}(e),function(t){t.IIIFTileSource=function(o){if(t.extend(!0,this,o),this._id=this["@id"]||this.id||this.identifier||null,!(this.height&&this.width&&this._id))throw new Error("IIIF required parameters (width, height, or id) not provided.");if(o.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=o.version,this.tile_width&&this.tile_height)o.tileWidth=this.tile_width,o.tileHeight=this.tile_height;else if(this.tile_width)o.tileSize=this.tile_width;else if(this.tile_height)o.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)o.tileWidth=this.tiles[0].width,o.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var l=0;l<this.tiles.length;l++)for(var h=0;h<this.tiles[l].scaleFactors.length;h++){var u=this.tiles[l].scaleFactors[h];this.scale_factors.push(u),o.tileSizePerScaleFactor[u]={width:this.tiles[l].width,height:this.tiles[l].height||this.tiles[l].width}}}else if(i(o)){for(var c=Math.min(this.height,this.width),d=[256,512,1024],f=[],p=0;p<d.length;p++)d[p]<=c&&f.push(d[p]);f.length>0?o.tileSize=Math.max.apply(null,f):o.tileSize=c}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,o.levels=s(this),t.extend(!0,o,{width:o.levels[o.levels.length-1].width,height:o.levels[o.levels.length-1].height,tileSize:Math.max(o.height,o.width),tileOverlap:0,minLevel:0,maxLevel:o.levels.length-1}),this.levels=o.levels):t.console.error("Nothing in the info.json to construct image pyramids from");if(!o.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)o.maxLevel=Number(Math.round(Math.log(Math.max(this.width,this.height),2)));else{var m=Math.max.apply(null,this.scale_factors);o.maxLevel=Math.round(Math.log(m)*Math.LOG2E)}if(this.sizes){var v=this.sizes.length;(v===o.maxLevel||v===o.maxLevel+1)&&(this.levelSizes=this.sizes.slice().sort(function(g,T){return g.width-T.width}),v===o.maxLevel&&this.levelSizes.push({width:this.width,height:this.height}))}t.TileSource.apply(this,[o])},t.extend(t.IIIFTileSource.prototype,t.TileSource.prototype,{supports:function(o,l){return o.protocol&&o.protocol==="http://iiif.io/api/image"||o["@context"]&&(o["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||o["@context"]==="http://iiif.io/api/image/1/context.json")||o.profile&&o.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||o.identifier&&o.width&&o.height?!0:!!(o.documentElement&&o.documentElement.tagName==="info"&&o.documentElement.namespaceURI==="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(o,l,h){if(t.isPlainObject(o)){if(!o["@context"])o["@context"]="http://iiif.io/api/image/1.0/context.json",o["@id"]=l.replace("/info.json",""),o.version=1;else{var c=o["@context"];if(Array.isArray(c)){for(var d=0;d<c.length;d++)if(typeof c[d]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(c[d])||c[d]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){c=c[d];break}}switch(c){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":o.version=1;break;case"http://iiif.io/api/image/2/context.json":o.version=2;break;case"http://iiif.io/api/image/3/context.json":o.version=3;break;default:t.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(o.preferredFormats){for(var f=0;f<o.preferredFormats.length;f++)if(e.imageFormatSupported(o.preferredFormats[f])){o.tileFormat=o.preferredFormats[f];break}}return o}else{var u=r(o);return u["@context"]="http://iiif.io/api/image/1.0/context.json",u["@id"]=l.replace("/info.xml",""),u.version=1,u}},getTileWidth:function(o){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileWidth.call(this,o);var l=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[l]?this.tileSizePerScaleFactor[l].width:this._tileWidth},getTileHeight:function(o){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileHeight.call(this,o);var l=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[l]?this.tileSizePerScaleFactor[l].height:this._tileHeight},getLevelScale:function(o){if(this.emulateLegacyImagePyramid){var l=NaN;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(l=this.levels[o].width/this.levels[this.maxLevel].width),l}return t.TileSource.prototype.getLevelScale.call(this,o)},getNumTiles:function(o){if(this.emulateLegacyImagePyramid){var l=this.getLevelScale(o);return l?new t.Point(1,1):new t.Point(0,0)}if(this.levelSizes){var h=this.levelSizes[o],u=Math.ceil(h.width/this.getTileWidth(o)),c=Math.ceil(h.height/this.getTileHeight(o));return new t.Point(u,c)}else return t.TileSource.prototype.getNumTiles.call(this,o)},getTileAtPoint:function(o,l){if(this.emulateLegacyImagePyramid)return new t.Point(0,0);if(this.levelSizes){var h=l.x>=0&&l.x<=1&&l.y>=0&&l.y<=1/this.aspectRatio;t.console.assert(h,"[TileSource.getTileAtPoint] must be called with a valid point.");var u=this.levelSizes[o].width,c=l.x*u,d=l.y*u,f=Math.floor(c/this.getTileWidth(o)),p=Math.floor(d/this.getTileHeight(o));l.x>=1&&(f=this.getNumTiles(o).x-1);var m=1e-15;return l.y>=1/this.aspectRatio-m&&(p=this.getNumTiles(o).y-1),new t.Point(f,p)}return t.TileSource.prototype.getTileAtPoint.call(this,o,l)},getTileUrl:function(o,l,h){if(this.emulateLegacyImagePyramid){var u=null;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(u=this.levels[o].url),u}var c="0",d=Math.pow(.5,this.maxLevel-o),f,p,m,v,g,T,w,E,P,C,D,B,H,I,N,M;return this.levelSizes?(f=this.levelSizes[o].width,p=this.levelSizes[o].height):(f=Math.ceil(this.width*d),p=Math.ceil(this.height*d)),m=this.getTileWidth(o),v=this.getTileHeight(o),g=Math.round(m/d),T=Math.round(v/d),this.version===1?N="native."+this.tileFormat:N="default."+this.tileFormat,f<m&&p<v?(this.version===2&&f===this.width?B="full":this.version===3&&f===this.width&&p===this.height?B="max":this.version===3?B=f+","+p:B=f+",",w="full"):(E=l*g,P=h*T,C=Math.min(g,this.width-E),D=Math.min(T,this.height-P),l===0&&h===0&&C===this.width&&D===this.height?w="full":w=[E,P,C,D].join(","),H=Math.min(m,f-l*m),I=Math.min(v,p-h*v),this.version===2&&H===this.width?B="full":this.version===3&&H===this.width&&I===this.height?B="max":this.version===3?B=H+","+I:B=H+","),M=[this._id,w,B,c,N].join("/"),M},__testonly__:{canBeTiled:i,constructLevels:s}});function i(o){var l=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],h=Array.isArray(o.profile)?o.profile[0]:o.profile,u=l.indexOf(h)!==-1,c=!1;return o.version===2&&o.profile.length>1&&o.profile[1].supports&&(c=o.profile[1].supports.indexOf("sizeByW")!==-1),o.version===3&&o.extraFeatures&&(c=o.extraFeatures.indexOf("sizeByWh")!==-1),!u||c}function s(o){for(var l=[],h=0;h<o.sizes.length;h++)l.push({url:o._id+"/full/"+o.sizes[h].width+","+(o.version===3?o.sizes[h].height:"")+"/0/default."+o.tileFormat,width:o.sizes[h].width,height:o.sizes[h].height});return l.sort(function(u,c){return u.width-c.width})}function r(o){if(!o||!o.documentElement)throw new Error(t.getString("Errors.Xml"));var l=o.documentElement,h=l.tagName,u=null;if(h==="info")try{return u={},a(l,u),u}catch(c){throw c instanceof Error?c:new Error(t.getString("Errors.IIIF"))}throw new Error(t.getString("Errors.IIIF"))}function a(o,l,h){var u,c;if(o.nodeType===3&&h)c=o.nodeValue.trim(),c.match(/^\d*$/)&&(c=Number(c)),l[h]?(t.isArray(l[h])||(l[h]=[l[h]]),l[h].push(c)):l[h]=c;else if(o.nodeType===1)for(u=0;u<o.childNodes.length;u++)a(o.childNodes[u],l,o.nodeName)}}(e),function(t){t.OsmTileSource=function(i,s,r,a,o){var l;t.isPlainObject(i)?l=i:l={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!l.width||!l.height)&&(l.width=65572864,l.height=65572864),l.tileSize||(l.tileSize=256,l.tileOverlap=0),l.tilesUrl||(l.tilesUrl="http://tile.openstreetmap.org/"),l.minLevel=8,t.TileSource.apply(this,[l])},t.extend(t.OsmTileSource.prototype,t.TileSource.prototype,{supports:function(i,s){return i.type&&i.type==="openstreetmaps"},configure:function(i,s,r){return i},getTileUrl:function(i,s,r){return this.tilesUrl+(i-8)+"/"+s+"/"+r+".png"}})}(e),function(t){t.TmsTileSource=function(i,s,r,a,o){var l;t.isPlainObject(i)?l=i:l={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var h=Math.ceil(l.width/256)*256,u=Math.ceil(l.height/256)*256,c;h>u?c=h/256:c=u/256,l.maxLevel=Math.ceil(Math.log(c)/Math.log(2))-1,l.tileSize=256,l.width=h,l.height=u,t.TileSource.apply(this,[l])},t.extend(t.TmsTileSource.prototype,t.TileSource.prototype,{supports:function(i,s){return i.type&&i.type==="tiledmapservice"},configure:function(i,s,r){return i},getTileUrl:function(i,s,r){var a=this.getNumTiles(i).y-1;return this.tilesUrl+i+"/"+s+"/"+(a-r)+".png"}})}(e),function(t){t.ZoomifyTileSource=function(i){typeof i.tileSize>"u"&&(i.tileSize=256),typeof i.fileFormat>"u"&&(i.fileFormat="jpg",this.fileFormat=i.fileFormat);var s={x:i.width,y:i.height};for(i.imageSizes=[{x:i.width,y:i.height}],i.gridSize=[this._getGridSize(i.width,i.height,i.tileSize)];parseInt(s.x,10)>i.tileSize||parseInt(s.y,10)>i.tileSize;)s.x=Math.floor(s.x/2),s.y=Math.floor(s.y/2),i.imageSizes.push({x:s.x,y:s.y}),i.gridSize.push(this._getGridSize(s.x,s.y,i.tileSize));i.imageSizes.reverse(),i.gridSize.reverse(),i.minLevel=0,i.maxLevel=i.gridSize.length-1,e.TileSource.apply(this,[i])},t.extend(t.ZoomifyTileSource.prototype,t.TileSource.prototype,{_getGridSize:function(i,s,r){return{x:Math.ceil(i/r),y:Math.ceil(s/r)}},_calculateAbsoluteTileNumber:function(i,s,r){for(var a=0,o={},l=0;l<i;l++)o=this.gridSize[l],a+=o.x*o.y;return o=this.gridSize[i],a+=o.x*r+s,a},supports:function(i,s){return i.type&&i.type==="zoomifytileservice"},configure:function(i,s,r){return i},getTileUrl:function(i,s,r){var a=0,o=this._calculateAbsoluteTileNumber(i,s,r);return a=Math.floor(o/256),this.tilesUrl+"TileGroup"+a+"/"+i+"-"+s+"-"+r+"."+this.fileFormat}})}(e),function(t){t.LegacyTileSource=function(a){var o,l,h;t.isArray(a)&&(o={type:"legacy-image-pyramid",levels:a}),o.levels=i(o.levels),o.levels.length>0?(l=o.levels[o.levels.length-1].width,h=o.levels[o.levels.length-1].height):(l=0,h=0,t.console.error("No supported image formats found")),t.extend(!0,o,{width:l,height:h,tileSize:Math.max(h,l),tileOverlap:0,minLevel:0,maxLevel:o.levels.length>0?o.levels.length-1:0}),t.TileSource.apply(this,[o]),this.levels=o.levels},t.extend(t.LegacyTileSource.prototype,t.TileSource.prototype,{supports:function(a,o){return a.type&&a.type==="legacy-image-pyramid"||a.documentElement&&a.documentElement.getAttribute("type")==="legacy-image-pyramid"},configure:function(a,o,l){var h;return t.isPlainObject(a)?h=r(this,a):h=s(this,a),h},getLevelScale:function(a){var o=NaN;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(o=this.levels[a].width/this.levels[this.maxLevel].width),o},getNumTiles:function(a){var o=this.getLevelScale(a);return o?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(a,o,l){var h=null;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(h=this.levels[a].url),h}});function i(a){var o=[],l,h;for(h=0;h<a.length;h++)l=a[h],l.height&&l.width&&l.url?o.push({url:l.url,width:Number(l.width),height:Number(l.height)}):t.console.error("Unsupported image format: %s",l.url?l.url:"<no URL>");return o.sort(function(u,c){return u.height-c.height})}function s(a,o){if(!o||!o.documentElement)throw new Error(t.getString("Errors.Xml"));var l=o.documentElement,h=l.tagName,u=null,c=[],d,f;if(h==="image")try{for(u={type:l.getAttribute("type"),levels:[]},c=l.getElementsByTagName("level"),f=0;f<c.length;f++)d=c[f],u.levels.push({url:d.getAttribute("url"),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10)});return r(a,u)}catch(p){throw p instanceof Error?p:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(h==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(h==="error")throw new Error("Error: "+o)}throw new Error("Unknown element "+h)}function r(a,o){return o.levels}}(e),function(t){t.ImageTileSource=function(i){i=t.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},i),t.TileSource.apply(this,[i])},t.extend(t.ImageTileSource.prototype,t.TileSource.prototype,{supports:function(i,s){return i.type&&i.type==="image"},configure:function(i,s,r){return i},getImageInfo:function(i){var s=this._image=new Image,r=this;this.crossOriginPolicy&&(s.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(s.useCredentials=this.ajaxWithCredentials),t.addEvent(s,"load",function(){r.width=s.naturalWidth,r.height=s.naturalHeight,r.aspectRatio=r.width/r.height,r.dimensions=new t.Point(r.width,r.height),r._tileWidth=r.width,r._tileHeight=r.height,r.tileOverlap=0,r.minLevel=0,r.levels=r._buildLevels(),r.maxLevel=r.levels.length-1,r.ready=!0,r.raiseEvent("ready",{tileSource:r})}),t.addEvent(s,"error",function(){r.raiseEvent("open-failed",{message:"Error loading image at "+i,source:i})}),s.src=i},getLevelScale:function(i){var s=NaN;return i>=this.minLevel&&i<=this.maxLevel&&(s=this.levels[i].width/this.levels[this.maxLevel].width),s},getNumTiles:function(i){var s=this.getLevelScale(i);return s?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(i,s,r){var a=null;return i>=this.minLevel&&i<=this.maxLevel&&(a=this.levels[i].url),a},getContext2D:function(i,s,r){var a=null;return i>=this.minLevel&&i<=this.maxLevel&&(a=this.levels[i].context2D),a},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var i=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!t.supportsCanvas||!this.useCanvas)return delete this._image,i;var s=this._image.naturalWidth,r=this._image.naturalHeight,a=document.createElement("canvas"),o=a.getContext("2d");if(a.width=s,a.height=r,o.drawImage(this._image,0,0,s,r),i[0].context2D=o,delete this._image,t.isCanvasTainted(a))return i;for(;s>=2&&r>=2;){s=Math.floor(s/2),r=Math.floor(r/2);var l=document.createElement("canvas"),h=l.getContext("2d");l.width=s,l.height=r,h.drawImage(a,0,0,s,r),i.splice(0,0,{context2D:h,width:s,height:r}),a=l,o=h}return i},_freeupCanvasMemory:function(){for(var i=0;i<this.levels.length;i++)this.levels[i].context2D&&(this.levels[i].context2D.canvas.height=0,this.levels[i].context2D.canvas.width=0)}})}(e),function(t){t.TileSourceCollection=function(i,s,r,a){t.console.error("TileSourceCollection is deprecated; use World instead")}}(e),function(t){t.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},t.Button=function(h){var u=this;t.EventSource.call(this),t.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},h),this.element=h.element||t.makeNeutralElement("div"),h.element||(this.imgRest=t.makeTransparentImage(this.srcRest),this.imgGroup=t.makeTransparentImage(this.srcGroup),this.imgHover=t.makeTransparentImage(this.srcHover),this.imgDown=t.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,t.setElementPointerEventsNone(this.imgRest),t.setElementPointerEventsNone(this.imgGroup),t.setElementPointerEventsNone(this.imgHover),t.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",t.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",t.Browser.vendor===t.BROWSERS.FIREFOX&&t.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=t.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new t.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(c){c.insideElementPressed?(o(u,t.ButtonState.DOWN),u.raiseEvent("enter",{originalEvent:c.originalEvent})):c.buttonDownAny||o(u,t.ButtonState.HOVER)},focusHandler:function(c){u.tracker.enterHandler(c),u.raiseEvent("focus",{originalEvent:c.originalEvent})},leaveHandler:function(c){l(u,t.ButtonState.GROUP),c.insideElementPressed&&u.raiseEvent("exit",{originalEvent:c.originalEvent})},blurHandler:function(c){u.tracker.leaveHandler(c),u.raiseEvent("blur",{originalEvent:c.originalEvent})},pressHandler:function(c){o(u,t.ButtonState.DOWN),u.raiseEvent("press",{originalEvent:c.originalEvent})},releaseHandler:function(c){c.insideElementPressed&&c.insideElementReleased?(l(u,t.ButtonState.HOVER),u.raiseEvent("release",{originalEvent:c.originalEvent})):c.insideElementPressed?l(u,t.ButtonState.GROUP):o(u,t.ButtonState.HOVER)},clickHandler:function(c){c.quick&&u.raiseEvent("click",{originalEvent:c.originalEvent})},keyHandler:function(c){c.keyCode===13?(u.raiseEvent("click",{originalEvent:c.originalEvent}),u.raiseEvent("release",{originalEvent:c.originalEvent}),c.preventDefault=!0):c.preventDefault=!1}}),l(this,t.ButtonState.REST)},t.extend(t.Button.prototype,t.EventSource.prototype,{notifyGroupEnter:function(){o(this,t.ButtonState.GROUP)},notifyGroupExit:function(){l(this,t.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,this.tracker.setTracking(!1),t.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,this.tracker.setTracking(!0),t.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function i(h){t.requestAnimationFrame(function(){s(h)})}function s(h){var u,c,d;h.shouldFade&&(u=t.now(),c=u-h.fadeBeginTime,d=1-c/h.fadeLength,d=Math.min(1,d),d=Math.max(0,d),h.imgGroup&&t.setElementOpacity(h.imgGroup,d,!0),d>0&&i(h))}function r(h){h.shouldFade=!0,h.fadeBeginTime=t.now()+h.fadeDelay,window.setTimeout(function(){i(h)},h.fadeDelay)}function a(h){h.shouldFade=!1,h.imgGroup&&t.setElementOpacity(h.imgGroup,1,!0)}function o(h,u){h.element.disabled||(u>=t.ButtonState.GROUP&&h.currentState===t.ButtonState.REST&&(a(h),h.currentState=t.ButtonState.GROUP),u>=t.ButtonState.HOVER&&h.currentState===t.ButtonState.GROUP&&(h.imgHover&&(h.imgHover.style.visibility=""),h.currentState=t.ButtonState.HOVER),u>=t.ButtonState.DOWN&&h.currentState===t.ButtonState.HOVER&&(h.imgDown&&(h.imgDown.style.visibility=""),h.currentState=t.ButtonState.DOWN))}function l(h,u){h.element.disabled||(u<=t.ButtonState.HOVER&&h.currentState===t.ButtonState.DOWN&&(h.imgDown&&(h.imgDown.style.visibility="hidden"),h.currentState=t.ButtonState.HOVER),u<=t.ButtonState.GROUP&&h.currentState===t.ButtonState.HOVER&&(h.imgHover&&(h.imgHover.style.visibility="hidden"),h.currentState=t.ButtonState.GROUP),u<=t.ButtonState.REST&&h.currentState===t.ButtonState.GROUP&&(r(h),h.currentState=t.ButtonState.REST))}}(e),function(t){t.ButtonGroup=function(i){t.extend(!0,this,{buttons:[],clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},i);var s=this.buttons.concat([]),r=this,a;if(this.element=i.element||t.makeNeutralElement("div"),!i.group)for(this.element.style.display="inline-block",a=0;a<s.length;a++)this.element.appendChild(s[a].element);t.setElementTouchActionNone(this.element),this.tracker=new t.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(o){var l;for(l=0;l<r.buttons.length;l++)r.buttons[l].notifyGroupEnter()},leaveHandler:function(o){var l;if(!o.insideElementPressed)for(l=0;l<r.buttons.length;l++)r.buttons[l].notifyGroupExit()}})},t.ButtonGroup.prototype={addButton:function(i){this.buttons.push(i),this.element.appendChild(i.element)},emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var i=this.buttons.pop();this.element.removeChild(i.element),i.destroy()}this.tracker.destroy(),this.element=null}}}(e),function(t){t.Rect=function(i,s,r,a,o){this.x=typeof i=="number"?i:0,this.y=typeof s=="number"?s:0,this.width=typeof r=="number"?r:0,this.height=typeof a=="number"?a:0,this.degrees=typeof o=="number"?o:0,this.degrees=t.positiveModulo(this.degrees,360);var l,h;this.degrees>=270?(l=this.getTopRight(),this.x=l.x,this.y=l.y,h=this.height,this.height=this.width,this.width=h,this.degrees-=270):this.degrees>=180?(l=this.getBottomRight(),this.x=l.x,this.y=l.y,this.degrees-=180):this.degrees>=90&&(l=this.getBottomLeft(),this.x=l.x,this.y=l.y,h=this.height,this.height=this.width,this.width=h,this.degrees-=90)},t.Rect.fromSummits=function(i,s,r){var a=i.distanceTo(s),o=i.distanceTo(r),l=s.minus(i),h=Math.atan(l.y/l.x);return l.x<0?h+=Math.PI:l.y<0&&(h+=2*Math.PI),new t.Rect(i.x,i.y,a,o,h/Math.PI*180)},t.Rect.prototype={clone:function(){return new t.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new t.Point(this.x,this.y)},getBottomRight:function(){return new t.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new t.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new t.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new t.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new t.Point(this.width,this.height)},equals:function(i){return i instanceof t.Rect&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height&&this.degrees===i.degrees},times:function(i){return new t.Rect(this.x*i,this.y*i,this.width*i,this.height*i,this.degrees)},translate:function(i){return new t.Rect(this.x+i.x,this.y+i.y,this.width,this.height,this.degrees)},union:function(i){var s=this.getBoundingBox(),r=i.getBoundingBox(),a=Math.min(s.x,r.x),o=Math.min(s.y,r.y),l=Math.max(s.x+s.width,r.x+r.width),h=Math.max(s.y+s.height,r.y+r.height);return new t.Rect(a,o,l-a,h-o)},intersection:function(i){var s=1e-10,r=[],a=this.getTopLeft();i.containsPoint(a,s)&&r.push(a);var o=this.getTopRight();i.containsPoint(o,s)&&r.push(o);var l=this.getBottomLeft();i.containsPoint(l,s)&&r.push(l);var h=this.getBottomRight();i.containsPoint(h,s)&&r.push(h);var u=i.getTopLeft();this.containsPoint(u,s)&&r.push(u);var c=i.getTopRight();this.containsPoint(c,s)&&r.push(c);var d=i.getBottomLeft();this.containsPoint(d,s)&&r.push(d);var f=i.getBottomRight();this.containsPoint(f,s)&&r.push(f);for(var p=this._getSegments(),m=i._getSegments(),v=0;v<p.length;v++)for(var g=p[v],T=0;T<m.length;T++){var w=m[T],E=P(g[0],g[1],w[0],w[1]);E&&r.push(E)}function P(M,R,F,L){var Z=R.minus(M),V=L.minus(F),q=-V.x*Z.y+Z.x*V.y;if(q===0)return null;var pe=(Z.x*(M.y-F.y)-Z.y*(M.x-F.x))/q,G=(V.x*(M.y-F.y)-V.y*(M.x-F.x))/q;return-s<=pe&&pe<=1-s&&-s<=G&&G<=1-s?new t.Point(M.x+G*Z.x,M.y+G*Z.y):null}if(r.length===0)return null;for(var C=r[0].x,D=r[0].x,B=r[0].y,H=r[0].y,I=1;I<r.length;I++){var N=r[I];N.x<C&&(C=N.x),N.x>D&&(D=N.x),N.y<B&&(B=N.y),N.y>H&&(H=N.y)}return new t.Rect(C,B,D-C,H-B)},_getSegments:function(){var i=this.getTopLeft(),s=this.getTopRight(),r=this.getBottomLeft(),a=this.getBottomRight();return[[i,s],[s,a],[a,r],[r,i]]},rotate:function(i,s){if(i=t.positiveModulo(i,360),i===0)return this.clone();s=s||this.getCenter();var r=this.getTopLeft().rotate(i,s),a=this.getTopRight().rotate(i,s),o=a.minus(r);o=o.apply(function(h){var u=1e-15;return Math.abs(h)<u?0:h});var l=Math.atan(o.y/o.x);return o.x<0?l+=Math.PI:o.y<0&&(l+=2*Math.PI),new t.Rect(r.x,r.y,this.width,this.height,l/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var i=this.getTopLeft(),s=this.getTopRight(),r=this.getBottomLeft(),a=this.getBottomRight(),o=Math.min(i.x,s.x,r.x,a.x),l=Math.max(i.x,s.x,r.x,a.x),h=Math.min(i.y,s.y,r.y,a.y),u=Math.max(i.y,s.y,r.y,a.y);return new t.Rect(o,h,l-o,u-h)},getIntegerBoundingBox:function(){var i=this.getBoundingBox(),s=Math.floor(i.x),r=Math.floor(i.y),a=Math.ceil(i.width+i.x-s),o=Math.ceil(i.height+i.y-r);return new t.Rect(s,r,a,o)},containsPoint:function(i,s){s=s||0;var r=this.getTopLeft(),a=this.getTopRight(),o=this.getBottomLeft(),l=a.minus(r),h=o.minus(r);return(i.x-r.x)*l.x+(i.y-r.y)*l.y>=-s&&(i.x-a.x)*l.x+(i.y-a.y)*l.y<=s&&(i.x-r.x)*h.x+(i.y-r.y)*h.y>=-s&&(i.x-o.x)*h.x+(i.y-o.y)*h.y<=s},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(e),function(t){var i={};t.ReferenceStrip=function(d){var f=this,p=d.viewer,m=t.getElementSize(p.element),v,g,T;for(d.id||(d.id="referencestrip-"+t.now(),this.element=t.makeNeutralElement("div"),this.element.id=d.id,this.element.className="referencestrip"),d=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.referenceStripSizeRatio,position:t.DEFAULT_SETTINGS.referenceStripPosition,scroll:t.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold},d,{element:this.element}),t.extend(this,d),i[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,g=this.element.style,g.marginTop="0px",g.marginRight="0px",g.marginBottom="0px",g.marginLeft="0px",g.left="0px",g.bottom="0px",g.border="0px",g.background="#000",g.position="relative",t.setElementTouchActionNone(this.element),t.setElementOpacity(this.element,.8),this.viewer=p,this.tracker=new t.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:t.delegate(this,s),dragHandler:t.delegate(this,r),scrollHandler:t.delegate(this,a),enterHandler:t.delegate(this,l),leaveHandler:t.delegate(this,h),keyDownHandler:t.delegate(this,u),keyHandler:t.delegate(this,c),preProcessEventHandler:function(w){w.eventType==="wheel"&&(w.preventDefault=!0)}}),d.width&&d.height?(this.element.style.width=d.width+"px",this.element.style.height=d.height+"px",p.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):d.scroll==="horizontal"?(this.element.style.width=m.x*d.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.height=m.y*d.sizeRatio+"px",p.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=m.y*d.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.width=m.x*d.sizeRatio+"px",p.addControl(this.element,{anchor:t.ControlAnchor.TOP_LEFT})),this.panelWidth=m.x*this.sizeRatio+8,this.panelHeight=m.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},T=0;T<p.tileSources.length;T++)v=t.makeNeutralElement("div"),v.id=this.element.id+"-"+T,v.style.width=f.panelWidth+"px",v.style.height=f.panelHeight+"px",v.style.display="inline",v.style.float="left",v.style.cssFloat="left",v.style.styleFloat="left",v.style.padding="2px",t.setElementTouchActionNone(v),t.setElementPointerEventsNone(v),this.element.appendChild(v),v.activePanel=!1,this.panels.push(v);o(this,this.scroll==="vertical"?m.y:m.x,0),this.setFocus(0)},t.ReferenceStrip.prototype={setFocus:function(d){var f=this.element.querySelector("#"+this.element.id+"-"+d),p=t.getElementSize(this.viewer.canvas),m=Number(this.element.style.width.replace("px","")),v=Number(this.element.style.height.replace("px","")),g=-Number(this.element.style.marginLeft.replace("px","")),T=-Number(this.element.style.marginTop.replace("px","")),w;this.currentSelected!==f&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=f,this.currentSelected.style.background="#999",this.scroll==="horizontal"?(w=Number(d)*(this.panelWidth+3),w>g+p.x-this.panelWidth?(w=Math.min(w,m-p.x),this.element.style.marginLeft=-w+"px",o(this,p.x,-w)):w<g&&(w=Math.max(0,w-p.x/2),this.element.style.marginLeft=-w+"px",o(this,p.x,-w))):(w=Number(d)*(this.panelHeight+3),w>T+p.y-this.panelHeight?(w=Math.min(w,v-p.y),this.element.style.marginTop=-w+"px",o(this,p.y,-w)):w<T&&(w=Math.max(0,w-p.y/2),this.element.style.marginTop=-w+"px",o(this,p.y,-w))),this.currentPage=d,l.call(this,{eventSource:this.tracker}))},update:function(){return!!i[this.id].animating},destroy:function(){if(this.miniViewers)for(var d in this.miniViewers)this.miniViewers[d].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function s(d){if(d.quick){var f;this.scroll==="horizontal"?f=Math.floor(d.position.x/(this.panelWidth+4)):f=Math.floor(d.position.y/this.panelHeight),this.viewer.goToPage(f)}this.element.focus()}function r(d){if(this.dragging=!0,this.element){var f=Number(this.element.style.marginLeft.replace("px","")),p=Number(this.element.style.marginTop.replace("px","")),m=Number(this.element.style.width.replace("px","")),v=Number(this.element.style.height.replace("px","")),g=t.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?-d.delta.x>0?f>-(m-g.x)&&(this.element.style.marginLeft=f+d.delta.x*2+"px",o(this,g.x,f+d.delta.x*2)):-d.delta.x<0&&f<0&&(this.element.style.marginLeft=f+d.delta.x*2+"px",o(this,g.x,f+d.delta.x*2)):-d.delta.y>0?p>-(v-g.y)&&(this.element.style.marginTop=p+d.delta.y*2+"px",o(this,g.y,p+d.delta.y*2)):-d.delta.y<0&&p<0&&(this.element.style.marginTop=p+d.delta.y*2+"px",o(this,g.y,p+d.delta.y*2))}}function a(d){if(this.element){var f=Number(this.element.style.marginLeft.replace("px","")),p=Number(this.element.style.marginTop.replace("px","")),m=Number(this.element.style.width.replace("px","")),v=Number(this.element.style.height.replace("px","")),g=t.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?d.scroll>0?f>-(m-g.x)&&(this.element.style.marginLeft=f-d.scroll*60+"px",o(this,g.x,f-d.scroll*60)):d.scroll<0&&f<0&&(this.element.style.marginLeft=f-d.scroll*60+"px",o(this,g.x,f-d.scroll*60)):d.scroll<0?p>g.y-v&&(this.element.style.marginTop=p+d.scroll*60+"px",o(this,g.y,p+d.scroll*60)):d.scroll>0&&p<0&&(this.element.style.marginTop=p+d.scroll*60+"px",o(this,g.y,p+d.scroll*60)),d.preventDefault=!0}}function o(d,f,p){var m,v,g,T,w,E;for(d.scroll==="horizontal"?m=d.panelWidth:m=d.panelHeight,v=Math.ceil(f/m)+5,g=Math.ceil((Math.abs(p)+f)/m)+1,v=g-v,v=v<0?0:v,w=v;w<g&&w<d.panels.length;w++)if(E=d.panels[w],!E.activePanel){var P,C=d.viewer.tileSources[w];C.referenceStripThumbnailUrl?P={type:"image",url:C.referenceStripThumbnailUrl}:P=C,T=new t.Viewer({id:E.id,tileSources:[P],element:E,navigatorSizeRatio:d.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:d.viewer.loadTilesWithAjax,ajaxHeaders:d.viewer.ajaxHeaders,useCanvas:d.useCanvas}),t.setElementPointerEventsNone(T.canvas),t.setElementPointerEventsNone(T.container),T.innerTracker.setTracking(!1),T.outerTracker.setTracking(!1),d.miniViewers[E.id]=T,E.activePanel=!0}}function l(d){var f=d.eventSource.element;this.scroll==="horizontal"?f.style.marginBottom="0px":f.style.marginLeft="0px"}function h(d){var f=d.eventSource.element;this.scroll==="horizontal"?f.style.marginBottom="-"+t.getElementSize(f).y/2+"px":f.style.marginLeft="-"+t.getElementSize(f).x/2+"px"}function u(d){if(!d.ctrl&&!d.alt&&!d.meta)switch(d.keyCode){case 38:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 40:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 37:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 39:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;default:d.preventDefault=!1;break}else d.preventDefault=!1}function c(d){if(!d.ctrl&&!d.alt&&!d.meta)switch(d.keyCode){case 61:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 45:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 48:case 119:case 87:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 115:case 83:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 97:a.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 100:a.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;default:d.preventDefault=!1;break}else d.preventDefault=!1}}(e),function(t){t.DisplayRect=function(i,s,r,a,o,l){t.Rect.apply(this,[i,s,r,a]),this.minLevel=o,this.maxLevel=l},t.extend(t.DisplayRect.prototype,t.Rect.prototype)}(e),function(t){t.Spring=function(s){var r=arguments;typeof s!="object"&&(s={initial:r.length&&typeof r[0]=="number"?r[0]:void 0,springStiffness:r.length>1?r[1].springStiffness:5,animationTime:r.length>1?r[1].animationTime:1.5}),t.console.assert(typeof s.springStiffness=="number"&&s.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),t.console.assert(typeof s.animationTime=="number"&&s.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),s.exponential&&(this._exponential=!0,delete s.exponential),t.extend(!0,this,s),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:t.now()},t.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},t.Spring.prototype={resetTo:function(s){t.console.assert(!this._exponential||s!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=s,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(s){t.console.assert(!this._exponential||s!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=s,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(s){this.start.value+=s,this.target.value+=s,this._exponential&&(t.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(s){this._exponential=s,this._exponential&&(t.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=t.now();var s,r;this._exponential?(s=this.start._logValue,r=this.target._logValue):(s=this.start.value,r=this.target.value);var a=this.current.time>=this.target.time?r:s+(r-s)*i(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),o=this.current.value;return this._exponential?this.current.value=Math.exp(a):this.current.value=a,o!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function i(s,r){return(1-Math.exp(s*-r))/(1-Math.exp(-s))}}(e),function(t){t.ImageJob=function(s){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null,tries:0},s),this.data=null,this.userData={},this.errorMsg=null},t.ImageJob.prototype={start:function(){this.tries++;var s=this,r=this.abort;this.jobId=window.setTimeout(function(){s.finish(null,null,"Image load exceeded timeout ("+s.timeout+" ms)")},this.timeout),this.abort=function(){s.source.downloadTileAbort(s),typeof r=="function"&&r()},this.source.downloadTileStart(this)},finish:function(s,r,a){this.data=s,this.request=r,this.errorMsg=a,this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(s){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],failedTiles:[],jobsInProgress:0},s)},t.ImageLoader.prototype={addJob:function(s){if(!s.source){t.console.error("ImageLoader.prototype.addJob() requires [options.source]. TileSource since new API defines how images are fetched. Creating a dummy TileSource.");var r=t.TileSource.prototype;s.source={downloadTileStart:r.downloadTileStart,downloadTileAbort:r.downloadTileAbort}}var a=this,o=function(u){i(a,u,s.callback)},l={src:s.src,tile:s.tile||{},source:s.source,loadWithAjax:s.loadWithAjax,ajaxHeaders:s.loadWithAjax?s.ajaxHeaders:null,crossOriginPolicy:s.crossOriginPolicy,ajaxWithCredentials:s.ajaxWithCredentials,postData:s.postData,callback:o,abort:s.abort,timeout:this.timeout},h=new t.ImageJob(l);!this.jobLimit||this.jobsInProgress<this.jobLimit?(h.start(),this.jobsInProgress++):this.jobQueue.push(h)},clear:function(){for(var s=0;s<this.jobQueue.length;s++){var r=this.jobQueue[s];typeof r.abort=="function"&&r.abort()}this.jobQueue=[]}};function i(s,r,a){r.errorMsg!==""&&(r.data===null||r.data===void 0)&&r.tries<1+s.tileRetryMax&&s.failedTiles.push(r);var o;s.jobsInProgress--,(!s.jobLimit||s.jobsInProgress<s.jobLimit)&&s.jobQueue.length>0&&(o=s.jobQueue.shift(),o.start(),s.jobsInProgress++),s.tileRetryMax>0&&s.jobQueue.length===0&&(!s.jobLimit||s.jobsInProgress<s.jobLimit)&&s.failedTiles.length>0&&(o=s.failedTiles.shift(),setTimeout(function(){o.start()},s.tileRetryDelay),s.jobsInProgress++),a(r.data,r.errorMsg,r.request)}}(e),function(t){t.Tile=function(i,s,r,a,o,l,h,u,c,d,f,p){this.level=i,this.x=s,this.y=r,this.bounds=a,this.sourceBounds=d,this.exists=o,this._url=l,this.postData=f,this.context2D=h,this.loadWithAjax=u,this.ajaxHeaders=c,p===void 0&&(t.console.warn("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),p=t.TileSource.prototype.getTileHashKey(i,s,r,l,c,f)),this.cacheKey=p,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.hasTransparency=!1,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},t.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return console.warn("Tile.prototype._hasTransparencyChannel() has been deprecated and will be removed in the future. Use TileSource.prototype.hasTransparency() instead."),!!this.context2D||this.getUrl().match(".png")},drawHTML:function(i){if(!this.cacheImageRecord){t.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}if(!this.element){var s=this.getImage();if(!s)return;this.element=t.makeNeutralElement("div"),this.imgElement=s.cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"}this.element.parentNode!==i&&i.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),t.setElementOpacity(this.element,this.opacity)},get image(){return t.console.error("[Tile.image] property has been deprecated. Use [Tile.prototype.getImage] instead."),this.getImage()},get url(){return t.console.error("[Tile.url] property has been deprecated. Use [Tile.prototype.getUrl] instead."),this.getUrl()},getImage:function(){return this.cacheImageRecord.getImage()},getUrl:function(){return typeof this._url=="function"?this._url():this._url},getCanvasContext:function(){return this.context2D||this.cacheImageRecord.getRenderedContext()},drawCanvas:function(i,s,r,a,o,l){var h=this.position.times(t.pixelDensityRatio),u=this.size.times(t.pixelDensityRatio),c;if(!this.context2D&&!this.cacheImageRecord){t.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(c=this.getCanvasContext(),!this.loaded||!c){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}i.save(),i.globalAlpha=this.opacity,typeof r=="number"&&r!==1&&(h=h.times(r),u=u.times(r)),a instanceof t.Point&&(h=h.plus(a)),i.globalAlpha===1&&this.hasTransparency&&(o&&(h.x=Math.round(h.x),h.y=Math.round(h.y),u.x=Math.round(u.x),u.y=Math.round(u.y)),i.clearRect(h.x,h.y,u.x,u.y)),s({context:i,tile:this,rendered:c});var d,f;this.sourceBounds?(d=Math.min(this.sourceBounds.width,c.canvas.width),f=Math.min(this.sourceBounds.height,c.canvas.height)):(d=c.canvas.width,f=c.canvas.height),i.translate(h.x+u.x/2,0),this.flipped&&i.scale(-1,1),i.drawImage(c.canvas,0,0,d,f,-u.x/2,h.y,u.x,u.y),i.restore()},getScaleForEdgeSmoothing:function(){var i;if(this.cacheImageRecord)i=this.cacheImageRecord.getRenderedContext();else if(this.context2D)i=this.context2D;else return t.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return i.canvas.width/(this.size.x*t.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(i,s,r){var a=Math.max(1,Math.ceil((r.x-s.x)/2)),o=Math.max(1,Math.ceil((r.y-s.y)/2));return new t.Point(a,o).minus(this.position.times(t.pixelDensityRatio).times(i||1).apply(function(l){return l%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(e),function(t){t.OverlayPlacement=t.Placement,t.OverlayRotationMode=t.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),t.Overlay=function(i,s,r){var a;t.isPlainObject(i)?a=i:a={element:i,location:s,placement:r},this.element=a.element,this.style=a.element.style,this._init(a)},t.Overlay.prototype={_init:function(i){this.location=i.location,this.placement=i.placement===void 0?t.Placement.TOP_LEFT:i.placement,this.onDraw=i.onDraw,this.checkResize=i.checkResize===void 0?!0:i.checkResize,this.width=i.width===void 0?null:i.width,this.height=i.height===void 0?null:i.height,this.rotationMode=i.rotationMode||t.OverlayRotationMode.EXACT,this.location instanceof t.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=t.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new t.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(i,s){var r=t.Placement.properties[this.placement];r&&(r.isHorizontallyCentered?i.x-=s.x/2:r.isRight&&(i.x-=s.x),r.isVerticallyCentered?i.y-=s.y/2:r.isBottom&&(i.y-=s.y))},destroy:function(){var i=this.element,s=this.style;i.parentNode&&(i.parentNode.removeChild(i),i.prevElementParent&&(s.display="none",document.body.appendChild(i))),this.onDraw=null,s.top="",s.left="",s.position="",this.width!==null&&(s.width=""),this.height!==null&&(s.height="");var r=t.getCssPropertyWithVendorPrefix("transformOrigin"),a=t.getCssPropertyWithVendorPrefix("transform");r&&a&&(s[r]="",s[a]="")},drawHTML:function(i,s){var r=this.element;r.parentNode!==i&&(r.prevElementParent=r.parentNode,r.prevNextSibling=r.nextSibling,i.appendChild(r),this.style.position="absolute",this.size=t.getElementSize(r));var a=this._getOverlayPositionAndSize(s),o=a.position,l=this.size=a.size,h=a.rotate;if(this.onDraw)this.onDraw(o,l,this.element);else{var u=this.style;u.left=o.x+"px",u.top=o.y+"px",this.width!==null&&(u.width=l.x+"px"),this.height!==null&&(u.height=l.y+"px");var c=t.getCssPropertyWithVendorPrefix("transformOrigin"),d=t.getCssPropertyWithVendorPrefix("transform");c&&d&&(h?(u[c]=this._getTransformOrigin(),u[d]="rotate("+h+"deg)"):(u[c]="",u[d]="")),u.display="block"}},_getOverlayPositionAndSize:function(i){var s=i.pixelFromPoint(this.location,!0),r=this._getSizeInPixels(i);this.adjust(s,r);var a=0;if(i.getRotation(!0)&&this.rotationMode!==t.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var o=new t.Rect(s.x,s.y,r.x,r.y),l=this._getBoundingBox(o,i.getRotation(!0));s=l.getTopLeft(),r=l.getSize()}else a=i.getRotation(!0);return{position:s,size:r,rotate:a}},_getSizeInPixels:function(i){var s=this.size.x,r=this.size.y;if(this.width!==null||this.height!==null){var a=i.deltaPixelsFromPointsNoRotate(new t.Point(this.width||0,this.height||0),!0);this.width!==null&&(s=a.x),this.height!==null&&(r=a.y)}if(this.checkResize&&(this.width===null||this.height===null)){var o=this.size=t.getElementSize(this.element);this.width===null&&(s=o.x),this.height===null&&(r=o.y)}return new t.Point(s,r)},_getBoundingBox:function(i,s){var r=this._getPlacementPoint(i);return i.rotate(s,r).getBoundingBox()},_getPlacementPoint:function(i){var s=new t.Point(i.x,i.y),r=t.Placement.properties[this.placement];return r&&(r.isHorizontallyCentered?s.x+=i.width/2:r.isRight&&(s.x+=i.width),r.isVerticallyCentered?s.y+=i.height/2:r.isBottom&&(s.y+=i.height)),s},_getTransformOrigin:function(){var i="",s=t.Placement.properties[this.placement];return s&&(s.isLeft?i="left":s.isRight&&(i="right"),s.isTop?i+=" top":s.isBottom&&(i+=" bottom")),i},update:function(i,s){var r=t.isPlainObject(i)?i:{location:i,placement:s};this._init({location:r.location||this.location,placement:r.placement!==void 0?r.placement:this.placement,onDraw:r.onDraw||this.onDraw,checkResize:r.checkResize||this.checkResize,width:r.width!==void 0?r.width:this.width,height:r.height!==void 0?r.height:this.height,rotationMode:r.rotationMode||this.rotationMode})},getBounds:function(i){t.console.assert(i,"A viewport must now be passed to Overlay.getBounds.");var s=this.width,r=this.height;if(s===null||r===null){var a=i.deltaPointsFromPixelsNoRotate(this.size,!0);s===null&&(s=a.x),r===null&&(r=a.y)}var o=this.location.clone();return this.adjust(o,new t.Point(s,r)),this._adjustBoundsForRotation(i,new t.Rect(o.x,o.y,s,r))},_adjustBoundsForRotation:function(i,s){if(!i||i.getRotation(!0)===0||this.rotationMode===t.OverlayRotationMode.EXACT)return s;if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return s;var r=this._getOverlayPositionAndSize(i);return i.viewerElementToViewportRectangle(new t.Rect(r.position.x,r.position.y,r.size.x,r.size.y))}return s.rotate(-i.getRotation(!0),this._getPlacementPoint(s))}}}(e),function(t){t.Drawer=function(i){t.console.assert(i.viewer,"[Drawer] options.viewer is required");var s=arguments;if(t.isPlainObject(i)||(i={source:s[0],viewport:s[1],element:s[2]}),t.console.assert(i.viewport,"[Drawer] options.viewport is required"),t.console.assert(i.element,"[Drawer] options.element is required"),i.source&&t.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=i.viewer,this.viewport=i.viewport,this.debugGridColor=typeof i.debugGridColor=="string"?[i.debugGridColor]:i.debugGridColor||t.DEFAULT_SETTINGS.debugGridColor,i.opacity&&t.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=t.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=t.getElement(i.element),this.canvas=t.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var r=this._calculateCanvasSize();this.canvas.width=r.x,this.canvas.height=r.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",t.setElementOpacity(this.canvas,this.opacity,!0),t.setElementPointerEventsNone(this.canvas),t.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},t.Drawer.prototype={addOverlay:function(i,s,r,a){return t.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(i,s,r,a),this},updateOverlay:function(i,s,r){return t.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(i,s,r),this},removeOverlay:function(i){return t.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(i),this},clearOverlays:function(){return t.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(i){var s=this.viewport.pixelFromPointNoRotate(i,!0);return new t.Point(s.x*t.pixelDensityRatio,s.y*t.pixelDensityRatio)},clipWithPolygons:function(i,s){if(this.useCanvas){var r=this._getContext(s);r.beginPath(),i.forEach(function(a){a.forEach(function(o,l){r[l===0?"moveTo":"lineTo"](o.x,o.y)})}),r.clip()}},setOpacity:function(i){t.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var s=this.viewer.world,r=0;r<s.getItemCount();r++)s.getItemAt(r).setOpacity(i);return this},getOpacity:function(){t.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var i=this.viewer.world,s=0,r=0;r<i.getItemCount();r++){var a=i.getItemAt(r).getOpacity();a>s&&(s=a)}return s},needsUpdate:function(){return t.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return t.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return t.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return t.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var i=this._calculateCanvasSize();if((this.canvas.width!==i.x||this.canvas.height!==i.y)&&(this.canvas.width=i.x,this.canvas.height=i.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var s=this._calculateSketchCanvasSize();this.sketchCanvas.width=s.x,this.sketchCanvas.height=s.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(i,s){if(this.useCanvas){var r=this._getContext(i);if(s)r.clearRect(s.x,s.y,s.width,s.height);else{var a=r.canvas;r.clearRect(0,0,a.width,a.height)}}},viewportToDrawerRectangle:function(i){var s=this.viewport.pixelFromPointNoRotate(i.getTopLeft(),!0),r=this.viewport.deltaPixelsFromPointsNoRotate(i.getSize(),!0);return new t.Rect(s.x*t.pixelDensityRatio,s.y*t.pixelDensityRatio,r.x*t.pixelDensityRatio,r.y*t.pixelDensityRatio)},drawTile:function(i,s,r,a,o,l,h){if(t.console.assert(i,"[Drawer.drawTile] tile is required"),t.console.assert(s,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var u=this._getContext(r);a=a||1,i.drawCanvas(u,s,a,o,l,h)}else i.drawHTML(this.canvas)},_getContext:function(i){var s=this.context;if(i){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var r=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=r.x,this.sketchCanvas.height=r.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var a=this;this.viewer.addHandler("rotate",function o(){if(a.viewport.getRotation()!==0){a.viewer.removeHandler("rotate",o);var l=a._calculateSketchCanvasSize();a.sketchCanvas.width=l.x,a.sketchCanvas.height=l.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}s=this.sketchContext}return s},saveContext:function(i){this.useCanvas&&this._getContext(i).save()},restoreContext:function(i){this.useCanvas&&this._getContext(i).restore()},setClip:function(i,s){if(this.useCanvas){var r=this._getContext(s);r.beginPath(),r.rect(i.x,i.y,i.width,i.height),r.clip()}},drawRectangle:function(i,s,r){if(this.useCanvas){var a=this._getContext(r);a.save(),a.fillStyle=s,a.fillRect(i.x,i.y,i.width,i.height),a.restore()}},blendSketch:function(i,s,r,a){var o=i;if(t.isPlainObject(o)||(o={opacity:i,scale:s,translate:r,compositeOperation:a}),!(!this.useCanvas||!this.sketchCanvas)){i=o.opacity,a=o.compositeOperation;var l=o.bounds;if(this.context.save(),this.context.globalAlpha=i,a&&(this.context.globalCompositeOperation=a),l)l.x<0&&(l.width+=l.x,l.x=0),l.x+l.width>this.canvas.width&&(l.width=this.canvas.width-l.x),l.y<0&&(l.height+=l.y,l.y=0),l.y+l.height>this.canvas.height&&(l.height=this.canvas.height-l.y),this.context.drawImage(this.sketchCanvas,l.x,l.y,l.width,l.height,l.x,l.y,l.width,l.height);else{s=o.scale||1,r=o.translate;var h=r instanceof t.Point?r:new t.Point(0,0),u=0,c=0;if(r){var d=this.sketchCanvas.width-this.canvas.width,f=this.sketchCanvas.height-this.canvas.height;u=Math.round(d/2),c=Math.round(f/2)}this.context.drawImage(this.sketchCanvas,h.x-u*s,h.y-c*s,(this.canvas.width+2*u)*s,(this.canvas.height+2*c)*s,-u,-c,this.canvas.width+2*u,this.canvas.height+2*c)}this.context.restore()}},drawDebugInfo:function(i,s,r,a){if(this.useCanvas){var o=this.viewer.world.getIndexOfItem(a)%this.debugGridColor.length,l=this.context;l.save(),l.lineWidth=2*t.pixelDensityRatio,l.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",l.strokeStyle=this.debugGridColor[o],l.fillStyle=this.debugGridColor[o],this.viewport.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:this.viewport.getRotation(!0)}),a.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:a.getRotation(!0),point:a.viewport.pixelFromPointNoRotate(a._getRotationPoint(!0),!0)}),a.viewport.getRotation(!0)%360===0&&a.getRotation(!0)%360===0&&a._drawer.viewer.viewport.getFlip()&&a._drawer._flip(),l.strokeRect(i.position.x*t.pixelDensityRatio,i.position.y*t.pixelDensityRatio,i.size.x*t.pixelDensityRatio,i.size.y*t.pixelDensityRatio);var h=(i.position.x+i.size.x/2)*t.pixelDensityRatio,u=(i.position.y+i.size.y/2)*t.pixelDensityRatio;l.translate(h,u),l.rotate(Math.PI/180*-this.viewport.getRotation(!0)),l.translate(-h,-u),i.x===0&&i.y===0&&(l.fillText("Zoom: "+this.viewport.getZoom(),i.position.x*t.pixelDensityRatio,(i.position.y-30)*t.pixelDensityRatio),l.fillText("Pan: "+this.viewport.getBounds().toString(),i.position.x*t.pixelDensityRatio,(i.position.y-20)*t.pixelDensityRatio)),l.fillText("Level: "+i.level,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+20)*t.pixelDensityRatio),l.fillText("Column: "+i.x,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+30)*t.pixelDensityRatio),l.fillText("Row: "+i.y,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+40)*t.pixelDensityRatio),l.fillText("Order: "+r+" of "+s,(i.position.x+10)*t.pixelDensityRatio,(i.position.y+50)*t.pixelDensityRatio),l.fillText("Size: "+i.size.toString(),(i.position.x+10)*t.pixelDensityRatio,(i.position.y+60)*t.pixelDensityRatio),l.fillText("Position: "+i.position.toString(),(i.position.x+10)*t.pixelDensityRatio,(i.position.y+70)*t.pixelDensityRatio),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(),a.getRotation(!0)%360!==0&&this._restoreRotationChanges(),a.viewport.getRotation(!0)%360===0&&a.getRotation(!0)%360===0&&a._drawer.viewer.viewport.getFlip()&&a._drawer._flip(),l.restore()}},debugRect:function(i){if(this.useCanvas){var s=this.context;s.save(),s.lineWidth=2*t.pixelDensityRatio,s.strokeStyle=this.debugGridColor[0],s.fillStyle=this.debugGridColor[0],s.strokeRect(i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio,i.width*t.pixelDensityRatio,i.height*t.pixelDensityRatio),s.restore()}},setImageSmoothingEnabled:function(i){this.useCanvas&&(this._imageSmoothingEnabled=i,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(i){i.msImageSmoothingEnabled=this._imageSmoothingEnabled,i.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(i){var s=this._getContext(i).canvas;return new t.Point(s.width,s.height)},getCanvasCenter:function(){return new t.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(i){var s=i.point?i.point.times(t.pixelDensityRatio):this.getCanvasCenter(),r=this._getContext(i.useSketch);r.save(),r.translate(s.x,s.y),this.viewer.viewport.flipped?(r.rotate(Math.PI/180*-i.degrees),r.scale(-1,1)):r.rotate(Math.PI/180*i.degrees),r.translate(-s.x,-s.y)},_flip:function(i){i=i||{};var s=i.point?i.point.times(t.pixelDensityRatio):this.getCanvasCenter(),r=this._getContext(i.useSketch);r.translate(s.x,0),r.scale(-1,1),r.translate(-s.x,0)},_restoreRotationChanges:function(i){var s=this._getContext(i);s.restore()},_calculateCanvasSize:function(){var i=t.pixelDensityRatio,s=this.viewport.getContainerSize();return{x:Math.round(s.x*i),y:Math.round(s.y*i)}},_calculateSketchCanvasSize:function(){var i=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return i;var s=Math.ceil(Math.sqrt(i.x*i.x+i.y*i.y));return{x:s,y:s}}}}(e),function(t){t.Viewport=function(i){var s=arguments;s.length&&s[0]instanceof t.Point&&(i={containerSize:s[0],contentSize:s[1],config:s[2]}),i.config&&(t.extend(!0,i,i.config),delete i.config),this._margins=t.extend({left:0,top:0,right:0,bottom:0},i.margins||{}),delete i.margins,i.initialDegrees=i.degrees,delete i.degrees,t.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,rotationPivot:null,viewer:null,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:t.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:t.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:t.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:t.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:t.DEFAULT_SETTINGS.maxZoomLevel,initialDegrees:t.DEFAULT_SETTINGS.degrees,flipped:t.DEFAULT_SETTINGS.flipped,homeFillsViewer:t.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:t.DEFAULT_SETTINGS.silenceMultiImageWarnings},i),this._updateContainerInnerSize(),this.centerSpringX=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new t.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.degreesSpring=new t.Spring({initial:i.initialDegrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,this._setContentBounds(new t.Rect(0,0,1,1),1),this.goHome(!0),this.update()},t.Viewport.prototype={get degrees(){return t.console.warn("Accessing [Viewport.degrees] is deprecated. Use viewport.getRotation instead."),this.getRotation()},set degrees(i){t.console.warn("Setting [Viewport.degrees] is deprecated. Use viewport.rotateTo, viewport.rotateBy, or viewport.setRotation instead."),this.rotateTo(i)},resetContentSize:function(i){return t.console.assert(i,"[Viewport.resetContentSize] contentSize is required"),t.console.assert(i instanceof t.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),t.console.assert(i.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),t.console.assert(i.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new t.Rect(0,0,1,i.y/i.x),i.x),this},setHomeBounds:function(i,s){t.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(i,s)},_setContentBounds:function(i,s){t.console.assert(i,"[Viewport._setContentBounds] bounds is required"),t.console.assert(i instanceof t.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),t.console.assert(i.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),t.console.assert(i.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=i.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(s),this._contentBounds=i.rotate(this.getRotation()).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(s),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:s,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var i=this._contentAspectRatio/this.getAspectRatio(),s;return this.homeFillsViewer?s=i>=1?i:1:s=i>=1?1:i,s/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var i=this._contentBounds.getCenter(),s=1/this.getHomeZoom(),r=s/this.getAspectRatio();return new t.Rect(i.x-s/2,i.y-r/2,s,r)},goHome:function(i){return this.viewer&&this.viewer.raiseEvent("home",{immediately:i}),this.fitBounds(this.getHomeBounds(),i)},getMinZoom:function(){var i=this.getHomeZoom(),s=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*i;return s},getMaxZoom:function(){var i=this.maxZoomLevel;return i||(i=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,i/=this._contentBounds.width),Math.max(i,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new t.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return t.extend({},this._margins)},setMargins:function(i){t.console.assert(t.type(i)==="object","[Viewport.setMargins] margins must be an object"),this._margins=t.extend({left:0,top:0,right:0,bottom:0},i),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(i){return this.getBoundsNoRotate(i).rotate(-this.getRotation(i))},getBoundsNoRotate:function(i){var s=this.getCenter(i),r=1/this.getZoom(i),a=r/this.getAspectRatio();return new t.Rect(s.x-r/2,s.y-a/2,r,a)},getBoundsWithMargins:function(i){return this.getBoundsNoRotateWithMargins(i).rotate(-this.getRotation(i),this.getCenter(i))},getBoundsNoRotateWithMargins:function(i){var s=this.getBoundsNoRotate(i),r=this._containerInnerSize.x*this.getZoom(i);return s.x-=this._margins.left/r,s.y-=this._margins.top/r,s.width+=(this._margins.left+this._margins.right)/r,s.height+=(this._margins.top+this._margins.bottom)/r,s},getCenter:function(i){var s=new t.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),r=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),a,o,l,h,u,c,d,f;return i?s:this.zoomPoint?(a=this.pixelFromPoint(this.zoomPoint,!0),o=this.getZoom(),l=1/o,h=l/this.getAspectRatio(),u=new t.Rect(s.x-l/2,s.y-h/2,l,h),c=this._pixelFromPoint(this.zoomPoint,u),d=c.minus(a).rotate(-this.getRotation(!0)),f=d.divide(this._containerInnerSize.x*o),r.plus(f)):r},getZoom:function(i){return i?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(i){return Math.max(Math.min(i,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(i){var s=this.viewportToViewerElementRectangle(i).getBoundingBox(),r=this.viewportToViewerElementRectangle(this._contentBoundsNoRotate).getBoundingBox(),a=!1,o=!1;if(!this.wrapHorizontal){var l=s.x+s.width,h=r.x+r.width,u,c,d;s.width>r.width?u=this.visibilityRatio*r.width:u=this.visibilityRatio*s.width,c=r.x-l+u,d=h-s.x-u,u>r.width?(s.x+=(c+d)/2,a=!0):d<0?(s.x+=d,a=!0):c>0&&(s.x+=c,a=!0)}if(!this.wrapVertical){var f=s.y+s.height,p=r.y+r.height,m,v,g;s.height>r.height?m=this.visibilityRatio*r.height:m=this.visibilityRatio*s.height,v=r.y-f+m,g=p-s.y-m,m>r.height?(s.y+=(v+g)/2,o=!0):g<0?(s.y+=g,o=!0):v>0&&(s.y+=v,o=!0)}var T=a||o,w=T?this.viewerElementToViewportRectangle(s):i.clone();return w.xConstrained=a,w.yConstrained=o,w.constraintApplied=T,w},_raiseConstraintsEvent:function(i){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:i})},applyConstraints:function(i){var s=this.getZoom(),r=this._applyZoomConstraints(s);s!==r&&this.zoomTo(r,this.zoomPoint,i);var a=this.getConstrainedBounds(!1);return a.constraintApplied&&(this.fitBounds(a,i),this._raiseConstraintsEvent(i)),this},ensureVisible:function(i){return this.applyConstraints(i)},_fitBounds:function(i,s){s=s||{};var r=s.immediately||!1,a=s.constraints||!1,o=this.getAspectRatio(),l=i.getCenter(),h=new t.Rect(i.x,i.y,i.width,i.height,i.degrees+this.getRotation()).getBoundingBox();h.getAspectRatio()>=o?h.height=h.width/o:h.width=h.height*o,h.x=l.x-h.width/2,h.y=l.y-h.height/2;var u=1/h.width;if(r)return this.panTo(l,!0),this.zoomTo(u,null,!0),a&&this.applyConstraints(!0),this;var c=this.getCenter(!0),d=this.getZoom(!0);this.panTo(c,!0),this.zoomTo(d,null,!0);var f=this.getBounds(),p=this.getZoom();if(p===0||Math.abs(u/p-1)<1e-8)return this.zoomTo(u,null,!0),this.panTo(l,r),a&&this.applyConstraints(!1),this;if(a){this.panTo(l,!1),u=this._applyZoomConstraints(u),this.zoomTo(u,null,!1);var m=this.getConstrainedBounds();this.panTo(c,!0),this.zoomTo(d,null,!0),this.fitBounds(m)}else{var v=h.rotate(-this.getRotation()),g=v.getTopLeft().times(u).minus(f.getTopLeft().times(p)).divide(u-p);this.zoomTo(u,g,r)}return this},fitBounds:function(i,s){return this._fitBounds(i,{immediately:s,constraints:!1})},fitBoundsWithConstraints:function(i,s){return this._fitBounds(i,{immediately:s,constraints:!0})},fitVertically:function(i){var s=new t.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(s,i)},fitHorizontally:function(i){var s=new t.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(s,i)},getConstrainedBounds:function(i){var s,r;return s=this.getBounds(i),r=this._applyBoundaryConstraints(s),r},panBy:function(i,s){var r=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(r.plus(i),s)},panTo:function(i,s){return s?(this.centerSpringX.resetTo(i.x),this.centerSpringY.resetTo(i.y)):(this.centerSpringX.springTo(i.x),this.centerSpringY.springTo(i.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:i,immediately:s}),this},zoomBy:function(i,s,r){return this.zoomTo(this.zoomSpring.target.value*i,s,r)},zoomTo:function(i,s,r){var a=this;return this.zoomPoint=s instanceof t.Point&&!isNaN(s.x)&&!isNaN(s.y)?s:null,r?this._adjustCenterSpringsForZoomPoint(function(){a.zoomSpring.resetTo(i)}):this.zoomSpring.springTo(i),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:i,refPoint:s,immediately:r}),this},setRotation:function(i,s){return this.rotateTo(i,null,s)},getRotation:function(i){return i?this.degreesSpring.current.value:this.degreesSpring.target.value},setRotationWithPivot:function(i,s,r){return this.rotateTo(i,s,r)},rotateTo:function(i,s,r){if(!this.viewer||!this.viewer.drawer.canRotate())return this;if(this.degreesSpring.target.value===i&&this.degreesSpring.isAtTargetValue())return this;if(this.rotationPivot=s instanceof t.Point&&!isNaN(s.x)&&!isNaN(s.y)?s:null,r)if(this.rotationPivot){var a=i-this._oldDegrees;if(!a)return this.rotationPivot=null,this;this._rotateAboutPivot(i)}else this.degreesSpring.resetTo(i);else{var o=t.positiveModulo(this.degreesSpring.current.value,360),l=t.positiveModulo(i,360),h=l-o;h>180?l-=360:h<-180&&(l+=360);var u=o-l;this.degreesSpring.resetTo(i+u),this.degreesSpring.springTo(i)}return this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:i,immediately:!!r,pivot:this.rotationPivot||this.getCenter()}),this},rotateBy:function(i,s,r){return this.rotateTo(this.degreesSpring.target.value+i,s,r)},resize:function(i,s){var r=this.getBoundsNoRotate(),a=r,o;this.containerSize.x=i.x,this.containerSize.y=i.y,this._updateContainerInnerSize(),s&&(o=i.x/this.containerSize.x,a.width=r.width*o,a.height=a.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:i,maintain:s});var l=this.fitBounds(a,!0);return this.viewer&&this.viewer.raiseEvent("after-resize",{newContainerSize:i,maintain:s}),l},_updateContainerInnerSize:function(){this._containerInnerSize=new t.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var i=this;this._adjustCenterSpringsForZoomPoint(function(){i.zoomSpring.update()}),this.degreesSpring.isAtTargetValue()&&(this.rotationPivot=null),this.centerSpringX.update(),this.centerSpringY.update(),this.rotationPivot?this._rotateAboutPivot(!0):this.degreesSpring.update();var s=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom||this.degreesSpring.current.value!==this._oldDegrees;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,s},_rotateAboutPivot:function(i){var s=i===!0,r=this.rotationPivot.minus(this.getCenter());this.centerSpringX.shiftBy(r.x),this.centerSpringY.shiftBy(r.y),s?this.degreesSpring.update():this.degreesSpring.resetTo(i);var a=this.degreesSpring.current.value-this._oldDegrees,o=r.rotate(a*-1).times(-1);this.centerSpringX.shiftBy(o.x),this.centerSpringY.shiftBy(o.y)},_adjustCenterSpringsForZoomPoint:function(i){if(this.zoomPoint){var s=this.pixelFromPoint(this.zoomPoint,!0);i();var r=this.pixelFromPoint(this.zoomPoint,!0),a=r.minus(s),o=this.deltaPointsFromPixels(a,!0);this.centerSpringX.shiftBy(o.x),this.centerSpringY.shiftBy(o.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else i()},deltaPixelsFromPointsNoRotate:function(i,s){return i.times(this._containerInnerSize.x*this.getZoom(s))},deltaPixelsFromPoints:function(i,s){return this.deltaPixelsFromPointsNoRotate(i.rotate(this.getRotation(s)),s)},deltaPointsFromPixelsNoRotate:function(i,s){return i.divide(this._containerInnerSize.x*this.getZoom(s))},deltaPointsFromPixels:function(i,s){return this.deltaPointsFromPixelsNoRotate(i,s).rotate(-this.getRotation(s))},pixelFromPointNoRotate:function(i,s){return this._pixelFromPointNoRotate(i,this.getBoundsNoRotate(s))},pixelFromPoint:function(i,s){return this._pixelFromPoint(i,this.getBoundsNoRotate(s))},_pixelFromPointNoRotate:function(i,s){return i.minus(s.getTopLeft()).times(this._containerInnerSize.x/s.width).plus(new t.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(i,s){return this._pixelFromPointNoRotate(i.rotate(this.getRotation(!0),this.getCenter(!0)),s)},pointFromPixelNoRotate:function(i,s){var r=this.getBoundsNoRotate(s);return i.minus(new t.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/r.width).plus(r.getTopLeft())},pointFromPixel:function(i,s){return this.pointFromPixelNoRotate(i,s).rotate(-this.getRotation(s),this.getCenter(s))},_viewportToImageDelta:function(i,s){var r=this._contentBoundsNoRotate.width;return new t.Point(i*this._contentSizeNoRotate.x/r,s*this._contentSizeNoRotate.x/r)},viewportToImageCoordinates:function(i,s){if(i instanceof t.Point)return this.viewportToImageCoordinates(i.x,i.y);if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(r===1){var a=this.viewer.world.getItemAt(0);return a.viewportToImageCoordinates(i,s,!0)}}return this._viewportToImageDelta(i-this._contentBoundsNoRotate.x,s-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(i,s){var r=this._contentBoundsNoRotate.width;return new t.Point(i/this._contentSizeNoRotate.x*r,s/this._contentSizeNoRotate.x*r)},imageToViewportCoordinates:function(i,s){if(i instanceof t.Point)return this.imageToViewportCoordinates(i.x,i.y);if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(r===1){var a=this.viewer.world.getItemAt(0);return a.imageToViewportCoordinates(i,s,!0)}}var o=this._imageToViewportDelta(i,s);return o.x+=this._contentBoundsNoRotate.x,o.y+=this._contentBoundsNoRotate.y,o},imageToViewportRectangle:function(i,s,r,a){var o=i;if(o instanceof t.Rect||(o=new t.Rect(i,s,r,a)),this.viewer){var l=this.viewer.world.getItemCount();if(l>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(l===1){var h=this.viewer.world.getItemAt(0);return h.imageToViewportRectangle(i,s,r,a,!0)}}var u=this.imageToViewportCoordinates(o.x,o.y),c=this._imageToViewportDelta(o.width,o.height);return new t.Rect(u.x,u.y,c.x,c.y,o.degrees)},viewportToImageRectangle:function(i,s,r,a){var o=i;if(o instanceof t.Rect||(o=new t.Rect(i,s,r,a)),this.viewer){var l=this.viewer.world.getItemCount();if(l>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(l===1){var h=this.viewer.world.getItemAt(0);return h.viewportToImageRectangle(i,s,r,a,!0)}}var u=this.viewportToImageCoordinates(o.x,o.y),c=this._viewportToImageDelta(o.width,o.height);return new t.Rect(u.x,u.y,c.x,c.y,o.degrees)},viewerElementToImageCoordinates:function(i){var s=this.pointFromPixel(i,!0);return this.viewportToImageCoordinates(s)},imageToViewerElementCoordinates:function(i){var s=this.imageToViewportCoordinates(i);return this.pixelFromPoint(s,!0)},windowToImageCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var s=i.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(s)},imageToWindowCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var s=this.imageToViewerElementCoordinates(i);return s.plus(t.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(i){return this.pointFromPixel(i,!0)},viewportToViewerElementCoordinates:function(i){return this.pixelFromPoint(i,!0)},viewerElementToViewportRectangle:function(i){return t.Rect.fromSummits(this.pointFromPixel(i.getTopLeft(),!0),this.pointFromPixel(i.getTopRight(),!0),this.pointFromPixel(i.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(i){return t.Rect.fromSummits(this.pixelFromPoint(i.getTopLeft(),!0),this.pixelFromPoint(i.getTopRight(),!0),this.pixelFromPoint(i.getBottomLeft(),!0))},windowToViewportCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var s=i.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(s)},viewportToWindowCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var s=this.viewportToViewerElementCoordinates(i);return s.plus(t.getElementPosition(this.viewer.element))},viewportToImageZoom:function(i){if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(s===1){var r=this.viewer.world.getItemAt(0);return r.viewportToImageZoom(i)}}var a=this._contentSizeNoRotate.x,o=this._containerInnerSize.x,l=this._contentBoundsNoRotate.width,h=o/a*l;return i*h},imageToViewportZoom:function(i){if(this.viewer){var s=this.viewer.world.getItemCount();if(s>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(s===1){var r=this.viewer.world.getItemAt(0);return r.imageToViewportZoom(i)}}var a=this._contentSizeNoRotate.x,o=this._containerInnerSize.x,l=this._contentBoundsNoRotate.width,h=a/o/l;return i*h},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(i){return this.flipped===i?this:(this.flipped=i,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:i}),this)}}}(e),function(t){t.TiledImage=function(o){var l=this;t.console.assert(o.tileCache,"[TiledImage] options.tileCache is required"),t.console.assert(o.drawer,"[TiledImage] options.drawer is required"),t.console.assert(o.viewer,"[TiledImage] options.viewer is required"),t.console.assert(o.imageLoader,"[TiledImage] options.imageLoader is required"),t.console.assert(o.source,"[TiledImage] options.source is required"),t.console.assert(!o.clip||o.clip instanceof t.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),t.EventSource.call(this),this._tileCache=o.tileCache,delete o.tileCache,this._drawer=o.drawer,delete o.drawer,this._imageLoader=o.imageLoader,delete o.imageLoader,o.clip instanceof t.Rect&&(this._clip=o.clip.clone()),delete o.clip;var h=o.x||0;delete o.x;var u=o.y||0;delete o.y,this.normHeight=o.source.dimensions.y/o.source.dimensions.x,this.contentAspectX=o.source.dimensions.x/o.source.dimensions.y;var c=1;o.width?(c=o.width,delete o.width,o.height&&(t.console.error("specifying both width and height to a tiledImage is not supported"),delete o.height)):o.height&&(c=o.height/this.normHeight,delete o.height);var d=o.fitBounds;delete o.fitBounds;var f=o.fitBoundsPlacement||e.Placement.CENTER;delete o.fitBoundsPlacement;var p=o.degrees||0;delete o.degrees;var m=o.ajaxHeaders;delete o.ajaxHeaders,t.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,immediateRender:t.DEFAULT_SETTINGS.immediateRender,blendTime:t.DEFAULT_SETTINGS.blendTime,alwaysBlend:t.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:t.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:t.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:t.DEFAULT_SETTINGS.iOSDevice,debugMode:t.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:t.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:t.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:t.DEFAULT_SETTINGS.placeholderFillStyle,opacity:t.DEFAULT_SETTINGS.opacity,preload:t.DEFAULT_SETTINGS.preload,compositeOperation:t.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:t.DEFAULT_SETTINGS.subPixelRoundingForTransparency},o),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new t.Spring({initial:h,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new t.Spring({initial:u,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new t.Spring({initial:c,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new t.Spring({initial:p,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),d&&this.fitBounds(d,f,!0),this._drawingHandler=function(v){l.viewer.raiseEvent("tile-drawing",t.extend({tiledImage:l},v))},this._ownAjaxHeaders={},this.setAjaxHeaders(m,!1)},t.extend(t.TiledImage.prototype,t.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(o){o!==this._fullyLoaded&&(this._fullyLoaded=o,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=t.now(),this._needsDraw=!0},update:function(){var o=this._xSpring.update(),l=this._ySpring.update(),h=this._scaleSpring.update(),u=this._degreesSpring.update();return o||l||h||u?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(o){return this.getBoundsNoRotate(o).rotate(this.getRotation(o),this._getRotationPoint(o))},getBoundsNoRotate:function(o){return o?new t.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new t.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return t.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(o){var l=this.getBoundsNoRotate(o);if(this._clip){var h=o?this._worldWidthCurrent:this._worldWidthTarget,u=h/this.source.dimensions.x,c=this._clip.times(u);l=new t.Rect(l.x+c.x,l.y+c.y,c.width,c.height)}return l.rotate(this.getRotation(o),this._getRotationPoint(o))},getTileBounds:function(o,l,h){var u=this.source.getNumTiles(o),c=(u.x+l%u.x)%u.x,d=(u.y+h%u.y)%u.y,f=this.source.getTileBounds(o,c,d);return this.getFlip()&&(f.x=1-f.x-f.width),f.x+=(l-c)/u.x,f.y+=this._worldHeightCurrent/this._worldWidthCurrent*((h-d)/u.y),f},getContentSize:function(){return new t.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var o=this.imageToWindowCoordinates(new t.Point(0,0)),l=this.imageToWindowCoordinates(this.getContentSize());return new t.Point(l.x-o.x,l.y-o.y)},_viewportToImageDelta:function(o,l,h){var u=h?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(o*(this.source.dimensions.x/u),l*(this.source.dimensions.y*this.contentAspectX/u))},viewportToImageCoordinates:function(o,l,h){var u;return o instanceof t.Point?(h=l,u=o):u=new t.Point(o,l),u=u.rotate(-this.getRotation(h),this._getRotationPoint(h)),h?this._viewportToImageDelta(u.x-this._xSpring.current.value,u.y-this._ySpring.current.value):this._viewportToImageDelta(u.x-this._xSpring.target.value,u.y-this._ySpring.target.value)},_imageToViewportDelta:function(o,l,h){var u=h?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(o/this.source.dimensions.x*u,l/this.source.dimensions.y/this.contentAspectX*u)},imageToViewportCoordinates:function(o,l,h){o instanceof t.Point&&(h=l,l=o.y,o=o.x);var u=this._imageToViewportDelta(o,l);return h?(u.x+=this._xSpring.current.value,u.y+=this._ySpring.current.value):(u.x+=this._xSpring.target.value,u.y+=this._ySpring.target.value),u.rotate(this.getRotation(h),this._getRotationPoint(h))},imageToViewportRectangle:function(o,l,h,u,c){var d=o;d instanceof t.Rect?c=l:d=new t.Rect(o,l,h,u);var f=this.imageToViewportCoordinates(d.getTopLeft(),c),p=this._imageToViewportDelta(d.width,d.height,c);return new t.Rect(f.x,f.y,p.x,p.y,d.degrees+this.getRotation(c))},viewportToImageRectangle:function(o,l,h,u,c){var d=o;o instanceof t.Rect?c=l:d=new t.Rect(o,l,h,u);var f=this.viewportToImageCoordinates(d.getTopLeft(),c),p=this._viewportToImageDelta(d.width,d.height,c);return new t.Rect(f.x,f.y,p.x,p.y,d.degrees-this.getRotation(c))},viewerElementToImageCoordinates:function(o){var l=this.viewport.pointFromPixel(o,!0);return this.viewportToImageCoordinates(l)},imageToViewerElementCoordinates:function(o){var l=this.imageToViewportCoordinates(o);return this.viewport.pixelFromPoint(l,!0)},windowToImageCoordinates:function(o){var l=o.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(l)},imageToWindowCoordinates:function(o){var l=this.imageToViewerElementCoordinates(o);return l.plus(e.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(o){var l=this._scaleSpring.current.value;return o=o.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new t.Rect((o.x-this._xSpring.current.value)/l,(o.y-this._ySpring.current.value)/l,o.width/l,o.height/l,o.degrees)},viewportToImageZoom:function(o){var l=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return l*o},imageToViewportZoom:function(o){var l=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return o/l},setPosition:function(o,l){var h=this._xSpring.target.value===o.x&&this._ySpring.target.value===o.y;if(l){if(h&&this._xSpring.current.value===o.x&&this._ySpring.current.value===o.y)return;this._xSpring.resetTo(o.x),this._ySpring.resetTo(o.y),this._needsDraw=!0}else{if(h)return;this._xSpring.springTo(o.x),this._ySpring.springTo(o.y),this._needsDraw=!0}h||this._raiseBoundsChange()},setWidth:function(o,l){this._setScale(o,l)},setHeight:function(o,l){this._setScale(o/this.normHeight,l)},setCroppingPolygons:function(o){var l=function(u){return u instanceof t.Point||typeof u.x=="number"&&typeof u.y=="number"},h=function(u){return u.map(function(c){try{if(l(c))return{x:c.x,y:c.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!t.isArray(o))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=o.map(function(u){return h(u)})}catch(u){t.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),t.console.error(u),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(o,l,h){l=l||t.Placement.CENTER;var u=t.Placement.properties[l],c=this.contentAspectX,d=0,f=0,p=1,m=1;if(this._clip&&(c=this._clip.getAspectRatio(),p=this._clip.width/this.source.dimensions.x,m=this._clip.height/this.source.dimensions.y,o.getAspectRatio()>c?(d=this._clip.x/this._clip.height*o.height,f=this._clip.y/this._clip.height*o.height):(d=this._clip.x/this._clip.width*o.width,f=this._clip.y/this._clip.width*o.width)),o.getAspectRatio()>c){var v=o.height/m,g=0;u.isHorizontallyCentered?g=(o.width-o.height*c)/2:u.isRight&&(g=o.width-o.height*c),this.setPosition(new t.Point(o.x-d+g,o.y-f),h),this.setHeight(v,h)}else{var T=o.width/p,w=0;u.isVerticallyCentered?w=(o.height-o.width/c)/2:u.isBottom&&(w=o.height-o.width/c),this.setPosition(new t.Point(o.x-d,o.y-f+w),h),this.setWidth(T,h)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(o){t.console.assert(!o||o instanceof t.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),o instanceof t.Rect?this._clip=o.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(o){this.flipped=!!o,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(o){o!==this.opacity&&(this.opacity=o,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(o){this._preload=!!o,this._needsDraw=!0},getRotation:function(o){return o?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(o,l){this._degreesSpring.target.value===o&&this._degreesSpring.isAtTargetValue()||(l?this._degreesSpring.resetTo(o):this._degreesSpring.springTo(o),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(o){return this.getBoundsNoRotate(o).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(o){o!==this.compositeOperation&&(this.compositeOperation=o,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},setAjaxHeaders:function(o,l){if(o===null&&(o={}),!t.isPlainObject(o)){console.error("[TiledImage.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}this._ownAjaxHeaders=o,this._updateAjaxHeaders(l)},_updateAjaxHeaders:function(o){if(o===void 0&&(o=!0),t.isPlainObject(this.viewer.ajaxHeaders)?this.ajaxHeaders=t.extend({},this.viewer.ajaxHeaders,this._ownAjaxHeaders):this.ajaxHeaders=this._ownAjaxHeaders,o){var l,h,u,c;for(var d in this.tilesMatrix){l=this.source.getNumTiles(d);for(var f in this.tilesMatrix[d]){h=(l.x+f%l.x)%l.x;for(var p in this.tilesMatrix[d][f])if(u=(l.y+p%l.y)%l.y,c=this.tilesMatrix[d][f][p],c.loadWithAjax=this.loadTilesWithAjax,c.loadWithAjax){var m=this.source.getTileAjaxHeaders(d,h,u);c.ajaxHeaders=t.extend({},this.ajaxHeaders,m)}else c.ajaxHeaders=null}}for(var v=0;v<this._imageLoader.jobQueue.length;v++){var g=this._imageLoader.jobQueue[v];g.loadWithAjax=g.tile.loadWithAjax,g.ajaxHeaders=g.tile.loadWithAjax?g.tile.ajaxHeaders:null}}},_setScale:function(o,l){var h=this._scaleSpring.target.value===o;if(l){if(h&&this._scaleSpring.current.value===o)return;this._scaleSpring.resetTo(o),this._updateForScale(),this._needsDraw=!0}else{if(h)return;this._scaleSpring.springTo(o),this._updateForScale(),this._needsDraw=!0}h||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var o=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),l=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,h=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(l/this.minPixelRatio)/Math.log(2))));return h=Math.max(h,this.source.minLevel||0),o=Math.min(o,h),{lowestLevel:o,highestLevel:h}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var o=this.lastDrawn.pop();o.beingDrawn=!1}var l=this.viewport,h=this._viewportToTiledImageRectangle(l.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var u=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(h=h.intersection(u),h===null)return}for(var c=this._getLevelsInterval(),d=c.lowestLevel,f=c.highestLevel,p=null,m=!1,v=t.now(),g=f;g>=d;g--){var T=!1,w=l.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(g),!0).x*this._scaleSpring.current.value;if(g===d||!m&&w>=this.minPixelRatio)T=!0,m=!0;else if(!m)continue;var E=l.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(g),!1).x*this._scaleSpring.current.value,P=l.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,C=this.immediateRender?1:P,D=Math.min(1,(w-.5)/.5),B=C/Math.abs(C-E);if(p=this._updateLevel(m,T,g,D,B,h,v,p),this._providesCoverage(this.coverage,g))break}this._drawTiles(this.lastDrawn),p&&!p.context2D?(this._loadTile(p,v),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(o,l,h){var u,c;this.wrapHorizontal?(u=t.positiveModulo(l.x,1),c=t.positiveModulo(h.x,1)):(u=Math.max(0,l.x),c=Math.min(1,h.x));var d,f,p=1/this.source.aspectRatio;this.wrapVertical?(d=t.positiveModulo(l.y,p),f=t.positiveModulo(h.y,p)):(d=Math.max(0,l.y),f=Math.min(p,h.y));var m=this.source.getTileAtPoint(o,new t.Point(u,d)),v=this.source.getTileAtPoint(o,new t.Point(c,f)),g=this.source.getNumTiles(o);return this.wrapHorizontal&&(m.x+=g.x*Math.floor(l.x),v.x+=g.x*Math.floor(h.x)),this.wrapVertical&&(m.y+=g.y*Math.floor(l.y/p),v.y+=g.y*Math.floor(h.y/p)),{topLeft:m,bottomRight:v}},_updateLevel:function(o,l,h,u,c,d,f,p){var m=d.getBoundingBox().getTopLeft(),v=d.getBoundingBox().getBottomRight();this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:o,level:h,opacity:u,visibility:c,drawArea:d,topleft:m,bottomright:v,currenttime:f,best:p}),this._resetCoverage(this.coverage,h),this._resetCoverage(this.loadingCoverage,h);var g=this._getCornerTiles(h,m,v),T=g.topLeft,w=g.bottomRight,E=this.source.getNumTiles(h),P=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(w.x+=1,this.wrapHorizontal||(w.x=Math.min(w.x,E.x-1)));for(var C=T.x;C<=w.x;C++)for(var D=T.y;D<=w.y;D++){var B;if(this.getFlip()){var H=(E.x+C%E.x)%E.x;B=C+E.x-H-H-1}else B=C;d.intersection(this.getTileBounds(h,B,D))!==null&&(p=this._updateTile(l,o,B,D,h,u,c,P,E,f,p))}return p},_updateTile:function(o,l,h,u,c,d,f,p,m,v,g){var T=this._getTile(h,u,c,v,m,this._worldWidthCurrent,this._worldHeightCurrent),w=l;this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:T}),this._setCoverage(this.coverage,c,h,u,!1);var E=T.loaded||T.loading||this._isCovered(this.loadingCoverage,c,h,u);if(this._setCoverage(this.loadingCoverage,c,h,u,E),!T.exists||(o&&!w&&(this._isCovered(this.coverage,c,h,u)?this._setCoverage(this.coverage,c,h,u,!0):w=!0),!w))return g;if(this._positionTile(T,this.source.tileOverlap,this.viewport,p,f),!T.loaded)if(T.context2D)this._setTileLoaded(T);else{var P=this._tileCache.getImageRecord(T.cacheKey);P&&this._setTileLoaded(T,P.getData())}if(T.loaded){var C=this._blendTile(T,h,u,c,d,v);C&&(this._needsDraw=!0)}else T.loading?this._tilesLoading++:E||(g=this._compareTiles(g,T));return g},_getTile:function(o,l,h,u,c,d,f){var p,m,v,g,T,w,E,P,C,D,B=this.tilesMatrix,H=this.source;return B[h]||(B[h]={}),B[h][o]||(B[h][o]={}),(!B[h][o][l]||!B[h][o][l].flipped!=!this.flipped)&&(p=(c.x+o%c.x)%c.x,m=(c.y+l%c.y)%c.y,v=this.getTileBounds(h,o,l),g=H.getTileBounds(h,p,m,!0),T=H.tileExists(h,p,m),w=H.getTileUrl(h,p,m),E=H.getTilePostData(h,p,m),this.loadTilesWithAjax?(P=H.getTileAjaxHeaders(h,p,m),t.isPlainObject(this.ajaxHeaders)&&(P=t.extend({},this.ajaxHeaders,P))):P=null,C=H.getContext2D?H.getContext2D(h,p,m):void 0,D=new t.Tile(h,o,l,v,T,w,C,this.loadTilesWithAjax,P,g,E,H.getTileHashKey(h,p,m,w,P,E)),this.getFlip()?p===0&&(D.isRightMost=!0):p===c.x-1&&(D.isRightMost=!0),m===c.y-1&&(D.isBottomMost=!0),D.flipped=this.flipped,B[h][o][l]=D),D=B[h][o][l],D.lastTouchTime=u,D},_loadTile:function(o,l){var h=this;o.loading=!0,this._imageLoader.addJob({src:o.getUrl(),tile:o,source:this.source,postData:o.postData,loadWithAjax:o.loadWithAjax,ajaxHeaders:o.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(u,c,d){h._onTileLoad(o,l,u,c,d)},abort:function(){o.loading=!1}})},_onTileLoad:function(o,l,h,u,c){if(h)o.exists=!0;else{t.console.error("Tile %s failed to load: %s - error: %s",o,o.getUrl(),u),this.viewer.raiseEvent("tile-load-failed",{tile:o,tiledImage:this,time:l,message:u,tileRequest:c}),o.loading=!1,o.exists=!1;return}if(l<this.lastResetTime){t.console.warn("Ignoring tile %s loaded before reset: %s",o,o.getUrl()),o.loading=!1;return}var d=this,f=function(){var p=d.source,m=p.getClosestLevel();d._setTileLoaded(o,h,m,c)};this._midDraw?window.setTimeout(f,1):f()},_setTileLoaded:function(o,l,h,u){var c=0,d=!1,f=this;function p(){return d&&t.console.error("Event 'tile-loaded' argument getCompletionCallback must be called synchronously. Its return value should be called asynchronously."),c++,m}function m(){c--,c===0&&(o.loading=!1,o.loaded=!0,o.hasTransparency=f.source.hasTransparency(o.context2D,o.getUrl(),o.ajaxHeaders,o.postData),o.context2D||f._tileCache.cacheTile({data:l,tile:o,cutoff:h,tiledImage:f}),f._needsDraw=!0)}var v=p();this.viewer.raiseEvent("tile-loaded",{tile:o,tiledImage:this,tileRequest:u,get image(){return t.console.error("[tile-loaded] event 'image' has been deprecated. Use 'data' property instead."),l},data:l,getCompletionCallback:p}),d=!0,v()},_positionTile:function(o,l,h,u,c){var d=o.bounds.getTopLeft();d.x*=this._scaleSpring.current.value,d.y*=this._scaleSpring.current.value,d.x+=this._xSpring.current.value,d.y+=this._ySpring.current.value;var f=o.bounds.getSize();f.x*=this._scaleSpring.current.value,f.y*=this._scaleSpring.current.value;var p=h.pixelFromPointNoRotate(d,!0),m=h.pixelFromPointNoRotate(d,!1),v=h.deltaPixelsFromPointsNoRotate(f,!0),g=h.deltaPixelsFromPointsNoRotate(f,!1),T=m.plus(g.divide(2)),w=u.squaredDistanceTo(T);l||(v=v.plus(new t.Point(1,1))),o.isRightMost&&this.wrapHorizontal&&(v.x+=.75),o.isBottomMost&&this.wrapVertical&&(v.y+=.75),o.position=p,o.size=v,o.squaredDistance=w,o.visibility=c},_blendTile:function(o,l,h,u,c,d){var f=1e3*this.blendTime,p,m;if(o.blendStart||(o.blendStart=d),p=d-o.blendStart,m=f?Math.min(1,p/f):1,this.alwaysBlend&&(m*=c),o.opacity=m,this.lastDrawn.push(o),m===1)this._setCoverage(this.coverage,u,l,h,!0),this._hasOpaqueTile=!0;else if(p<f)return!0;return!1},_compareTiles:function(o,l){return!o||l.visibility>o.visibility||l.visibility===o.visibility&&l.squaredDistance<o.squaredDistance?l:o},_drawTiles:function(o){if(!(this.opacity===0||o.length===0&&!this.placeholderFillStyle)){var l=o[0],h;l&&(h=this.opacity<1||this.compositeOperation&&this.compositeOperation!=="source-over"||!this._isBottomItem()&&this.source.hasTransparency(l.context2D,l.getUrl(),l.ajaxHeaders,l.postData));var u,c,d=this.viewport.getZoom(!0),f=this.viewportToImageZoom(d);o.length>1&&f>this.smoothTileEdgesMinZoom&&!this.iOSDevice&&this.getRotation(!0)%360===0&&t.supportsCanvas&&this.viewer.useCanvas&&(h=!0,u=l.getScaleForEdgeSmoothing(),c=l.getTranslationForEdgeSmoothing(u,this._drawer.getCanvasSize(!1),this._drawer.getCanvasSize(!0)));var p;h&&(u||(p=this.viewport.viewportToViewerElementRectangle(this.getClippedBounds(!0)).getIntegerBoundingBox(),this._drawer.viewer.viewport.getFlip()&&(this.viewport.getRotation(!0)%360!==0||this.getRotation(!0)%360!==0)&&(p.x=this._drawer.viewer.container.clientWidth-(p.x+p.width)),p=p.times(t.pixelDensityRatio)),this._drawer._clear(!0,p)),u||(this.viewport.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:h}),this.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:h}),this.viewport.getRotation(!0)%360===0&&this.getRotation(!0)%360===0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip());var m=!1;if(this._clip){this._drawer.saveContext(h);var v=this.imageToViewportRectangle(this._clip,!0);v=v.rotate(-this.getRotation(!0),this._getRotationPoint(!0));var g=this._drawer.viewportToDrawerRectangle(v);u&&(g=g.times(u)),c&&(g=g.translate(c)),this._drawer.setClip(g,h),m=!0}if(this._croppingPolygons){var T=this;this._drawer.saveContext(h);try{var w=this._croppingPolygons.map(function(I){return I.map(function(N){var M=T.imageToViewportCoordinates(N.x,N.y,!0).rotate(-T.getRotation(!0),T._getRotationPoint(!0)),R=T._drawer.viewportCoordToDrawerCoord(M);return u&&(R=R.times(u)),c&&(R=R.plus(c)),R})});this._drawer.clipWithPolygons(w,h)}catch(I){t.console.error(I)}m=!0}if(this.placeholderFillStyle&&this._hasOpaqueTile===!1){var E=this._drawer.viewportToDrawerRectangle(this.getBounds(!0));u&&(E=E.times(u)),c&&(E=E.translate(c));var P=null;typeof this.placeholderFillStyle=="function"?P=this.placeholderFillStyle(this,this._drawer.context):P=this.placeholderFillStyle,this._drawer.drawRectangle(E,P,h)}var C=a(this.subPixelRoundingForTransparency),D=!1;if(C===t.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS)D=!0;else if(C===t.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST){var B=this.viewer&&this.viewer.isAnimating();D=!B}for(var H=o.length-1;H>=0;H--)l=o[H],this._drawer.drawTile(l,this._drawingHandler,h,u,c,D,this.source),l.beingDrawn=!0,this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:this,tile:l});m&&this._drawer.restoreContext(h),u||(this.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(h),this.viewport.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(h)),h&&(u&&(this.viewport.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:!1}),this.getRotation(!0)%360!==0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:!1})),this._drawer.blendSketch({opacity:this.opacity,scale:u,translate:c,compositeOperation:this.compositeOperation,bounds:p}),u&&(this.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(!1),this.viewport.getRotation(!0)%360!==0&&this._drawer._restoreRotationChanges(!1))),u||this.viewport.getRotation(!0)%360===0&&this.getRotation(!0)%360===0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip(),this._drawDebugInfo(o)}},_drawDebugInfo:function(o){if(this.debugMode)for(var l=o.length-1;l>=0;l--){var h=o[l];try{this._drawer.drawDebugInfo(h,o.length,l,this)}catch(u){t.console.error(u)}}},_providesCoverage:function(o,l,h,u){var c,d,f,p;if(!o[l])return!1;if(h===void 0||u===void 0){c=o[l];for(f in c)if(Object.prototype.hasOwnProperty.call(c,f)){d=c[f];for(p in d)if(Object.prototype.hasOwnProperty.call(d,p)&&!d[p])return!1}return!0}return o[l][h]===void 0||o[l][h][u]===void 0||o[l][h][u]===!0},_isCovered:function(o,l,h,u){return h===void 0||u===void 0?this._providesCoverage(o,l+1):this._providesCoverage(o,l+1,2*h,2*u)&&this._providesCoverage(o,l+1,2*h,2*u+1)&&this._providesCoverage(o,l+1,2*h+1,2*u)&&this._providesCoverage(o,l+1,2*h+1,2*u+1)},_setCoverage:function(o,l,h,u,c){if(!o[l]){t.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",l);return}o[l][h]||(o[l][h]={}),o[l][h][u]=c},_resetCoverage:function(o,l){o[l]={}}});var i=t.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function s(o){return o!==t.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&o!==t.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&o!==t.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function r(o){return s(o)?i:o}function a(o){if(typeof o=="number")return r(o);if(!o||!t.Browser)return i;var l=o[t.Browser.vendor];return s(l)&&(l=o["*"]),r(l)}}(e),function(t){var i=function(r){t.console.assert(r,"[TileCache.cacheTile] options is required"),t.console.assert(r.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(r.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=r.tile,this.tiledImage=r.tiledImage},s=function(r){t.console.assert(r,"[ImageRecord] options is required"),t.console.assert(r.data,"[ImageRecord] options.data is required"),this._tiles=[],r.create.apply(null,[this,r.data,r.ownerTile]),this._destroyImplementation=r.destroy.bind(null,this),this.getImage=r.getImage.bind(null,this),this.getData=r.getData.bind(null,this),this.getRenderedContext=r.getRenderedContext.bind(null,this)};s.prototype={destroy:function(){this._destroyImplementation(),this._tiles=null},addTile:function(r){t.console.assert(r,"[ImageRecord.addTile] tile is required"),this._tiles.push(r)},removeTile:function(r){for(var a=0;a<this._tiles.length;a++)if(this._tiles[a]===r){this._tiles.splice(a,1);return}t.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",r)},getTileCount:function(){return this._tiles.length}},t.TileCache=function(r){r=r||{},this._maxImageCacheCount=r.maxImageCacheCount||t.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},t.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(r){t.console.assert(r,"[TileCache.cacheTile] options is required"),t.console.assert(r.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(r.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),t.console.assert(r.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var a=r.cutoff||0,o=this._tilesLoaded.length,l=this._imagesLoaded[r.tile.cacheKey];if(l||(r.data||(t.console.error("[TileCache.cacheTile] options.image was renamed to options.data. '.image' attribute has been deprecated and will be removed in the future."),r.data=r.image),t.console.assert(r.data,"[TileCache.cacheTile] options.data is required to create an ImageRecord"),l=this._imagesLoaded[r.tile.cacheKey]=new s({data:r.data,ownerTile:r.tile,create:r.tiledImage.source.createTileCache,destroy:r.tiledImage.source.destroyTileCache,getImage:r.tiledImage.source.getTileCacheDataAsImage,getData:r.tiledImage.source.getTileCacheData,getRenderedContext:r.tiledImage.source.getTileCacheDataAsContext2D}),this._imagesLoadedCount++),l.addTile(r.tile),r.tile.cacheImageRecord=l,this._imagesLoadedCount>this._maxImageCacheCount){for(var h=null,u=-1,c=null,d,f,p,m,v,g,T=this._tilesLoaded.length-1;T>=0;T--)if(g=this._tilesLoaded[T],d=g.tile,!(d.level<=a||d.beingDrawn)){if(!h){h=d,u=T,c=g;continue}m=d.lastTouchTime,f=h.lastTouchTime,v=d.level,p=h.level,(m<f||m===f&&v>p)&&(h=d,u=T,c=g)}h&&u>=0&&(this._unloadTile(c),o=u)}this._tilesLoaded[o]=new i({tile:r.tile,tiledImage:r.tiledImage})},clearTilesFor:function(r){t.console.assert(r,"[TileCache.clearTilesFor] tiledImage is required");for(var a,o=0;o<this._tilesLoaded.length;++o)a=this._tilesLoaded[o],a.tiledImage===r&&(this._unloadTile(a),this._tilesLoaded.splice(o,1),o--)},getImageRecord:function(r){return t.console.assert(r,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[r]},_unloadTile:function(r){t.console.assert(r,"[TileCache._unloadTile] tileRecord is required");var a=r.tile,o=r.tiledImage;a.unload(),a.cacheImageRecord=null;var l=this._imagesLoaded[a.cacheKey];l.removeTile(a),l.getTileCount()||(l.destroy(),delete this._imagesLoaded[a.cacheKey],this._imagesLoadedCount--),o.viewer.raiseEvent("tile-unloaded",{tile:a,tiledImage:o})}}}(e),function(t){t.World=function(i){var s=this;t.console.assert(i.viewer,"[World] options.viewer is required"),t.EventSource.call(this),this.viewer=i.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(r){s._autoRefigureSizes?s._figureSizes():s._needsSizesFigured=!0},this._figureSizes()},t.extend(t.World.prototype,t.EventSource.prototype,{addItem:function(i,s){if(t.console.assert(i,"[World.addItem] item is required"),t.console.assert(i instanceof t.TiledImage,"[World.addItem] only TiledImages supported at this time"),s=s||{},s.index!==void 0){var r=Math.max(0,Math.min(this._items.length,s.index));this._items.splice(r,0,i)}else this._items.push(i);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,i.addHandler("bounds-change",this._delegatedFigureSizes),i.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:i})},getItemAt:function(i){return t.console.assert(i!==void 0,"[World.getItemAt] index is required"),this._items[i]},getIndexOfItem:function(i){return t.console.assert(i,"[World.getIndexOfItem] item is required"),t.indexOf(this._items,i)},getItemCount:function(){return this._items.length},setItemIndex:function(i,s){t.console.assert(i,"[World.setItemIndex] item is required"),t.console.assert(s!==void 0,"[World.setItemIndex] index is required");var r=this.getIndexOfItem(i);if(s>=this._items.length)throw new Error("Index bigger than number of layers.");s===r||r===-1||(this._items.splice(r,1),this._items.splice(s,0,i),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:i,previousIndex:r,newIndex:s}))},removeItem:function(i){t.console.assert(i,"[World.removeItem] item is required");var s=t.indexOf(this._items,i);s!==-1&&(i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy(),this._items.splice(s,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(i))},removeAll:function(){this.viewer._cancelPendingImages();var i,s;for(s=0;s<this._items.length;s++)i=this._items[s],i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy();var r=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,s=0;s<r.length;s++)i=r[s],this._raiseRemoveItem(i)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(){for(var i=!1,s=0;s<this._items.length;s++)i=this._items[s].update()||i;return i},draw:function(){for(var i=0;i<this._items.length;i++)this._items[i].draw();this._needsDraw=!1},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(i){this._autoRefigureSizes=i,i&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(i){i=i||{};var s=i.immediately||!1,r=i.layout||t.DEFAULT_SETTINGS.collectionLayout,a=i.rows||t.DEFAULT_SETTINGS.collectionRows,o=i.columns||t.DEFAULT_SETTINGS.collectionColumns,l=i.tileSize||t.DEFAULT_SETTINGS.collectionTileSize,h=i.tileMargin||t.DEFAULT_SETTINGS.collectionTileMargin,u=l+h,c;!i.rows&&o?c=o:c=Math.ceil(this._items.length/a);var d=0,f=0,p,m,v,g,T;this.setAutoRefigureSizes(!1);for(var w=0;w<this._items.length;w++)w&&w%c===0&&(r==="horizontal"?(f+=u,d=0):(d+=u,f=0)),p=this._items[w],m=p.getBounds(),m.width>m.height?v=l:v=l*(m.width/m.height),g=v*(m.height/m.width),T=new t.Point(d+(l-v)/2,f+(l-g)/2),p.setPosition(T,s),p.setWidth(v,s),r==="horizontal"?d+=u:f+=u;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var i=this._homeBounds?this._homeBounds.clone():null,s=this._contentSize?this._contentSize.clone():null,r=this._contentFactor||0;if(!this._items.length)this._homeBounds=new t.Rect(0,0,1,1),this._contentSize=new t.Point(1,1),this._contentFactor=1;else{var a=this._items[0],o=a.getBounds();this._contentFactor=a.getContentSize().x/o.width;for(var l=a.getClippedBounds().getBoundingBox(),h=l.x,u=l.y,c=l.x+l.width,d=l.y+l.height,f=1;f<this._items.length;f++)a=this._items[f],o=a.getBounds(),this._contentFactor=Math.max(this._contentFactor,a.getContentSize().x/o.width),l=a.getClippedBounds().getBoundingBox(),h=Math.min(h,l.x),u=Math.min(u,l.y),c=Math.max(c,l.x+l.width),d=Math.max(d,l.y+l.height);this._homeBounds=new t.Rect(h,u,c-h,d-u),this._contentSize=new t.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==r||!this._homeBounds.equals(i)||!this._contentSize.equals(s))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(i){this.raiseEvent("remove-item",{item:i})}})}(e)})(Kh);var cd=Kh.exports;const Li=hd(cd);var dd=Object.defineProperty,fd=(n,e,t)=>e in n?dd(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Va=(n,e,t)=>fd(n,typeof e!="symbol"?e+"":e,t),Wa=Object.prototype.hasOwnProperty;function Fi(n,e){var t,i;if(n===e)return!0;if(n&&e&&(t=n.constructor)===e.constructor){if(t===Date)return n.getTime()===e.getTime();if(t===RegExp)return n.toString()===e.toString();if(t===Array){if((i=n.length)===e.length)for(;i--&&Fi(n[i],e[i]););return i===-1}if(!t||typeof n=="object"){i=0;for(t in n)if(Wa.call(n,t)&&++i&&!Wa.call(e,t)||!(t in e)||!Fi(n[t],e[t]))return!1;return Object.keys(e).length===i}}return n!==n&&e!==e}var Jh=(n=>(n.EDIT="EDIT",n.SELECT="SELECT",n.NONE="NONE",n))(Jh||{}),pd=[];for(var Pr=0;Pr<256;++Pr)pd.push((Pr+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const md=(n,e)=>{const t=new Set(n.bodies.map(i=>i.id));return e.bodies.filter(i=>!t.has(i.id))},gd=(n,e)=>{const t=new Set(e.bodies.map(i=>i.id));return n.bodies.filter(i=>!t.has(i.id))},vd=(n,e)=>e.bodies.map(t=>{const i=n.bodies.find(s=>s.id===t.id);return{newBody:t,oldBody:i&&!Fi(i,t)?i:void 0}}).filter(({oldBody:t})=>t).map(({oldBody:t,newBody:i})=>({oldBody:t,newBody:i})),yd=(n,e)=>!Fi(n.target,e.target),xd=(n,e)=>{const t=md(n,e),i=gd(n,e),s=vd(n,e);return{oldValue:n,newValue:e,bodiesCreated:t.length>0?t:void 0,bodiesDeleted:i.length>0?i:void 0,bodiesUpdated:s.length>0?s:void 0,targetUpdated:yd(n,e)?{oldTarget:n.target,newTarget:e.target}:void 0}};var ui=(n=>(n.LOCAL="LOCAL",n.REMOTE="REMOTE",n))(ui||{});const _d=(n,e)=>{const t=new Set((n.created||[]).map(c=>c.id)),i=new Set((n.updated||[]).map(({newValue:c})=>c.id)),s=new Set((e.created||[]).map(c=>c.id)),r=new Set((e.deleted||[]).map(c=>c.id)),a=new Set((e.updated||[]).map(({oldValue:c})=>c.id)),o=new Set((e.updated||[]).filter(({oldValue:c})=>t.has(c.id)||i.has(c.id)).map(({oldValue:c})=>c.id)),l=[...(n.created||[]).filter(c=>!r.has(c.id)).map(c=>a.has(c.id)?e.updated.find(({oldValue:d})=>d.id===c.id).newValue:c),...e.created||[]],h=[...(n.deleted||[]).filter(c=>!s.has(c.id)),...(e.deleted||[]).filter(c=>!t.has(c.id))],u=[...(n.updated||[]).filter(({newValue:c})=>!r.has(c.id)).map(c=>{const{oldValue:d,newValue:f}=c;if(a.has(f.id)){const p=e.updated.find(m=>m.oldValue.id===f.id).newValue;return xd(d,p)}else return c}),...(e.updated||[]).filter(({oldValue:c})=>!o.has(c.id))];return{created:l,deleted:h,updated:u}};let wd=()=>({emit(n,...e){for(let t=0,i=this.events[n]||[],s=i.length;t<s;t++)i[t](...e)},events:{},on(n,e){var t;return((t=this.events)[n]||(t[n]=[])).push(e),()=>{var i;this.events[n]=(i=this.events[n])==null?void 0:i.filter(s=>e!==s)}}});const Td=250,Ed=n=>{const e=wd(),t=[];let i=-1,s=!1,r=0;const a=f=>{if(!s){const{changes:p}=f,m=performance.now();if(m-r>Td)t.splice(i+1),t.push(p),i=t.length-1;else{const v=t.length-1;t[v]=_d(t[v],p)}r=m}s=!1};n.observe(a,{origin:ui.LOCAL});const o=f=>f&&f.length>0&&n.bulkDeleteAnnotation(f),l=f=>f&&f.length>0&&n.bulkAddAnnotation(f,!1),h=f=>f&&f.length>0&&n.bulkUpdateAnnotation(f.map(({oldValue:p})=>p)),u=f=>f&&f.length>0&&n.bulkUpdateAnnotation(f.map(({newValue:p})=>p)),c=f=>f&&f.length>0&&n.bulkAddAnnotation(f,!1),d=f=>f&&f.length>0&&n.bulkDeleteAnnotation(f);return{canRedo:()=>t.length-1>i,canUndo:()=>i>-1,destroy:()=>n.unobserve(a),on:(f,p)=>e.on(f,p),redo:()=>{if(t.length-1>i){s=!0;const{created:f,updated:p,deleted:m}=t[i+1];l(f),u(p),d(m),e.emit("redo",t[i+1]),i+=1}},undo:()=>{if(i>-1){s=!0;const{created:f,updated:p,deleted:m}=t[i];o(f),h(p),c(m),e.emit("undo",t[i]),i-=1}}}},bd=(n,e,t,i)=>{const{store:s,selection:r,hover:a,viewport:o}=n,l=new Map;let h=[],u,c;const d=(g,T)=>{l.has(g)?l.get(g).push(T):l.set(g,[T])},f=(g,T)=>{const w=l.get(g);if(w){const E=w.indexOf(T);E!==-1&&w.splice(E,1)}},p=(g,T,w)=>{l.has(g)&&setTimeout(()=>{l.get(g).forEach(E=>{if(t){const P=Array.isArray(T)?T.map(D=>t.serialize(D)):t.serialize(T),C=w?w instanceof PointerEvent?w:t.serialize(w):void 0;E(P,C)}else E(T,w)})},1)},m=()=>{const{selected:g}=r,T=(g||[]).map(({id:w})=>s.getAnnotation(w));T.forEach(w=>{const E=h.find(P=>P.id===w.id);(!E||!Fi(E,w))&&p("updateAnnotation",w,E)}),h=h.map(w=>T.find(({id:E})=>E===w.id)||w)};r.subscribe(({selected:g})=>{if(!(h.length===0&&g.length===0)){if(h.length===0&&g.length>0)h=g.map(({id:T})=>s.getAnnotation(T));else if(h.length>0&&g.length===0)h.forEach(T=>{const w=s.getAnnotation(T.id);w&&!Fi(w,T)&&p("updateAnnotation",w,T)}),h=[];else{const T=new Set(h.map(E=>E.id)),w=new Set(g.map(({id:E})=>E));h.filter(E=>!w.has(E.id)).forEach(E=>{const P=s.getAnnotation(E.id);P&&!Fi(P,E)&&p("updateAnnotation",P,E)}),h=[...h.filter(E=>w.has(E.id)),...g.filter(({id:E})=>!T.has(E)).map(({id:E})=>s.getAnnotation(E))]}p("selectionChanged",h)}}),a.subscribe(g=>{!u&&g?p("mouseEnterAnnotation",s.getAnnotation(g)):u&&!g?p("mouseLeaveAnnotation",s.getAnnotation(u)):u&&g&&(p("mouseLeaveAnnotation",s.getAnnotation(u)),p("mouseEnterAnnotation",s.getAnnotation(g))),u=g}),o?.subscribe(g=>p("viewportIntersect",g.map(T=>s.getAnnotation(T)))),s.observe(g=>{i&&(c&&clearTimeout(c),c=setTimeout(m,1e3));const{created:T,deleted:w}=g.changes;(T||[]).forEach(E=>p("createAnnotation",E)),(w||[]).forEach(E=>p("deleteAnnotation",E)),(g.changes.updated||[]).filter(E=>[...E.bodiesCreated||[],...E.bodiesDeleted||[],...E.bodiesUpdated||[]].length>0).forEach(({oldValue:E,newValue:P})=>{const C=h.find(D=>D.id===E.id)||E;h=h.map(D=>D.id===E.id?P:D),p("updateAnnotation",P,C)})},{origin:ui.LOCAL}),s.observe(g=>{if(h){const T=new Set(h.map(E=>E.id)),w=(g.changes.updated||[]).filter(({newValue:E})=>T.has(E.id)).map(({newValue:E})=>E);w.length>0&&(h=h.map(E=>w.find(P=>P.id===E.id)||E))}},{origin:ui.REMOTE});const v=g=>T=>{const{updated:w}=T;g?(w||[]).forEach(E=>p("updateAnnotation",E.oldValue,E.newValue)):(w||[]).forEach(E=>p("updateAnnotation",E.newValue,E.oldValue))};return e.on("undo",v(!0)),e.on("redo",v(!1)),{on:d,off:f,emit:p}},Sd=n=>e=>e.reduce((t,i)=>{const{parsed:s,error:r}=n.parse(i);return r?{parsed:t.parsed,failed:[...t.failed,i]}:s?{parsed:[...t.parsed,s],failed:t.failed}:{...t}},{parsed:[],failed:[]}),Ad=(n,e,t)=>{const{store:i,selection:s}=n,r=g=>{if(t){const{parsed:T,error:w}=t.parse(g);T?i.addAnnotation(T,ui.REMOTE):console.error(w)}else i.addAnnotation(g,ui.REMOTE)},a=()=>s.clear(),o=()=>i.clear(),l=g=>{const T=i.getAnnotation(g);return t&&T?t.serialize(T):T},h=()=>t?i.all().map(t.serialize):i.all(),u=()=>{var g;const T=(((g=s.selected)==null?void 0:g.map(w=>w.id))||[]).map(w=>i.getAnnotation(w)).filter(Boolean);return t?T.map(t.serialize):T},c=(g,T=!0)=>fetch(g).then(w=>w.json()).then(w=>(f(w,T),w)),d=g=>{if(typeof g=="string"){const T=i.getAnnotation(g);if(i.deleteAnnotation(g),T)return t?t.serialize(T):T}else{const T=t?t.parse(g).parsed:g;if(T)return i.deleteAnnotation(T),g}},f=(g,T=!0)=>{if(t){const{parsed:w,failed:E}=Sd(t)(g);E.length>0&&console.warn(`Discarded ${E.length} invalid annotations`,E),i.bulkAddAnnotation(w,T,ui.REMOTE)}else i.bulkAddAnnotation(g,T,ui.REMOTE)},p=(g,T)=>{g?s.setSelected(g,T):s.clear()},m=g=>{s.clear(),s.setUserSelectAction(g)},v=g=>{if(t){const T=t.parse(g).parsed,w=t.serialize(i.getAnnotation(T.id));return i.updateAnnotation(T),w}else{const T=i.getAnnotation(g.id);return i.updateAnnotation(g),T}};return{addAnnotation:r,cancelSelected:a,canRedo:e.canRedo,canUndo:e.canUndo,clearAnnotations:o,getAnnotationById:l,getAnnotations:h,getSelected:u,loadAnnotations:c,redo:e.redo,removeAnnotation:d,setAnnotations:f,setSelected:p,setUserSelectAction:m,undo:e.undo,updateAnnotation:v}},Rd="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Pd=n=>crypto.getRandomValues(new Uint8Array(n)),Cd=(n,e,t)=>{let i=(2<<Math.log(n.length-1)/Math.LN2)-1,s=-~(1.6*i*e/n.length);return(r=e)=>{let a="";for(;;){let o=t(s),l=s;for(;l--;)if(a+=n[o[l]&i]||"",a.length===r)return a}}},Id=(n,e=21)=>Cd(n,e,Pd),Md=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n));for(;n--;)e+=Rd[t[n]&63];return e};const Dd=()=>({isGuest:!0,id:Id("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",20)()});Md();var Bd=Object.defineProperty,Od=(n,e,t)=>e in n?Bd(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ja=(n,e,t)=>Od(n,typeof e!="symbol"?e+"":e,t);function Kt(){}function To(n,e){for(const t in e)n[t]=e[t];return n}function Qh(n){return n()}function Xa(){return Object.create(null)}function $t(n){n.forEach(Qh)}function it(n){return typeof n=="function"}function As(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function Ld(n){return Object.keys(n).length===0}function Fd(n,e,t,i){if(n){const s=$h(n,e,t,i);return n[0](s)}}function $h(n,e,t,i){return n[1]&&i?To(t.ctx.slice(),n[1](i(e))):t.ctx}function Nd(n,e,t,i){if(n[2]&&i){const s=n[2](i(t));if(e.dirty===void 0)return s;if(typeof s=="object"){const r=[],a=Math.max(e.dirty.length,s.length);for(let o=0;o<a;o+=1)r[o]=e.dirty[o]|s[o];return r}return e.dirty|s}return e.dirty}function kd(n,e,t,i,s,r){if(s){const a=$h(e,t,i,r);n.p(a,s)}}function Ud(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function Ya(n){const e={};for(const t in n)t[0]!=="$"&&(e[t]=n[t]);return e}function qn(n){return n??""}function qa(n,e){n.appendChild(e)}function be(n,e,t){n.insertBefore(e,t||null)}function Ee(n){n.parentNode&&n.parentNode.removeChild(n)}function Hd(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function We(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function eu(n){return document.createTextNode(n)}function Tt(){return eu(" ")}function ya(){return eu("")}function Qe(n,e,t,i){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t,i)}function k(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function Gd(n){return Array.from(n.childNodes)}function Za(n,e,t){n.classList.toggle(e,!!t)}function zd(n,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:i})}let $s;function Ks(n){$s=n}function tu(){if(!$s)throw new Error("Function called outside component initialization");return $s}function iu(n){tu().$$.on_mount.push(n)}function xa(){const n=tu();return(e,t,{cancelable:i=!1}={})=>{const s=n.$$.callbacks[e];if(s){const r=zd(e,t,{cancelable:i});return s.slice().forEach(a=>{a.call(n,r)}),!r.defaultPrevented}return!0}}function Zt(n,e){const t=n.$$.callbacks[e.type];t&&t.slice().forEach(i=>i.call(this,e))}const is=[],Ka=[];let ps=[];const Ja=[],Vd=Promise.resolve();let Eo=!1;function Wd(){Eo||(Eo=!0,Vd.then(su))}function bo(n){ps.push(n)}const Cr=new Set;let qi=0;function su(){if(qi!==0)return;const n=$s;do{try{for(;qi<is.length;){const e=is[qi];qi++,Ks(e),jd(e.$$)}}catch(e){throw is.length=0,qi=0,e}for(Ks(null),is.length=0,qi=0;Ka.length;)Ka.pop()();for(let e=0;e<ps.length;e+=1){const t=ps[e];Cr.has(t)||(Cr.add(t),t())}ps.length=0}while(is.length);for(;Ja.length;)Ja.pop()();Eo=!1,Cr.clear(),Ks(n)}function jd(n){if(n.fragment!==null){n.update(),$t(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(bo)}}function Xd(n){const e=[],t=[];ps.forEach(i=>n.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),ps=e}const Nn=new Set;let Di;function Yd(){Di={r:0,c:[],p:Di}}function qd(){Di.r||$t(Di.c),Di=Di.p}function pt(n,e){n&&n.i&&(Nn.delete(n),n.i(e))}function Nt(n,e,t,i){if(n&&n.o){if(Nn.has(n))return;Nn.add(n),Di.c.push(()=>{Nn.delete(n),i&&(t&&n.d(1),i())}),n.o(e)}else i&&i()}function Qa(n){return n?.length!==void 0?n:Array.from(n)}function Bi(n){n&&n.c()}function ci(n,e,t){const{fragment:i,after_update:s}=n.$$;i&&i.m(e,t),bo(()=>{const r=n.$$.on_mount.map(Qh).filter(it);n.$$.on_destroy?n.$$.on_destroy.push(...r):$t(r),n.$$.on_mount=[]}),s.forEach(bo)}function di(n,e){const t=n.$$;t.fragment!==null&&(Xd(t.after_update),$t(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Zd(n,e){n.$$.dirty[0]===-1&&(is.push(n),Wd(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function Rs(n,e,t,i,s,r,a=null,o=[-1]){const l=$s;Ks(n);const h=n.$$={fragment:null,ctx:[],props:r,update:Kt,not_equal:s,bound:Xa(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Xa(),dirty:o,skip_bound:!1,root:e.target||l.$$.root};a&&a(h.root);let u=!1;if(h.ctx=t?t(n,e.props||{},(c,d,...f)=>{const p=f.length?f[0]:d;return h.ctx&&s(h.ctx[c],h.ctx[c]=p)&&(!h.skip_bound&&h.bound[c]&&h.bound[c](p),u&&Zd(n,c)),d}):[],h.update(),u=!0,$t(h.before_update),h.fragment=i?i(h.ctx):!1,e.target){if(e.hydrate){const c=Gd(e.target);h.fragment&&h.fragment.l(c),c.forEach(Ee)}else h.fragment&&h.fragment.c();e.intro&&pt(n.$$.fragment),ci(n,e.target,e.anchor),su()}Ks(l)}class Ps{constructor(){ja(this,"$$"),ja(this,"$$set")}$destroy(){di(this,1),this.$destroy=Kt}$on(e,t){if(!it(t))return Kt;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}$set(e){this.$$set&&!Ld(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Kd="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Kd);var rt=(n=>(n.ELLIPSE="ELLIPSE",n.POLYGON="POLYGON",n.RECTANGLE="RECTANGLE",n))(rt||{});const _a={},wa=(n,e)=>_a[n]=e,So=n=>_a[n.type].area(n),Jd=(n,e,t)=>_a[n.type].intersects(n,e,t),Ao=n=>{let e=1/0,t=1/0,i=-1/0,s=-1/0;return n.forEach(([r,a])=>{e=Math.min(e,r),t=Math.min(t,a),i=Math.max(i,r),s=Math.max(s,a)}),{minX:e,minY:t,maxX:i,maxY:s}},Qd={area:n=>Math.PI*n.geometry.rx*n.geometry.ry,intersects:(n,e,t)=>{const{cx:i,cy:s,rx:r,ry:a}=n.geometry,o=0,l=Math.cos(o),h=Math.sin(o),u=e-i,c=t-s,d=l*u+h*c,f=h*u-l*c;return d*d/(r*r)+f*f/(a*a)<=1}};wa(rt.ELLIPSE,Qd);const $d={area:n=>{const{points:e}=n.geometry;let t=0,i=e.length-1;for(let s=0;s<e.length;s++)t+=(e[i][0]+e[s][0])*(e[i][1]-e[s][1]),i=s;return Math.abs(.5*t)},intersects:(n,e,t)=>{const{points:i}=n.geometry;let s=!1;for(let r=0,a=i.length-1;r<i.length;a=r++){const o=i[r][0],l=i[r][1],h=i[a][0],u=i[a][1];l>t!=u>t&&e<(h-o)*(t-l)/(u-l)+o&&(s=!s)}return s}};wa(rt.POLYGON,$d);const ef={area:n=>n.geometry.w*n.geometry.h,intersects:(n,e,t)=>e>=n.geometry.x&&e<=n.geometry.x+n.geometry.w&&t>=n.geometry.y&&t<=n.geometry.y+n.geometry.h};wa(rt.RECTANGLE,ef);var tf=[];for(var Ir=0;Ir<256;++Ir)tf.push((Ir+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var $a=Object.prototype.hasOwnProperty;function Zn(n,e){var t,i;if(n===e)return!0;if(n&&e&&(t=n.constructor)===e.constructor){if(t===Date)return n.getTime()===e.getTime();if(t===RegExp)return n.toString()===e.toString();if(t===Array){if((i=n.length)===e.length)for(;i--&&Zn(n[i],e[i]););return i===-1}if(!t||typeof n=="object"){i=0;for(t in n)if($a.call(n,t)&&++i&&!$a.call(e,t)||!(t in e)||!Zn(n[t],e[t]))return!1;return Object.keys(e).length===i}}return n!==n&&e!==e}function Mr(){}function sf(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}const Zi=[];function Ta(n,e=Mr){let t;const i=new Set;function s(o){if(sf(n,o)&&(n=o,t)){const l=!Zi.length;for(const h of i)h[1](),Zi.push(h,n);if(l){for(let h=0;h<Zi.length;h+=2)Zi[h][0](Zi[h+1]);Zi.length=0}}}function r(o){s(o(n))}function a(o,l=Mr){const h=[o,l];return i.add(h),i.size===1&&(t=e(s,r)||Mr),o(n),()=>{i.delete(h),i.size===0&&t&&(t(),t=null)}}return{set:s,update:r,subscribe:a}}const nf=n=>{const{subscribe:e,set:t}=Ta();let i;return e(s=>i=s),n.observe(({changes:s})=>{if(i){(s.deleted||[]).some(a=>a.id===i)&&t(void 0);const r=(s.updated||[]).find(({oldValue:a})=>a.id===i);r&&t(r.newValue.id)}}),{get current(){return i},subscribe:e,set:t}},Dr={selected:[]},rf=(n,e="EDIT")=>{const{subscribe:t,set:i}=Ta(Dr);let s=e,r=Dr;t(f=>r=f);const a=()=>i(Dr),o=()=>{var f;return((f=r.selected)==null?void 0:f.length)===0},l=f=>{if(o())return!1;const p=typeof f=="string"?f:f.id;return r.selected.some(m=>m.id===p)},h=(f,p)=>{const m=n.getAnnotation(f);if(!m){console.warn("Invalid selection: "+f);return}switch(el(m,s)){case"EDIT":i({selected:[{id:f,editable:!0}],event:p});break;case"SELECT":i({selected:[{id:f}],event:p});break;default:i({selected:[],event:p})}},u=(f,p)=>{const m=Array.isArray(f)?f:[f],v=m.map(g=>n.getAnnotation(g)).filter(g=>!!g);i({selected:v.map(g=>{const T=p===void 0?el(g,s)==="EDIT":p;return{id:g.id,editable:T}})}),v.length!==m.length&&console.warn("Invalid selection",f)},c=f=>{if(o())return!1;const{selected:p}=r;p.some(({id:m})=>f.includes(m))&&i({selected:p.filter(({id:m})=>!f.includes(m))})},d=f=>s=f;return n.observe(({changes:f})=>c((f.deleted||[]).map(p=>p.id))),{get event(){return r?r.event:null},get selected(){return r?[...r.selected]:null},clear:a,isEmpty:o,isSelected:l,setSelected:u,setUserSelectAction:d,subscribe:t,userSelect:h}},el=(n,e)=>typeof e=="function"?e(n):e||"EDIT";var of=[];for(var Br=0;Br<256;++Br)of.push((Br+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const af=(n,e)=>{const t=new Set(n.bodies.map(i=>i.id));return e.bodies.filter(i=>!t.has(i.id))},lf=(n,e)=>{const t=new Set(e.bodies.map(i=>i.id));return n.bodies.filter(i=>!t.has(i.id))},hf=(n,e)=>e.bodies.map(t=>{const i=n.bodies.find(s=>s.id===t.id);return{newBody:t,oldBody:i&&!Zn(i,t)?i:void 0}}).filter(({oldBody:t})=>t).map(({oldBody:t,newBody:i})=>({oldBody:t,newBody:i})),uf=(n,e)=>!Zn(n.target,e.target),cf=(n,e)=>{const t=af(n,e),i=lf(n,e),s=hf(n,e);return{oldValue:n,newValue:e,bodiesCreated:t.length>0?t:void 0,bodiesDeleted:i.length>0?i:void 0,bodiesUpdated:s.length>0?s:void 0,targetUpdated:uf(n,e)?{oldTarget:n.target,newTarget:e.target}:void 0}};var tt=(n=>(n.LOCAL="LOCAL",n.REMOTE="REMOTE",n))(tt||{});const df=(n,e)=>{var t,i;const{changes:s,origin:r}=e;if(!(!n.options.origin||n.options.origin===r))return!1;if(n.options.ignore){const{ignore:a}=n.options,o=l=>l&&l.length>0;if(!(o(s.created)||o(s.deleted))){const l=(t=s.updated)==null?void 0:t.some(u=>o(u.bodiesCreated)||o(u.bodiesDeleted)||o(u.bodiesUpdated)),h=(i=s.updated)==null?void 0:i.some(u=>u.targetUpdated);if(a==="BODY_ONLY"&&l&&!h||a==="TARGET_ONLY"&&h&&!l)return!1}}if(n.options.annotations){const a=new Set([...(s.created||[]).map(o=>o.id),...(s.deleted||[]).map(o=>o.id),...(s.updated||[]).map(({oldValue:o})=>o.id)]);return!!(Array.isArray(n.options.annotations)?n.options.annotations:[n.options.annotations]).find(o=>a.has(o))}else return!0},ff=n=>n.id!==void 0,pf=()=>{const n=new Map,e=new Map,t=[],i=(I,N={})=>t.push({onChange:I,options:N}),s=I=>{const N=t.findIndex(M=>M.onChange==I);N>-1&&t.splice(N,1)},r=(I,N)=>{const M={origin:I,changes:{created:N.created||[],updated:N.updated||[],deleted:N.deleted||[]},state:[...n.values()]};t.forEach(R=>{df(R,M)&&R.onChange(M)})},a=(I,N=tt.LOCAL)=>{if(n.get(I.id))throw Error(`Cannot add annotation ${I.id} - exists already`);n.set(I.id,I),I.bodies.forEach(M=>e.set(M.id,I.id)),r(N,{created:[I]})},o=(I,N)=>{const M=typeof I=="string"?N:I,R=typeof I=="string"?I:I.id,F=n.get(R);if(F){const L=cf(F,M);return R===M.id?n.set(R,M):(n.delete(R),n.set(M.id,M)),F.bodies.forEach(Z=>e.delete(Z.id)),M.bodies.forEach(Z=>e.set(Z.id,M.id)),L}else console.warn(`Cannot update annotation ${R} - does not exist`)},l=(I,N=tt.LOCAL,M=tt.LOCAL)=>{const R=ff(N)?M:N,F=o(I,N);F&&r(R,{updated:[F]})},h=(I,N=tt.LOCAL)=>{const M=I.reduce((R,F)=>{const L=o(F);return L?[...R,L]:R},[]);M.length>0&&r(N,{updated:M})},u=(I,N=tt.LOCAL)=>{const M=n.get(I.annotation);if(M){const R={...M,bodies:[...M.bodies,I]};n.set(M.id,R),e.set(I.id,R.id),r(N,{updated:[{oldValue:M,newValue:R,bodiesCreated:[I]}]})}else console.warn(`Attempt to add body to missing annotation: ${I.annotation}`)},c=()=>[...n.values()],d=(I=tt.LOCAL)=>{const N=[...n.values()];n.clear(),e.clear(),r(I,{deleted:N})},f=(I,N=!0,M=tt.LOCAL)=>{if(N){const R=[...n.values()];n.clear(),e.clear(),I.forEach(F=>{n.set(F.id,F),F.bodies.forEach(L=>e.set(L.id,F.id))}),r(M,{created:I,deleted:R})}else{const R=I.reduce((F,L)=>{const Z=n.get(L.id);return Z?[...F,Z]:F},[]);if(R.length>0)throw Error(`Bulk insert would overwrite the following annotations: ${R.map(F=>F.id).join(", ")}`);I.forEach(F=>{n.set(F.id,F),F.bodies.forEach(L=>e.set(L.id,F.id))}),r(M,{created:I})}},p=I=>{const N=typeof I=="string"?I:I.id,M=n.get(N);if(M)return n.delete(N),M.bodies.forEach(R=>e.delete(R.id)),M;console.warn(`Attempt to delete missing annotation: ${N}`)},m=(I,N=tt.LOCAL)=>{const M=p(I);M&&r(N,{deleted:[M]})},v=(I,N=tt.LOCAL)=>{const M=I.reduce((R,F)=>{const L=p(F);return L?[...R,L]:R},[]);M.length>0&&r(N,{deleted:M})},g=I=>{const N=n.get(I.annotation);if(N){const M=N.bodies.find(R=>R.id===I.id);if(M){e.delete(M.id);const R={...N,bodies:N.bodies.filter(F=>F.id!==I.id)};return n.set(N.id,R),{oldValue:N,newValue:R,bodiesDeleted:[M]}}else console.warn(`Attempt to delete missing body ${I.id} from annotation ${I.annotation}`)}else console.warn(`Attempt to delete body from missing annotation ${I.annotation}`)},T=(I,N=tt.LOCAL)=>{const M=g(I);M&&r(N,{updated:[M]})},w=(I,N=tt.LOCAL)=>{const M=I.map(R=>g(R)).filter(Boolean);M.length>0&&r(N,{updated:M})},E=I=>{const N=n.get(I);return N?{...N}:void 0},P=I=>{const N=e.get(I);if(N){const M=E(N).bodies.find(R=>R.id===I);if(M)return M;console.error(`Store integrity error: body ${I} in index, but not in annotation`)}else console.warn(`Attempt to retrieve missing body: ${I}`)},C=(I,N)=>{if(I.annotation!==N.annotation)throw"Annotation integrity violation: annotation ID must be the same when updating bodies";const M=n.get(I.annotation);if(M){const R=M.bodies.find(L=>L.id===I.id),F={...M,bodies:M.bodies.map(L=>L.id===R.id?N:L)};return n.set(M.id,F),R.id!==N.id&&(e.delete(R.id),e.set(N.id,F.id)),{oldValue:M,newValue:F,bodiesUpdated:[{oldBody:R,newBody:N}]}}else console.warn(`Attempt to add body to missing annotation ${I.annotation}`)},D=(I,N,M=tt.LOCAL)=>{const R=C(I,N);R&&r(M,{updated:[R]})},B=(I,N=tt.LOCAL)=>{const M=I.map(R=>C({id:R.id,annotation:R.annotation},R)).filter(Boolean);r(N,{updated:M})},H=I=>{const N=n.get(I.annotation);if(N){const M={...N,target:{...N.target,...I}};return n.set(N.id,M),{oldValue:N,newValue:M,targetUpdated:{oldTarget:N.target,newTarget:I}}}else console.warn(`Attempt to update target on missing annotation: ${I.annotation}`)};return{addAnnotation:a,addBody:u,all:c,bulkAddAnnotation:f,bulkDeleteAnnotation:v,bulkDeleteBodies:w,bulkUpdateAnnotation:h,bulkUpdateBodies:B,bulkUpdateTargets:(I,N=tt.LOCAL)=>{const M=I.map(R=>H(R)).filter(Boolean);M.length>0&&r(N,{updated:M})},clear:d,deleteAnnotation:m,deleteBody:T,getAnnotation:E,getBody:P,observe:i,unobserve:s,updateAnnotation:l,updateBody:D,updateTarget:(I,N=tt.LOCAL)=>{const M=H(I);M&&r(N,{updated:[M]})}}},mf=()=>{const{subscribe:n,set:e}=Ta([]);return{subscribe:n,set:e}},gf="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let vf=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n));for(;n--;)e+=gf[t[n]&63];return e};vf();function tl(n,e,t){const i=n.slice();return i[10]=e[t],i[12]=t,i}function il(n){let e,t;return e=new Hs({props:{x:n[10][0],y:n[10][1],scale:n[3]}}),e.$on("pointerdown",function(){it(n[9](`HANDLE-${n[12]}`))&&n[9](`HANDLE-${n[12]}`).apply(this,arguments)}),{c(){Bi(e.$$.fragment)},m(i,s){ci(e,i,s),t=!0},p(i,s){n=i;const r={};s&16&&(r.x=n[10][0]),s&16&&(r.y=n[10][1]),s&8&&(r.scale=n[3]),e.$set(r)},i(i){t||(pt(e.$$.fragment,i),t=!0)},o(i){Nt(e.$$.fragment,i),t=!1},d(i){di(e,i)}}}function yf(n){let e,t,i,s,r,a,o,l,h,u,c,d=Qa(n[4].points),f=[];for(let m=0;m<d.length;m+=1)f[m]=il(tl(n,d,m));const p=m=>Nt(f[m],1,1,()=>{f[m]=null});return{c(){e=We("polygon"),s=Tt(),r=We("polygon"),o=Tt();for(let m=0;m<f.length;m+=1)f[m].c();l=ya(),k(e,"class","a9s-outer"),k(e,"style",t=n[1]?"display:none;":void 0),k(e,"points",i=n[4].points.map(sl).join(" ")),k(r,"class","a9s-inner a9s-shape-handle"),k(r,"style",n[1]),k(r,"points",a=n[4].points.map(nl).join(" "))},m(m,v){be(m,e,v),be(m,s,v),be(m,r,v),be(m,o,v);for(let g=0;g<f.length;g+=1)f[g]&&f[g].m(m,v);be(m,l,v),h=!0,u||(c=[Qe(e,"pointerdown",function(){it(n[9]("SHAPE"))&&n[9]("SHAPE").apply(this,arguments)}),Qe(r,"pointerdown",function(){it(n[9]("SHAPE"))&&n[9]("SHAPE").apply(this,arguments)})],u=!0)},p(m,v){if(n=m,(!h||v&2&&t!==(t=n[1]?"display:none;":void 0))&&k(e,"style",t),(!h||v&16&&i!==(i=n[4].points.map(sl).join(" ")))&&k(e,"points",i),(!h||v&2)&&k(r,"style",n[1]),(!h||v&16&&a!==(a=n[4].points.map(nl).join(" ")))&&k(r,"points",a),v&536){d=Qa(n[4].points);let g;for(g=0;g<d.length;g+=1){const T=tl(n,d,g);f[g]?(f[g].p(T,v),pt(f[g],1)):(f[g]=il(T),f[g].c(),pt(f[g],1),f[g].m(l.parentNode,l))}for(Yd(),g=d.length;g<f.length;g+=1)p(g);qd()}},i(m){if(!h){for(let v=0;v<d.length;v+=1)pt(f[v]);h=!0}},o(m){f=f.filter(Boolean);for(let v=0;v<f.length;v+=1)Nt(f[v]);h=!1},d(m){m&&(Ee(e),Ee(s),Ee(r),Ee(o),Ee(l)),Hd(f,m),u=!1,$t(c)}}}function xf(n){let e,t;return e=new ou({props:{shape:n[0],transform:n[2],editor:n[5],$$slots:{default:[yf,({grab:i})=>({9:i}),({grab:i})=>i?512:0]},$$scope:{ctx:n}}}),e.$on("change",n[6]),e.$on("grab",n[7]),e.$on("release",n[8]),{c(){Bi(e.$$.fragment)},m(i,s){ci(e,i,s),t=!0},p(i,[s]){const r={};s&1&&(r.shape=i[0]),s&4&&(r.transform=i[2]),s&8730&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(pt(e.$$.fragment,i),t=!0)},o(i){Nt(e.$$.fragment,i),t=!1},d(i){di(e,i)}}}const sl=n=>n.join(","),nl=n=>n.join(",");function _f(n,e,t){let i,{shape:s}=e,{computedStyle:r}=e,{transform:a}=e,{viewportScale:o=1}=e;const l=(d,f,p)=>{let m;const v=d.geometry;f==="SHAPE"?m=v.points.map(([T,w])=>[T+p[0],w+p[1]]):m=v.points.map(([T,w],E)=>f===`HANDLE-${E}`?[T+p[0],w+p[1]]:[T,w]);const g=Ao(m);return{...d,geometry:{points:m,bounds:g}}};function h(d){Zt.call(this,n,d)}function u(d){Zt.call(this,n,d)}function c(d){Zt.call(this,n,d)}return n.$$set=d=>{"shape"in d&&t(0,s=d.shape),"computedStyle"in d&&t(1,r=d.computedStyle),"transform"in d&&t(2,a=d.transform),"viewportScale"in d&&t(3,o=d.viewportScale)},n.$$.update=()=>{n.$$.dirty&1&&t(4,i=s.geometry)},[s,r,a,o,i,l,h,u,c]}class wf extends Ps{constructor(e){super(),Rs(this,e,_f,xf,As,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}const Or=(n,e)=>{const t=Math.abs(e[0]-n[0]),i=Math.abs(e[1]-n[1]);return Math.sqrt(Math.pow(t,2)+Math.pow(i,2))},nu="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;function Tf(n){let e,t,i,s,r,a;return{c(){e=We("rect"),k(e,"class",t=qn(`a9s-handle ${n[8].class||""}`.trim())+" svelte-1sgkh33"),k(e,"x",i=n[0]-n[5]/2),k(e,"y",s=n[1]-n[5]/2),k(e,"width",n[5]),k(e,"height",n[5])},m(o,l){be(o,e,l),r||(a=Qe(e,"pointerdown",n[11]),r=!0)},p(o,l){l&256&&t!==(t=qn(`a9s-handle ${o[8].class||""}`.trim())+" svelte-1sgkh33")&&k(e,"class",t),l&33&&i!==(i=o[0]-o[5]/2)&&k(e,"x",i),l&34&&s!==(s=o[1]-o[5]/2)&&k(e,"y",s),l&32&&k(e,"width",o[5]),l&32&&k(e,"height",o[5])},d(o){o&&Ee(e),r=!1,a()}}}function Ef(n){let e,t,i,s,r,a,o,l,h;return{c(){e=We("g"),t=We("circle"),s=We("rect"),k(t,"cx",n[0]),k(t,"cy",n[1]),k(t,"r",i=n[3]/n[2]),k(t,"class","a9s-touch-halo svelte-1sgkh33"),Za(t,"touched",n[4]),k(s,"class",r=qn(`a9s-handle ${n[8].class||""}`.trim())+" svelte-1sgkh33"),k(s,"x",a=n[0]-n[5]/2),k(s,"y",o=n[1]-n[5]/2),k(s,"width",n[5]),k(s,"height",n[5]),k(e,"class","a9s-touch-handle")},m(u,c){be(u,e,c),qa(e,t),qa(e,s),l||(h=[Qe(t,"pointerdown",n[10]),Qe(t,"pointerdown",n[6]),Qe(t,"pointerup",n[7]),Qe(s,"pointerdown",n[9]),Qe(s,"pointerdown",n[6]),Qe(s,"pointerup",n[7])],l=!0)},p(u,c){c&1&&k(t,"cx",u[0]),c&2&&k(t,"cy",u[1]),c&12&&i!==(i=u[3]/u[2])&&k(t,"r",i),c&16&&Za(t,"touched",u[4]),c&256&&r!==(r=qn(`a9s-handle ${u[8].class||""}`.trim())+" svelte-1sgkh33")&&k(s,"class",r),c&33&&a!==(a=u[0]-u[5]/2)&&k(s,"x",a),c&34&&o!==(o=u[1]-u[5]/2)&&k(s,"y",o),c&32&&k(s,"width",u[5]),c&32&&k(s,"height",u[5])},d(u){u&&Ee(e),l=!1,$t(h)}}}function bf(n){let e;function t(s,r){return nu?Ef:Tf}let i=t()(n);return{c(){i.c(),e=ya()},m(s,r){i.m(s,r),be(s,e,r)},p(s,[r]){i.p(s,r)},i:Kt,o:Kt,d(s){s&&Ee(e),i.d(s)}}}function Sf(n,e,t){let i,{x:s}=e,{y:r}=e,{scale:a}=e,{radius:o=30}=e,l=!1;const h=p=>{p.pointerType==="touch"&&t(4,l=!0)},u=()=>t(4,l=!1);function c(p){Zt.call(this,n,p)}function d(p){Zt.call(this,n,p)}function f(p){Zt.call(this,n,p)}return n.$$set=p=>{t(8,e=To(To({},e),Ya(p))),"x"in p&&t(0,s=p.x),"y"in p&&t(1,r=p.y),"scale"in p&&t(2,a=p.scale),"radius"in p&&t(3,o=p.radius)},n.$$.update=()=>{n.$$.dirty&4&&t(5,i=10/a)},e=Ya(e),[s,r,a,o,l,i,h,u,e,c,d,f]}class Hs extends Ps{constructor(e){super(),Rs(this,e,Sf,bf,As,{x:0,y:1,scale:2,radius:3})}}function Af(n){let e,t,i,s,r,a,o,l,h,u,c,d,f,p,m,v,g,T,w,E,P,C,D,B,H,I,N,M,R,F,L,Z,V,q,pe,G,Y,de,J,ye,he,Re,Me;return q=new Hs({props:{class:"a9s-corner-handle-topleft",x:n[4].x,y:n[4].y,scale:n[3]}}),q.$on("pointerdown",function(){it(n[9]("TOP_LEFT"))&&n[9]("TOP_LEFT").apply(this,arguments)}),G=new Hs({props:{class:"a9s-corner-handle-topright",x:n[4].x+n[4].w,y:n[4].y,scale:n[3]}}),G.$on("pointerdown",function(){it(n[9]("TOP_RIGHT"))&&n[9]("TOP_RIGHT").apply(this,arguments)}),de=new Hs({props:{class:"a9s-corner-handle-bottomright",x:n[4].x+n[4].w,y:n[4].y+n[4].h,scale:n[3]}}),de.$on("pointerdown",function(){it(n[9]("BOTTOM_RIGHT"))&&n[9]("BOTTOM_RIGHT").apply(this,arguments)}),ye=new Hs({props:{class:"a9s-corner-handle-bottomleft",x:n[4].x,y:n[4].y+n[4].h,scale:n[3]}}),ye.$on("pointerdown",function(){it(n[9]("BOTTOM_LEFT"))&&n[9]("BOTTOM_LEFT").apply(this,arguments)}),{c(){e=We("rect"),o=Tt(),l=We("rect"),f=Tt(),p=We("rect"),T=Tt(),w=We("rect"),D=Tt(),B=We("rect"),M=Tt(),R=We("rect"),V=Tt(),Bi(q.$$.fragment),pe=Tt(),Bi(G.$$.fragment),Y=Tt(),Bi(de.$$.fragment),J=Tt(),Bi(ye.$$.fragment),k(e,"class","a9s-outer"),k(e,"style",t=n[1]?"display:none;":void 0),k(e,"x",i=n[4].x),k(e,"y",s=n[4].y),k(e,"width",r=n[4].w),k(e,"height",a=n[4].h),k(l,"class","a9s-inner a9s-shape-handle"),k(l,"style",n[1]),k(l,"x",h=n[4].x),k(l,"y",u=n[4].y),k(l,"width",c=n[4].w),k(l,"height",d=n[4].h),k(p,"class","a9s-edge-handle a9s-edge-handle-top"),k(p,"x",m=n[4].x),k(p,"y",v=n[4].y),k(p,"height",1),k(p,"width",g=n[4].w),k(w,"class","a9s-edge-handle a9s-edge-handle-right"),k(w,"x",E=n[4].x+n[4].w),k(w,"y",P=n[4].y),k(w,"height",C=n[4].h),k(w,"width",1),k(B,"class","a9s-edge-handle a9s-edge-handle-bottom"),k(B,"x",H=n[4].x),k(B,"y",I=n[4].y+n[4].h),k(B,"height",1),k(B,"width",N=n[4].w),k(R,"class","a9s-edge-handle a9s-edge-handle-left"),k(R,"x",F=n[4].x),k(R,"y",L=n[4].y),k(R,"height",Z=n[4].h),k(R,"width",1)},m(re,$){be(re,e,$),be(re,o,$),be(re,l,$),be(re,f,$),be(re,p,$),be(re,T,$),be(re,w,$),be(re,D,$),be(re,B,$),be(re,M,$),be(re,R,$),be(re,V,$),ci(q,re,$),be(re,pe,$),ci(G,re,$),be(re,Y,$),ci(de,re,$),be(re,J,$),ci(ye,re,$),he=!0,Re||(Me=[Qe(e,"pointerdown",function(){it(n[9]("SHAPE"))&&n[9]("SHAPE").apply(this,arguments)}),Qe(l,"pointerdown",function(){it(n[9]("SHAPE"))&&n[9]("SHAPE").apply(this,arguments)}),Qe(p,"pointerdown",function(){it(n[9]("TOP"))&&n[9]("TOP").apply(this,arguments)}),Qe(w,"pointerdown",function(){it(n[9]("RIGHT"))&&n[9]("RIGHT").apply(this,arguments)}),Qe(B,"pointerdown",function(){it(n[9]("BOTTOM"))&&n[9]("BOTTOM").apply(this,arguments)}),Qe(R,"pointerdown",function(){it(n[9]("LEFT"))&&n[9]("LEFT").apply(this,arguments)})],Re=!0)},p(re,$){n=re,(!he||$&2&&t!==(t=n[1]?"display:none;":void 0))&&k(e,"style",t),(!he||$&16&&i!==(i=n[4].x))&&k(e,"x",i),(!he||$&16&&s!==(s=n[4].y))&&k(e,"y",s),(!he||$&16&&r!==(r=n[4].w))&&k(e,"width",r),(!he||$&16&&a!==(a=n[4].h))&&k(e,"height",a),(!he||$&2)&&k(l,"style",n[1]),(!he||$&16&&h!==(h=n[4].x))&&k(l,"x",h),(!he||$&16&&u!==(u=n[4].y))&&k(l,"y",u),(!he||$&16&&c!==(c=n[4].w))&&k(l,"width",c),(!he||$&16&&d!==(d=n[4].h))&&k(l,"height",d),(!he||$&16&&m!==(m=n[4].x))&&k(p,"x",m),(!he||$&16&&v!==(v=n[4].y))&&k(p,"y",v),(!he||$&16&&g!==(g=n[4].w))&&k(p,"width",g),(!he||$&16&&E!==(E=n[4].x+n[4].w))&&k(w,"x",E),(!he||$&16&&P!==(P=n[4].y))&&k(w,"y",P),(!he||$&16&&C!==(C=n[4].h))&&k(w,"height",C),(!he||$&16&&H!==(H=n[4].x))&&k(B,"x",H),(!he||$&16&&I!==(I=n[4].y+n[4].h))&&k(B,"y",I),(!he||$&16&&N!==(N=n[4].w))&&k(B,"width",N),(!he||$&16&&F!==(F=n[4].x))&&k(R,"x",F),(!he||$&16&&L!==(L=n[4].y))&&k(R,"y",L),(!he||$&16&&Z!==(Z=n[4].h))&&k(R,"height",Z);const De={};$&16&&(De.x=n[4].x),$&16&&(De.y=n[4].y),$&8&&(De.scale=n[3]),q.$set(De);const we={};$&16&&(we.x=n[4].x+n[4].w),$&16&&(we.y=n[4].y),$&8&&(we.scale=n[3]),G.$set(we);const Pe={};$&16&&(Pe.x=n[4].x+n[4].w),$&16&&(Pe.y=n[4].y+n[4].h),$&8&&(Pe.scale=n[3]),de.$set(Pe);const Ce={};$&16&&(Ce.x=n[4].x),$&16&&(Ce.y=n[4].y+n[4].h),$&8&&(Ce.scale=n[3]),ye.$set(Ce)},i(re){he||(pt(q.$$.fragment,re),pt(G.$$.fragment,re),pt(de.$$.fragment,re),pt(ye.$$.fragment,re),he=!0)},o(re){Nt(q.$$.fragment,re),Nt(G.$$.fragment,re),Nt(de.$$.fragment,re),Nt(ye.$$.fragment,re),he=!1},d(re){re&&(Ee(e),Ee(o),Ee(l),Ee(f),Ee(p),Ee(T),Ee(w),Ee(D),Ee(B),Ee(M),Ee(R),Ee(V),Ee(pe),Ee(Y),Ee(J)),di(q,re),di(G,re),di(de,re),di(ye,re),Re=!1,$t(Me)}}}function Rf(n){let e,t;return e=new ou({props:{shape:n[0],transform:n[2],editor:n[5],$$slots:{default:[Af,({grab:i})=>({9:i}),({grab:i})=>i?512:0]},$$scope:{ctx:n}}}),e.$on("grab",n[6]),e.$on("change",n[7]),e.$on("release",n[8]),{c(){Bi(e.$$.fragment)},m(i,s){ci(e,i,s),t=!0},p(i,[s]){const r={};s&1&&(r.shape=i[0]),s&4&&(r.transform=i[2]),s&1562&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(pt(e.$$.fragment,i),t=!0)},o(i){Nt(e.$$.fragment,i),t=!1},d(i){di(e,i)}}}function Pf(n,e,t){let i,{shape:s}=e,{computedStyle:r}=e,{transform:a}=e,{viewportScale:o=1}=e;const l=(d,f,p)=>{const m=d.geometry.bounds;let[v,g]=[m.minX,m.minY],[T,w]=[m.maxX,m.maxY];const[E,P]=p;if(f==="SHAPE")v+=E,T+=E,g+=P,w+=P;else{switch(f){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{g+=P;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{w+=P;break}}switch(f){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{v+=E;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{T+=E;break}}}const C=Math.min(v,T),D=Math.min(g,w),B=Math.abs(T-v),H=Math.abs(w-g);return{...d,geometry:{x:C,y:D,w:B,h:H,bounds:{minX:C,minY:D,maxX:C+B,maxY:D+H}}}};function h(d){Zt.call(this,n,d)}function u(d){Zt.call(this,n,d)}function c(d){Zt.call(this,n,d)}return n.$$set=d=>{"shape"in d&&t(0,s=d.shape),"computedStyle"in d&&t(1,r=d.computedStyle),"transform"in d&&t(2,a=d.transform),"viewportScale"in d&&t(3,o=d.viewportScale)},n.$$.update=()=>{n.$$.dirty&1&&t(4,i=s.geometry)},[s,r,a,o,i,l,h,u,c]}class Cf extends Ps{constructor(e){super(),Rs(this,e,Pf,Rf,As,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}const ru=new Map([[rt.RECTANGLE,Cf],[rt.POLYGON,wf]]),If=n=>ru.get(n.type),Mf=(n,e)=>ru.set(n,e),Df=n=>({}),rl=n=>({grab:n[0]});function Bf(n){let e,t,i,s;const r=n[7].default,a=Fd(r,n,n[6],rl);return{c(){e=We("g"),a&&a.c(),k(e,"class","a9s-annotation selected")},m(o,l){be(o,e,l),a&&a.m(e,null),t=!0,i||(s=[Qe(e,"pointerup",n[2]),Qe(e,"pointermove",n[1])],i=!0)},p(o,[l]){a&&a.p&&(!t||l&64)&&kd(a,r,o,o[6],t?Nd(r,o[6],l,Df):Ud(o[6]),rl)},i(o){t||(pt(a,o),t=!0)},o(o){Nt(a,o),t=!1},d(o){o&&Ee(e),a&&a.d(o),i=!1,$t(s)}}}function Of(n,e,t){let{$$slots:i={},$$scope:s}=e;const r=xa();let{shape:a}=e,{editor:o}=e,{transform:l}=e,h,u,c;const d=m=>v=>{h=m,u=l.elementToImage(v.offsetX,v.offsetY),c=a,v.target.setPointerCapture(v.pointerId),r("grab",v)},f=m=>{if(h){const[v,g]=l.elementToImage(m.offsetX,m.offsetY),T=[v-u[0],g-u[1]];t(3,a=o(c,h,T)),r("change",a)}},p=m=>{m.target.releasePointerCapture(m.pointerId),h=void 0,c=a,r("release",m)};return n.$$set=m=>{"shape"in m&&t(3,a=m.shape),"editor"in m&&t(4,o=m.editor),"transform"in m&&t(5,l=m.transform),"$$scope"in m&&t(6,s=m.$$scope)},[d,f,p,a,o,l,s,i]}class ou extends Ps{constructor(e){super(),Rs(this,e,Of,Bf,As,{shape:3,editor:4,transform:5})}}function ol(n){let e,t;return{c(){e=We("rect"),t=We("rect"),k(e,"class","a9s-outer"),k(e,"x",n[1]),k(e,"y",n[2]),k(e,"width",n[3]),k(e,"height",n[4]),k(t,"class","a9s-inner"),k(t,"x",n[1]),k(t,"y",n[2]),k(t,"width",n[3]),k(t,"height",n[4])},m(i,s){be(i,e,s),be(i,t,s)},p(i,s){s&2&&k(e,"x",i[1]),s&4&&k(e,"y",i[2]),s&8&&k(e,"width",i[3]),s&16&&k(e,"height",i[4]),s&2&&k(t,"x",i[1]),s&4&&k(t,"y",i[2]),s&8&&k(t,"width",i[3]),s&16&&k(t,"height",i[4])},d(i){i&&(Ee(e),Ee(t))}}}function Lf(n){let e,t=n[0]&&ol(n);return{c(){e=We("g"),t&&t.c(),k(e,"class","a9s-annotation a9s-rubberband")},m(i,s){be(i,e,s),t&&t.m(e,null)},p(i,[s]){i[0]?t?t.p(i,s):(t=ol(i),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},i:Kt,o:Kt,d(i){i&&Ee(e),t&&t.d()}}}function Ff(n,e,t){const i=xa();let{addEventListener:s}=e,{drawingMode:r}=e,{transform:a}=e,o,l,h,u,c,d,f;const p=T=>{const w=T;o=performance.now(),r==="drag"&&(t(0,l=a.elementToImage(w.offsetX,w.offsetY)),h=l,t(1,u=l[0]),t(2,c=l[1]),t(3,d=1),t(4,f=1))},m=T=>{const w=T;l&&(h=a.elementToImage(w.offsetX,w.offsetY),t(1,u=Math.min(h[0],l[0])),t(2,c=Math.min(h[1],l[1])),t(3,d=Math.abs(h[0]-l[0])),t(4,f=Math.abs(h[1]-l[1])))},v=T=>{const w=T,E=performance.now()-o;if(r==="click"){if(E>300)return;l?g():(t(0,l=a.elementToImage(w.offsetX,w.offsetY)),h=l,t(1,u=l[0]),t(2,c=l[1]),t(3,d=1),t(4,f=1))}else l&&(E>300||d*f>100?(w.stopPropagation(),g()):(t(0,l=void 0),h=void 0))},g=()=>{if(d*f>15){const T={type:rt.RECTANGLE,geometry:{bounds:{minX:u,minY:c,maxX:u+d,maxY:c+f},x:u,y:c,w:d,h:f}};i("create",T)}t(0,l=void 0),h=void 0};return iu(()=>{s("pointerdown",p),s("pointermove",m),s("pointerup",v,!0)}),n.$$set=T=>{"addEventListener"in T&&t(5,s=T.addEventListener),"drawingMode"in T&&t(6,r=T.drawingMode),"transform"in T&&t(7,a=T.transform)},[l,u,c,d,f,s,r,a]}class Nf extends Ps{constructor(e){super(),Rs(this,e,Ff,Lf,As,{addEventListener:5,drawingMode:6,transform:7})}}function Lr(n){const e=n.slice(),t=(e[2]?e[0]:[...e[0],e[1]]).map(i=>i.join(",")).join(" ");return e[16]=t,e}function al(n){let e,t,i,s,r,a=n[2]&&ll(n);return{c(){e=We("polygon"),i=We("polygon"),a&&a.c(),r=ya(),k(e,"class","a9s-outer"),k(e,"points",t=n[16]),k(i,"class","a9s-inner"),k(i,"points",s=n[16])},m(o,l){be(o,e,l),be(o,i,l),a&&a.m(o,l),be(o,r,l)},p(o,l){l&7&&t!==(t=o[16])&&k(e,"points",t),l&7&&s!==(s=o[16])&&k(i,"points",s),o[2]?a?a.p(o,l):(a=ll(o),a.c(),a.m(r.parentNode,r)):a&&(a.d(1),a=null)},d(o){o&&(Ee(e),Ee(i),Ee(r)),a&&a.d(o)}}}function ll(n){let e,t,i;return{c(){e=We("rect"),k(e,"class","a9s-corner-handle"),k(e,"x",t=n[0][0][0]-n[3]/2),k(e,"y",i=n[0][0][1]-n[3]/2),k(e,"height",n[3]),k(e,"width",n[3])},m(s,r){be(s,e,r)},p(s,r){r&9&&t!==(t=s[0][0][0]-s[3]/2)&&k(e,"x",t),r&9&&i!==(i=s[0][0][1]-s[3]/2)&&k(e,"y",i),r&8&&k(e,"height",s[3]),r&8&&k(e,"width",s[3])},d(s){s&&Ee(e)}}}function kf(n){let e,t=n[1]&&al(Lr(n));return{c(){e=We("g"),t&&t.c(),k(e,"class","a9s-annotation a9s-rubberband")},m(i,s){be(i,e,s),t&&t.m(e,null)},p(i,[s]){i[1]?t?t.p(Lr(i),s):(t=al(Lr(i)),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},i:Kt,o:Kt,d(i){i&&Ee(e),t&&t.d()}}}const Uf=20,Hf=1500;function Gf(n,e,t){let i;const s=xa();let{addEventListener:r}=e,{drawingMode:a}=e,{transform:o}=e,{viewportScale:l=1}=e,h,u=[],c,d,f=!1;const p=w=>{const E=w,{timeStamp:P,offsetX:C,offsetY:D}=E;if(h={timeStamp:P,offsetX:C,offsetY:D},a==="drag"&&u.length===0){const B=o.elementToImage(E.offsetX,E.offsetY);u.push(B),t(1,c=B)}},m=w=>{const E=w;if(d&&clearTimeout(d),u.length>0){if(t(1,c=o.elementToImage(E.offsetX,E.offsetY)),u.length>2){const P=Or(c,u[0])*l;t(2,f=P<Uf)}E.pointerType==="touch"&&(d=setTimeout(()=>{g()},Hf))}},v=w=>{const E=w;if(d&&clearTimeout(d),a==="click"){const P=E.timeStamp-h.timeStamp,C=Or([h.offsetX,h.offsetY],[E.offsetX,E.offsetY]);if(P>300||C>15)return;if(f)T();else if(u.length===0){const D=o.elementToImage(E.offsetX,E.offsetY);u.push(D),t(1,c=D)}else u.push(c)}else{if(u.length===1&&Or(u[0],c)<=4){t(0,u=[]),t(1,c=void 0);return}E.stopImmediatePropagation(),f?T():u.push(c)}},g=()=>{if(!c)return;const w=[...u,c],E={type:rt.POLYGON,geometry:{bounds:Ao(w),points:w}};So(E)>4&&(t(0,u=[]),t(1,c=void 0),s("create",E))},T=()=>{const w={type:rt.POLYGON,geometry:{bounds:Ao(u),points:[...u]}};t(0,u=[]),t(1,c=void 0),s("create",w)};return iu(()=>{r("pointerdown",p,!0),r("pointermove",m),r("pointerup",v,!0),r("dblclick",g,!0)}),n.$$set=w=>{"addEventListener"in w&&t(4,r=w.addEventListener),"drawingMode"in w&&t(5,a=w.drawingMode),"transform"in w&&t(6,o=w.transform),"viewportScale"in w&&t(7,l=w.viewportScale)},n.$$.update=()=>{n.$$.dirty&128&&t(3,i=10/l)},[u,c,f,i,r,a,o,l]}class zf extends Ps{constructor(e){super(),Rs(this,e,Gf,kf,As,{addEventListener:4,drawingMode:5,transform:6,viewportScale:7})}}const Ea=new Map([["rectangle",{tool:Nf}],["polygon",{tool:zf}]]),au=()=>[...Ea.keys()],lu=n=>Ea.get(n),Vf=(n,e,t)=>Ea.set(n,{tool:e,opts:t});function Wf(n,e,t,i,s){hu(n,e,t||0,i||n.length-1,s||jf)}function hu(n,e,t,i,s){for(;i>t;){if(i-t>600){var r=i-t+1,a=e-t+1,o=Math.log(r),l=.5*Math.exp(2*o/3),h=.5*Math.sqrt(o*l*(r-l)/r)*(a-r/2<0?-1:1),u=Math.max(t,Math.floor(e-a*l/r+h)),c=Math.min(i,Math.floor(e+(r-a)*l/r+h));hu(n,e,u,c,s)}var d=n[e],f=t,p=i;for(Os(n,t,e),s(n[i],d)>0&&Os(n,t,i);f<p;){for(Os(n,f,p),f++,p--;s(n[f],d)<0;)f++;for(;s(n[p],d)>0;)p--}s(n[t],d)===0?Os(n,t,p):(p++,Os(n,p,i)),p<=e&&(t=p+1),e<=p&&(i=p-1)}}function Os(n,e,t){var i=n[e];n[e]=n[t],n[t]=i}function jf(n,e){return n<e?-1:n>e?1:0}class Xf{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!fn(e,t))return i;const s=this.toBBox,r=[];for(;t;){for(let a=0;a<t.children.length;a++){const o=t.children[a],l=t.leaf?s(o):o;fn(e,l)&&(t.leaf?i.push(o):Nr(e,l)?this._all(o,i):r.push(o))}t=r.pop()}return i}collides(e){let t=this.data;if(!fn(e,t))return!1;const i=[];for(;t;){for(let s=0;s<t.children.length;s++){const r=t.children[s],a=t.leaf?this.toBBox(r):r;if(fn(e,a)){if(t.leaf||Nr(e,a))return!0;i.push(r)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=ss([]),this}remove(e,t){if(!e)return this;let i=this.data;const s=this.toBBox(e),r=[],a=[];let o,l,h;for(;i||r.length;){if(i||(i=r.pop(),l=r[r.length-1],o=a.pop(),h=!0),i.leaf){const u=Yf(e,i.children,t);if(u!==-1)return i.children.splice(u,1),r.push(i),this._condense(r),this}!h&&!i.leaf&&Nr(i,s)?(r.push(i),a.push(o),o=0,l=i,i=i.children[0]):l?(o++,i=l.children[o],h=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,s){const r=i-t+1;let a=this._maxEntries,o;if(r<=a)return o=ss(e.slice(t,i+1)),Ki(o,this.toBBox),o;s||(s=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,s-1))),o=ss([]),o.leaf=!1,o.height=s;const l=Math.ceil(r/a),h=l*Math.ceil(Math.sqrt(a));hl(e,t,i,h,this.compareMinX);for(let u=t;u<=i;u+=h){const c=Math.min(u+h-1,i);hl(e,u,c,l,this.compareMinY);for(let d=u;d<=c;d+=l){const f=Math.min(d+l-1,c);o.children.push(this._build(e,d,f,s-1))}}return Ki(o,this.toBBox),o}_chooseSubtree(e,t,i,s){for(;s.push(t),!(t.leaf||s.length-1===i);){let r=1/0,a=1/0,o;for(let l=0;l<t.children.length;l++){const h=t.children[l],u=Fr(h),c=Kf(e,h)-u;c<a?(a=c,r=u<r?u:r,o=h):c===a&&u<r&&(r=u,o=h)}t=o||t.children[0]}return t}_insert(e,t,i){const s=i?e:this.toBBox(e),r=[],a=this._chooseSubtree(s,this.data,t,r);for(a.children.push(e),zs(a,s);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(s,r,t)}_split(e,t){const i=e[t],s=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,s);const a=this._chooseSplitIndex(i,r,s),o=ss(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,Ki(i,this.toBBox),Ki(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(i,o)}_splitRoot(e,t){this.data=ss([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Ki(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let s,r=1/0,a=1/0;for(let o=t;o<=i-t;o++){const l=Gs(e,0,o,this.toBBox),h=Gs(e,o,i,this.toBBox),u=Jf(l,h),c=Fr(l)+Fr(h);u<r?(r=u,s=o,a=c<a?c:a):u===r&&c<a&&(a=c,s=o)}return s||i-t}_chooseSplitAxis(e,t,i){const s=e.leaf?this.compareMinX:qf,r=e.leaf?this.compareMinY:Zf,a=this._allDistMargin(e,t,i,s),o=this._allDistMargin(e,t,i,r);a<o&&e.children.sort(s)}_allDistMargin(e,t,i,s){e.children.sort(s);const r=this.toBBox,a=Gs(e,0,t,r),o=Gs(e,i-t,i,r);let l=dn(a)+dn(o);for(let h=t;h<i-t;h++){const u=e.children[h];zs(a,e.leaf?r(u):u),l+=dn(a)}for(let h=i-t-1;h>=t;h--){const u=e.children[h];zs(o,e.leaf?r(u):u),l+=dn(o)}return l}_adjustParentBBoxes(e,t,i){for(let s=i;s>=0;s--)zs(t[s],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():Ki(e[t],this.toBBox)}}function Yf(n,e,t){if(!t)return e.indexOf(n);for(let i=0;i<e.length;i++)if(t(n,e[i]))return i;return-1}function Ki(n,e){Gs(n,0,n.children.length,e,n)}function Gs(n,e,t,i,s){s||(s=ss(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=e;r<t;r++){const a=n.children[r];zs(s,n.leaf?i(a):a)}return s}function zs(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function qf(n,e){return n.minX-e.minX}function Zf(n,e){return n.minY-e.minY}function Fr(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function dn(n){return n.maxX-n.minX+(n.maxY-n.minY)}function Kf(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function Jf(n,e){const t=Math.max(n.minX,e.minX),i=Math.max(n.minY,e.minY),s=Math.min(n.maxX,e.maxX),r=Math.min(n.maxY,e.maxY);return Math.max(0,s-t)*Math.max(0,r-i)}function Nr(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function fn(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function ss(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function hl(n,e,t,i,s){const r=[e,t];for(;r.length;){if(t=r.pop(),e=r.pop(),t-e<=i)continue;const a=e+Math.ceil((t-e)/i/2)*i;Wf(n,a,e,t,s),r.push(e,a,a,t)}}const Qf=()=>{const n=new Xf,e=new Map,t=()=>[...e.values()],i=()=>{n.clear(),e.clear()},s=a=>{const{minX:o,minY:l,maxX:h,maxY:u}=a.selector.geometry.bounds,c={minX:o,minY:l,maxX:h,maxY:u,target:a};n.insert(c),e.set(a.annotation,c)},r=a=>{const o=e.get(a.annotation);o&&n.remove(o),e.delete(a.annotation)};return{all:t,clear:i,getAt:(a,o)=>{const l=n.search({minX:a,minY:o,maxX:a,maxY:o}).map(h=>h.target).filter(h=>h.selector.type===rt.RECTANGLE||Jd(h.selector,a,o));if(l.length>0)return l.sort((h,u)=>So(h.selector)-So(u.selector)),l[0]},getIntersecting:(a,o,l,h)=>n.search({minX:a,minY:o,maxX:a+l,maxY:o+h}).map(u=>u.target),insert:s,remove:r,set:(a,o=!0)=>{o&&i();const l=a.reduce((h,u)=>{var c,d;if((d=(c=u.selector)==null?void 0:c.geometry)!=null&&d.bounds){const{minX:f,minY:p,maxX:m,maxY:v}=u.selector.geometry.bounds;return[...h,{minX:f,minY:p,maxX:m,maxY:v,target:u}]}else return h},[]);l.forEach(h=>e.set(h.target.annotation,h)),n.load(l)},size:()=>n.all().length,update:(a,o)=>{r(a),s(o)}}},$f=n=>{const e=pf(),t=Qf(),i=rf(e,n.userSelectAction),s=nf(e),r=mf();return e.observe(({changes:a})=>{t.set((a.created||[]).map(o=>o.target),!1),(a.deleted||[]).forEach(o=>t.remove(o.target)),(a.updated||[]).forEach(({oldValue:o,newValue:l})=>t.update(o.target,l.target))}),{store:{...e,getAt:(a,o)=>{const l=t.getAt(a,o);return l?e.getAnnotation(l.annotation):void 0},getIntersecting:(a,o,l,h)=>t.getIntersecting(a,o,l,h).map(u=>e.getAnnotation(u.annotation))},selection:i,hover:s,viewport:r}},ep=n=>{let e,t;if(n.nodeName==="CANVAS")e=n,t=e.getContext("2d",{willReadFrequently:!0});else{const s=n;e=document.createElement("canvas"),e.width=s.width,e.height=s.height,t=e.getContext("2d",{willReadFrequently:!0}),t.drawImage(s,0,0,s.width,s.height)}let i=0;for(let s=1;s<10;s++)for(let r=1;r<10;r++){const a=Math.round(r*e.width/10),o=Math.round(s*e.height/10),l=t.getImageData(a,o,1,1).data,h=(.299*l[0]+.587*l[1]+.114*l[2])/255;i+=h}return i/81},tp=n=>{const e=ep(n),t=e>.6?"dark":"light";return console.log(`[Annotorious] Image brightness: ${e.toFixed(1)}. Setting ${t} theme.`),t},ip=(n,e)=>({...n,drawingEnabled:n.drawingEnabled===void 0?e.drawingEnabled:n.drawingEnabled,drawingMode:n.drawingMode||e.drawingMode,userSelectAction:n.userSelectAction||e.userSelectAction,theme:n.theme||e.theme}),ul=navigator.userAgent.indexOf("Mac OS X")!==-1,sp=(n,e)=>{const t=e||document,i=a=>{const o=a;o.key==="z"&&o.ctrlKey?n.undo():o.key==="y"&&o.ctrlKey&&n.redo()},s=a=>{const o=a;o.key==="z"&&o.metaKey&&(o.shiftKey?n.redo():n.undo())},r=()=>{ul?t.removeEventListener("keydown",s):t.removeEventListener("keydown",i)};return ul?t.addEventListener("keydown",s):t.addEventListener("keydown",i),{destroy:r}};function gi(){}function np(n,e){for(const t in e)n[t]=e[t];return n}function uu(n){return n()}function cl(){return Object.create(null)}function an(n){n.forEach(uu)}function ba(n){return typeof n=="function"}function Pt(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}function rp(n){return Object.keys(n).length===0}function op(n,...e){if(n==null){for(const i of e)i(void 0);return gi}const t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Ro(n,e,t){n.$$.on_destroy.push(op(e,t))}function ap(n,e,t,i){if(n){const s=cu(n,e,t,i);return n[0](s)}}function cu(n,e,t,i){return n[1]&&i?np(t.ctx.slice(),n[1](i(e))):t.ctx}function lp(n,e,t,i){if(n[2]&&i){const s=n[2](i(t));if(e.dirty===void 0)return s;if(typeof s=="object"){const r=[],a=Math.max(e.dirty.length,s.length);for(let o=0;o<a;o+=1)r[o]=e.dirty[o]|s[o];return r}return e.dirty|s}return e.dirty}function hp(n,e,t,i,s,r){if(s){const a=cu(e,t,i,r);n.p(a,s)}}function up(n){if(n.ctx.length>32){const e=[],t=n.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}const cp=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Ni(n,e){n.appendChild(e)}function Ct(n,e,t){n.insertBefore(e,t||null)}function vt(n){n.parentNode&&n.parentNode.removeChild(n)}function du(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function bt(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function fu(n){return document.createTextNode(n)}function Cs(){return fu("")}function fe(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function dp(n){return Array.from(n.childNodes)}function fp(n,e){e=""+e,n.data!==e&&(n.data=e)}function dl(n,e,t){n.classList.toggle(e,!!t)}function pp(n,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:i})}let en;function Js(n){en=n}function Sa(){if(!en)throw new Error("Function called outside component initialization");return en}function gr(n){Sa().$$.on_mount.push(n)}function mp(n){Sa().$$.on_destroy.push(n)}function Aa(){const n=Sa();return(e,t,{cancelable:i=!1}={})=>{const s=n.$$.callbacks[e];if(s){const r=pp(e,t,{cancelable:i});return s.slice().forEach(a=>{a.call(n,r)}),!r.defaultPrevented}return!0}}const ns=[],Kn=[];let ms=[];const fl=[],gp=Promise.resolve();let Po=!1;function vp(){Po||(Po=!0,gp.then(pu))}function Co(n){ms.push(n)}const kr=new Set;let Ji=0;function pu(){if(Ji!==0)return;const n=en;do{try{for(;Ji<ns.length;){const e=ns[Ji];Ji++,Js(e),yp(e.$$)}}catch(e){throw ns.length=0,Ji=0,e}for(Js(null),ns.length=0,Ji=0;Kn.length;)Kn.pop()();for(let e=0;e<ms.length;e+=1){const t=ms[e];kr.has(t)||(kr.add(t),t())}ms.length=0}while(ns.length);for(;fl.length;)fl.pop()();Po=!1,kr.clear(),Js(n)}function yp(n){if(n.fragment!==null){n.update(),an(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(Co)}}function xp(n){const e=[],t=[];ms.forEach(i=>n.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),ms=e}const kn=new Set;let Oi;function xi(){Oi={r:0,c:[],p:Oi}}function _i(){Oi.r||an(Oi.c),Oi=Oi.p}function Ae(n,e){n&&n.i&&(kn.delete(n),n.i(e))}function Ne(n,e,t,i){if(n&&n.o){if(kn.has(n))return;kn.add(n),Oi.c.push(()=>{kn.delete(n),i&&(t&&n.d(1),i())}),n.o(e)}else i&&i()}function Jn(n){return n?.length!==void 0?n:Array.from(n)}function wi(n){n&&n.c()}function ei(n,e,t){const{fragment:i,after_update:s}=n.$$;i&&i.m(e,t),Co(()=>{const r=n.$$.on_mount.map(uu).filter(ba);n.$$.on_destroy?n.$$.on_destroy.push(...r):an(r),n.$$.on_mount=[]}),s.forEach(Co)}function ti(n,e){const t=n.$$;t.fragment!==null&&(xp(t.after_update),an(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function _p(n,e){n.$$.dirty[0]===-1&&(ns.push(n),vp(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function ii(n,e,t,i,s,r,a=null,o=[-1]){const l=en;Js(n);const h=n.$$={fragment:null,ctx:[],props:r,update:gi,not_equal:s,bound:cl(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:cl(),dirty:o,skip_bound:!1,root:e.target||l.$$.root};a&&a(h.root);let u=!1;if(h.ctx=t?t(n,e.props||{},(c,d,...f)=>{const p=f.length?f[0]:d;return h.ctx&&s(h.ctx[c],h.ctx[c]=p)&&(!h.skip_bound&&h.bound[c]&&h.bound[c](p),u&&_p(n,c)),d}):[],h.update(),u=!0,an(h.before_update),h.fragment=i?i(h.ctx):!1,e.target){if(e.hydrate){const c=dp(e.target);h.fragment&&h.fragment.l(c),c.forEach(vt)}else h.fragment&&h.fragment.c();e.intro&&Ae(n.$$.fragment),ei(n,e.target,e.anchor),pu()}Js(l)}class si{constructor(){Va(this,"$$"),Va(this,"$$set")}$destroy(){ti(this,1),this.$destroy=gi}$on(e,t){if(!ba(t))return gi;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}$set(e){this.$$set&&!rp(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const wp="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(wp);var ji=(n=>(n[n.WEBGL_LEGACY=0]="WEBGL_LEGACY",n[n.WEBGL=1]="WEBGL",n[n.WEBGL2=2]="WEBGL2",n))(ji||{}),mu=(n=>(n[n.UNKNOWN=0]="UNKNOWN",n[n.WEBGL=1]="WEBGL",n[n.CANVAS=2]="CANVAS",n))(mu||{}),Io=(n=>(n[n.COLOR=16384]="COLOR",n[n.DEPTH=256]="DEPTH",n[n.STENCIL=1024]="STENCIL",n))(Io||{}),ce=(n=>(n[n.NORMAL=0]="NORMAL",n[n.ADD=1]="ADD",n[n.MULTIPLY=2]="MULTIPLY",n[n.SCREEN=3]="SCREEN",n[n.OVERLAY=4]="OVERLAY",n[n.DARKEN=5]="DARKEN",n[n.LIGHTEN=6]="LIGHTEN",n[n.COLOR_DODGE=7]="COLOR_DODGE",n[n.COLOR_BURN=8]="COLOR_BURN",n[n.HARD_LIGHT=9]="HARD_LIGHT",n[n.SOFT_LIGHT=10]="SOFT_LIGHT",n[n.DIFFERENCE=11]="DIFFERENCE",n[n.EXCLUSION=12]="EXCLUSION",n[n.HUE=13]="HUE",n[n.SATURATION=14]="SATURATION",n[n.COLOR=15]="COLOR",n[n.LUMINOSITY=16]="LUMINOSITY",n[n.NORMAL_NPM=17]="NORMAL_NPM",n[n.ADD_NPM=18]="ADD_NPM",n[n.SCREEN_NPM=19]="SCREEN_NPM",n[n.NONE=20]="NONE",n[n.SRC_OVER=0]="SRC_OVER",n[n.SRC_IN=21]="SRC_IN",n[n.SRC_OUT=22]="SRC_OUT",n[n.SRC_ATOP=23]="SRC_ATOP",n[n.DST_OVER=24]="DST_OVER",n[n.DST_IN=25]="DST_IN",n[n.DST_OUT=26]="DST_OUT",n[n.DST_ATOP=27]="DST_ATOP",n[n.ERASE=26]="ERASE",n[n.SUBTRACT=28]="SUBTRACT",n[n.XOR=29]="XOR",n))(ce||{}),kt=(n=>(n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n))(kt||{}),j=(n=>(n[n.RGBA=6408]="RGBA",n[n.RGB=6407]="RGB",n[n.RG=33319]="RG",n[n.RED=6403]="RED",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.ALPHA=6406]="ALPHA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n))(j||{}),gs=(n=>(n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n))(gs||{}),oe=(n=>(n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.BYTE=5120]="BYTE",n[n.SHORT=5122]="SHORT",n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.HALF_FLOAT=36193]="HALF_FLOAT",n))(oe||{}),ee=(n=>(n[n.FLOAT=0]="FLOAT",n[n.INT=1]="INT",n[n.UINT=2]="UINT",n))(ee||{}),jt=(n=>(n[n.NEAREST=0]="NEAREST",n[n.LINEAR=1]="LINEAR",n))(jt||{}),mi=(n=>(n[n.CLAMP=33071]="CLAMP",n[n.REPEAT=10497]="REPEAT",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n))(mi||{}),Gt=(n=>(n[n.OFF=0]="OFF",n[n.POW2=1]="POW2",n[n.ON=2]="ON",n[n.ON_MANUAL=3]="ON_MANUAL",n))(Gt||{}),at=(n=>(n[n.NPM=0]="NPM",n[n.UNPACK=1]="UNPACK",n[n.PMA=2]="PMA",n[n.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",n[n.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",n[n.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",n))(at||{}),Ft=(n=>(n[n.NO=0]="NO",n[n.YES=1]="YES",n[n.AUTO=2]="AUTO",n[n.BLEND=0]="BLEND",n[n.CLEAR=1]="CLEAR",n[n.BLIT=2]="BLIT",n))(Ft||{}),Ra=(n=>(n[n.AUTO=0]="AUTO",n[n.MANUAL=1]="MANUAL",n))(Ra||{}),mt=(n=>(n.LOW="lowp",n.MEDIUM="mediump",n.HIGH="highp",n))(mt||{}),je=(n=>(n[n.NONE=0]="NONE",n[n.SCISSOR=1]="SCISSOR",n[n.STENCIL=2]="STENCIL",n[n.SPRITE=3]="SPRITE",n[n.COLOR=4]="COLOR",n))(je||{}),Ve=(n=>(n[n.NONE=0]="NONE",n[n.LOW=2]="LOW",n[n.MEDIUM=4]="MEDIUM",n[n.HIGH=8]="HIGH",n))(Ve||{}),Ut=(n=>(n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n))(Ut||{});const Tp={createCanvas:(n,e)=>{const t=document.createElement("canvas");return t.width=n,t.height=e,t},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(n,e)=>fetch(n,e),parseXML:n=>new DOMParser().parseFromString(n,"text/xml")},te={ADAPTER:Tp,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Ur=/iPhone/i,pl=/iPod/i,ml=/iPad/i,gl=/\biOS-universal(?:.+)Mac\b/i,Hr=/\bAndroid(?:.+)Mobile\b/i,vl=/Android/i,Qi=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,pn=/Silk/i,Vt=/Windows Phone/i,yl=/\bWindows(?:.+)ARM\b/i,xl=/BlackBerry/i,_l=/BB10/i,wl=/Opera Mini/i,Tl=/\b(CriOS|Chrome)(?:.+)Mobile/i,El=/Mobile(?:.+)Firefox\b/i,bl=function(n){return typeof n<"u"&&n.platform==="MacIntel"&&typeof n.maxTouchPoints=="number"&&n.maxTouchPoints>1&&typeof MSStream>"u"};function Ep(n){return function(e){return e.test(n)}}function Sl(n){var e={userAgent:"",platform:"",maxTouchPoints:0};!n&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof n=="string"?e.userAgent=n:n&&n.userAgent&&(e={userAgent:n.userAgent,platform:n.platform,maxTouchPoints:n.maxTouchPoints||0});var t=e.userAgent,i=t.split("[FBAN");typeof i[1]<"u"&&(t=i[0]),i=t.split("Twitter"),typeof i[1]<"u"&&(t=i[0]);var s=Ep(t),r={apple:{phone:s(Ur)&&!s(Vt),ipod:s(pl),tablet:!s(Ur)&&(s(ml)||bl(e))&&!s(Vt),universal:s(gl),device:(s(Ur)||s(pl)||s(ml)||s(gl)||bl(e))&&!s(Vt)},amazon:{phone:s(Qi),tablet:!s(Qi)&&s(pn),device:s(Qi)||s(pn)},android:{phone:!s(Vt)&&s(Qi)||!s(Vt)&&s(Hr),tablet:!s(Vt)&&!s(Qi)&&!s(Hr)&&(s(pn)||s(vl)),device:!s(Vt)&&(s(Qi)||s(pn)||s(Hr)||s(vl))||s(/\bokhttp\b/i)},windows:{phone:s(Vt),tablet:s(yl),device:s(Vt)||s(yl)},other:{blackberry:s(xl),blackberry10:s(_l),opera:s(wl),firefox:s(El),chrome:s(Tl),device:s(xl)||s(_l)||s(wl)||s(El)||s(Tl)},any:!1,phone:!1,tablet:!1};return r.any=r.apple.device||r.android.device||r.windows.device||r.other.device,r.phone=r.apple.phone||r.android.phone||r.windows.phone,r.tablet=r.apple.tablet||r.android.tablet||r.windows.tablet,r}const bp=Sl.default??Sl,Xt=bp(globalThis.navigator);te.RETINA_PREFIX=/@([0-9\.]+)x/;te.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Gr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Sp(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return n[i]}})}),t}var vu={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function s(l,h,u){this.fn=l,this.context=h,this.once=u||!1}function r(l,h,u,c,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new s(u,c||l,d),p=t?t+h:h;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function a(l,h){--l._eventsCount===0?l._events=new i:delete l._events[h]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],h,u;if(this._eventsCount===0)return l;for(u in h=this._events)e.call(h,u)&&l.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(h)):l},o.prototype.listeners=function(l){var h=t?t+l:l,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var c=0,d=u.length,f=new Array(d);c<d;c++)f[c]=u[c].fn;return f},o.prototype.listenerCount=function(l){var h=t?t+l:l,u=this._events[h];return u?u.fn?1:u.length:0},o.prototype.emit=function(l,h,u,c,d,f){var p=t?t+l:l;if(!this._events[p])return!1;var m=this._events[p],v=arguments.length,g,T;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),v){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,h),!0;case 3:return m.fn.call(m.context,h,u),!0;case 4:return m.fn.call(m.context,h,u,c),!0;case 5:return m.fn.call(m.context,h,u,c,d),!0;case 6:return m.fn.call(m.context,h,u,c,d,f),!0}for(T=1,g=new Array(v-1);T<v;T++)g[T-1]=arguments[T];m.fn.apply(m.context,g)}else{var w=m.length,E;for(T=0;T<w;T++)switch(m[T].once&&this.removeListener(l,m[T].fn,void 0,!0),v){case 1:m[T].fn.call(m[T].context);break;case 2:m[T].fn.call(m[T].context,h);break;case 3:m[T].fn.call(m[T].context,h,u);break;case 4:m[T].fn.call(m[T].context,h,u,c);break;default:if(!g)for(E=1,g=new Array(v-1);E<v;E++)g[E-1]=arguments[E];m[T].fn.apply(m[T].context,g)}}return!0},o.prototype.on=function(l,h,u){return r(this,l,h,u,!1)},o.prototype.once=function(l,h,u){return r(this,l,h,u,!0)},o.prototype.removeListener=function(l,h,u,c){var d=t?t+l:l;if(!this._events[d])return this;if(!h)return a(this,d),this;var f=this._events[d];if(f.fn)f.fn===h&&(!c||f.once)&&(!u||f.context===u)&&a(this,d);else{for(var p=0,m=[],v=f.length;p<v;p++)(f[p].fn!==h||c&&!f[p].once||u&&f[p].context!==u)&&m.push(f[p]);m.length?this._events[d]=m.length===1?m[0]:m:a(this,d)}return this},o.prototype.removeAllListeners=function(l){var h;return l?(h=t?t+l:l,this._events[h]&&a(this,h)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(vu);var Ap=vu.exports;const ln=gu(Ap);var Pa={exports:{}};Pa.exports=vr;Pa.exports.default=vr;function vr(n,e,t){t=t||2;var i=e&&e.length,s=i?e[0]*t:n.length,r=yu(n,0,s,t,!0),a=[];if(!r||r.next===r.prev)return a;var o,l,h,u,c,d,f;if(i&&(r=Mp(n,e,r,t)),n.length>80*t){o=h=n[0],l=u=n[1];for(var p=t;p<s;p+=t)c=n[p],d=n[p+1],c<o&&(o=c),d<l&&(l=d),c>h&&(h=c),d>u&&(u=d);f=Math.max(h-o,u-l),f=f!==0?32767/f:0}return tn(r,a,t,o,l,f,0),a}function yu(n,e,t,i,s){var r,a;if(s===Bo(n,e,t,i)>0)for(r=e;r<t;r+=i)a=Al(r,n[r],n[r+1],a);else for(r=t-i;r>=e;r-=i)a=Al(r,n[r],n[r+1],a);return a&&yr(a,a.next)&&(nn(a),a=a.next),a}function zi(n,e){if(!n)return n;e||(e=n);var t=n,i;do if(i=!1,!t.steiner&&(yr(t,t.next)||Ue(t.prev,t,t.next)===0)){if(nn(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function tn(n,e,t,i,s,r,a){if(n){!a&&r&&Fp(n,i,s,r);for(var o=n,l,h;n.prev!==n.next;){if(l=n.prev,h=n.next,r?Pp(n,i,s,r):Rp(n)){e.push(l.i/t|0),e.push(n.i/t|0),e.push(h.i/t|0),nn(n),n=h.next,o=h.next;continue}if(n=h,n===o){a?a===1?(n=Cp(zi(n),e,t),tn(n,e,t,i,s,r,2)):a===2&&Ip(n,e,t,i,s,r):tn(zi(n),e,t,i,s,r,1);break}}}}function Rp(n){var e=n.prev,t=n,i=n.next;if(Ue(e,t,i)>=0)return!1;for(var s=e.x,r=t.x,a=i.x,o=e.y,l=t.y,h=i.y,u=s<r?s<a?s:a:r<a?r:a,c=o<l?o<h?o:h:l<h?l:h,d=s>r?s>a?s:a:r>a?r:a,f=o>l?o>h?o:h:l>h?l:h,p=i.next;p!==e;){if(p.x>=u&&p.x<=d&&p.y>=c&&p.y<=f&&ds(s,o,r,l,a,h,p.x,p.y)&&Ue(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Pp(n,e,t,i){var s=n.prev,r=n,a=n.next;if(Ue(s,r,a)>=0)return!1;for(var o=s.x,l=r.x,h=a.x,u=s.y,c=r.y,d=a.y,f=o<l?o<h?o:h:l<h?l:h,p=u<c?u<d?u:d:c<d?c:d,m=o>l?o>h?o:h:l>h?l:h,v=u>c?u>d?u:d:c>d?c:d,g=Mo(f,p,e,t,i),T=Mo(m,v,e,t,i),w=n.prevZ,E=n.nextZ;w&&w.z>=g&&E&&E.z<=T;){if(w.x>=f&&w.x<=m&&w.y>=p&&w.y<=v&&w!==s&&w!==a&&ds(o,u,l,c,h,d,w.x,w.y)&&Ue(w.prev,w,w.next)>=0||(w=w.prevZ,E.x>=f&&E.x<=m&&E.y>=p&&E.y<=v&&E!==s&&E!==a&&ds(o,u,l,c,h,d,E.x,E.y)&&Ue(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;w&&w.z>=g;){if(w.x>=f&&w.x<=m&&w.y>=p&&w.y<=v&&w!==s&&w!==a&&ds(o,u,l,c,h,d,w.x,w.y)&&Ue(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;E&&E.z<=T;){if(E.x>=f&&E.x<=m&&E.y>=p&&E.y<=v&&E!==s&&E!==a&&ds(o,u,l,c,h,d,E.x,E.y)&&Ue(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function Cp(n,e,t){var i=n;do{var s=i.prev,r=i.next.next;!yr(s,r)&&xu(s,i,i.next,r)&&sn(s,r)&&sn(r,s)&&(e.push(s.i/t|0),e.push(i.i/t|0),e.push(r.i/t|0),nn(i),nn(i.next),i=n=r),i=i.next}while(i!==n);return zi(i)}function Ip(n,e,t,i,s,r){var a=n;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&Up(a,o)){var l=_u(a,o);a=zi(a,a.next),l=zi(l,l.next),tn(a,e,t,i,s,r,0),tn(l,e,t,i,s,r,0);return}o=o.next}a=a.next}while(a!==n)}function Mp(n,e,t,i){var s=[],r,a,o,l,h;for(r=0,a=e.length;r<a;r++)o=e[r]*i,l=r<a-1?e[r+1]*i:n.length,h=yu(n,o,l,i,!1),h===h.next&&(h.steiner=!0),s.push(kp(h));for(s.sort(Dp),r=0;r<s.length;r++)t=Bp(s[r],t);return t}function Dp(n,e){return n.x-e.x}function Bp(n,e){var t=Op(n,e);if(!t)return e;var i=_u(t,n);return zi(i,i.next),zi(t,t.next)}function Op(n,e){var t=e,i=n.x,s=n.y,r=-1/0,a;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){var o=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(o<=i&&o>r&&(r=o,a=t.x<t.next.x?t:t.next,o===i))return a}t=t.next}while(t!==e);if(!a)return null;var l=a,h=a.x,u=a.y,c=1/0,d;t=a;do i>=t.x&&t.x>=h&&i!==t.x&&ds(s<u?i:r,s,h,u,s<u?r:i,s,t.x,t.y)&&(d=Math.abs(s-t.y)/(i-t.x),sn(t,n)&&(d<c||d===c&&(t.x>a.x||t.x===a.x&&Lp(a,t)))&&(a=t,c=d)),t=t.next;while(t!==l);return a}function Lp(n,e){return Ue(n.prev,n,e.prev)<0&&Ue(e.next,n,n.next)<0}function Fp(n,e,t,i){var s=n;do s.z===0&&(s.z=Mo(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,Np(s)}function Np(n){var e,t,i,s,r,a,o,l,h=1;do{for(t=n,n=null,r=null,a=0;t;){for(a++,i=t,o=0,e=0;e<h&&(o++,i=i.nextZ,!!i);e++);for(l=h;o>0||l>0&&i;)o!==0&&(l===0||!i||t.z<=i.z)?(s=t,t=t.nextZ,o--):(s=i,i=i.nextZ,l--),r?r.nextZ=s:n=s,s.prevZ=r,r=s;t=i}r.nextZ=null,h*=2}while(a>1);return n}function Mo(n,e,t,i,s){return n=(n-t)*s|0,e=(e-i)*s|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function kp(n){var e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function ds(n,e,t,i,s,r,a,o){return(s-a)*(e-o)>=(n-a)*(r-o)&&(n-a)*(i-o)>=(t-a)*(e-o)&&(t-a)*(r-o)>=(s-a)*(i-o)}function Up(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!Hp(n,e)&&(sn(n,e)&&sn(e,n)&&Gp(n,e)&&(Ue(n.prev,n,e.prev)||Ue(n,e.prev,e))||yr(n,e)&&Ue(n.prev,n,n.next)>0&&Ue(e.prev,e,e.next)>0)}function Ue(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function yr(n,e){return n.x===e.x&&n.y===e.y}function xu(n,e,t,i){var s=gn(Ue(n,e,t)),r=gn(Ue(n,e,i)),a=gn(Ue(t,i,n)),o=gn(Ue(t,i,e));return!!(s!==r&&a!==o||s===0&&mn(n,t,e)||r===0&&mn(n,i,e)||a===0&&mn(t,n,i)||o===0&&mn(t,e,i))}function mn(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function gn(n){return n>0?1:n<0?-1:0}function Hp(n,e){var t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&xu(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function sn(n,e){return Ue(n.prev,n,n.next)<0?Ue(n,e,n.next)>=0&&Ue(n,n.prev,e)>=0:Ue(n,e,n.prev)<0||Ue(n,n.next,e)<0}function Gp(n,e){var t=n,i=!1,s=(n.x+e.x)/2,r=(n.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function _u(n,e){var t=new Do(n.i,n.x,n.y),i=new Do(e.i,e.x,e.y),s=n.next,r=e.prev;return n.next=e,e.prev=n,t.next=s,s.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function Al(n,e,t,i){var s=new Do(n,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function nn(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Do(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}vr.deviation=function(n,e,t,i){var s=e&&e.length,r=s?e[0]*t:n.length,a=Math.abs(Bo(n,0,r,t));if(s)for(var o=0,l=e.length;o<l;o++){var h=e[o]*t,u=o<l-1?e[o+1]*t:n.length;a-=Math.abs(Bo(n,h,u,t))}var c=0;for(o=0;o<i.length;o+=3){var d=i[o]*t,f=i[o+1]*t,p=i[o+2]*t;c+=Math.abs((n[d]-n[p])*(n[f+1]-n[d+1])-(n[d]-n[f])*(n[p+1]-n[d+1]))}return a===0&&c===0?0:Math.abs((c-a)/a)};function Bo(n,e,t,i){for(var s=0,r=e,a=t-i;r<t;r+=i)s+=(n[a]-n[r])*(n[r+1]+n[a+1]),a=r;return s}vr.flatten=function(n){for(var e=n[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,s=0;s<n.length;s++){for(var r=0;r<n[s].length;r++)for(var a=0;a<e;a++)t.vertices.push(n[s][r][a]);s>0&&(i+=n[s-1].length,t.holes.push(i))}return t};var zp=Pa.exports;const Vp=gu(zp);var Qn={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */Qn.exports;(function(n,e){(function(t){var i=e&&!e.nodeType&&e,s=n&&!n.nodeType&&n,r=typeof Gr=="object"&&Gr;(r.global===r||r.window===r||r.self===r)&&(t=r);var a,o=2147483647,l=36,h=1,u=26,c=38,d=700,f=72,p=128,m="-",v=/^xn--/,g=/[^\x20-\x7E]/,T=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=l-h,P=Math.floor,C=String.fromCharCode,D;function B(G){throw new RangeError(w[G])}function H(G,Y){for(var de=G.length,J=[];de--;)J[de]=Y(G[de]);return J}function I(G,Y){var de=G.split("@"),J="";de.length>1&&(J=de[0]+"@",G=de[1]),G=G.replace(T,".");var ye=G.split("."),he=H(ye,Y).join(".");return J+he}function N(G){for(var Y=[],de=0,J=G.length,ye,he;de<J;)ye=G.charCodeAt(de++),ye>=55296&&ye<=56319&&de<J?(he=G.charCodeAt(de++),(he&64512)==56320?Y.push(((ye&1023)<<10)+(he&1023)+65536):(Y.push(ye),de--)):Y.push(ye);return Y}function M(G){return H(G,function(Y){var de="";return Y>65535&&(Y-=65536,de+=C(Y>>>10&1023|55296),Y=56320|Y&1023),de+=C(Y),de}).join("")}function R(G){return G-48<10?G-22:G-65<26?G-65:G-97<26?G-97:l}function F(G,Y){return G+22+75*(G<26)-((Y!=0)<<5)}function L(G,Y,de){var J=0;for(G=de?P(G/d):G>>1,G+=P(G/Y);G>E*u>>1;J+=l)G=P(G/E);return P(J+(E+1)*G/(G+c))}function Z(G){var Y=[],de=G.length,J,ye=0,he=p,Re=f,Me,re,$,De,we,Pe,Ce,ot,et;for(Me=G.lastIndexOf(m),Me<0&&(Me=0),re=0;re<Me;++re)G.charCodeAt(re)>=128&&B("not-basic"),Y.push(G.charCodeAt(re));for($=Me>0?Me+1:0;$<de;){for(De=ye,we=1,Pe=l;$>=de&&B("invalid-input"),Ce=R(G.charCodeAt($++)),(Ce>=l||Ce>P((o-ye)/we))&&B("overflow"),ye+=Ce*we,ot=Pe<=Re?h:Pe>=Re+u?u:Pe-Re,!(Ce<ot);Pe+=l)et=l-ot,we>P(o/et)&&B("overflow"),we*=et;J=Y.length+1,Re=L(ye-De,J,De==0),P(ye/J)>o-he&&B("overflow"),he+=P(ye/J),ye%=J,Y.splice(ye++,0,he)}return M(Y)}function V(G){var Y,de,J,ye,he,Re,Me,re,$,De,we,Pe=[],Ce,ot,et,ct;for(G=N(G),Ce=G.length,Y=p,de=0,he=f,Re=0;Re<Ce;++Re)we=G[Re],we<128&&Pe.push(C(we));for(J=ye=Pe.length,ye&&Pe.push(m);J<Ce;){for(Me=o,Re=0;Re<Ce;++Re)we=G[Re],we>=Y&&we<Me&&(Me=we);for(ot=J+1,Me-Y>P((o-de)/ot)&&B("overflow"),de+=(Me-Y)*ot,Y=Me,Re=0;Re<Ce;++Re)if(we=G[Re],we<Y&&++de>o&&B("overflow"),we==Y){for(re=de,$=l;De=$<=he?h:$>=he+u?u:$-he,!(re<De);$+=l)ct=re-De,et=l-De,Pe.push(C(F(De+ct%et,0))),re=P(ct/et);Pe.push(C(F(re,0))),he=L(de,ot,J==ye),de=0,++J}++de,++Y}return Pe.join("")}function q(G){return I(G,function(Y){return v.test(Y)?Z(Y.slice(4).toLowerCase()):Y})}function pe(G){return I(G,function(Y){return g.test(Y)?"xn--"+V(Y):Y})}if(a={version:"1.4.1",ucs2:{decode:N,encode:M},decode:Z,encode:V,toASCII:pe,toUnicode:q},i&&s)if(n.exports==i)s.exports=a;else for(D in a)a.hasOwnProperty(D)&&(i[D]=a[D]);else t.punycode=a})(Gr)})(Qn,Qn.exports);Qn.exports;var Wp=Error,jp=EvalError,Xp=RangeError,Yp=ReferenceError,wu=SyntaxError,xr=TypeError,qp=URIError,Zp=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var n={},e=Symbol("test"),t=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(t)!=="[object Symbol]")return!1;var i=42;n[e]=i;for(e in n)return!1;if(typeof Object.keys=="function"&&Object.keys(n).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(n).length!==0)return!1;var s=Object.getOwnPropertySymbols(n);if(s.length!==1||s[0]!==e||!Object.prototype.propertyIsEnumerable.call(n,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var r=Object.getOwnPropertyDescriptor(n,e);if(r.value!==i||r.enumerable!==!0)return!1}return!0},Rl=typeof Symbol<"u"&&Symbol,Kp=Zp,Jp=function(){return typeof Rl!="function"||typeof Symbol!="function"||typeof Rl("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:Kp()},zr={__proto__:null,foo:{}},Qp=Object,$p=function(){return{__proto__:zr}.foo===zr.foo&&!(zr instanceof Qp)},em="Function.prototype.bind called on incompatible ",tm=Object.prototype.toString,im=Math.max,sm="[object Function]",Pl=function(n,e){for(var t=[],i=0;i<n.length;i+=1)t[i]=n[i];for(var s=0;s<e.length;s+=1)t[s+n.length]=e[s];return t},nm=function(n,e){for(var t=[],i=e,s=0;i<n.length;i+=1,s+=1)t[s]=n[i];return t},rm=function(n,e){for(var t="",i=0;i<n.length;i+=1)t+=n[i],i+1<n.length&&(t+=e);return t},om=function(n){var e=this;if(typeof e!="function"||tm.apply(e)!==sm)throw new TypeError(em+e);for(var t=nm(arguments,1),i,s=function(){if(this instanceof i){var h=e.apply(this,Pl(t,arguments));return Object(h)===h?h:this}return e.apply(n,Pl(t,arguments))},r=im(0,e.length-t.length),a=[],o=0;o<r;o++)a[o]="$"+o;if(i=Function("binder","return function ("+rm(a,",")+"){ return binder.apply(this,arguments); }")(s),e.prototype){var l=function(){};l.prototype=e.prototype,i.prototype=new l,l.prototype=null}return i},am=om,Ca=Function.prototype.bind||am,lm=Function.prototype.call,hm=Object.prototype.hasOwnProperty,um=Ca,cm=um.call(lm,hm),_e,dm=Wp,fm=jp,pm=Xp,mm=Yp,Es=wu,vs=xr,gm=qp,Tu=Function,Vr=function(n){try{return Tu('"use strict"; return ('+n+").constructor;")()}catch{}},ki=Object.getOwnPropertyDescriptor;if(ki)try{ki({},"")}catch{ki=null}var Wr=function(){throw new vs},vm=ki?function(){try{return arguments.callee,Wr}catch{try{return ki(arguments,"callee").get}catch{return Wr}}}():Wr,$i=Jp(),ym=$p(),Ye=Object.getPrototypeOf||(ym?function(n){return n.__proto__}:null),rs={},xm=typeof Uint8Array>"u"||!Ye?_e:Ye(Uint8Array),Ui={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?_e:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?_e:ArrayBuffer,"%ArrayIteratorPrototype%":$i&&Ye?Ye([][Symbol.iterator]()):_e,"%AsyncFromSyncIteratorPrototype%":_e,"%AsyncFunction%":rs,"%AsyncGenerator%":rs,"%AsyncGeneratorFunction%":rs,"%AsyncIteratorPrototype%":rs,"%Atomics%":typeof Atomics>"u"?_e:Atomics,"%BigInt%":typeof BigInt>"u"?_e:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?_e:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?_e:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?_e:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":dm,"%eval%":eval,"%EvalError%":fm,"%Float32Array%":typeof Float32Array>"u"?_e:Float32Array,"%Float64Array%":typeof Float64Array>"u"?_e:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?_e:FinalizationRegistry,"%Function%":Tu,"%GeneratorFunction%":rs,"%Int8Array%":typeof Int8Array>"u"?_e:Int8Array,"%Int16Array%":typeof Int16Array>"u"?_e:Int16Array,"%Int32Array%":typeof Int32Array>"u"?_e:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":$i&&Ye?Ye(Ye([][Symbol.iterator]())):_e,"%JSON%":typeof JSON=="object"?JSON:_e,"%Map%":typeof Map>"u"?_e:Map,"%MapIteratorPrototype%":typeof Map>"u"||!$i||!Ye?_e:Ye(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?_e:Promise,"%Proxy%":typeof Proxy>"u"?_e:Proxy,"%RangeError%":pm,"%ReferenceError%":mm,"%Reflect%":typeof Reflect>"u"?_e:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?_e:Set,"%SetIteratorPrototype%":typeof Set>"u"||!$i||!Ye?_e:Ye(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?_e:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":$i&&Ye?Ye(""[Symbol.iterator]()):_e,"%Symbol%":$i?Symbol:_e,"%SyntaxError%":Es,"%ThrowTypeError%":vm,"%TypedArray%":xm,"%TypeError%":vs,"%Uint8Array%":typeof Uint8Array>"u"?_e:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?_e:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?_e:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?_e:Uint32Array,"%URIError%":gm,"%WeakMap%":typeof WeakMap>"u"?_e:WeakMap,"%WeakRef%":typeof WeakRef>"u"?_e:WeakRef,"%WeakSet%":typeof WeakSet>"u"?_e:WeakSet};if(Ye)try{null.error}catch(n){var _m=Ye(Ye(n));Ui["%Error.prototype%"]=_m}var wm=function n(e){var t;if(e==="%AsyncFunction%")t=Vr("async function () {}");else if(e==="%GeneratorFunction%")t=Vr("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Vr("async function* () {}");else if(e==="%AsyncGenerator%"){var i=n("%AsyncGeneratorFunction%");i&&(t=i.prototype)}else if(e==="%AsyncIteratorPrototype%"){var s=n("%AsyncGenerator%");s&&Ye&&(t=Ye(s.prototype))}return Ui[e]=t,t},Cl={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},hn=Ca,$n=cm,Tm=hn.call(Function.call,Array.prototype.concat),Em=hn.call(Function.apply,Array.prototype.splice),Il=hn.call(Function.call,String.prototype.replace),er=hn.call(Function.call,String.prototype.slice),bm=hn.call(Function.call,RegExp.prototype.exec),Sm=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Am=/\\(\\)?/g,Rm=function(n){var e=er(n,0,1),t=er(n,-1);if(e==="%"&&t!=="%")throw new Es("invalid intrinsic syntax, expected closing `%`");if(t==="%"&&e!=="%")throw new Es("invalid intrinsic syntax, expected opening `%`");var i=[];return Il(n,Sm,function(s,r,a,o){i[i.length]=a?Il(o,Am,"$1"):r||s}),i},Pm=function(n,e){var t=n,i;if($n(Cl,t)&&(i=Cl[t],t="%"+i[0]+"%"),$n(Ui,t)){var s=Ui[t];if(s===rs&&(s=wm(t)),typeof s>"u"&&!e)throw new vs("intrinsic "+n+" exists, but is not available. Please file an issue!");return{alias:i,name:t,value:s}}throw new Es("intrinsic "+n+" does not exist!")},Is=function(n,e){if(typeof n!="string"||n.length===0)throw new vs("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new vs('"allowMissing" argument must be a boolean');if(bm(/^%?[^%]*%?$/,n)===null)throw new Es("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var t=Rm(n),i=t.length>0?t[0]:"",s=Pm("%"+i+"%",e),r=s.name,a=s.value,o=!1,l=s.alias;l&&(i=l[0],Em(t,Tm([0,1],l)));for(var h=1,u=!0;h<t.length;h+=1){var c=t[h],d=er(c,0,1),f=er(c,-1);if((d==='"'||d==="'"||d==="`"||f==='"'||f==="'"||f==="`")&&d!==f)throw new Es("property names with quotes must have matching quotes");if((c==="constructor"||!u)&&(o=!0),i+="."+c,r="%"+i+"%",$n(Ui,r))a=Ui[r];else if(a!=null){if(!(c in a)){if(!e)throw new vs("base intrinsic for "+n+" exists, but the property is not available.");return}if(ki&&h+1>=t.length){var p=ki(a,c);u=!!p,u&&"get"in p&&!("originalValue"in p.get)?a=p.get:a=a[c]}else u=$n(a,c),a=a[c];u&&!o&&(Ui[r]=a)}}return a},Eu={exports:{}},jr,Ml;function Ia(){if(Ml)return jr;Ml=1;var n=Is,e=n("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return jr=e,jr}var Cm=Is,Un=Cm("%Object.getOwnPropertyDescriptor%",!0);if(Un)try{Un([],"length")}catch{Un=null}var bu=Un,Dl=Ia(),Im=wu,es=xr,Bl=bu,Mm=function(n,e,t){if(!n||typeof n!="object"&&typeof n!="function")throw new es("`obj` must be an object or a function`");if(typeof e!="string"&&typeof e!="symbol")throw new es("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new es("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new es("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new es("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new es("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,r=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,o=!!Bl&&Bl(n,e);if(Dl)Dl(n,e,{configurable:r===null&&o?o.configurable:!r,enumerable:i===null&&o?o.enumerable:!i,value:t,writable:s===null&&o?o.writable:!s});else if(a||!i&&!s&&!r)n[e]=t;else throw new Im("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Oo=Ia(),Su=function(){return!!Oo};Su.hasArrayLengthDefineBug=function(){if(!Oo)return null;try{return Oo([],"length",{value:1}).length!==1}catch{return!0}};var Dm=Su,Bm=Is,Ol=Mm,Om=Dm(),Ll=bu,Fl=xr,Lm=Bm("%Math.floor%"),Fm=function(n,e){if(typeof n!="function")throw new Fl("`fn` is not a function");if(typeof e!="number"||e<0||e>4294967295||Lm(e)!==e)throw new Fl("`length` must be a positive 32-bit integer");var t=arguments.length>2&&!!arguments[2],i=!0,s=!0;if("length"in n&&Ll){var r=Ll(n,"length");r&&!r.configurable&&(i=!1),r&&!r.writable&&(s=!1)}return(i||s||!t)&&(Om?Ol(n,"length",e,!0,!0):Ol(n,"length",e)),n};(function(n){var e=Ca,t=Is,i=Fm,s=xr,r=t("%Function.prototype.apply%"),a=t("%Function.prototype.call%"),o=t("%Reflect.apply%",!0)||e.call(a,r),l=Ia(),h=t("%Math.max%");n.exports=function(c){if(typeof c!="function")throw new s("a function is required");var d=o(e,a,arguments);return i(d,1+h(0,c.length-(arguments.length-1)),!0)};var u=function(){return o(e,r,arguments)};l?l(n.exports,"apply",{value:u}):n.exports.apply=u})(Eu);var Nm=Eu.exports,Au=Is,Ru=Nm,km=Ru(Au("String.prototype.indexOf")),Um=function(n,e){var t=Au(n,!!e);return typeof t=="function"&&km(n,".prototype.")>-1?Ru(t):t};const Hm={},Gm=Object.freeze(Object.defineProperty({__proto__:null,default:Hm},Symbol.toStringTag,{value:"Module"})),zm=Sp(Gm);var Pu=typeof Map=="function"&&Map.prototype,Xr=Object.getOwnPropertyDescriptor&&Pu?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null;Pu&&Xr&&typeof Xr.get=="function"&&Xr.get;var Cu=typeof Set=="function"&&Set.prototype,Yr=Object.getOwnPropertyDescriptor&&Cu?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null;Cu&&Yr&&typeof Yr.get=="function"&&Yr.get;var Vm=typeof WeakRef=="function"&&WeakRef.prototype;Vm&&WeakRef.prototype.deref;var Nl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Wm=typeof Symbol=="function"&&typeof Symbol.iterator=="object",jm=zm,kl=jm.custom;Xm(kl);function Xm(n){if(Wm)return n&&typeof n=="object"&&n instanceof Symbol;if(typeof n=="symbol")return!0;if(!n||typeof n!="object"||!Nl)return!1;try{return Nl.call(n),!0}catch{}return!1}var Iu=Is,Ms=Um;Iu("%WeakMap%",!0);Iu("%Map%",!0);Ms("WeakMap.prototype.get",!0);Ms("WeakMap.prototype.set",!0);Ms("WeakMap.prototype.has",!0);Ms("Map.prototype.get",!0);Ms("Map.prototype.set",!0);Ms("Map.prototype.has",!0);(function(){for(var n=[],e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})();const Ul={};function xe(n,e,t=3){if(Ul[e])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${n}`):(i=i.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${n}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${n}`),console.warn(i))),Ul[e]=!0}function yt(n){if(typeof n!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(n)}`)}function Ls(n){return n.split("?")[0].split("#")[0]}function Ym(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function qm(n,e,t){return n.replace(new RegExp(Ym(e),"g"),t)}function Zm(n,e){let t="",i=0,s=-1,r=0,a=-1;for(let o=0;o<=n.length;++o){if(o<n.length)a=n.charCodeAt(o);else{if(a===47)break;a=47}if(a===47){if(!(s===o-1||r===1))if(s!==o-1&&r===2){if(t.length<2||i!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){const l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",i=0):(t=t.slice(0,l),i=t.length-1-t.lastIndexOf("/")),s=o,r=0;continue}}else if(t.length===2||t.length===1){t="",i=0,s=o,r=0;continue}}}else t.length>0?t+=`/${n.slice(s+1,o)}`:t=n.slice(s+1,o),i=o-s-1;s=o,r=0}else a===46&&r!==-1?++r:r=-1}return t}const Ze={toPosix(n){return qm(n,"\\","/")},isUrl(n){return/^https?:/.test(this.toPosix(n))},isDataUrl(n){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(n)},isBlobUrl(n){return n.startsWith("blob:")},hasProtocol(n){return/^[^/:]+:/.test(this.toPosix(n))},getProtocol(n){yt(n),n=this.toPosix(n);const e=/^file:\/\/\//.exec(n);if(e)return e[0];const t=/^[^/:]+:\/{0,2}/.exec(n);return t?t[0]:""},toAbsolute(n,e,t){if(yt(n),this.isDataUrl(n)||this.isBlobUrl(n))return n;const i=Ls(this.toPosix(e??te.ADAPTER.getBaseUrl())),s=Ls(this.toPosix(t??this.rootname(i)));return n=this.toPosix(n),n.startsWith("/")?Ze.join(s,n.slice(1)):this.isAbsolute(n)?n:this.join(i,n)},normalize(n){if(yt(n),n.length===0)return".";if(this.isDataUrl(n)||this.isBlobUrl(n))return n;n=this.toPosix(n);let e="";const t=n.startsWith("/");this.hasProtocol(n)&&(e=this.rootname(n),n=n.slice(e.length));const i=n.endsWith("/");return n=Zm(n),n.length>0&&i&&(n+="/"),t?`/${n}`:e+n},isAbsolute(n){return yt(n),n=this.toPosix(n),this.hasProtocol(n)?!0:n.startsWith("/")},join(...n){if(n.length===0)return".";let e;for(let t=0;t<n.length;++t){const i=n[t];if(yt(i),i.length>0)if(e===void 0)e=i;else{const s=n[t-1]??"";this.joinExtensions.includes(this.extname(s).toLowerCase())?e+=`/../${i}`:e+=`/${i}`}}return e===void 0?".":this.normalize(e)},dirname(n){if(yt(n),n.length===0)return".";n=this.toPosix(n);let e=n.charCodeAt(0);const t=e===47;let i=-1,s=!0;const r=this.getProtocol(n),a=n;n=n.slice(r.length);for(let o=n.length-1;o>=1;--o)if(e=n.charCodeAt(o),e===47){if(!s){i=o;break}}else s=!1;return i===-1?t?"/":this.isUrl(a)?r+n:r:t&&i===1?"//":r+n.slice(0,i)},rootname(n){yt(n),n=this.toPosix(n);let e="";if(n.startsWith("/")?e="/":e=this.getProtocol(n),this.isUrl(n)){const t=n.indexOf("/",e.length);t!==-1?e=n.slice(0,t):e=n,e.endsWith("/")||(e+="/")}return e},basename(n,e){yt(n),e&&yt(e),n=Ls(this.toPosix(n));let t=0,i=-1,s=!0,r;if(e!==void 0&&e.length>0&&e.length<=n.length){if(e.length===n.length&&e===n)return"";let a=e.length-1,o=-1;for(r=n.length-1;r>=0;--r){const l=n.charCodeAt(r);if(l===47){if(!s){t=r+1;break}}else o===-1&&(s=!1,o=r+1),a>=0&&(l===e.charCodeAt(a)?--a===-1&&(i=r):(a=-1,i=o))}return t===i?i=o:i===-1&&(i=n.length),n.slice(t,i)}for(r=n.length-1;r>=0;--r)if(n.charCodeAt(r)===47){if(!s){t=r+1;break}}else i===-1&&(s=!1,i=r+1);return i===-1?"":n.slice(t,i)},extname(n){yt(n),n=Ls(this.toPosix(n));let e=-1,t=0,i=-1,s=!0,r=0;for(let a=n.length-1;a>=0;--a){const o=n.charCodeAt(a);if(o===47){if(!s){t=a+1;break}continue}i===-1&&(s=!1,i=a+1),o===46?e===-1?e=a:r!==1&&(r=1):e!==-1&&(r=-1)}return e===-1||i===-1||r===0||r===1&&e===i-1&&e===t+1?"":n.slice(e,i)},parse(n){yt(n);const e={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return e;n=Ls(this.toPosix(n));let t=n.charCodeAt(0);const i=this.isAbsolute(n);let s;e.root=this.rootname(n),i||this.hasProtocol(n)?s=1:s=0;let r=-1,a=0,o=-1,l=!0,h=n.length-1,u=0;for(;h>=s;--h){if(t=n.charCodeAt(h),t===47){if(!l){a=h+1;break}continue}o===-1&&(l=!1,o=h+1),t===46?r===-1?r=h:u!==1&&(u=1):r!==-1&&(u=-1)}return r===-1||o===-1||u===0||u===1&&r===o-1&&r===a+1?o!==-1&&(a===0&&i?e.base=e.name=n.slice(1,o):e.base=e.name=n.slice(a,o)):(a===0&&i?(e.name=n.slice(1,r),e.base=n.slice(1,o)):(e.name=n.slice(a,r),e.base=n.slice(a,o)),e.ext=n.slice(r,o)),e.dir=this.dirname(n),e},sep:"/",delimiter:":",joinExtensions:[".html"]};let qr;async function Km(){return qr??(qr=(async()=>{var n;const e=document.createElement("canvas").getContext("webgl");if(!e)return at.UNPACK;const t=await new Promise(a=>{const o=document.createElement("video");o.onloadeddata=()=>a(o),o.onerror=()=>a(null),o.autoplay=!1,o.crossOrigin="anonymous",o.preload="auto",o.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",o.load()});if(!t)return at.UNPACK;const i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);const s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);const r=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,r),e.deleteFramebuffer(s),e.deleteTexture(i),(n=e.getExtension("WEBGL_lose_context"))==null||n.loseContext(),r[0]<=r[3]?at.PMA:at.UNPACK})()),qr}let Zr;function Jm(){return typeof Zr>"u"&&(Zr=function(){var n;const e={stencil:!0,failIfMajorPerformanceCaveat:te.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!te.ADAPTER.getWebGLRenderingContext())return!1;const t=te.ADAPTER.createCanvas();let i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);const s=!!((n=i?.getContextAttributes())!=null&&n.stencil);if(i){const r=i.getExtension("WEBGL_lose_context");r&&r.loseContext()}return i=null,s}catch{return!1}}()),Zr}var Qm={grad:.9,turn:360,rad:360/(2*Math.PI)},Wt=function(n){return typeof n=="string"?n.length>0:typeof n=="number"},qe=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*n)/t+0},gt=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),n>t?t:n>e?n:e},Mu=function(n){return(n=isFinite(n)?n%360:0)>0?n:n+360},Hl=function(n){return{r:gt(n.r,0,255),g:gt(n.g,0,255),b:gt(n.b,0,255),a:gt(n.a)}},Kr=function(n){return{r:qe(n.r),g:qe(n.g),b:qe(n.b),a:qe(n.a,3)}},$m=/^#([0-9a-f]{3,8})$/i,vn=function(n){var e=n.toString(16);return e.length<2?"0"+e:e},Du=function(n){var e=n.r,t=n.g,i=n.b,s=n.a,r=Math.max(e,t,i),a=r-Math.min(e,t,i),o=a?r===e?(t-i)/a:r===t?2+(i-e)/a:4+(e-t)/a:0;return{h:60*(o<0?o+6:o),s:r?a/r*100:0,v:r/255*100,a:s}},Bu=function(n){var e=n.h,t=n.s,i=n.v,s=n.a;e=e/360*6,t/=100,i/=100;var r=Math.floor(e),a=i*(1-t),o=i*(1-(e-r)*t),l=i*(1-(1-e+r)*t),h=r%6;return{r:255*[i,o,a,a,l,i][h],g:255*[l,i,i,o,a,a][h],b:255*[a,a,l,i,i,o][h],a:s}},Gl=function(n){return{h:Mu(n.h),s:gt(n.s,0,100),l:gt(n.l,0,100),a:gt(n.a)}},zl=function(n){return{h:qe(n.h),s:qe(n.s),l:qe(n.l),a:qe(n.a,3)}},Vl=function(n){return Bu((t=(e=n).s,{h:e.h,s:(t*=((i=e.l)<50?i:100-i)/100)>0?2*t/(i+t)*100:0,v:i+t,a:e.a}));var e,t,i},Qs=function(n){return{h:(e=Du(n)).h,s:(s=(200-(t=e.s))*(i=e.v)/100)>0&&s<200?t*i/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,t,i,s},eg=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,tg=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ig=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,sg=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Lo={string:[[function(n){var e=$m.exec(n);return e?(n=e[1]).length<=4?{r:parseInt(n[0]+n[0],16),g:parseInt(n[1]+n[1],16),b:parseInt(n[2]+n[2],16),a:n.length===4?qe(parseInt(n[3]+n[3],16)/255,2):1}:n.length===6||n.length===8?{r:parseInt(n.substr(0,2),16),g:parseInt(n.substr(2,2),16),b:parseInt(n.substr(4,2),16),a:n.length===8?qe(parseInt(n.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(n){var e=ig.exec(n)||sg.exec(n);return e?e[2]!==e[4]||e[4]!==e[6]?null:Hl({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(n){var e=eg.exec(n)||tg.exec(n);if(!e)return null;var t,i,s=Gl({h:(t=e[1],i=e[2],i===void 0&&(i="deg"),Number(t)*(Qm[i]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return Vl(s)},"hsl"]],object:[[function(n){var e=n.r,t=n.g,i=n.b,s=n.a,r=s===void 0?1:s;return Wt(e)&&Wt(t)&&Wt(i)?Hl({r:Number(e),g:Number(t),b:Number(i),a:Number(r)}):null},"rgb"],[function(n){var e=n.h,t=n.s,i=n.l,s=n.a,r=s===void 0?1:s;if(!Wt(e)||!Wt(t)||!Wt(i))return null;var a=Gl({h:Number(e),s:Number(t),l:Number(i),a:Number(r)});return Vl(a)},"hsl"],[function(n){var e=n.h,t=n.s,i=n.v,s=n.a,r=s===void 0?1:s;if(!Wt(e)||!Wt(t)||!Wt(i))return null;var a=function(o){return{h:Mu(o.h),s:gt(o.s,0,100),v:gt(o.v,0,100),a:gt(o.a)}}({h:Number(e),s:Number(t),v:Number(i),a:Number(r)});return Bu(a)},"hsv"]]},Wl=function(n,e){for(var t=0;t<e.length;t++){var i=e[t][0](n);if(i)return[i,e[t][1]]}return[null,void 0]},ng=function(n){return typeof n=="string"?Wl(n.trim(),Lo.string):typeof n=="object"&&n!==null?Wl(n,Lo.object):[null,void 0]},Jr=function(n,e){var t=Qs(n);return{h:t.h,s:gt(t.s+100*e,0,100),l:t.l,a:t.a}},Qr=function(n){return(299*n.r+587*n.g+114*n.b)/1e3/255},jl=function(n,e){var t=Qs(n);return{h:t.h,s:t.s,l:gt(t.l+100*e,0,100),a:t.a}},Fo=function(){function n(e){this.parsed=ng(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return n.prototype.isValid=function(){return this.parsed!==null},n.prototype.brightness=function(){return qe(Qr(this.rgba),2)},n.prototype.isDark=function(){return Qr(this.rgba)<.5},n.prototype.isLight=function(){return Qr(this.rgba)>=.5},n.prototype.toHex=function(){return e=Kr(this.rgba),t=e.r,i=e.g,s=e.b,a=(r=e.a)<1?vn(qe(255*r)):"","#"+vn(t)+vn(i)+vn(s)+a;var e,t,i,s,r,a},n.prototype.toRgb=function(){return Kr(this.rgba)},n.prototype.toRgbString=function(){return e=Kr(this.rgba),t=e.r,i=e.g,s=e.b,(r=e.a)<1?"rgba("+t+", "+i+", "+s+", "+r+")":"rgb("+t+", "+i+", "+s+")";var e,t,i,s,r},n.prototype.toHsl=function(){return zl(Qs(this.rgba))},n.prototype.toHslString=function(){return e=zl(Qs(this.rgba)),t=e.h,i=e.s,s=e.l,(r=e.a)<1?"hsla("+t+", "+i+"%, "+s+"%, "+r+")":"hsl("+t+", "+i+"%, "+s+"%)";var e,t,i,s,r},n.prototype.toHsv=function(){return e=Du(this.rgba),{h:qe(e.h),s:qe(e.s),v:qe(e.v),a:qe(e.a,3)};var e},n.prototype.invert=function(){return Mt({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},n.prototype.saturate=function(e){return e===void 0&&(e=.1),Mt(Jr(this.rgba,e))},n.prototype.desaturate=function(e){return e===void 0&&(e=.1),Mt(Jr(this.rgba,-e))},n.prototype.grayscale=function(){return Mt(Jr(this.rgba,-1))},n.prototype.lighten=function(e){return e===void 0&&(e=.1),Mt(jl(this.rgba,e))},n.prototype.darken=function(e){return e===void 0&&(e=.1),Mt(jl(this.rgba,-e))},n.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},n.prototype.alpha=function(e){return typeof e=="number"?Mt({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):qe(this.rgba.a,3);var t},n.prototype.hue=function(e){var t=Qs(this.rgba);return typeof e=="number"?Mt({h:e,s:t.s,l:t.l,a:t.a}):qe(t.h)},n.prototype.isEqual=function(e){return this.toHex()===Mt(e).toHex()},n}(),Mt=function(n){return n instanceof Fo?n:new Fo(n)},Xl=[],rg=function(n){n.forEach(function(e){Xl.indexOf(e)<0&&(e(Fo,Lo),Xl.push(e))})};function og(n,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var s in t)i[t[s]]=s;var r={};n.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,l,h=i[this.toHex()];if(h)return h;if(a!=null&&a.closest){var u=this.toRgb(),c=1/0,d="black";if(!r.length)for(var f in t)r[f]=new n(t[f]).toRgb();for(var p in t){var m=(o=u,l=r[p],Math.pow(o.r-l.r,2)+Math.pow(o.g-l.g,2)+Math.pow(o.b-l.b,2));m<c&&(c=m,d=p)}return d}},e.string.push([function(a){var o=a.toLowerCase(),l=o==="transparent"?"#0000":t[o];return l?new n(l).toRgb():null},"name"])}rg([og]);const os=class Hn{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof Hn)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}isSourceEqual(e,t){const i=typeof e;if(i!==typeof t)return!1;if(i==="number"||i==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((s,r)=>s===t[r]);if(e!==null&&t!==null){const s=Object.keys(e),r=Object.keys(t);return s.length!==r.length?!1:s.every(a=>e[a]===t[a])}return e===t}toRgba(){const[e,t,i,s]=this._components;return{r:e,g:t,b:i,a:s}}toRgb(){const[e,t,i]=this._components;return{r:e,g:t,b:i}}toRgbaString(){const[e,t,i]=this.toUint8RgbArray();return`rgba(${e},${t},${i},${this.alpha})`}toUint8RgbArray(e){const[t,i,s]=this._components;return e=e??[],e[0]=Math.round(t*255),e[1]=Math.round(i*255),e[2]=Math.round(s*255),e}toRgbArray(e){e=e??[];const[t,i,s]=this._components;return e[0]=t,e[1]=i,e[2]=s,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[t,i,s,r]=Hn.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=i,this._components[2]*=s,this._components[3]*=r,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let i=this._int>>16&255,s=this._int>>8&255,r=this._int&255;return t&&(i=i*e+.5|0,s=s*e+.5|0,r=r*e+.5|0),(e*255<<24)+(i<<16)+(s<<8)+r}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,i,s]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(i*e)/e,this._components[2]=Math.round(s*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,i,s,r]=this._components;return e[0]=t,e[1]=i,e[2]=s,e[3]=r,e}normalize(e){let t,i,s,r;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const a=e;t=(a>>16&255)/255,i=(a>>8&255)/255,s=(a&255)/255,r=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,i,s,r=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,i,s,r=255]=e,t/=255,i/=255,s/=255,r/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const o=Hn.HEX_PATTERN.exec(e);o&&(e=`#${o[2]}`)}const a=Mt(e);a.isValid()&&({r:t,g:i,b:s,a:r}=a.rgba,t/=255,i/=255,s/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=i,this._components[2]=s,this._components[3]=r,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);const[e,t,i]=this._components;this._int=(e*255<<16)+(t*255<<8)+(i*255|0)}_clamp(e,t=0,i=1){return typeof e=="number"?Math.min(Math.max(e,t),i):(e.forEach((s,r)=>{e[r]=Math.min(Math.max(s,t),i)}),e)}};os.shared=new os,os.temp=new os,os.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Oe=os;function ag(n){return xe("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Oe.shared.setValue(n).toHex()}function lg(n){return xe("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Oe.shared.setValue(n).toNumber()}function hg(){const n=[],e=[];for(let i=0;i<32;i++)n[i]=i,e[i]=i;n[ce.NORMAL_NPM]=ce.NORMAL,n[ce.ADD_NPM]=ce.ADD,n[ce.SCREEN_NPM]=ce.SCREEN,e[ce.NORMAL]=ce.NORMAL_NPM,e[ce.ADD]=ce.ADD_NPM,e[ce.SCREEN]=ce.SCREEN_NPM;const t=[];return t.push(e),t.push(n),t}const Ou=hg();function Lu(n,e){return Ou[e?1:0][n]}function ug(n,e=null){const t=n*6;if(e=e||new Uint16Array(t),e.length!==t)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${t}`);for(let i=0,s=0;i<t;i+=6,s+=4)e[i+0]=s+0,e[i+1]=s+1,e[i+2]=s+2,e[i+3]=s+0,e[i+4]=s+2,e[i+5]=s+3;return e}function Fu(n){if(n.BYTES_PER_ELEMENT===4)return n instanceof Float32Array?"Float32Array":n instanceof Uint32Array?"Uint32Array":"Int32Array";if(n.BYTES_PER_ELEMENT===2){if(n instanceof Uint16Array)return"Uint16Array"}else if(n.BYTES_PER_ELEMENT===1&&n instanceof Uint8Array)return"Uint8Array";return null}function tr(n){return n+=n===0?1:0,--n,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n+1}function Yl(n){return!(n&n-1)&&!!n}function ql(n){let e=(n>65535?1:0)<<4;n>>>=e;let t=(n>255?1:0)<<3;return n>>>=t,e|=t,t=(n>15?1:0)<<2,n>>>=t,e|=t,t=(n>3?1:0)<<1,n>>>=t,e|=t,e|n>>1}function ys(n,e,t){const i=n.length;let s;if(e>=i||t===0)return;t=e+t>i?i-e:t;const r=i-t;for(s=e;s<r;++s)n[s]=n[s+t];n.length=r}function fi(n){return n===0?0:n<0?-1:1}let cg=0;function Vi(){return++cg}const No=class{constructor(n,e,t,i){this.left=n,this.top=e,this.right=t,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};No.EMPTY=new No(0,0,0,0);let Zl=No;const Kl={},Dt=Object.create(null),ni=Object.create(null);class dg{constructor(e,t,i){this._canvas=te.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||te.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Jl(n,e,t){for(let i=0,s=4*t*e;i<e;++i,s+=4)if(n[s+3]!==0)return!1;return!0}function Ql(n,e,t,i,s){const r=4*e;for(let a=i,o=i*r+4*t;a<=s;++a,o+=r)if(n[o+3]!==0)return!1;return!0}function fg(n){const{width:e,height:t}=n,i=n.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const s=i.getImageData(0,0,e,t).data;let r=0,a=0,o=e-1,l=t-1;for(;a<t&&Jl(s,e,a);)++a;if(a===t)return Zl.EMPTY;for(;Jl(s,e,l);)--l;for(;Ql(s,e,r,a,l);)++r;for(;Ql(s,e,o,a,l);)--o;return++o,++l,new Zl(r,a,o,l)}function pg(n){const e=fg(n),{width:t,height:i}=e;let s=null;if(!e.isEmpty()){const r=n.getContext("2d");if(r===null)throw new TypeError("Failed to get canvas 2D context");s=r.getImageData(e.left,e.top,t,i)}return{width:t,height:i,data:s}}function mg(n,e=globalThis.location){if(n.startsWith("data:"))return"";e=e||globalThis.location;const t=new URL(n,document.baseURI);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol?"anonymous":""}function Jt(n,e=1){var t;const i=(t=te.RETINA_PREFIX)==null?void 0:t.exec(n);return i?parseFloat(i[1]):e}var K=(n=>(n.Renderer="renderer",n.Application="application",n.RendererSystem="renderer-webgl-system",n.RendererPlugin="renderer-webgl-plugin",n.CanvasRendererSystem="renderer-canvas-system",n.CanvasRendererPlugin="renderer-canvas-plugin",n.Asset="asset",n.LoadParser="load-parser",n.ResolveParser="resolve-parser",n.CacheParser="cache-parser",n.DetectionParser="detection-parser",n))(K||{});const ko=n=>{if(typeof n=="function"||typeof n=="object"&&n.extension){if(!n.extension)throw new Error("Extension class must have an extension object");n={...typeof n.extension!="object"?{type:n.extension}:n.extension,ref:n}}if(typeof n=="object")n={...n};else throw new Error("Invalid extension type");return typeof n.type=="string"&&(n.type=[n.type]),n},$l=(n,e)=>ko(n).priority??e,se={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...n){return n.map(ko).forEach(e=>{e.type.forEach(t=>{var i,s;return(s=(i=this._removeHandlers)[t])==null?void 0:s.call(i,e)})}),this},add(...n){return n.map(ko).forEach(e=>{e.type.forEach(t=>{var i,s;const r=this._addHandlers,a=this._queue;r[t]?(i=r[t])==null||i.call(r,e):(a[t]=a[t]||[],(s=a[t])==null||s.push(e))})}),this},handle(n,e,t){var i;const s=this._addHandlers,r=this._removeHandlers;if(s[n]||r[n])throw new Error(`Extension type ${n} already has a handler`);s[n]=e,r[n]=t;const a=this._queue;return a[n]&&((i=a[n])==null||i.forEach(o=>e(o)),delete a[n]),this},handleByMap(n,e){return this.handle(n,t=>{t.name&&(e[t.name]=t.ref)},t=>{t.name&&delete e[t.name]})},handleByList(n,e,t=-1){return this.handle(n,i=>{e.includes(i.ref)||(e.push(i.ref),e.sort((s,r)=>$l(r,t)-$l(s,t)))},i=>{const s=e.indexOf(i.ref);s!==-1&&e.splice(s,1)})}};class Uo{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const gg=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function vg(n){let e="";for(let t=0;t<n;++t)t>0&&(e+=`
else `),t<n-1&&(e+=`if(test == ${t}.0){}`);return e}function yg(n,e){if(n===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const t=e.createShader(e.FRAGMENT_SHADER);for(;;){const i=gg.replace(/%forloop%/gi,vg(n));if(e.shaderSource(t,i),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))n=n/2|0;else break}return n}const $r=0,eo=1,to=2,io=3,so=4,no=5;class zt{constructor(){this.data=0,this.blendMode=ce.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<$r)}set blend(e){!!(this.data&1<<$r)!==e&&(this.data^=1<<$r)}get offsets(){return!!(this.data&1<<eo)}set offsets(e){!!(this.data&1<<eo)!==e&&(this.data^=1<<eo)}get culling(){return!!(this.data&1<<to)}set culling(e){!!(this.data&1<<to)!==e&&(this.data^=1<<to)}get depthTest(){return!!(this.data&1<<io)}set depthTest(e){!!(this.data&1<<io)!==e&&(this.data^=1<<io)}get depthMask(){return!!(this.data&1<<no)}set depthMask(e){!!(this.data&1<<no)!==e&&(this.data^=1<<no)}get clockwiseFrontFace(){return!!(this.data&1<<so)}set clockwiseFrontFace(e){!!(this.data&1<<so)!==e&&(this.data^=1<<so)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==ce.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new zt;return e.depthTest=!1,e.blend=!0,e}}zt.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const Ho=[];function Nu(n,e){if(!n)return null;let t="";if(typeof n=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(n);i&&(t=i[1].toLowerCase())}for(let i=Ho.length-1;i>=0;--i){const s=Ho[i];if(s.test&&s.test(n,t))return new s(n,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class St{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,i,s,r,a,o,l){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:u}=this;this._aliasCount++;for(let c=0,d=u.length;c<d;c++)u[c][h](e,t,i,s,r,a,o,l);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(St.prototype,{dispatch:{value:St.prototype.emit},run:{value:St.prototype.emit}});class rn{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new St("setRealSize"),this.onUpdate=new St("update"),this.onError=new St("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class _r extends rn{constructor(e,t){const{width:i,height:s}=t||{};if(!i||!s)throw new Error("BufferResource width or height invalid");super(i,s),this.data=e,this.unpackAlignment=t.unpackAlignment??4}upload(e,t,i){const s=e.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===at.UNPACK);const r=t.realWidth,a=t.realHeight;return i.width===r&&i.height===a?s.texSubImage2D(t.target,0,0,0,r,a,t.format,i.type,this.data):(i.width=r,i.height=a,s.texImage2D(t.target,0,i.internalFormat,r,a,0,t.format,i.type,this.data)),!0}dispose(){this.data=null}static test(e){return e===null||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const xg={scaleMode:jt.NEAREST,alphaMode:at.NPM},Go=class as extends ln{constructor(e=null,t=null){super(),t=Object.assign({},as.defaultOptions,t);const{alphaMode:i,mipmap:s,anisotropicLevel:r,scaleMode:a,width:o,height:l,wrapMode:h,format:u,type:c,target:d,resolution:f,resourceOptions:p}=t;e&&!(e instanceof rn)&&(e=Nu(e,p),e.internal=!0),this.resolution=f||te.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((l||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=r,this._wrapMode=h,this._scaleMode=a,this.format=u,this.type=c,this.target=d,this.alphaMode=i,this.uid=Vi(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&l>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let i;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,i=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,i=!0),i&&this.dirtyStyleId++,this}setSize(e,t,i){return i=i||this.resolution,this.setRealSize(e*i,t*i,i)}setRealSize(e,t,i){return this.resolution=i||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Yl(this.realWidth)&&Yl(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ni[this.cacheId],delete Dt[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),as.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,i=te.STRICT_TEXTURE_CACHE){const s=typeof e=="string";let r=null;if(s)r=e;else{if(!e._pixiId){const o=t?.pixiIdPrefix||"pixiid";e._pixiId=`${o}_${Vi()}`}r=e._pixiId}let a=ni[r];if(s&&i&&!a)throw new Error(`The cacheId "${r}" does not exist in BaseTextureCache.`);return a||(a=new as(e,t),a.cacheId=r,as.addToCache(a,r)),a}static fromBuffer(e,t,i,s){e=e||new Float32Array(t*i*4);const r=new _r(e,{width:t,height:i,...s?.resourceOptions});let a,o;return e instanceof Float32Array?(a=j.RGBA,o=oe.FLOAT):e instanceof Int32Array?(a=j.RGBA_INTEGER,o=oe.INT):e instanceof Uint32Array?(a=j.RGBA_INTEGER,o=oe.UNSIGNED_INT):e instanceof Int16Array?(a=j.RGBA_INTEGER,o=oe.SHORT):e instanceof Uint16Array?(a=j.RGBA_INTEGER,o=oe.UNSIGNED_SHORT):e instanceof Int8Array?(a=j.RGBA,o=oe.BYTE):(a=j.RGBA,o=oe.UNSIGNED_BYTE),r.internal=!0,new as(r,Object.assign({},xg,{type:o,format:a},s))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),ni[t]&&ni[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),ni[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=ni[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete ni[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete ni[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};Go.defaultOptions={mipmap:Gt.POW2,anisotropicLevel:0,scaleMode:jt.LINEAR,wrapMode:mi.CLAMP,alphaMode:at.UNPACK,target:gs.TEXTURE_2D,format:j.RGBA,type:oe.UNSIGNED_BYTE},Go._globalBatch=0;let ge=Go;class zo{constructor(){this.texArray=null,this.blend=0,this.type=kt.TRIANGLES,this.start=0,this.size=0,this.data=null}}let _g=0;class ze{constructor(e,t=!0,i=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=t,this.id=_g++,this.disposeRunner=new St("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?Ut.ELEMENT_ARRAY_BUFFER:Ut.ARRAY_BUFFER}get index(){return this.type===Ut.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new ze(e)}}class ir{constructor(e,t=0,i=!1,s=oe.FLOAT,r,a,o,l=1){this.buffer=e,this.size=t,this.normalized=i,this.type=s,this.stride=r,this.start=a,this.instance=o,this.divisor=l}destroy(){this.buffer=null}static from(e,t,i,s,r){return new ir(e,t,i,s,r)}}const wg={Float32Array,Uint32Array,Int32Array,Uint8Array};function Tg(n,e){let t=0,i=0;const s={};for(let l=0;l<n.length;l++)i+=e[l],t+=n[l].length;const r=new ArrayBuffer(t*4);let a=null,o=0;for(let l=0;l<n.length;l++){const h=e[l],u=n[l],c=Fu(u);s[c]||(s[c]=new wg[c](r)),a=s[c];for(let d=0;d<u.length;d++){const f=(d/h|0)*i+o,p=d%h;a[f+p]=u[d]}o+=h}return new Float32Array(r)}const eh={5126:4,5123:2,5121:1};let Eg=0;const bg={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class vi{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=Eg++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new St("disposeGeometry"),this.refCount=0}addAttribute(e,t,i=0,s=!1,r,a,o,l=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof ze||(t instanceof Array&&(t=new Float32Array(t)),t=new ze(t));const h=e.split("|");if(h.length>1){for(let c=0;c<h.length;c++)this.addAttribute(h[c],t,i,s,r);return this}let u=this.buffers.indexOf(t);return u===-1&&(this.buffers.push(t),u=this.buffers.length-1),this.attributes[e]=new ir(u,i,s,r,a,o,l),this.instanced=this.instanced||l,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof ze||(e instanceof Array&&(e=new Uint16Array(e)),e=new ze(e)),e.type=Ut.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const e=[],t=[],i=new ze;let s;for(s in this.attributes){const r=this.attributes[s],a=this.buffers[r.buffer];e.push(a.data),t.push(r.size*eh[r.type]/4),r.buffer=0}for(i.data=Tg(e,t),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new vi;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new ze(this.buffers[t].data.slice(0));for(const t in this.attributes){const i=this.attributes[t];e.attributes[t]=new ir(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=Ut.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new vi,i=[],s=[],r=[];let a;for(let o=0;o<e.length;o++){a=e[o];for(let l=0;l<a.buffers.length;l++)s[l]=s[l]||0,s[l]+=a.buffers[l].data.length,r[l]=0}for(let o=0;o<a.buffers.length;o++)i[o]=new bg[Fu(a.buffers[o].data)](s[o]),t.buffers[o]=new ze(i[o]);for(let o=0;o<e.length;o++){a=e[o];for(let l=0;l<a.buffers.length;l++)i[l].set(a.buffers[l].data,r[l]),r[l]+=a.buffers[l].data.length}if(t.attributes=a.attributes,a.indexBuffer){t.indexBuffer=t.buffers[a.buffers.indexOf(a.indexBuffer)],t.indexBuffer.type=Ut.ELEMENT_ARRAY_BUFFER;let o=0,l=0,h=0,u=0;for(let c=0;c<a.buffers.length;c++)if(a.buffers[c]!==a.indexBuffer){u=c;break}for(const c in a.attributes){const d=a.attributes[c];(d.buffer|0)===u&&(l+=d.size*eh[d.type]/4)}for(let c=0;c<e.length;c++){const d=e[c].indexBuffer.data;for(let f=0;f<d.length;f++)t.indexBuffer.data[f+h]+=o;o+=e[c].buffers[u].data.length/l,h+=d.length}}return t}}class ku extends vi{constructor(e=!1){super(),this._buffer=new ze(null,e,!1),this._indexBuffer=new ze(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,oe.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,oe.FLOAT).addAttribute("aColor",this._buffer,4,!0,oe.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,oe.FLOAT).addIndex(this._indexBuffer)}}const sr=Math.PI*2,Sg=180/Math.PI,Ag=Math.PI/180;var $e=(n=>(n[n.POLY=0]="POLY",n[n.RECT=1]="RECT",n[n.CIRC=2]="CIRC",n[n.ELIP=3]="ELIP",n[n.RREC=4]="RREC",n))($e||{});class Te{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new Te(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}}Te.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const yn=[new Te,new Te,new Te,new Te];class ve{constructor(e=0,t=0,i=0,s=0){this.x=Number(e),this.y=Number(t),this.width=Number(i),this.height=Number(s),this.type=$e.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new ve(0,0,0,0)}clone(){return new ve(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){const B=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=B)return!1;const H=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>H}const i=this.left,s=this.right,r=this.top,a=this.bottom;if(s<=i||a<=r)return!1;const o=yn[0].set(e.left,e.top),l=yn[1].set(e.left,e.bottom),h=yn[2].set(e.right,e.top),u=yn[3].set(e.right,e.bottom);if(h.x<=o.x||l.y<=o.y)return!1;const c=Math.sign(t.a*t.d-t.b*t.c);if(c===0||(t.apply(o,o),t.apply(l,l),t.apply(h,h),t.apply(u,u),Math.max(o.x,l.x,h.x,u.x)<=i||Math.min(o.x,l.x,h.x,u.x)>=s||Math.max(o.y,l.y,h.y,u.y)<=r||Math.min(o.y,l.y,h.y,u.y)>=a))return!1;const d=c*(l.y-o.y),f=c*(o.x-l.x),p=d*i+f*r,m=d*s+f*r,v=d*i+f*a,g=d*s+f*a;if(Math.max(p,m,v,g)<=d*o.x+f*o.y||Math.min(p,m,v,g)>=d*u.x+f*u.y)return!1;const T=c*(o.y-h.y),w=c*(h.x-o.x),E=T*i+w*r,P=T*s+w*r,C=T*i+w*a,D=T*s+w*a;return!(Math.max(E,P,C,D)<=T*o.x+w*o.y||Math.min(E,P,C,D)>=T*u.x+w*u.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this}fit(e){const t=Math.max(this.x,e.x),i=Math.min(this.x+this.width,e.x+e.width),s=Math.max(this.y,e.y),r=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(i-t,0),this.y=s,this.height=Math.max(r-s,0),this}ceil(e=1,t=.001){const i=Math.ceil((this.x+this.width-t)*e)/e,s=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=i-this.x,this.height=s-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),i=Math.max(this.x+this.width,e.x+e.width),s=Math.min(this.y,e.y),r=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=i-t,this.y=s,this.height=r-s,this}}ve.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class wr{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.radius=i,this.type=$e.CIRC}clone(){return new wr(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const i=this.radius*this.radius;let s=this.x-e,r=this.y-t;return s*=s,r*=r,s+r<=i}getBounds(){return new ve(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}wr.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Tr{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.width=i,this.height=s,this.type=$e.ELIP}clone(){return new Tr(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let i=(e-this.x)/this.width,s=(t-this.y)/this.height;return i*=i,s*=s,i+s<=1}getBounds(){return new ve(this.x-this.width,this.y-this.height,this.width,this.height)}}Tr.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Hi{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if(typeof t[0]!="number"){const i=[];for(let s=0,r=t.length;s<r;s++)i.push(t[s].x,t[s].y);t=i}this.points=t,this.type=$e.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),t=new Hi(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let i=!1;const s=this.points.length/2;for(let r=0,a=s-1;r<s;a=r++){const o=this.points[r*2],l=this.points[r*2+1],h=this.points[a*2],u=this.points[a*2+1];l>t!=u>t&&e<(h-o)*((t-l)/(u-l))+o&&(i=!i)}return i}}Hi.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((n,e)=>`${n}, ${e}`,"")}]`};class Er{constructor(e=0,t=0,i=0,s=0,r=20){this.x=e,this.y=t,this.width=i,this.height=s,this.radius=r,this.type=$e.RREC}clone(){return new Er(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+i&&t<=this.y+this.height-i||e>=this.x+i&&e<=this.x+this.width-i)return!0;let s=e-(this.x+i),r=t-(this.y+i);const a=i*i;if(s*s+r*r<=a||(s=e-(this.x+this.width-i),s*s+r*r<=a)||(r=t-(this.y+this.height-i),s*s+r*r<=a)||(s=e-(this.x+i),s*s+r*r<=a))return!0}return!1}}Er.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Fe{constructor(e=1,t=0,i=0,s=1,r=0,a=0){this.array=null,this.a=e,this.b=t,this.c=i,this.d=s,this.tx=r,this.ty=a}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,i,s,r,a){return this.a=e,this.b=t,this.c=i,this.d=s,this.tx=r,this.ty=a,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const i=t||this.array;return e?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(e,t){t=t||new Te;const i=e.x,s=e.y;return t.x=this.a*i+this.c*s+this.tx,t.y=this.b*i+this.d*s+this.ty,t}applyInverse(e,t){t=t||new Te;const i=1/(this.a*this.d+this.c*-this.b),s=e.x,r=e.y;return t.x=this.d*i*s+-this.c*i*r+(this.ty*this.c-this.tx*this.d)*i,t.y=this.a*i*r+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),s=this.a,r=this.c,a=this.tx;return this.a=s*t-this.b*i,this.b=s*i+this.b*t,this.c=r*t-this.d*i,this.d=r*i+this.d*t,this.tx=a*t-this.ty*i,this.ty=a*i+this.ty*t,this}append(e){const t=this.a,i=this.b,s=this.c,r=this.d;return this.a=e.a*t+e.b*s,this.b=e.a*i+e.b*r,this.c=e.c*t+e.d*s,this.d=e.c*i+e.d*r,this.tx=e.tx*t+e.ty*s+this.tx,this.ty=e.tx*i+e.ty*r+this.ty,this}setTransform(e,t,i,s,r,a,o,l,h){return this.a=Math.cos(o+h)*r,this.b=Math.sin(o+h)*r,this.c=-Math.sin(o-l)*a,this.d=Math.cos(o-l)*a,this.tx=e-(i*this.a+s*this.c),this.ty=t-(i*this.b+s*this.d),this}prepend(e){const t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const i=this.a,s=this.c;this.a=i*e.a+this.b*e.c,this.b=i*e.b+this.b*e.d,this.c=s*e.a+this.d*e.c,this.d=s*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,i=this.b,s=this.c,r=this.d,a=e.pivot,o=-Math.atan2(-s,r),l=Math.atan2(i,t),h=Math.abs(o+l);return h<1e-5||Math.abs(sr-h)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=l),e.scale.x=Math.sqrt(t*t+i*i),e.scale.y=Math.sqrt(s*s+r*r),e.position.x=this.tx+(a.x*t+a.y*s),e.position.y=this.ty+(a.x*i+a.y*r),e}invert(){const e=this.a,t=this.b,i=this.c,s=this.d,r=this.tx,a=e*s-t*i;return this.a=s/a,this.b=-t/a,this.c=-i/a,this.d=e/a,this.tx=(i*this.ty-s*r)/a,this.ty=-(e*this.ty-t*r)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new Fe;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new Fe}static get TEMP_MATRIX(){return new Fe}}Fe.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Si=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ai=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Ri=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Pi=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Vo=[],Uu=[],xn=Math.sign;function Rg(){for(let n=0;n<16;n++){const e=[];Vo.push(e);for(let t=0;t<16;t++){const i=xn(Si[n]*Si[t]+Ri[n]*Ai[t]),s=xn(Ai[n]*Si[t]+Pi[n]*Ai[t]),r=xn(Si[n]*Ri[t]+Ri[n]*Pi[t]),a=xn(Ai[n]*Ri[t]+Pi[n]*Pi[t]);for(let o=0;o<16;o++)if(Si[o]===i&&Ai[o]===s&&Ri[o]===r&&Pi[o]===a){e.push(o);break}}}for(let n=0;n<16;n++){const e=new Fe;e.set(Si[n],Ai[n],Ri[n],Pi[n],0,0),Uu.push(e)}}Rg();const ke={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:n=>Si[n],uY:n=>Ai[n],vX:n=>Ri[n],vY:n=>Pi[n],inv:n=>n&8?n&15:-n&7,add:(n,e)=>Vo[n][e],sub:(n,e)=>Vo[n][ke.inv(e)],rotate180:n=>n^4,isVertical:n=>(n&3)===2,byDirection:(n,e)=>Math.abs(n)*2<=Math.abs(e)?e>=0?ke.S:ke.N:Math.abs(e)*2<=Math.abs(n)?n>0?ke.E:ke.W:e>0?n>0?ke.SE:ke.SW:n>0?ke.NE:ke.NW,matrixAppendRotationInv:(n,e,t=0,i=0)=>{const s=Uu[ke.inv(e)];s.tx=t,s.ty=i,n.append(s)}};class Yt{constructor(e,t,i=0,s=0){this._x=i,this._y=s,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new Yt(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}Yt.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Wo=class{constructor(){this.worldTransform=new Fe,this.localTransform=new Fe,this.position=new Yt(this.onChange,this,0,0),this.scale=new Yt(this.onChange,this,1,1),this.pivot=new Yt(this.onChange,this,0,0),this.skew=new Yt(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const n=this.localTransform;this._localID!==this._currentLocalID&&(n.a=this._cx*this.scale.x,n.b=this._sx*this.scale.x,n.c=this._cy*this.scale.y,n.d=this._sy*this.scale.y,n.tx=this.position.x-(this.pivot.x*n.a+this.pivot.y*n.c),n.ty=this.position.y-(this.pivot.x*n.b+this.pivot.y*n.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(n){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==n._worldID){const t=n.worldTransform,i=this.worldTransform;i.a=e.a*t.a+e.b*t.c,i.b=e.a*t.b+e.b*t.d,i.c=e.c*t.a+e.d*t.c,i.d=e.c*t.b+e.d*t.d,i.tx=e.tx*t.a+e.ty*t.c+t.tx,i.ty=e.tx*t.b+e.ty*t.d+t.ty,this._parentID=n._worldID,this._worldID++}}setFromMatrix(n){n.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(n){this._rotation!==n&&(this._rotation=n,this.updateSkew())}};Wo.IDENTITY=new Wo;let Ma=Wo;Ma.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var Pg=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,Cg=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function th(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}function ro(n){const e=new Array(n);for(let t=0;t<e.length;t++)e[t]=!1;return e}function Hu(n,e){switch(n){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return ro(2*e);case"bvec3":return ro(3*e);case"bvec4":return ro(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const xs=[{test:n=>n.type==="float"&&n.size===1&&!n.isArray,code:n=>`
            if(uv["${n}"] !== ud["${n}"].value)
            {
                ud["${n}"].value = uv["${n}"]
                gl.uniform1f(ud["${n}"].location, uv["${n}"])
            }
            `},{test:(n,e)=>(n.type==="sampler2D"||n.type==="samplerCube"||n.type==="sampler2DArray")&&n.size===1&&!n.isArray&&(e==null||e.castToBaseTexture!==void 0),code:n=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${n}"], t);

            if(ud["${n}"].value !== t)
            {
                ud["${n}"].value = t;
                gl.uniform1i(ud["${n}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(n,e)=>n.type==="mat3"&&n.size===1&&!n.isArray&&e.a!==void 0,code:n=>`
            gl.uniformMatrix3fv(ud["${n}"].location, false, uv["${n}"].toArray(true));
            `,codeUbo:n=>`
                var ${n}_matrix = uv.${n}.toArray(true);

                data[offset] = ${n}_matrix[0];
                data[offset+1] = ${n}_matrix[1];
                data[offset+2] = ${n}_matrix[2];
        
                data[offset + 4] = ${n}_matrix[3];
                data[offset + 5] = ${n}_matrix[4];
                data[offset + 6] = ${n}_matrix[5];
        
                data[offset + 8] = ${n}_matrix[6];
                data[offset + 9] = ${n}_matrix[7];
                data[offset + 10] = ${n}_matrix[8];
            `},{test:(n,e)=>n.type==="vec2"&&n.size===1&&!n.isArray&&e.x!==void 0,code:n=>`
                cv = ud["${n}"].value;
                v = uv["${n}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${n}"].location, v.x, v.y);
                }`,codeUbo:n=>`
                v = uv.${n};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:n=>n.type==="vec2"&&n.size===1&&!n.isArray,code:n=>`
                cv = ud["${n}"].value;
                v = uv["${n}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${n}"].location, v[0], v[1]);
                }
            `},{test:(n,e)=>n.type==="vec4"&&n.size===1&&!n.isArray&&e.width!==void 0,code:n=>`
                cv = ud["${n}"].value;
                v = uv["${n}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${n}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:n=>`
                    v = uv.${n};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(n,e)=>n.type==="vec4"&&n.size===1&&!n.isArray&&e.red!==void 0,code:n=>`
                cv = ud["${n}"].value;
                v = uv["${n}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${n}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:n=>`
                    v = uv.${n};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(n,e)=>n.type==="vec3"&&n.size===1&&!n.isArray&&e.red!==void 0,code:n=>`
                cv = ud["${n}"].value;
                v = uv["${n}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${n}"].location, v.red, v.green, v.blue)
                }`,codeUbo:n=>`
                    v = uv.${n};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:n=>n.type==="vec4"&&n.size===1&&!n.isArray,code:n=>`
                cv = ud["${n}"].value;
                v = uv["${n}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${n}"].location, v[0], v[1], v[2], v[3])
                }`}],Ig={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Mg={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Dg(n,e){var t;const i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const s in n.uniforms){const r=e[s];if(!r){((t=n.uniforms[s])==null?void 0:t.group)===!0&&(n.uniforms[s].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.${s}, syncData);
                    `));continue}const a=n.uniforms[s];let o=!1;for(let l=0;l<xs.length;l++)if(xs[l].test(r,a)){i.push(xs[l].code(s,a)),o=!0;break}if(!o){const l=(r.size===1&&!r.isArray?Ig:Mg)[r.type].replace("location",`ud["${s}"].location`);i.push(`
            cu = ud["${s}"];
            cv = cu.value;
            v = uv["${s}"];
            ${l};`)}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}const Gu={};let Fs=Gu;function Bg(){if(Fs===Gu||Fs!=null&&Fs.isContextLost()){const n=te.ADAPTER.createCanvas();let e;te.PREFER_ENV>=ji.WEBGL2&&(e=n.getContext("webgl2",{})),e||(e=n.getContext("webgl",{})||n.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),Fs=e}return Fs}let _n;function Og(){if(!_n){_n=mt.MEDIUM;const n=Bg();if(n&&n.getShaderPrecisionFormat){const e=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT);e&&(_n=e.precision?mt.HIGH:mt.MEDIUM)}}return _n}function ih(n,e){const t=n.getShaderSource(e).split(`
`).map((h,u)=>`${u}: ${h}`),i=n.getShaderInfoLog(e),s=i.split(`
`),r={},a=s.map(h=>parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(h=>h&&!r[h]?(r[h]=!0,!0):!1),o=[""];a.forEach(h=>{t[h-1]=`%c${t[h-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=t.join(`
`);o[0]=l,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function Lg(n,e,t,i){n.getProgramParameter(e,n.LINK_STATUS)||(n.getShaderParameter(t,n.COMPILE_STATUS)||ih(n,t),n.getShaderParameter(i,n.COMPILE_STATUS)||ih(n,i),console.error("PixiJS Error: Could not initialize shader."),n.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",n.getProgramInfoLog(e)))}const Fg={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function zu(n){return Fg[n]}let wn=null;const sh={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Vu(n,e){if(!wn){const t=Object.keys(sh);wn={};for(let i=0;i<t.length;++i){const s=t[i];wn[n[s]]=sh[s]}}return wn[e]}function nh(n,e,t){if(n.substring(0,9)!=="precision"){let i=e;return e===mt.HIGH&&t!==mt.HIGH&&(i=mt.MEDIUM),`precision ${i} float;
${n}`}else if(t!==mt.HIGH&&n.substring(0,15)==="precision highp")return n.replace("precision highp","precision mediump");return n}let Ns;function Ng(){if(typeof Ns=="boolean")return Ns;try{Ns=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Ns=!1}return Ns}let kg=0;const Tn={},jo=class ls{constructor(e,t,i="pixi-shader",s={}){this.extra={},this.id=kg++,this.vertexSrc=e||ls.defaultVertexSrc,this.fragmentSrc=t||ls.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),Tn[i]?(Tn[i]++,i+=`-${Tn[i]}`):Tn[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=nh(this.vertexSrc,ls.defaultVertexPrecision,mt.HIGH),this.fragmentSrc=nh(this.fragmentSrc,ls.defaultFragmentPrecision,Og())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return Cg}static get defaultFragmentSrc(){return Pg}static from(e,t,i){const s=e+t;let r=Kl[s];return r||(Kl[s]=r=new ls(e,t,i)),r}};jo.defaultVertexPrecision=mt.HIGH,jo.defaultFragmentPrecision=Xt.apple.device?mt.HIGH:mt.MEDIUM;let qt=jo,Ug=0;class At{constructor(e,t,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Ug++,this.static=!!t,this.ubo=!!i,e instanceof ze?(this.buffer=e,this.buffer.type=Ut.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new ze(new Float32Array(1)),this.buffer.type=Ut.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,i){if(!this.ubo)this.uniforms[e]=new At(t,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,t,i){return new At(e,t,i)}static uboFrom(e,t){return new At(e,t??!0,!0)}}class Ht{constructor(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof At?this.uniformGroup=t:this.uniformGroup=new At(t):this.uniformGroup=new At({}),this.disposeRunner=new St("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const i in t.uniforms){const s=t.uniforms[i];if(s.group===!0&&this.checkUniformExists(e,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,i){const s=qt.from(e,t);return new Ht(s,i)}}class Hg{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const i=new Int32Array(e);for(let r=0;r<e;r++)i[r]=r;this.defaultGroupCache[e]=At.from({uSamplers:i},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${e}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new qt(this.vertexSrc,s)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new Fe,default:this.defaultGroupCache[e]};return new Ht(this.programCache[e],t)}generateSampleSrc(e){let t="";t+=`
`,t+=`
`;for(let i=0;i<e;i++)i>0&&(t+=`
else `),i<e-1&&(t+=`if(vTextureId < ${i}.5)`),t+=`
{`,t+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,t+=`
}`;return t+=`
`,t+=`
`,t}}class Xo{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}function Gg(){return!Xt.apple.device}function zg(n){let e=!0;const t=te.ADAPTER.getNavigator();if(Xt.tablet||Xt.phone){if(Xt.apple.device){const i=t.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(e=!1)}if(Xt.android.device){const i=t.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(e=!1)}}return e?n:4}class br{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}var Vg=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Wg=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const Vs=class _t extends br{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=ku,this.vertexSize=6,this.state=zt.for2d(),this.size=_t.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??zg(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??Gg(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return xe("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return Wg}static get defaultFragmentTemplate(){return Vg}setShaderGenerator({vertex:e=_t.defaultVertexSrc,fragment:t=_t.defaultFragmentTemplate}={}){this.shaderGenerator=new Hg(e,t)}contextChange(){const e=this.renderer.gl;te.PREFER_ENV===ji.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),_t.defaultMaxTextures),this.maxTextures=yg(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=_t,i=this.size/4,s=Math.floor(i/this.maxTextures)+1;for(;e.length<i;)e.push(new zo);for(;t.length<s;)t.push(new Xo);for(let r=0;r<this.maxTextures;r++)this._tempBoundTextures[r]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,i=_t._textureArrayPool,s=this.renderer.batch,r=this._tempBoundTextures,a=this.renderer.textureGC.count;let o=++ge._globalBatch,l=0,h=i[0],u=0;s.copyBoundTextures(r,t);for(let c=0;c<this._bufferSize;++c){const d=e[c];e[c]=null,d._batchEnabled!==o&&(h.count>=t&&(s.boundArray(h,r,o,t),this.buildDrawCalls(h,u,c),u=c,h=i[++l],++o),d._batchEnabled=o,d.touched=a,h.elements[h.count++]=d)}h.count>0&&(s.boundArray(h,r,o,t),this.buildDrawCalls(h,u,this._bufferSize),++l,++o);for(let c=0;c<r.length;c++)r[c]=null;ge._globalBatch=o}buildDrawCalls(e,t,i){const{_bufferedElements:s,_attributeBuffer:r,_indexBuffer:a,vertexSize:o}=this,l=_t._drawCallPool;let h=this._dcIndex,u=this._aIndex,c=this._iIndex,d=l[h];d.start=this._iIndex,d.texArray=e;for(let f=t;f<i;++f){const p=s[f],m=p._texture.baseTexture,v=Ou[m.alphaMode?1:0][p.blendMode];s[f]=null,t<f&&d.blend!==v&&(d.size=c-d.start,t=f,d=l[++h],d.texArray=e,d.start=c),this.packInterleavedGeometry(p,r,a,u,c),u+=p.vertexData.length/2*o,c+=p.indices.length,d.blend=v}t<i&&(d.size=c-d.start,++h),this._dcIndex=h,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(e){const t=this.renderer.texture;for(let i=0;i<e.count;i++)t.bind(e.elements[i],e.ids[i]),e.elements[i]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:i}=this;_t.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:i}=this.renderer,s=_t._drawCallPool;let r=null;for(let a=0;a<e;a++){const{texArray:o,type:l,size:h,start:u,blend:c}=s[a];r!==o&&(r=o,this.bindAndClearTexArray(o)),this.state.blendMode=c,i.set(this.state),t.drawElements(l,h,t.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),_t.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=tr(Math.ceil(e/8)),i=ql(t),s=t*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._aBuffers[s];return r||(this._aBuffers[s]=r=new Uo(s*this.vertexSize*4)),r}getIndexBuffer(e){const t=tr(Math.ceil(e/12)),i=ql(t),s=t*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._iBuffers[i];return r||(this._iBuffers[i]=r=new Uint16Array(s)),r}packInterleavedGeometry(e,t,i,s,r){const{uint32View:a,float32View:o}=t,l=s/this.vertexSize,h=e.uvs,u=e.indices,c=e.vertexData,d=e._texture.baseTexture._batchLocation,f=Math.min(e.worldAlpha,1),p=Oe.shared.setValue(e._tintRGB).toPremultiplied(f,e._texture.baseTexture.alphaMode>0);for(let m=0;m<c.length;m+=2)o[s++]=c[m],o[s++]=c[m+1],o[s++]=h[m],o[s++]=h[m+1],a[s++]=p,o[s++]=d;for(let m=0;m<u.length;m++)i[r++]=l+u[m]}};Vs.defaultBatchSize=4096,Vs.extension={name:"batch",type:K.RendererPlugin},Vs._drawCallPool=[],Vs._textureArrayPool=[];let Ci=Vs;se.add(Ci);var jg=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Xg=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Yo=class Ws extends Ht{constructor(e,t,i){const s=qt.from(e||Ws.defaultVertexSrc,t||Ws.defaultFragmentSrc);super(s,i),this.padding=0,this.resolution=Ws.defaultResolution,this.multisample=Ws.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new zt}apply(e,t,i,s,r){e.applyFilter(this,t,i,s)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return Xg}static get defaultFragmentSrc(){return jg}};Yo.defaultResolution=1,Yo.defaultMultisample=Ve.NONE;let nt=Yo;class nr{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Oe(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:t,background:i,backgroundAlpha:s}=e,r=i??t;r!==void 0&&(this.color=r),this.alpha=s}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}nr.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},nr.extension={type:[K.RendererSystem,K.CanvasRendererSystem],name:"background"};se.add(nr);class Wu{constructor(e){this.renderer=e,this.emptyRenderer=new br(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:i}=this.renderer.texture;for(let s=t-1;s>=0;--s)e[s]=i[s]||null,e[s]&&(e[s]._batchLocation=s)}boundArray(e,t,i,s){const{elements:r,ids:a,count:o}=e;let l=0;for(let h=0;h<o;h++){const u=r[h],c=u._batchLocation;if(c>=0&&c<s&&t[c]===u){a[h]=c;continue}for(;l<s;){const d=t[l];if(d&&d._batchEnabled===i&&d._batchLocation===l){l++;continue}a[h]=l,u._batchLocation=l,t[l]=u;break}}}destroy(){this.renderer=null}}Wu.extension={type:K.RendererSystem,name:"batch"};se.add(Wu);let rh=0;class rr{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=rh++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,i=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:i,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=rh++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;t.addEventListener!==void 0&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let i;if(te.PREFER_ENV>=ji.WEBGL2&&(i=e.getContext("webgl2",t)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=i||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}rr.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},rr.extension={type:K.RendererSystem,name:"context"};se.add(rr);class qo{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new St("disposeFramebuffer"),this.multisample=Ve.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new ge(null,{scaleMode:jt.NEAREST,resolution:1,mipmap:Gt.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new ge(null,{scaleMode:jt.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Gt.OFF,format:j.DEPTH_COMPONENT,type:oe.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw new Error("Framebuffer width and height must not be zero");if(!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const s=this.colorTextures[i],r=s.resolution;s.setSize(e/r,t/r)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(e/i,t/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class ju extends ge{constructor(e={}){if(typeof e=="number"){const t=arguments[0],i=arguments[1],s=arguments[2],r=arguments[3];e={width:t,height:i,scaleMode:s,resolution:r}}e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=Ve.NONE),super(null,e),this.mipmap=Gt.OFF,this.valid=!0,this._clear=new Oe([0,0,0,0]),this.framebuffer=new qo(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Qt extends rn{constructor(e){const t=e,i=t.naturalWidth||t.videoWidth||t.displayWidth||t.width,s=t.naturalHeight||t.videoHeight||t.displayHeight||t.height;super(i,s),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,i){i===void 0&&!t.startsWith("data:")?e.crossOrigin=mg(t):i!==!1&&(e.crossOrigin=typeof i=="string"?i:"anonymous")}upload(e,t,i,s){const r=e.gl,a=t.realWidth,o=t.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===at.UNPACK),!this.noSubImage&&t.target===r.TEXTURE_2D&&i.width===a&&i.height===o?r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.format,i.type,s):(i.width=a,i.height=o,r.texImage2D(t.target,0,i.internalFormat,t.format,i.type,s)),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,i=e.naturalHeight||e.videoHeight||e.height;this.resize(t,i),super.update()}dispose(){this.source=null}}class Xu extends Qt{constructor(e,t){if(t=t||{},typeof e=="string"){const i=new Image;Qt.crossOrigin(i,e,t.crossorigin),i.src=e,e=i}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??te.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.bitmap=null,this._load=null,t.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((t,i)=>{const s=this.source;this.url=s.src;const r=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?t(this.process()):t(this))};s.complete&&s.src?r():(s.onload=r,s.onerror=a=>{i(a),this.onError.emit(a)})}),this._load)}process(){const e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,i=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:i?"cors":"no-cors"}).then(s=>s.blob()).then(s=>t(s,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===at.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,i){if(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,i,this.bitmap),!this.preserveBitmap){let s=!0;const r=t._glTextures;for(const a in r){const o=r[a];if(o!==i&&o.dirtyId!==t.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}}class Da{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,i){const s=t.width,r=t.height;if(i){const a=e.width/2/s,o=e.height/2/r,l=e.x/s+a,h=e.y/r+o;i=ke.add(i,ke.NW),this.x0=l+a*ke.uX(i),this.y0=h+o*ke.uY(i),i=ke.add(i,2),this.x1=l+a*ke.uX(i),this.y1=h+o*ke.uY(i),i=ke.add(i,2),this.x2=l+a*ke.uX(i),this.y2=h+o*ke.uY(i),i=ke.add(i,2),this.x3=l+a*ke.uX(i),this.y3=h+o*ke.uY(i)}else this.x0=e.x/s,this.y0=e.y/r,this.x1=(e.x+e.width)/s,this.y1=e.y/r,this.x2=(e.x+e.width)/s,this.y2=(e.y+e.height)/r,this.x3=e.x/s,this.y3=(e.y+e.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}Da.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const oh=new Da;function En(n){n.destroy=function(){},n.on=function(){},n.once=function(){},n.emit=function(){}}class ie extends ln{constructor(e,t,i,s,r,a,o){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new ve(0,0,1,1)),e instanceof ie&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=oh,this.uvMatrix=null,this.orig=i||t,this._rotate=Number(r||0),r===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new Te(a.x,a.y):new Te(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:t}=this.baseTexture;t!=null&&t.url&&Dt[t.url]&&ie.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,ie.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var e;const t=this._frame.clone(),i=this._frame===this.orig?t:this.orig.clone(),s=new ie(this.baseTexture,!this.noFrame&&t,i,(e=this.trim)==null?void 0:e.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(s._frame=t),s}updateUvs(){this._uvs===oh&&(this._uvs=new Da),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},i=te.STRICT_TEXTURE_CACHE){const s=typeof e=="string";let r=null;if(s)r=e;else if(e instanceof ge){if(!e.cacheId){const o=t?.pixiIdPrefix||"pixiid";e.cacheId=`${o}-${Vi()}`,ge.addToCache(e,e.cacheId)}r=e.cacheId}else{if(!e._pixiId){const o=t?.pixiIdPrefix||"pixiid";e._pixiId=`${o}_${Vi()}`}r=e._pixiId}let a=Dt[r];if(s&&i&&!a)throw new Error(`The cacheId "${r}" does not exist in TextureCache.`);return!a&&!(e instanceof ge)?(t.resolution||(t.resolution=Jt(e)),a=new ie(new ge(e,t)),a.baseTexture.cacheId=r,ge.addToCache(a.baseTexture,r),ie.addToCache(a,r)):!a&&e instanceof ge&&(a=new ie(e),ie.addToCache(a,r)),a}static fromURL(e,t){const i=Object.assign({autoLoad:!1},t?.resourceOptions),s=ie.from(e,Object.assign({resourceOptions:i},t),!1),r=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):r.load().then(()=>Promise.resolve(s))}static fromBuffer(e,t,i,s){return new ie(ge.fromBuffer(e,t,i,s))}static fromLoader(e,t,i,s){const r=new ge(e,Object.assign({scaleMode:ge.defaultOptions.scaleMode,resolution:Jt(t)},s)),{resource:a}=r;a instanceof Xu&&(a.url=t);const o=new ie(r);return i||(i=t),ge.addToCache(o.baseTexture,i),ie.addToCache(o,i),i!==t&&(ge.addToCache(o.baseTexture,t),ie.addToCache(o,t)),o.baseTexture.valid?Promise.resolve(o):new Promise(l=>{o.baseTexture.once("loaded",()=>l(o))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Dt[t]&&Dt[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),Dt[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=Dt[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete Dt[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)Dt[e.textureCacheIds[t]]===e&&delete Dt[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:i,width:s,height:r}=e,a=t+s>this.baseTexture.width,o=i+r>this.baseTexture.height;if(a||o){const l=a&&o?"and":"or",h=`X: ${t} + ${s} = ${t+s} > ${this.baseTexture.width}`,u=`Y: ${i} + ${r} = ${i+r} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${h} ${l} ${u}`)}this.valid=s&&r&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return ie._EMPTY||(ie._EMPTY=new ie(new ge),En(ie._EMPTY),En(ie._EMPTY.baseTexture)),ie._EMPTY}static get WHITE(){if(!ie._WHITE){const e=te.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),ie._WHITE=new ie(ge.from(e)),En(ie._WHITE),En(ie._WHITE.baseTexture)}return ie._WHITE}}class Xi extends ie{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,i=!0){const s=this.baseTexture.resolution,r=Math.round(e*s)/s,a=Math.round(t*s)/s;this.valid=r>0&&a>0,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=a,i&&this.baseTexture.resize(r,a),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new Xi(new ju(e))}}class Yu{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,i=Ve.NONE){const s=new ju(Object.assign({width:e,height:t,resolution:1,multisample:i},this.textureOptions));return new Xi(s)}getOptimalTexture(e,t,i=1,s=Ve.NONE){let r;e=Math.max(Math.ceil(e*i-1e-6),1),t=Math.max(Math.ceil(t*i-1e-6),1),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=tr(e),t=tr(t),r=((e&65535)<<16|t&65535)>>>0,s>1&&(r+=s*4294967296)):r=s>1?-s:-1,this.texturePool[r]||(this.texturePool[r]=[]);let a=this.texturePool[r].pop();return a||(a=this.createTexture(e,t,s)),a.filterPoolKey=r,a.setResolution(i),a}getFilterTexture(e,t,i){const s=this.getOptimalTexture(e.width,e.height,t||e.resolution,i||Ve.NONE);return s.filterFrame=e.filterFrame,s}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(const t in this.texturePool){const i=this.texturePool[t];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const i=this.texturePool[t];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}Yu.SCREEN_KEY=-1;class Yg extends vi{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class qu extends vi{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new ze(this.vertices),this.uvBuffer=new ze(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+t.width/e.width,this.uvs[3]=s,this.uvs[4]=i+t.width/e.width,this.uvs[5]=s+t.height/e.height,this.uvs[6]=i,this.uvs[7]=s+t.height/e.height,i=t.x,s=t.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+t.width,this.vertices[3]=s,this.vertices[4]=i+t.width,this.vertices[5]=s+t.height,this.vertices[6]=i,this.vertices[7]=s+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class qg{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Ve.NONE,this.sourceFrame=new ve,this.destinationFrame=new ve,this.bindingSourceFrame=new ve,this.bindingDestinationFrame=new ve,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const bn=[new Te,new Te,new Te,new Te],oo=new Fe;class Zu{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new Yu,this.statePool=[],this.quad=new Yg,this.quadUv=new qu,this.tempRect=new ve,this.activeState={},this.globalUniforms=new At({outputFrame:new ve,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const i=this.renderer,s=this.defaultFilterStack,r=this.statePool.pop()||new qg,a=i.renderTexture;let o,l;if(a.current){const v=a.current;o=v.resolution,l=v.multisample}else o=i.resolution,l=i.multisample;let h=t[0].resolution||o,u=t[0].multisample??l,c=t[0].padding,d=t[0].autoFit,f=t[0].legacy??!0;for(let v=1;v<t.length;v++){const g=t[v];h=Math.min(h,g.resolution||o),u=Math.min(u,g.multisample??l),c=this.useMaxPadding?Math.max(c,g.padding):c+g.padding,d=d&&g.autoFit,f=f||(g.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),s.push(r),r.resolution=h,r.multisample=u,r.legacy=f,r.target=e,r.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),r.sourceFrame.pad(c);const p=this.tempRect.copyFrom(a.sourceFrame);i.projection.transform&&this.transformAABB(oo.copyFrom(i.projection.transform).invert(),p),d?(r.sourceFrame.fit(p),(r.sourceFrame.width<=0||r.sourceFrame.height<=0)&&(r.sourceFrame.width=0,r.sourceFrame.height=0)):r.sourceFrame.intersects(p)||(r.sourceFrame.width=0,r.sourceFrame.height=0),this.roundFrame(r.sourceFrame,a.current?a.current.resolution:i.resolution,a.sourceFrame,a.destinationFrame,i.projection.transform),r.renderTexture=this.getOptimalFilterTexture(r.sourceFrame.width,r.sourceFrame.height,h,u),r.filters=t,r.destinationFrame.width=r.renderTexture.width,r.destinationFrame.height=r.renderTexture.height;const m=this.tempRect;m.x=0,m.y=0,m.width=r.sourceFrame.width,m.height=r.sourceFrame.height,r.renderTexture.filterFrame=r.sourceFrame,r.bindingSourceFrame.copyFrom(a.sourceFrame),r.bindingDestinationFrame.copyFrom(a.destinationFrame),r.transform=i.projection.transform,i.projection.transform=null,a.bind(r.renderTexture,r.sourceFrame,m),i.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),i=t.filters;this.activeState=t;const s=this.globalUniforms.uniforms;s.outputFrame=t.sourceFrame,s.resolution=t.resolution;const r=s.inputSize,a=s.inputPixel,o=s.inputClamp;if(r[0]=t.destinationFrame.width,r[1]=t.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],a[0]=Math.round(r[0]*t.resolution),a[1]=Math.round(r[1]*t.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=t.sourceFrame.width*r[2]-.5*a[2],o[3]=t.sourceFrame.height*r[3]-.5*a[3],t.legacy){const h=s.filterArea;h[0]=t.destinationFrame.width,h[1]=t.destinationFrame.height,h[2]=t.sourceFrame.x,h[3]=t.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const l=e[e.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,t.renderTexture,l.renderTexture,Ft.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let h=t.renderTexture,u=this.getOptimalFilterTexture(h.width,h.height,t.resolution);u.filterFrame=h.filterFrame;let c=0;for(c=0;c<i.length-1;++c){c===1&&t.multisample>1&&(u=this.getOptimalFilterTexture(h.width,h.height,t.resolution),u.filterFrame=h.filterFrame),i[c].apply(this,h,u,Ft.CLEAR,t);const d=h;h=u,u=d}i[c].apply(this,h,l.renderTexture,Ft.BLEND,t),c>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(u)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=Ft.CLEAR){const{renderTexture:i,state:s}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e?.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=e.filterFrame.width,a.height=e.filterFrame.height,i.bind(e,e.filterFrame,a)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const r=s.stateId&1||this.forceClear;(t===Ft.CLEAR||t===Ft.BLIT&&r)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,i,s){const r=this.renderer;r.state.set(e.state),this.bindAndClear(i,s),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(kt.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(kt.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:i,destinationFrame:s}=this.activeState,{orig:r}=t._texture,a=e.set(s.width,0,0,s.height,i.x,i.y),o=t.worldTransform.copyTo(Fe.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/r.width,1/r.height),a.translate(t.anchor.x,t.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,i=1,s=Ve.NONE){return this.texturePool.getOptimalTexture(e,t,i,s)}getFilterTexture(e,t,i){if(typeof e=="number"){const r=e;e=t,t=r}e=e||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,i||Ve.NONE);return s.filterFrame=e.filterFrame,s}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const i=bn[0],s=bn[1],r=bn[2],a=bn[3];i.set(t.left,t.top),s.set(t.left,t.bottom),r.set(t.right,t.top),a.set(t.right,t.bottom),e.apply(i,i),e.apply(s,s),e.apply(r,r),e.apply(a,a);const o=Math.min(i.x,s.x,r.x,a.x),l=Math.min(i.y,s.y,r.y,a.y),h=Math.max(i.x,s.x,r.x,a.x),u=Math.max(i.y,s.y,r.y,a.y);t.x=o,t.y=l,t.width=h-o,t.height=u-l}roundFrame(e,t,i,s,r){if(!(e.width<=0||e.height<=0||i.width<=0||i.height<=0)){if(r){const{a,b:o,c:l,d:h}=r;if((Math.abs(o)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(h)>1e-4))return}r=r?oo.copyFrom(r):oo.identity(),r.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.transformAABB(r,e),e.ceil(t),this.transformAABB(r.invert(),e)}}}Zu.extension={type:K.RendererSystem,name:"filter"};se.add(Zu);class Zg{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Ve.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Kg=new ve;class Ku{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new qo(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new ve,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let t=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;te.PREFER_ENV===ji.WEBGL_LEGACY&&(t=null,i=null),t?e.drawBuffers=s=>t.drawBuffersWEBGL(s):(this.hasMRT=!1,e.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,i=0){const{gl:s}=this;if(e){const r=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,s.bindFramebuffer(s.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==i&&(e.dirtyId++,e.dirtyFormat++,r.mipLevel=i),r.dirtyId!==e.dirtyId&&(r.dirtyId=e.dirtyId,r.dirtyFormat!==e.dirtyFormat?(r.dirtyFormat=e.dirtyFormat,r.dirtySize=e.dirtySize,this.updateFramebuffer(e,i)):r.dirtySize!==e.dirtySize&&(r.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let a=0;a<e.colorTextures.length;a++){const o=e.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const a=t.width>>i,o=t.height>>i,l=a/t.width;this.setViewport(t.x*l,t.y*l,a,o)}else{const a=e.width>>i,o=e.height>>i;this.setViewport(0,0,a,o)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,i,s){const r=this.viewport;e=Math.round(e),t=Math.round(t),i=Math.round(i),s=Math.round(s),(r.width!==i||r.height!==s||r.x!==e||r.y!==t)&&(r.x=e,r.y=t,r.width=i,r.height=s,this.gl.viewport(e,t,i,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,i,s,r=Io.COLOR|Io.DEPTH){const{gl:a}=this;a.clearColor(e,t,i,s),a.clear(r)}initFramebuffer(e){const{gl:t}=this,i=new Zg(t.createFramebuffer());return i.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(e),e.disposeRunner.add(this),i}resizeFramebuffer(e){const{gl:t}=this,i=e.glFramebuffers[this.CONTEXT_UID];if(i.stencil){t.bindRenderbuffer(t.RENDERBUFFER,i.stencil);let a;this.renderer.context.webGLVersion===1?a=t.DEPTH_STENCIL:e.depth&&e.stencil?a=t.DEPTH24_STENCIL8:e.depth?a=t.DEPTH_COMPONENT24:a=t.STENCIL_INDEX8,i.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,a,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,a,e.width,e.height)}const s=e.colorTextures;let r=s.length;t.drawBuffers||(r=Math.min(r,1));for(let a=0;a<r;a++){const o=s[a],l=o.parentTextureArray||o;this.renderer.texture.bind(l,0),a===0&&i.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,i.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:i}=this,s=e.glFramebuffers[this.CONTEXT_UID],r=e.colorTextures;let a=r.length;i.drawBuffers||(a=Math.min(a,1)),s.multisample>1&&this.canMultisampleFramebuffer(e)?s.msaaBuffer=s.msaaBuffer||i.createRenderbuffer():s.msaaBuffer&&(i.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const o=[];for(let l=0;l<a;l++){const h=r[l],u=h.parentTextureArray||h;this.renderer.texture.bind(u,0),l===0&&s.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,s.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+l,h.target,u._glTextures[this.CONTEXT_UID].texture,t),o.push(i.COLOR_ATTACHMENT0+l))}if(o.length>1&&i.drawBuffers(o),e.depthTexture&&this.writeDepthTexture){const l=e.depthTexture;this.renderer.texture.bind(l,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,l._glTextures[this.CONTEXT_UID].texture,t)}if((e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||i.createRenderbuffer();let l,h;this.renderer.context.webGLVersion===1?(l=i.DEPTH_STENCIL_ATTACHMENT,h=i.DEPTH_STENCIL):e.depth&&e.stencil?(l=i.DEPTH_STENCIL_ATTACHMENT,h=i.DEPTH24_STENCIL8):e.depth?(l=i.DEPTH_ATTACHMENT,h=i.DEPTH_COMPONENT24):(l=i.STENCIL_ATTACHMENT,h=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,h,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,h,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,l,i.RENDERBUFFER,s.stencil)}else s.stencil&&(i.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let i=Ve.NONE;if(e<=1||t===null)return i;for(let s=0;s<t.length;s++)if(t[s]<=e){i=t[s];break}return i===1&&(i=Ve.NONE),i}blit(e,t,i){const{current:s,renderer:r,gl:a,CONTEXT_UID:o}=this;if(r.context.webGLVersion!==2||!s)return;const l=s.glFramebuffers[o];if(!l)return;if(!e){if(!l.msaaBuffer)return;const u=s.colorTextures[0];if(!u)return;l.blitFramebuffer||(l.blitFramebuffer=new qo(s.width,s.height),l.blitFramebuffer.addColorTexture(0,u)),e=l.blitFramebuffer,e.colorTextures[0]!==u&&(e.colorTextures[0]=u,e.dirtyId++,e.dirtyFormat++),(e.width!==s.width||e.height!==s.height)&&(e.width=s.width,e.height=s.height,e.dirtyId++,e.dirtySize++)}t||(t=Kg,t.width=s.width,t.height=s.height),i||(i=t);const h=t.width===i.width&&t.height===i.height;this.bind(e),a.bindFramebuffer(a.READ_FRAMEBUFFER,l.framebuffer),a.blitFramebuffer(t.left,t.top,t.right,t.bottom,i.left,i.top,i.right,i.bottom,a.COLOR_BUFFER_BIT,h?a.NEAREST:a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){const i=e.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!i)return;delete e.glFramebuffers[this.CONTEXT_UID];const r=this.managedFramebuffers.indexOf(e);r>=0&&this.managedFramebuffers.splice(r,1),e.disposeRunner.remove(this),t||(s.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&s.deleteRenderbuffer(i.msaaBuffer),i.stencil&&s.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,t)}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<t.length;i++)this.disposeFramebuffer(t[i],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil&&e.stencil)return;e.stencil=!0;const i=e.width,s=e.height,r=this.gl,a=t.stencil=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,a);let o,l;this.renderer.context.webGLVersion===1?(o=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH_STENCIL):e.depth?(o=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH24_STENCIL8):(o=r.STENCIL_ATTACHMENT,l=r.STENCIL_INDEX8),t.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,t.multisample,l,i,s):r.renderbufferStorage(r.RENDERBUFFER,l,i,s),r.framebufferRenderbuffer(r.FRAMEBUFFER,o,r.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new ve}destroy(){this.renderer=null}}Ku.extension={type:K.RendererSystem,name:"framebuffer"};se.add(Ku);const ao={5126:4,5123:2,5121:1};class Ju{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;te.PREFER_ENV===ji.WEBGL_LEGACY&&(i=null),i?(e.createVertexArray=()=>i.createVertexArrayOES(),e.bindVertexArray=s=>i.bindVertexArrayOES(s),e.deleteVertexArray=s=>i.deleteVertexArrayOES(s)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(t.webGLVersion!==2){const i=e.getExtension("ANGLE_instanced_arrays");i?(e.vertexAttribDivisor=(s,r)=>i.vertexAttribDivisorANGLE(s,r),e.drawElementsInstanced=(s,r,a,o,l)=>i.drawElementsInstancedANGLE(s,r,a,o,l),e.drawArraysInstanced=(s,r,a,o)=>i.drawArraysInstancedANGLE(s,r,a,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:i}=this;let s=e.glVertexArrayObjects[this.CONTEXT_UID],r=!1;s||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=s={},r=!0);const a=s[t.program.id]||this.initGeometryVao(e,t,r);this._activeGeometry=e,this._activeVao!==a&&(this._activeVao=a,this.hasVao?i.bindVertexArray(a):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let i=0;i<e.buffers.length;i++){const s=e.buffers[i];t.update(s)}}checkCompatibility(e,t){const i=e.attributes,s=t.attributeData;for(const r in s)if(!i[r])throw new Error(`shader and geometry incompatible, geometry missing the "${r}" attribute`)}getSignature(e,t){const i=e.attributes,s=t.attributeData,r=["g",e.id];for(const a in i)s[a]&&r.push(a,s[a].location);return r.join("-")}initGeometryVao(e,t,i=!0){const s=this.gl,r=this.CONTEXT_UID,a=this.renderer.buffer,o=t.program;o.glPrograms[r]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,o);const l=this.getSignature(e,o),h=e.glVertexArrayObjects[this.CONTEXT_UID];let u=h[l];if(u)return h[o.id]=u,u;const c=e.buffers,d=e.attributes,f={},p={};for(const m in c)f[m]=0,p[m]=0;for(const m in d)!d[m].size&&o.attributeData[m]?d[m].size=o.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*ao[d[m].type];for(const m in d){const v=d[m],g=v.size;v.stride===void 0&&(f[v.buffer]===g*ao[v.type]?v.stride=0:v.stride=f[v.buffer]),v.start===void 0&&(v.start=p[v.buffer],p[v.buffer]+=g*ao[v.type])}u=s.createVertexArray(),s.bindVertexArray(u);for(let m=0;m<c.length;m++){const v=c[m];a.bind(v),i&&v._glBuffers[r].refCount++}return this.activateVao(e,o),h[o.id]=u,h[l]=u,s.bindVertexArray(null),a.unbind(Ut.ARRAY_BUFFER),u}disposeGeometry(e,t){var i;if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const s=e.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,a=e.buffers,o=(i=this.renderer)==null?void 0:i.buffer;if(e.disposeRunner.remove(this),!!s){if(o)for(let l=0;l<a.length;l++){const h=a[l]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!t&&o.dispose(a[l],t))}if(!t){for(const l in s)if(l[0]==="g"){const h=s[l];this._activeVao===h&&this.unbind(),r.deleteVertexArray(h)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let i=0;i<t.length;i++)this.disposeGeometry(this.managedGeometries[t[i]],e)}activateVao(e,t){const i=this.gl,s=this.CONTEXT_UID,r=this.renderer.buffer,a=e.buffers,o=e.attributes;e.indexBuffer&&r.bind(e.indexBuffer);let l=null;for(const h in o){const u=o[h],c=a[u.buffer],d=c._glBuffers[s];if(t.attributeData[h]){l!==d&&(r.bind(c),l=d);const f=t.attributeData[h].location;if(i.enableVertexAttribArray(f),i.vertexAttribPointer(f,u.size,u.type||i.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)i.vertexAttribDivisor(f,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,t,i,s){const{gl:r}=this,a=this._activeGeometry;if(a.indexBuffer){const o=a.indexBuffer.data.BYTES_PER_ELEMENT,l=o===2?r.UNSIGNED_SHORT:r.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?a.instanced?r.drawElementsInstanced(e,t||a.indexBuffer.data.length,l,(i||0)*o,s||1):r.drawElements(e,t||a.indexBuffer.data.length,l,(i||0)*o):console.warn("unsupported index buffer type: uint32")}else a.instanced?r.drawArraysInstanced(e,i,t||a.getSize(),s||1):r.drawArrays(e,i,t||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Ju.extension={type:K.RendererSystem,name:"geometry"};se.add(Ju);const ah=new Fe;class Qu{constructor(e,t){this._texture=e,this.mapCoord=new Fe,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){t===void 0&&(t=e);const i=this.mapCoord;for(let s=0;s<e.length;s+=2){const r=e[s],a=e[s+1];t[s]=r*i.a+a*i.c+i.tx,t[s+1]=r*i.b+a*i.d+i.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const i=t._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const s=t.orig,r=t.trim;r&&(ah.set(s.width/r.width,0,0,s.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(ah));const a=t.baseTexture,o=this.uClampFrame,l=this.clampMargin/a.resolution,h=this.clampOffset;return o[0]=(t._frame.x+l+h)/a.width,o[1]=(t._frame.y+l+h)/a.height,o[2]=(t._frame.x+t._frame.width-l+h)/a.width,o[3]=(t._frame.y+t._frame.height-l+h)/a.height,this.uClampOffset[0]=h/a.realWidth,this.uClampOffset[1]=h/a.realHeight,this.isSimple=t._frame.width===a.width&&t._frame.height===a.height&&t.rotate===0,!0}}var Jg=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Qg=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class $g extends nt{constructor(e,t,i){let s=null;typeof e!="string"&&t===void 0&&i===void 0&&(s=e,e=void 0,t=void 0,i=void 0),super(e||Qg,t||Jg,i),this.maskSprite=s,this.maskMatrix=new Fe}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,i,s){const r=this._maskSprite,a=r._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new Qu(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,r).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,e.applyFilter(this,t,i,s))}}class ev{constructor(e=null){this.type=je.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=nt.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=je.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class $u{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let i=t;if(!i.isMaskData){const r=this.maskDataPool.pop()||new ev;r.pooled=!0,r.maskObject=t,i=r}const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=e,i.type!==je.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case je.SCISSOR:this.renderer.scissor.push(i);break;case je.STENCIL:this.renderer.stencil.push(i);break;case je.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case je.COLOR:this.pushColorMask(i);break}i.type===je.SPRITE&&this.maskStack.push(i)}pop(e){const t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case je.SCISSOR:this.renderer.scissor.pop(t);break;case je.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case je.SPRITE:this.popSpriteMask(t);break;case je.COLOR:this.popColorMask(t);break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===je.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=je.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=je.SCISSOR:e.type=je.STENCIL:e.type=je.COLOR}pushSpriteMask(e){const{maskObject:t}=e,i=e._target;let s=e._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new $g])),s[0].resolution=e.resolution,s[0].multisample=e.multisample,s[0].maskSprite=t;const r=i.filterArea;i.filterArea=t.getBounds(!0),this.renderer.filter.push(i,s),i.filterArea=r,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,i=e._colorMask=t&e.colorMask;i!==t&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(e){const t=e._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==t&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}$u.extension={type:K.RendererSystem,name:"mask"};se.add($u);class ec{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,i=this.getStackLength();this.maskStack=e;const s=this.getStackLength();s!==i&&(s===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const lh=new Fe,hh=[],tc=class Gn extends ec{constructor(e){super(e),this.glConst=te.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:i}=e,{renderer:s}=this,r=s.renderTexture,a=i.getBounds(!0,hh.pop()??new ve);this.roundFrameToPixels(a,r.current?r.current.resolution:s.resolution,r.sourceFrame,r.destinationFrame,s.projection.transform),t&&a.fit(t),e._scissorRectLocal=a}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:i,c:s,d:r}=e;return(Math.abs(i)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(r)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||Gn.isMatrixRotated(t.worldTransform)||Gn.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const i=e._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(e,t,i,s,r){Gn.isMatrixRotated(r)||(r=r?lh.copyFrom(r):lh.identity(),r.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(r,e),e.fit(s),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&hh.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};tc.extension={type:K.RendererSystem,name:"scissor"};let tv=tc;se.add(tv);class ic extends ec{constructor(e){super(e),this.glConst=te.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:i}=this.renderer,s=e._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),e._stencilCounter++;const r=e._colorMask;r!==0&&(e._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,s,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,r!==0&&(e._colorMask=r,i.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)),this._useCurrent()}pop(e){const t=this.renderer.gl;if(this.getStackLength()===0)t.disable(t.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=i?i._colorMask:15;s!==0&&(i._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(i._colorMask=s,t.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}ic.extension={type:K.RendererSystem,name:"stencil"};se.add(ic);class sc{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return xe("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return xe("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return xe("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}sc.extension={type:[K.RendererSystem,K.CanvasRendererSystem],name:"_plugin"};se.add(sc);class nc{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Fe,this.transform=null}update(e,t,i,s){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,s),this.transform&&this.projectionMatrix.append(this.transform);const r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)}calculateProjection(e,t,i,s){const r=this.projectionMatrix,a=s?-1:1;r.identity(),r.a=1/t.width*2,r.d=a*(1/t.height*2),r.tx=-1-t.x*r.a,r.ty=-a-t.y*r.d}setTransform(e){}destroy(){this.renderer=null}}nc.extension={type:K.RendererSystem,name:"projection"};se.add(nc);const iv=new Ma,uh=new ve;class rc{constructor(e){this.renderer=e,this._tempMatrix=new Fe}generateTexture(e,t){const{region:i,...s}=t||{},r=i?.copyTo(uh)||e.getLocalBounds(uh,!0),a=s.resolution||this.renderer.resolution;r.width=Math.max(r.width,1/a),r.height=Math.max(r.height,1/a),s.width=r.width,s.height=r.height,s.resolution=a,s.multisample??(s.multisample=this.renderer.multisample);const o=Xi.create(s);this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const l=e.transform;return e.transform=iv,this.renderer.render(e,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=l,o}destroy(){}}rc.extension={type:[K.RendererSystem,K.CanvasRendererSystem],name:"textureGenerator"};se.add(rc);const Ei=new ve,ks=new ve;class oc{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new ve,this.destinationFrame=new ve,this.viewportFrame=new ve}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(e=null,t,i){const s=this.renderer;this.current=e;let r,a,o;e?(r=e.baseTexture,o=r.resolution,t||(Ei.width=e.frame.width,Ei.height=e.frame.height,t=Ei),i||(ks.x=e.frame.x,ks.y=e.frame.y,ks.width=t.width,ks.height=t.height,i=ks),a=r.framebuffer):(o=s.resolution,t||(Ei.width=s._view.screen.width,Ei.height=s._view.screen.height,t=Ei),i||(i=Ei,i.width=t.width,i.height=t.height));const l=this.viewportFrame;l.x=i.x*o,l.y=i.y*o,l.width=i.width*o,l.height=i.height*o,e||(l.y=s.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(a,l),this.renderer.projection.update(i,t,o,!a),e?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(i)}clear(e,t){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=Oe.shared.setValue(e||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);const r=this.destinationFrame,a=this.current?this.current.baseTexture:this.renderer._view.screen,o=r.width!==a.width||r.height!==a.height;if(o){let{x:l,y:h,width:u,height:c}=this.viewportFrame;l=Math.round(l),h=Math.round(h),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,h,u,c)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,t),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}oc.extension={type:K.RendererSystem,name:"renderTexture"};se.add(oc);class sv{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function nv(n,e){const t={},i=e.getProgramParameter(n,e.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const r=e.getActiveAttrib(n,s);if(r.name.startsWith("gl_"))continue;const a=Vu(e,r.type),o={type:a,name:r.name,size:zu(a),location:e.getAttribLocation(n,r.name)};t[r.name]=o}return t}function rv(n,e){const t={},i=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let s=0;s<i;s++){const r=e.getActiveUniform(n,s),a=r.name.replace(/\[.*?\]$/,""),o=!!r.name.match(/\[.*?\]$/),l=Vu(e,r.type);t[a]={name:a,index:s,type:l,size:r.size,isArray:o,value:Hu(l,r.size)}}return t}function ov(n,e){var t;const i=th(n,n.VERTEX_SHADER,e.vertexSrc),s=th(n,n.FRAGMENT_SHADER,e.fragmentSrc),r=n.createProgram();n.attachShader(r,i),n.attachShader(r,s);const a=(t=e.extra)==null?void 0:t.transformFeedbackVaryings;if(a&&(typeof n.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):n.transformFeedbackVaryings(r,a.names,a.bufferMode==="separate"?n.SEPARATE_ATTRIBS:n.INTERLEAVED_ATTRIBS)),n.linkProgram(r),n.getProgramParameter(r,n.LINK_STATUS)||Lg(n,r,i,s),e.attributeData=nv(r,n),e.uniformData=rv(r,n),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const l=Object.keys(e.attributeData);l.sort((h,u)=>h>u?1:-1);for(let h=0;h<l.length;h++)e.attributeData[l[h]].location=h,n.bindAttribLocation(r,h,l[h]);n.linkProgram(r)}n.deleteShader(i),n.deleteShader(s);const o={};for(const l in e.uniformData){const h=e.uniformData[l];o[l]={location:n.getUniformLocation(r,l),value:Hu(h.type,h.size)}}return new sv(r,o)}function av(n,e,t,i,s){t.buffer.update(s)}const lv={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},ac={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function hv(n){const e=n.map(r=>({data:r,offset:0,dataLen:0,dirty:0}));let t=0,i=0,s=0;for(let r=0;r<e.length;r++){const a=e[r];if(t=ac[a.data.type],a.data.size>1&&(t=Math.max(t,16)*a.data.size),a.dataLen=t,i%t!==0&&i<16){const o=i%t%16;i+=o,s+=o}i+t>16?(s=Math.ceil(s/16)*16,a.offset=s,s+=t,i=t):(a.offset=s,i+=t,s+=t)}return s=Math.ceil(s/16)*16,{uboElements:e,size:s}}function uv(n,e){const t=[];for(const i in n)e[i]&&t.push(e[i]);return t.sort((i,s)=>i.index-s.index),t}function cv(n,e){if(!n.autoManage)return{size:0,syncFunc:av};const t=uv(n.uniforms,e),{uboElements:i,size:s}=hv(t),r=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<i.length;a++){const o=i[a],l=n.uniforms[o.data.name],h=o.data.name;let u=!1;for(let c=0;c<xs.length;c++){const d=xs[c];if(d.codeUbo&&d.test(o.data,l)){r.push(`offset = ${o.offset/4};`,xs[c].codeUbo(o.data.name,l)),u=!0;break}}if(!u)if(o.data.size>1){const c=zu(o.data.type),d=Math.max(ac[o.data.type]/16,1),f=c/d,p=(4-f%4)%4;r.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${o.offset/4};

                t = 0;

                for(var i=0; i < ${o.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const c=lv[o.data.type];r.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${o.offset/4};
                ${c};
                `)}}return r.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",r.join(`
`))}}let dv=0;const Sn={textureCount:0,uboCount:0};class lc{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=dv++}systemCheck(){if(!Ng())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const i=e.program,s=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==i&&(this.program=i,this.gl.useProgram(s.program)),t||(Sn.textureCount=0,Sn.uboCount=0,this.syncUniformGroup(e.uniformGroup,Sn)),s}setUniforms(e){const t=this.shader.program,i=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(i.uniformData,e,this.renderer)}syncUniformGroup(e,t){const i=this.getGlProgram();(!e.static||e.dirtyId!==i.uniformDirtyGroups[e.id])&&(i.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,i,t))}syncUniforms(e,t,i){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,i)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=Dg(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const i=this.getGlProgram();if(!e.static||e.dirtyId!==0||!i.uniformGroups[e.id]){e.dirtyId=0;const s=i.uniformGroups[e.id]||this.createSyncBufferGroup(e,i,t);e.buffer.update(),s(i.uniformData,e.uniforms,this.renderer,Sn,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,i.uniformBufferBindings[t])}createSyncBufferGroup(e,t,i){const{gl:s}=this.renderer;this.renderer.buffer.bind(e.buffer);const r=this.gl.getUniformBlockIndex(t.program,i);t.uniformBufferBindings[i]=this.shader.uniformBindCount,s.uniformBlockBinding(t.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(e,this.shader.program.uniformData,"ubo");let o=this._uboCache[a];if(o||(o=this._uboCache[a]=cv(e,this.shader.program.uniformData)),e.autoManage){const l=new Float32Array(o.size/4);e.buffer.update(l)}return t.uniformGroups[e.id]=o.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,i){const s=e.uniforms,r=[`${i}-`];for(const a in s)r.push(a),t[a]&&r.push(t[a].type);return r.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,i=e.program,s=ov(t,i);return i.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}lc.extension={type:K.RendererSystem,name:"shader"};se.add(lc);class or{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.2 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}or.defaultOptions={hello:!1},or.extension={type:[K.RendererSystem,K.CanvasRendererSystem],name:"startup"};se.add(or);function fv(n,e=[]){return e[ce.NORMAL]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.ADD]=[n.ONE,n.ONE],e[ce.MULTIPLY]=[n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.SCREEN]=[n.ONE,n.ONE_MINUS_SRC_COLOR,n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.OVERLAY]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.DARKEN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.LIGHTEN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.COLOR_DODGE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.COLOR_BURN]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.HARD_LIGHT]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.SOFT_LIGHT]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.DIFFERENCE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.EXCLUSION]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.HUE]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.SATURATION]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.COLOR]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.LUMINOSITY]=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.NONE]=[0,0],e[ce.NORMAL_NPM]=[n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.ADD_NPM]=[n.SRC_ALPHA,n.ONE,n.ONE,n.ONE],e[ce.SCREEN_NPM]=[n.SRC_ALPHA,n.ONE_MINUS_SRC_COLOR,n.ONE,n.ONE_MINUS_SRC_ALPHA],e[ce.SRC_IN]=[n.DST_ALPHA,n.ZERO],e[ce.SRC_OUT]=[n.ONE_MINUS_DST_ALPHA,n.ZERO],e[ce.SRC_ATOP]=[n.DST_ALPHA,n.ONE_MINUS_SRC_ALPHA],e[ce.DST_OVER]=[n.ONE_MINUS_DST_ALPHA,n.ONE],e[ce.DST_IN]=[n.ZERO,n.SRC_ALPHA],e[ce.DST_OUT]=[n.ZERO,n.ONE_MINUS_SRC_ALPHA],e[ce.DST_ATOP]=[n.ONE_MINUS_DST_ALPHA,n.SRC_ALPHA],e[ce.XOR]=[n.ONE_MINUS_DST_ALPHA,n.ONE_MINUS_SRC_ALPHA],e[ce.SUBTRACT]=[n.ONE,n.ONE,n.ONE,n.ONE,n.FUNC_REVERSE_SUBTRACT,n.FUNC_ADD],e}const pv=0,mv=1,gv=2,vv=3,yv=4,xv=5,hc=class Zo{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ce.NONE,this._blendEq=!1,this.map=[],this.map[pv]=this.setBlend,this.map[mv]=this.setOffset,this.map[gv]=this.setCullFace,this.map[vv]=this.setDepthTest,this.map[yv]=this.setFrontFace,this.map[xv]=this.setDepthMask,this.checks=[],this.defaultState=new zt,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=fv(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,i=0;for(;t;)t&1&&this.map[i].call(this,!!(e.data&1<<i)),t=t>>1,i++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(Zo.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(Zo.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],i=this.gl;t.length===2?i.blendFunc(t[0],t[1]):i.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,i.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const i=this.checks.indexOf(e);t&&i===-1?this.checks.push(e):!t&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};hc.extension={type:K.RendererSystem,name:"state"};let _v=hc;se.add(_v);class wv extends ln{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter(s=>e.systems[s]),i=[...t,...Object.keys(e.systems).filter(s=>!t.includes(s))];for(const s of i)this.addSystem(e.systems[s],s)}addRunners(...e){e.forEach(t=>{this.runners[t]=new St(t)})}addSystem(e,t){const i=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=i,this._systemsHash[t]=i;for(const s in this.runners)this.runners[s].add(i);return this}emitWithCustomOptions(e,t){const i=Object.keys(this._systemsHash);e.items.forEach(s=>{const r=i.find(a=>this._systemsHash[a]===s);s[e.name](t[r])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const js=class zn{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=zn.defaultMaxIdle,this.checkCountMax=zn.defaultCheckCountMax,this.mode=zn.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Ra.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let i=!1;for(let s=0;s<t.length;s++){const r=t[s];r.resource&&this.count-r.touched>this.maxIdle&&(e.destroyTexture(r,!0),t[s]=null,i=!0)}if(i){let s=0;for(let r=0;r<t.length;r++)t[r]!==null&&(t[s++]=t[r]);t.length=s}}unload(e){const t=this.renderer.texture,i=e._texture;i&&!i.framebuffer&&t.destroyTexture(i);for(let s=e.children.length-1;s>=0;s--)this.unload(e.children[s])}destroy(){this.renderer=null}};js.defaultMode=Ra.AUTO,js.defaultMaxIdle=60*60,js.defaultCheckCountMax=60*10,js.extension={type:K.RendererSystem,name:"textureGC"};let Ii=js;se.add(Ii);class lo{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=oe.UNSIGNED_BYTE,this.internalFormat=j.RGBA,this.samplerType=0}}function Tv(n){let e;return"WebGL2RenderingContext"in globalThis&&n instanceof globalThis.WebGL2RenderingContext?e={[n.RGB]:ee.FLOAT,[n.RGBA]:ee.FLOAT,[n.ALPHA]:ee.FLOAT,[n.LUMINANCE]:ee.FLOAT,[n.LUMINANCE_ALPHA]:ee.FLOAT,[n.R8]:ee.FLOAT,[n.R8_SNORM]:ee.FLOAT,[n.RG8]:ee.FLOAT,[n.RG8_SNORM]:ee.FLOAT,[n.RGB8]:ee.FLOAT,[n.RGB8_SNORM]:ee.FLOAT,[n.RGB565]:ee.FLOAT,[n.RGBA4]:ee.FLOAT,[n.RGB5_A1]:ee.FLOAT,[n.RGBA8]:ee.FLOAT,[n.RGBA8_SNORM]:ee.FLOAT,[n.RGB10_A2]:ee.FLOAT,[n.RGB10_A2UI]:ee.FLOAT,[n.SRGB8]:ee.FLOAT,[n.SRGB8_ALPHA8]:ee.FLOAT,[n.R16F]:ee.FLOAT,[n.RG16F]:ee.FLOAT,[n.RGB16F]:ee.FLOAT,[n.RGBA16F]:ee.FLOAT,[n.R32F]:ee.FLOAT,[n.RG32F]:ee.FLOAT,[n.RGB32F]:ee.FLOAT,[n.RGBA32F]:ee.FLOAT,[n.R11F_G11F_B10F]:ee.FLOAT,[n.RGB9_E5]:ee.FLOAT,[n.R8I]:ee.INT,[n.R8UI]:ee.UINT,[n.R16I]:ee.INT,[n.R16UI]:ee.UINT,[n.R32I]:ee.INT,[n.R32UI]:ee.UINT,[n.RG8I]:ee.INT,[n.RG8UI]:ee.UINT,[n.RG16I]:ee.INT,[n.RG16UI]:ee.UINT,[n.RG32I]:ee.INT,[n.RG32UI]:ee.UINT,[n.RGB8I]:ee.INT,[n.RGB8UI]:ee.UINT,[n.RGB16I]:ee.INT,[n.RGB16UI]:ee.UINT,[n.RGB32I]:ee.INT,[n.RGB32UI]:ee.UINT,[n.RGBA8I]:ee.INT,[n.RGBA8UI]:ee.UINT,[n.RGBA16I]:ee.INT,[n.RGBA16UI]:ee.UINT,[n.RGBA32I]:ee.INT,[n.RGBA32UI]:ee.UINT,[n.DEPTH_COMPONENT16]:ee.FLOAT,[n.DEPTH_COMPONENT24]:ee.FLOAT,[n.DEPTH_COMPONENT32F]:ee.FLOAT,[n.DEPTH_STENCIL]:ee.FLOAT,[n.DEPTH24_STENCIL8]:ee.FLOAT,[n.DEPTH32F_STENCIL8]:ee.FLOAT}:e={[n.RGB]:ee.FLOAT,[n.RGBA]:ee.FLOAT,[n.ALPHA]:ee.FLOAT,[n.LUMINANCE]:ee.FLOAT,[n.LUMINANCE_ALPHA]:ee.FLOAT,[n.DEPTH_STENCIL]:ee.FLOAT},e}function Ev(n){let e;return"WebGL2RenderingContext"in globalThis&&n instanceof globalThis.WebGL2RenderingContext?e={[oe.UNSIGNED_BYTE]:{[j.RGBA]:n.RGBA8,[j.RGB]:n.RGB8,[j.RG]:n.RG8,[j.RED]:n.R8,[j.RGBA_INTEGER]:n.RGBA8UI,[j.RGB_INTEGER]:n.RGB8UI,[j.RG_INTEGER]:n.RG8UI,[j.RED_INTEGER]:n.R8UI,[j.ALPHA]:n.ALPHA,[j.LUMINANCE]:n.LUMINANCE,[j.LUMINANCE_ALPHA]:n.LUMINANCE_ALPHA},[oe.BYTE]:{[j.RGBA]:n.RGBA8_SNORM,[j.RGB]:n.RGB8_SNORM,[j.RG]:n.RG8_SNORM,[j.RED]:n.R8_SNORM,[j.RGBA_INTEGER]:n.RGBA8I,[j.RGB_INTEGER]:n.RGB8I,[j.RG_INTEGER]:n.RG8I,[j.RED_INTEGER]:n.R8I},[oe.UNSIGNED_SHORT]:{[j.RGBA_INTEGER]:n.RGBA16UI,[j.RGB_INTEGER]:n.RGB16UI,[j.RG_INTEGER]:n.RG16UI,[j.RED_INTEGER]:n.R16UI,[j.DEPTH_COMPONENT]:n.DEPTH_COMPONENT16},[oe.SHORT]:{[j.RGBA_INTEGER]:n.RGBA16I,[j.RGB_INTEGER]:n.RGB16I,[j.RG_INTEGER]:n.RG16I,[j.RED_INTEGER]:n.R16I},[oe.UNSIGNED_INT]:{[j.RGBA_INTEGER]:n.RGBA32UI,[j.RGB_INTEGER]:n.RGB32UI,[j.RG_INTEGER]:n.RG32UI,[j.RED_INTEGER]:n.R32UI,[j.DEPTH_COMPONENT]:n.DEPTH_COMPONENT24},[oe.INT]:{[j.RGBA_INTEGER]:n.RGBA32I,[j.RGB_INTEGER]:n.RGB32I,[j.RG_INTEGER]:n.RG32I,[j.RED_INTEGER]:n.R32I},[oe.FLOAT]:{[j.RGBA]:n.RGBA32F,[j.RGB]:n.RGB32F,[j.RG]:n.RG32F,[j.RED]:n.R32F,[j.DEPTH_COMPONENT]:n.DEPTH_COMPONENT32F},[oe.HALF_FLOAT]:{[j.RGBA]:n.RGBA16F,[j.RGB]:n.RGB16F,[j.RG]:n.RG16F,[j.RED]:n.R16F},[oe.UNSIGNED_SHORT_5_6_5]:{[j.RGB]:n.RGB565},[oe.UNSIGNED_SHORT_4_4_4_4]:{[j.RGBA]:n.RGBA4},[oe.UNSIGNED_SHORT_5_5_5_1]:{[j.RGBA]:n.RGB5_A1},[oe.UNSIGNED_INT_2_10_10_10_REV]:{[j.RGBA]:n.RGB10_A2,[j.RGBA_INTEGER]:n.RGB10_A2UI},[oe.UNSIGNED_INT_10F_11F_11F_REV]:{[j.RGB]:n.R11F_G11F_B10F},[oe.UNSIGNED_INT_5_9_9_9_REV]:{[j.RGB]:n.RGB9_E5},[oe.UNSIGNED_INT_24_8]:{[j.DEPTH_STENCIL]:n.DEPTH24_STENCIL8},[oe.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[j.DEPTH_STENCIL]:n.DEPTH32F_STENCIL8}}:e={[oe.UNSIGNED_BYTE]:{[j.RGBA]:n.RGBA,[j.RGB]:n.RGB,[j.ALPHA]:n.ALPHA,[j.LUMINANCE]:n.LUMINANCE,[j.LUMINANCE_ALPHA]:n.LUMINANCE_ALPHA},[oe.UNSIGNED_SHORT_5_6_5]:{[j.RGB]:n.RGB},[oe.UNSIGNED_SHORT_4_4_4_4]:{[j.RGBA]:n.RGBA},[oe.UNSIGNED_SHORT_5_5_5_1]:{[j.RGBA]:n.RGBA}},e}class uc{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ge,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Ev(e),this.samplerTypes=Tv(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let s=0;s<t;s++)this.boundTextures[s]=null;this.emptyTextures={};const i=new lo(e.createTexture());e.bindTexture(e.TEXTURE_2D,i.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=i,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new lo(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(e,t=0){const{gl:i}=this;if(e=e?.castToBaseTexture(),e?.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const s=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(e.target,s.texture)),s.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),this.updateTexture(e)):s.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<i.length;s++)i[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<i.length;s++)i[s]===e&&(this.currentLocation!==s&&(t.activeTexture(t.TEXTURE0+s),this.currentLocation=s),t.bindTexture(e.target,this.emptyTextures[e.target].texture),i[s]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:i,CONTEXT_UID:s}=this;if(i)for(let r=e-1;r>=0;--r){const a=t[r];a&&a._glTextures[s].samplerType!==ee.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(e){const t=new lo(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){var i;t.internalFormat=((i=this.internalFormats[e.type])==null?void 0:i[e.format])??e.format,t.samplerType=this.samplerTypes[t.internalFormat]??ee.FLOAT,this.webGLVersion===2&&e.type===oe.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){var t;const i=e._glTextures[this.CONTEXT_UID];if(!i)return;const s=this.renderer;if(this.initTextureType(e,i),(t=e.resource)==null?void 0:t.upload(s,e,i))i.samplerType!==ee.FLOAT&&(this.hasIntegerTextures=!0);else{const r=e.realWidth,a=e.realHeight,o=s.gl;(i.width!==r||i.height!==a||i.dirtyId<0)&&(i.width=r,i.height=a,o.texImage2D(e.target,0,i.internalFormat,r,a,0,e.format,i.type,null))}e.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(e),i.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:i}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),i.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const s=this.managedTextures.indexOf(e);s!==-1&&ys(this.managedTextures,s,1)}}updateTextureStyle(e){var t;const i=e._glTextures[this.CONTEXT_UID];i&&((e.mipmap===Gt.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?i.mipmap=!1:i.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?i.wrapMode=mi.CLAMP:i.wrapMode=e.wrapMode,(t=e.resource)!=null&&t.style(this.renderer,e,i)||this.setStyle(e,i),i.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const i=this.gl;if(t.mipmap&&e.mipmap!==Gt.ON_MANUAL&&i.generateMipmap(e.target),i.texParameteri(e.target,i.TEXTURE_WRAP_S,t.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===jt.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const s=this.renderer.context.extensions.anisotropicFiltering;if(s&&e.anisotropicLevel>0&&e.scaleMode===jt.LINEAR){const r=Math.min(e.anisotropicLevel,i.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(e.target,s.TEXTURE_MAX_ANISOTROPY_EXT,r)}}else i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===jt.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,e.scaleMode===jt.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}uc.extension={type:K.RendererSystem,name:"texture"};se.add(uc);class cc{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:i}=this,s=e._glTransformFeedbacks[i]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:i,renderer:s}=this;t&&s.shader.bind(t),i.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:i,CONTEXT_UID:s}=this,r=t.createTransformFeedback();e._glTransformFeedbacks[s]=r,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,r);for(let a=0;a<e.buffers.length;a++){const o=e.buffers[a];o&&(i.buffer.update(o),o._glBuffers[s].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[s].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),r}disposeTransformFeedback(e,t){const i=e._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this);const r=this.renderer.buffer;if(r)for(let a=0;a<e.buffers.length;a++){const o=e.buffers[a];if(!o)continue;const l=o._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!t&&r.dispose(o,t))}i&&(t||s.deleteTransformFeedback(i),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}cc.extension={type:K.RendererSystem,name:"transformFeedback"};se.add(cc);class ar{constructor(e){this.renderer=e}init(e){this.screen=new ve(0,0,e.width,e.height),this.element=e.view||te.ADAPTER.createCanvas(),this.resolution=e.resolution||te.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const i=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=i,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",i,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){var t;e&&((t=this.element.parentNode)==null||t.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}ar.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},ar.extension={type:[K.RendererSystem,K.CanvasRendererSystem],name:"_view"};se.add(ar);te.PREFER_ENV=ji.WEBGL2;te.STRICT_TEXTURE_CACHE=!1;te.RENDER_OPTIONS={...rr.defaultOptions,...nr.defaultOptions,...ar.defaultOptions,...or.defaultOptions};Object.defineProperties(te,{WRAP_MODE:{get(){return ge.defaultOptions.wrapMode},set(n){xe("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),ge.defaultOptions.wrapMode=n}},SCALE_MODE:{get(){return ge.defaultOptions.scaleMode},set(n){xe("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),ge.defaultOptions.scaleMode=n}},MIPMAP_TEXTURES:{get(){return ge.defaultOptions.mipmap},set(n){xe("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),ge.defaultOptions.mipmap=n}},ANISOTROPIC_LEVEL:{get(){return ge.defaultOptions.anisotropicLevel},set(n){xe("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),ge.defaultOptions.anisotropicLevel=n}},FILTER_RESOLUTION:{get(){return xe("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),nt.defaultResolution},set(n){nt.defaultResolution=n}},FILTER_MULTISAMPLE:{get(){return xe("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),nt.defaultMultisample},set(n){nt.defaultMultisample=n}},SPRITE_MAX_TEXTURES:{get(){return Ci.defaultMaxTextures},set(n){xe("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Ci.defaultMaxTextures=n}},SPRITE_BATCH_SIZE:{get(){return Ci.defaultBatchSize},set(n){xe("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Ci.defaultBatchSize=n}},CAN_UPLOAD_SAME_BUFFER:{get(){return Ci.canUploadSameBuffer},set(n){xe("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Ci.canUploadSameBuffer=n}},GC_MODE:{get(){return Ii.defaultMode},set(n){xe("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Ii.defaultMode=n}},GC_MAX_IDLE:{get(){return Ii.defaultMaxIdle},set(n){xe("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Ii.defaultMaxIdle=n}},GC_MAX_CHECK_COUNT:{get(){return Ii.defaultCheckCountMax},set(n){xe("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Ii.defaultCheckCountMax=n}},PRECISION_VERTEX:{get(){return qt.defaultVertexPrecision},set(n){xe("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),qt.defaultVertexPrecision=n}},PRECISION_FRAGMENT:{get(){return qt.defaultFragmentPrecision},set(n){xe("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),qt.defaultFragmentPrecision=n}}});var Wi=(n=>(n[n.INTERACTION=50]="INTERACTION",n[n.HIGH=25]="HIGH",n[n.NORMAL=0]="NORMAL",n[n.LOW=-25]="LOW",n[n.UTILITY=-50]="UTILITY",n))(Wi||{});class ho{constructor(e,t=null,i=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=i,this.once=s}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const dc=class ht{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new ho(null,null,1/0),this.deltaMS=1/ht.targetFPMS,this.elapsedMS=1/ht.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,i=Wi.NORMAL){return this._addListener(new ho(e,t,i))}addOnce(e,t,i=Wi.NORMAL){return this._addListener(new ho(e,t,i,!0))}_addListener(e){let t=this._head.next,i=this._head;if(!t)e.connect(i);else{for(;t;){if(e.priority>t.priority){e.connect(i);break}i=t,t=t.next}e.previous||e.connect(i)}return this._startIfPossible(),this}remove(e,t){let i=this._head.next;for(;i;)i.match(e,t)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const r=e-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=e-r%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*ht.targetFPMS;const i=this._head;let s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),i=Math.min(Math.max(0,t)/1e3,ht.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!ht._shared){const e=ht._shared=new ht;e.autoStart=!0,e._protected=!0}return ht._shared}static get system(){if(!ht._system){const e=ht._system=new ht;e.autoStart=!0,e._protected=!0}return ht._system}};dc.targetFPMS=.06;let ut=dc;Object.defineProperties(te,{TARGET_FPMS:{get(){return ut.targetFPMS},set(n){xe("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),ut.targetFPMS=n}}});class fc{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Wi.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?ut.shared:new ut,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}fc.extension=K.Application;se.add(fc);const pc=[];se.handleByList(K.Renderer,pc);function mc(n){for(const e of pc)if(e.test(n))return new e(n);throw new Error("Unable to auto-detect a suitable renderer.")}var bv=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Sv=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Av=bv,gc=Sv;class vc{constructor(e){this.renderer=e}contextChange(e){let t;if(this.renderer.context.webGLVersion===1){const i=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,i)}else{const i=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,i)}t>=Ve.HIGH?this.multisample=Ve.HIGH:t>=Ve.MEDIUM?this.multisample=Ve.MEDIUM:t>=Ve.LOW?this.multisample=Ve.LOW:this.multisample=Ve.NONE}destroy(){}}vc.extension={type:K.RendererSystem,name:"_multisample"};se.add(vc);class Rv{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class yc{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:i}=this,s=e._glBuffers[i]||this.createGLBuffer(e);t.bindBuffer(e.type,s.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:i,CONTEXT_UID:s}=this;if(this.boundBufferBases[t]!==e){const r=e._glBuffers[s]||this.createGLBuffer(e);this.boundBufferBases[t]=e,i.bindBufferBase(i.UNIFORM_BUFFER,t,r.buffer)}}bindBufferRange(e,t,i){const{gl:s,CONTEXT_UID:r}=this;i=i||0;const a=e._glBuffers[r]||this.createGLBuffer(e);s.bindBufferRange(s.UNIFORM_BUFFER,t||0,a.buffer,i*256,256)}update(e){const{gl:t,CONTEXT_UID:i}=this,s=e._glBuffers[i]||this.createGLBuffer(e);if(e._updateID!==s.updateID)if(s.updateID=e._updateID,t.bindBuffer(e.type,s.buffer),s.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const r=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;s.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,r)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const i=e._glBuffers[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this),i&&(t||s.deleteBuffer(i.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let i=0;i<t.length;i++)this.dispose(this.managedBuffers[t[i]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:i}=this;return e._glBuffers[t]=new Rv(i.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}yc.extension={type:K.RendererSystem,name:"buffer"};se.add(yc);class xc{constructor(e){this.renderer=e}render(e,t){const i=this.renderer;let s,r,a,o;if(t&&(s=t.renderTexture,r=t.clear,a=t.transform,o=t.skipUpdateTransform),this.renderingToScreen=!s,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=a,!i.context.isLost){if(s||(this.lastObjectRendered=e),!o){const l=e.enableTempParent();e.updateTransform(),e.disableTempParent(l)}i.renderTexture.bind(s),i.batch.currentRenderer.start(),(r??i.background.clearBeforeRender)&&i.renderTexture.clear(),e.render(i),i.batch.currentRenderer.flush(),s&&(t.blit&&i.framebuffer.blit(),s.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}xc.extension={type:K.RendererSystem,name:"objectRenderer"};se.add(xc);const Vn=class Ko extends wv{constructor(e){super(),this.type=mu.WEBGL,e=Object.assign({},te.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new At({projectionMatrix:new Fe},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Ko.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(xe("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=Ko.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return e!=null&&e.forceCanvas?!1:Jm()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return xe("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return xe("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return xe("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return xe("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){xe("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return xe("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){xe("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return xe("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};Vn.extension={type:K.Renderer,priority:1},Vn.__plugins={},Vn.__systems={};let Ba=Vn;se.handleByMap(K.RendererPlugin,Ba.__plugins);se.handleByMap(K.RendererSystem,Ba.__systems);se.add(Ba);class _c extends rn{constructor(e,t){const{width:i,height:s}=t||{};super(i,s),this.items=[],this.itemDirtyIds=[];for(let r=0;r<e;r++){const a=new ge;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let i=0;i<this.length;i++)e[i]&&(e[i].castToBaseTexture?this.addBaseTextureAt(e[i].castToBaseTexture(),i):e[i]instanceof rn?this.addResourceAt(e[i],i):this.addResourceAt(Nu(e[i],t),i))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map(t=>t.resource).filter(t=>t).map(t=>t.load());return this._load=Promise.all(e).then(()=>{const{realWidth:t,realHeight:i}=this.items[0];return this.resize(t,i),this.update(),Promise.resolve(this)}),this._load}}class Pv extends _c{constructor(e,t){const{width:i,height:s}=t||{};let r,a;Array.isArray(e)?(r=e,a=e.length):a=e,super(a,{width:i,height:s}),r&&this.initFromArray(r,t)}addBaseTextureAt(e,t){if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=gs.TEXTURE_2D_ARRAY}upload(e,t,i){const{length:s,itemDirtyIds:r,items:a}=this,{gl:o}=e;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,s,0,t.format,i.type,null);for(let l=0;l<s;l++){const h=a[l];r[l]<h.dirtyId&&(r[l]=h.dirtyId,h.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,l,h.resource.width,h.resource.height,1,t.format,i.type,h.resource.source))}return!0}}class Cv extends Qt{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return t&&e instanceof t?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}}const wc=class Xs extends _c{constructor(e,t){const{width:i,height:s,autoLoad:r,linkBaseTexture:a}=t||{};if(e&&e.length!==Xs.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:i,height:s});for(let o=0;o<Xs.SIDES;o++)this.items[o].target=gs.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=a!==!1,e&&this.initFromArray(e,t),r!==!1&&this.load()}bind(e){super.bind(e),e.target=gs.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=gs.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,i){const s=this.itemDirtyIds;for(let r=0;r<Xs.SIDES;r++){const a=this.items[r];(s[r]<a.dirtyId||i.dirtyId<t.dirtyId)&&(a.valid&&a.resource?(a.resource.upload(e,a,i),s[r]=a.dirtyId):s[r]<-1&&(e.gl.texImage2D(a.target,0,i.internalFormat,t.realWidth,t.realHeight,0,t.format,i.type,null),s[r]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===Xs.SIDES}};wc.SIDES=6;let Iv=wc;class fs extends Qt{constructor(e,t){t=t||{};let i,s,r;typeof e=="string"?(i=fs.EMPTY,s=e,r=!0):(i=e,s=null,r=!1),super(i),this.url=s,this.crossOrigin=t.crossOrigin??!0,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.ownsImageBitmap=t.ownsImageBitmap??r,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(e,t)=>{if(this.url===null){e(this);return}try{const i=await te.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=await i.blob();if(this.destroyed)return;const r=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===at.UNPACK?"premultiply":"none"});if(this.destroyed){r.close();return}this.source=r,this.update(),e(this)}catch(i){if(this.destroyed)return;t(i),this.onError.emit(i)}}),this._load)}upload(e,t,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),super.upload(e,t,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){return fs._EMPTY=fs._EMPTY??te.ADAPTER.createCanvas(0,0),fs._EMPTY}}const Jo=class Wn extends Qt{constructor(e,t){t=t||{},super(te.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.update(),e(this)},Wn.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;Qt.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,i=e.height;if(!t||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=t*this.scale,r=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/i*t,r=this._overrideHeight||this._overrideWidth/t*i),s=Math.round(s),r=Math.round(r);const a=this.source;a.width=s,a.height=r,a._pixiId=`canvas_${Vi()}`,a.getContext("2d").drawImage(e,0,0,t,i,0,0,s,r),this._resolve(),this._resolve=null}}static getSize(e){const t=Wn.SVG_SIZE.exec(e),i={};return t&&(i[t[1]]=Math.round(parseFloat(t[3])),i[t[5]]=Math.round(parseFloat(t[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&Wn.SVG_XML.test(e)}};Jo.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Jo.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Qo=Jo;class Mv extends Qt{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}}const $o=class ea extends Qt{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const i=document.createElement("video");t.autoLoad!==!1&&i.setAttribute("preload","auto"),t.playsinline!==!1&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),t.muted===!0&&(i.setAttribute("muted",""),i.muted=!0),t.loop===!0&&i.setAttribute("loop",""),t.autoPlay!==!1&&i.setAttribute("autoplay",""),typeof e=="string"&&(e=[e]);const s=e[0].src||e[0];Qt.crossOrigin(i,s,t.crossorigin);for(let r=0;r<e.length;++r){const a=document.createElement("source");let{src:o,mime:l}=e[r];if(o=o||e[r],o.startsWith("data:"))l=o.slice(5,o.indexOf(";"));else if(!o.startsWith("blob:")){const h=o.split("?").shift().toLowerCase(),u=h.slice(h.lastIndexOf(".")+1);l=l||ea.MIME_TYPES[u]||`video/${u}`}a.src=o,l&&(a.type=l),i.appendChild(a)}e=i}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){const t=ut.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((t,i)=>{this.valid?t(this):(this._resolve=t,this._reject=i,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(ut.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(ut.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(ut.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||ea.TYPES.includes(t)}};$o.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],$o.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Tc=$o;Ho.push(fs,Xu,Cv,Tc,Mv,Qo,_r,Iv,Pv);class lr{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?ve.EMPTY:(e=e||new ve(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:i,b:s,c:r,d:a,tx:o,ty:l}=e,h=i*t.x+r*t.y+o,u=s*t.x+a*t.y+l;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(e){let t=this.minX,i=this.minY,s=this.maxX,r=this.maxY,a=e[0],o=e[1];t=a<t?a:t,i=o<i?o:i,s=a>s?a:s,r=o>r?o:r,a=e[2],o=e[3],t=a<t?a:t,i=o<i?o:i,s=a>s?a:s,r=o>r?o:r,a=e[4],o=e[5],t=a<t?a:t,i=o<i?o:i,s=a>s?a:s,r=o>r?o:r,a=e[6],o=e[7],t=a<t?a:t,i=o<i?o:i,s=a>s?a:s,r=o>r?o:r,this.minX=t,this.minY=i,this.maxX=s,this.maxY=r}addFrame(e,t,i,s,r){this.addFrameMatrix(e.worldTransform,t,i,s,r)}addFrameMatrix(e,t,i,s,r){const a=e.a,o=e.b,l=e.c,h=e.d,u=e.tx,c=e.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,v=a*t+l*i+u,g=o*t+h*i+c;d=v<d?v:d,f=g<f?g:f,p=v>p?v:p,m=g>m?g:m,v=a*s+l*i+u,g=o*s+h*i+c,d=v<d?v:d,f=g<f?g:f,p=v>p?v:p,m=g>m?g:m,v=a*t+l*r+u,g=o*t+h*r+c,d=v<d?v:d,f=g<f?g:f,p=v>p?v:p,m=g>m?g:m,v=a*s+l*r+u,g=o*s+h*r+c,d=v<d?v:d,f=g<f?g:f,p=v>p?v:p,m=g>m?g:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(e,t,i){let s=this.minX,r=this.minY,a=this.maxX,o=this.maxY;for(let l=t;l<i;l+=2){const h=e[l],u=e[l+1];s=h<s?h:s,r=u<r?u:r,a=h>a?h:a,o=u>o?u:o}this.minX=s,this.minY=r,this.maxX=a,this.maxY=o}addVertices(e,t,i,s){this.addVerticesMatrix(e.worldTransform,t,i,s)}addVerticesMatrix(e,t,i,s,r=0,a=r){const o=e.a,l=e.b,h=e.c,u=e.d,c=e.tx,d=e.ty;let f=this.minX,p=this.minY,m=this.maxX,v=this.maxY;for(let g=i;g<s;g+=2){const T=t[g],w=t[g+1],E=o*T+h*w+c,P=u*w+l*T+d;f=Math.min(f,E-r),m=Math.max(m,E+r),p=Math.min(p,P-a),v=Math.max(v,P+a)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=v}addBounds(e){const t=this.minX,i=this.minY,s=this.maxX,r=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<i?e.minY:i,this.maxX=e.maxX>s?e.maxX:s,this.maxY=e.maxY>r?e.maxY:r}addBoundsMask(e,t){const i=e.minX>t.minX?e.minX:t.minX,s=e.minY>t.minY?e.minY:t.minY,r=e.maxX<t.maxX?e.maxX:t.maxX,a=e.maxY<t.maxY?e.maxY:t.maxY;if(i<=r&&s<=a){const o=this.minX,l=this.minY,h=this.maxX,u=this.maxY;this.minX=i<o?i:o,this.minY=s<l?s:l,this.maxX=r>h?r:h,this.maxY=a>u?a:u}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const i=e.minX>t.x?e.minX:t.x,s=e.minY>t.y?e.minY:t.y,r=e.maxX<t.x+t.width?e.maxX:t.x+t.width,a=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(i<=r&&s<=a){const o=this.minX,l=this.minY,h=this.maxX,u=this.maxY;this.minX=i<o?i:o,this.minY=s<l?s:l,this.maxX=r>h?r:h,this.maxY=a>u?a:u}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,i,s,r,a){e-=r,t-=a,i+=r,s+=a,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>s?this.maxY:s}}class He extends ln{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Ma,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new lr,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let i=0;i<t.length;++i){const s=t[i];Object.defineProperty(He.prototype,s,Object.getOwnPropertyDescriptor(e,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new ve),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new ve),e=this._localBoundsRect),this._localBounds||(this._localBounds=new lr);const t=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=i?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,r=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,e);return this.parent=i,this.transform=t,this._bounds=s,this._bounds.updateID+=this._boundsID-r,a}toGlobal(e,t,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,i,s){return t&&(e=t.toGlobal(e,i,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,i)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e=0,t=0,i=1,s=1,r=0,a=0,o=0,l=0,h=0){return this.position.x=e,this.position.y=t,this.scale.x=i||1,this.scale.y=s||1,this.rotation=r,this.skew.x=a,this.skew.y=o,this.pivot.x=l,this.pivot.y=h,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new Dv),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*Sg}set angle(e){this.transform.rotation=e*Ag}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,t._maskRefCount===0&&(t.renderable=!0,t.isMask=!1))}if(this._mask=e,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount===0&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class Dv extends He{constructor(){super(...arguments),this.sortDirty=null}}He.prototype.displayObjectUpdateTransform=He.prototype.updateTransform;const Bv=new Fe;function Ov(n,e){return n.zIndex===e.zIndex?n._lastSortedIndex-e._lastSortedIndex:n.zIndex-e.zIndex}const Ec=class ta extends He{constructor(){super(),this.children=[],this.sortableChildren=ta.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const i=this.getChildIndex(e),s=this.getChildIndex(t);this.children[i]=t,this.children[s]=e,this.onChildrenChange(i<s?i:s)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(e);ys(this.children,i,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],i=this.children.indexOf(t);if(i===-1)return null;t.parent=null,t.transform._parentID=-1,ys(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,ys(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const i=e,s=t,r=s-i;let a;if(r>0&&r<=s){a=this.children.splice(i,r);for(let o=0;o<a.length;++o)a[o].parent=null,a[o].transform&&(a[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let o=0;o<a.length;++o)a[o].emit("removed",this),this.emit("childRemoved",a[o],this,o);return a}else if(r===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,i=this.children.length;t<i;++t){const s=this.children[t];s._lastSortedIndex=t,!e&&s.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(Ov),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const i=this.children[e];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(t._bounds,i._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const i=super.getLocalBounds(e);if(!t)for(let s=0,r=this.children.length;s<r;++s){const a=this.children[s];a.visible&&a.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let i,s;this.cullArea?(i=this.cullArea,s=this.worldTransform):this._render!==ta.prototype._render&&(i=this.getBounds(!0));const r=e.projection.transform;if(r&&(s?(s=Bv.copyFrom(s),s.prepend(r)):s=r),i&&t.intersects(i,s))this._render(e);else if(this.cullArea)return;for(let a=0,o=this.children.length;a<o;++a){const l=this.children[a],h=l.cullable;l.cullable=h||!this.cullArea,l.render(e),l.cullable=h}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let i=0,s=this.children.length;i<s;++i)this.children[i].render(e)}}renderAdvanced(e){var t,i,s;const r=this.filters,a=this._mask;if(r){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let l=0;l<r.length;l++)r[l].enabled&&this._enabledFilters.push(r[l])}const o=r&&((t=this._enabledFilters)==null?void 0:t.length)||a&&(!a.isMaskData||a.enabled&&(a.autoDetect||a.type!==je.NONE));if(o&&e.batch.flush(),r&&(i=this._enabledFilters)!=null&&i.length&&e.filter.push(this,this._enabledFilters),a&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let l=0,h=this.children.length;l<h;++l)this.children[l].render(e)}o&&e.batch.flush(),a&&e.mask.pop(this),r&&(s=this._enabledFilters)!=null&&s.length&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e?.children,i=this.removeChildren(0,this.children.length);if(t)for(let s=0;s<i.length;++s)i[s].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};Ec.defaultSortableChildren=!1;let Rt=Ec;Rt.prototype.containerUpdateTransform=Rt.prototype.updateTransform;Object.defineProperties(te,{SORTABLE_CHILDREN:{get(){return Rt.defaultSortableChildren},set(n){xe("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Rt.defaultSortableChildren=n}}});const Us=new Te,Lv=new Uint16Array([0,1,2,0,2,3]);class Ds extends Rt{constructor(e){super(),this._anchor=new Yt(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Oe(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=ce.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||ie.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Lv,this.pluginName="batch",this.isSprite=!0,this._roundPixels=te.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=fi(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=fi(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const t=this.transform.worldTransform,i=t.a,s=t.b,r=t.c,a=t.d,o=t.tx,l=t.ty,h=this.vertexData,u=e.trim,c=e.orig,d=this._anchor;let f=0,p=0,m=0,v=0;if(u?(p=u.x-d._x*c.width,f=p+u.width,v=u.y-d._y*c.height,m=v+u.height):(p=-d._x*c.width,f=p+c.width,v=-d._y*c.height,m=v+c.height),h[0]=i*p+r*v+o,h[1]=a*v+s*p+l,h[2]=i*f+r*v+o,h[3]=a*v+s*f+l,h[4]=i*f+r*m+o,h[5]=a*m+s*f+l,h[6]=i*p+r*m+o,h[7]=a*m+s*p+l,this._roundPixels){const g=te.RESOLUTION;for(let T=0;T<h.length;++T)h[T]=Math.round(h[T]*g)/g}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,t=this.vertexTrimmedData,i=e.orig,s=this._anchor,r=this.transform.worldTransform,a=r.a,o=r.b,l=r.c,h=r.d,u=r.tx,c=r.ty,d=-s._x*i.width,f=d+i.width,p=-s._y*i.height,m=p+i.height;if(t[0]=a*d+l*p+u,t[1]=h*p+o*d+c,t[2]=a*f+l*p+u,t[3]=h*p+o*f+c,t[4]=a*f+l*m+u,t[5]=h*m+o*f+c,t[6]=a*d+l*m+u,t[7]=h*m+o*d+c,this._roundPixels){const v=te.RESOLUTION;for(let g=0;g<t.length;++g)t[g]=Math.round(t[g]*v)/v}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return this.children.length===0?(this._localBounds||(this._localBounds=new lr),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new ve),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,Us);const t=this._texture.orig.width,i=this._texture.orig.height,s=-t*this.anchor.x;let r=0;return Us.x>=s&&Us.x<s+t&&(r=-i*this.anchor.y,Us.y>=r&&Us.y<r+i)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof e=="boolean"?e:e?.texture){const t=typeof e=="boolean"?e:e?.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){const i=e instanceof ie?e:ie.from(e,t);return new Ds(i)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=fi(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=fi(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||ie.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const bc=new Fe;He.prototype._cacheAsBitmap=!1;He.prototype._cacheData=null;He.prototype._cacheAsBitmapResolution=null;He.prototype._cacheAsBitmapMultisample=null;class Fv{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(He.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(n){n!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=n,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(n){n!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=n,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(n){if(this._cacheAsBitmap===n)return;this._cacheAsBitmap=n;let e;n?(this._cacheData||(this._cacheData=new Fv),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}});He.prototype._renderCached=function(n){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(n),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(n))};He.prototype._initCachedDisplayObject=function(n){var e,t;if((e=this._cacheData)!=null&&e.sprite)return;const i=this.alpha;this.alpha=1,n.batch.flush();const s=this.getLocalBounds(new ve,!0);if((t=this.filters)!=null&&t.length){const p=this.filters[0].padding;s.pad(p)}const r=this.cacheAsBitmapResolution||n.resolution;s.ceil(r),s.width=Math.max(s.width,1/r),s.height=Math.max(s.height,1/r);const a=n.renderTexture.current,o=n.renderTexture.sourceFrame.clone(),l=n.renderTexture.destinationFrame.clone(),h=n.projection.transform,u=Xi.create({width:s.width,height:s.height,resolution:r,multisample:this.cacheAsBitmapMultisample??n.multisample}),c=`cacheAsBitmap_${Vi()}`;this._cacheData.textureCacheId=c,ge.addToCache(u.baseTexture,c),ie.addToCache(u,c);const d=this.transform.localTransform.copyTo(bc).invert().translate(-s.x,-s.y);this.render=this._cacheData.originalRender,n.render(this,{renderTexture:u,clear:!0,transform:d,skipUpdateTransform:!1}),n.framebuffer.blit(),n.projection.transform=h,n.renderTexture.bind(a,o,l),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const f=new Ds(u);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-(s.x/s.width),f.anchor.y=-(s.y/s.height),f.alpha=i,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=f.containsPoint.bind(f)};He.prototype._renderCachedCanvas=function(n){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(n),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(n))};He.prototype._initCachedDisplayObjectCanvas=function(n){var e;if((e=this._cacheData)!=null&&e.sprite)return;const t=this.getLocalBounds(new ve,!0),i=this.alpha;this.alpha=1;const s=n.canvasContext.activeContext,r=n._projTransform,a=this.cacheAsBitmapResolution||n.resolution;t.ceil(a),t.width=Math.max(t.width,1/a),t.height=Math.max(t.height,1/a);const o=Xi.create({width:t.width,height:t.height,resolution:a}),l=`cacheAsBitmap_${Vi()}`;this._cacheData.textureCacheId=l,ge.addToCache(o.baseTexture,l),ie.addToCache(o,l);const h=bc;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=t.x,h.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,n.render(this,{renderTexture:o,clear:!0,transform:h,skipUpdateTransform:!1}),n.canvasContext.activeContext=s,n._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const u=new Ds(o);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(t.x/t.width),u.anchor.y=-(t.y/t.height),u.alpha=i,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=n._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=u.containsPoint.bind(u)};He.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};He.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};He.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,ge.removeFromCache(this._cacheData.textureCacheId),ie.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};He.prototype._cacheAsBitmapDestroy=function(n){this.cacheAsBitmap=!1,this.destroy(n)};He.prototype.name=null;Rt.prototype.getChildByName=function(n,e){for(let t=0,i=this.children.length;t<i;t++)if(this.children[t].name===n)return this.children[t];if(e)for(let t=0,i=this.children.length;t<i;t++){const s=this.children[t];if(!s.getChildByName)continue;const r=s.getChildByName(n,!0);if(r)return r}return null};He.prototype.getGlobalPosition=function(n=new Te,e=!1){return this.parent?this.parent.toGlobal(this.position,n,e):(n.x=this.position.x,n.y=this.position.y),n};var Nv=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class kv extends nt{constructor(e=1){super(Av,Nv,{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}const Uv={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Hv=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function Gv(n){const e=Uv[n],t=e.length;let i=Hv,s="";const r="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let a;for(let o=0;o<n;o++){let l=r.replace("%index%",o.toString());a=o,o>=t&&(a=n-o-1),l=l.replace("%value%",e[a].toString()),s+=l,s+=`
`}return i=i.replace("%blur%",s),i=i.replace("%size%",n.toString()),i}const zv=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function Vv(n,e){const t=Math.ceil(n/2);let i=zv,s="",r;e?r="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":r="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let a=0;a<n;a++){let o=r.replace("%index%",a.toString());o=o.replace("%sampleIndex%",`${a-(t-1)}.0`),s+=o,s+=`
`}return i=i.replace("%blur%",s),i=i.replace("%size%",n.toString()),i}class ia extends nt{constructor(e,t=8,i=4,s=nt.defaultResolution,r=5){const a=Vv(r,e),o=Gv(r);super(a,o),this.horizontal=e,this.resolution=s,this._quality=0,this.quality=i,this.blur=t}apply(e,t,i,s){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/t.width):this.uniforms.strength=1/i.height*(i.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)e.applyFilter(this,t,i,s);else{const r=e.getFilterTexture(),a=e.renderer;let o=t,l=r;this.state.blend=!1,e.applyFilter(this,o,l,Ft.CLEAR);for(let h=1;h<this.passes-1;h++){e.bindAndClear(o,Ft.BLIT),this.uniforms.uSampler=l;const u=l;l=o,o=u,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,l,i,s),e.returnFilterTexture(r)}}get blur(){return this.strength}set blur(e){this.padding=1+Math.abs(e)*2,this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class Wv extends nt{constructor(e=8,t=4,i=nt.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new ia(!0,e,t,i,s),this.blurYFilter=new ia(!1,e,t,i,s),this.resolution=i,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,i,s){const r=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(r&&a){const o=e.getFilterTexture();this.blurXFilter.apply(e,t,o,Ft.CLEAR),this.blurYFilter.apply(e,o,i,s),e.returnFilterTexture(o)}else a?this.blurYFilter.apply(e,t,i,s):this.blurXFilter.apply(e,t,i,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}}var jv=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class sa extends nt{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(gc,jv,e),this.alpha=1}_loadMatrix(e,t=!1){let i=e;t&&(this._multiply(i,this.uniforms.m,e),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(e,t,i){return e[0]=t[0]*i[0]+t[1]*i[5]+t[2]*i[10]+t[3]*i[15],e[1]=t[0]*i[1]+t[1]*i[6]+t[2]*i[11]+t[3]*i[16],e[2]=t[0]*i[2]+t[1]*i[7]+t[2]*i[12]+t[3]*i[17],e[3]=t[0]*i[3]+t[1]*i[8]+t[2]*i[13]+t[3]*i[18],e[4]=t[0]*i[4]+t[1]*i[9]+t[2]*i[14]+t[3]*i[19]+t[4],e[5]=t[5]*i[0]+t[6]*i[5]+t[7]*i[10]+t[8]*i[15],e[6]=t[5]*i[1]+t[6]*i[6]+t[7]*i[11]+t[8]*i[16],e[7]=t[5]*i[2]+t[6]*i[7]+t[7]*i[12]+t[8]*i[17],e[8]=t[5]*i[3]+t[6]*i[8]+t[7]*i[13]+t[8]*i[18],e[9]=t[5]*i[4]+t[6]*i[9]+t[7]*i[14]+t[8]*i[19]+t[9],e[10]=t[10]*i[0]+t[11]*i[5]+t[12]*i[10]+t[13]*i[15],e[11]=t[10]*i[1]+t[11]*i[6]+t[12]*i[11]+t[13]*i[16],e[12]=t[10]*i[2]+t[11]*i[7]+t[12]*i[12]+t[13]*i[17],e[13]=t[10]*i[3]+t[11]*i[8]+t[12]*i[13]+t[13]*i[18],e[14]=t[10]*i[4]+t[11]*i[9]+t[12]*i[14]+t[13]*i[19]+t[14],e[15]=t[15]*i[0]+t[16]*i[5]+t[17]*i[10]+t[18]*i[15],e[16]=t[15]*i[1]+t[16]*i[6]+t[17]*i[11]+t[18]*i[16],e[17]=t[15]*i[2]+t[16]*i[7]+t[17]*i[12]+t[18]*i[17],e[18]=t[15]*i[3]+t[16]*i[8]+t[17]*i[13]+t[18]*i[18],e[19]=t[15]*i[4]+t[16]*i[9]+t[17]*i[14]+t[18]*i[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const i=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)}tint(e,t){const[i,s,r]=Oe.shared.setValue(e).toArray(),a=[i,0,0,0,0,0,s,0,0,0,0,0,r,0,0,0,0,0,1,0];this._loadMatrix(a,t)}greyscale(e,t){const i=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)}blackAndWhite(e){const t=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(t,e)}hue(e,t){e=(e||0)/180*Math.PI;const i=Math.cos(e),s=Math.sin(e),r=Math.sqrt,a=1/3,o=r(a),l=i+(1-i)*a,h=a*(1-i)-o*s,u=a*(1-i)+o*s,c=a*(1-i)+o*s,d=i+a*(1-i),f=a*(1-i)-o*s,p=a*(1-i)-o*s,m=a*(1-i)+o*s,v=i+a*(1-i),g=[l,h,u,0,0,c,d,f,0,0,p,m,v,0,0,0,0,0,1,0];this._loadMatrix(g,t)}contrast(e,t){const i=(e||0)+1,s=-.5*(i-1),r=[i,0,0,0,s,0,i,0,0,s,0,0,i,0,s,0,0,0,1,0];this._loadMatrix(r,t)}saturate(e=0,t){const i=e*2/3+1,s=(i-1)*-.5,r=[i,s,s,0,0,s,i,s,0,0,s,s,i,0,0,0,0,0,1,0];this._loadMatrix(r,t)}desaturate(){this.saturate(-1)}negative(e){const t=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(t,e)}sepia(e){const t=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(t,e)}technicolor(e){const t=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(t,e)}polaroid(e){const t=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(t,e)}toBGR(e){const t=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)}kodachrome(e){const t=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(t,e)}browni(e){const t=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(t,e)}vintage(e){const t=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(t,e)}colorTone(e,t,i,s,r){e=e||.2,t=t||.15,i=i||16770432,s=s||3375104;const a=Oe.shared,[o,l,h]=a.setValue(i).toArray(),[u,c,d]=a.setValue(s).toArray(),f=[.3,.59,.11,0,0,o,l,h,e,0,u,c,d,t,0,o-u,l-c,h-d,0,0];this._loadMatrix(f,r)}night(e,t){e=e||.1;const i=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(i,t)}predator(e,t){const i=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(i,t)}lsd(e){const t=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(t,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}sa.prototype.grayscale=sa.prototype.greyscale;var Xv=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,Yv=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class qv extends nt{constructor(e,t){const i=new Fe;e.renderable=!1,super(Yv,Xv,{mapSampler:e._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=i,t==null&&(t=20),this.scale=new Te(t,t)}apply(e,t,i,s){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const r=this.maskSprite.worldTransform,a=Math.sqrt(r.a*r.a+r.b*r.b),o=Math.sqrt(r.c*r.c+r.d*r.d);a!==0&&o!==0&&(this.uniforms.rotation[0]=r.a/a,this.uniforms.rotation[1]=r.b/a,this.uniforms.rotation[2]=r.c/o,this.uniforms.rotation[3]=r.d/o),e.applyFilter(this,t,i,s)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}}var Zv=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,Kv=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class Jv extends nt{constructor(){super(Kv,Zv)}}var Qv=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class $v extends nt{constructor(e=.5,t=Math.random()){super(gc,Qv,{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}const ch={AlphaFilter:kv,BlurFilter:Wv,BlurFilterPass:ia,ColorMatrixFilter:sa,DisplacementFilter:qv,FXAAFilter:Jv,NoiseFilter:$v};Object.entries(ch).forEach(([n,e])=>{Object.defineProperty(ch,n,{get(){return xe("7.1.0",`filters.${n} has moved to ${n}`),e}})});class ey{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(ut.system.add(this.tickerUpdate,this,Wi.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(ut.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const li=new ey;class un{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=un.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Te,this.page=new Te,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,i,s,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class hr extends un{constructor(){super(...arguments),this.client=new Te,this.movement=new Te,this.offset=new Te,this.global=new Te,this.screen=new Te}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,i){return e.worldTransform.applyInverse(i||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,i,s,r,a,o,l,h,u,c,d,f,p,m){throw new Error("Method not implemented.")}}class wt extends hr{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class _s extends hr{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}_s.DOM_DELTA_PIXEL=0,_s.DOM_DELTA_LINE=1,_s.DOM_DELTA_PAGE=2;const ty=2048,iy=new Te,uo=new Te;class sy{constructor(e){this.dispatch=new ln,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((i,s)=>i.priority-s.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let i=0,s=t.length;i<s;i++)t[i].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){li.pauseUpdate=!0;const i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",s=this[i](this.rootTarget,this.rootTarget.eventMode,iy.set(e,t),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(e,t){if(!e.target)return;const i=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let s=0,r=i.length-1;s<r;s++)if(e.currentTarget=i[s],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let s=i.length-2;s>=0;s--)if(e.currentTarget=i[s],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,i=this._allInteractiveElements){if(i.length===0)return;e.eventPhase=e.BUBBLING_PHASE;const s=Array.isArray(t)?t:[t];for(let r=i.length-1;r>=0;r--)s.forEach(a=>{e.currentTarget=i[r],this.notifyTarget(e,a)})}propagationPath(e){const t=[e];for(let i=0;i<ty&&e!==this.rootTarget;i++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,i,s,r,a=!1){let o=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(li.pauseUpdate=!1),e.interactiveChildren&&e.children){const u=e.children;for(let c=u.length-1;c>=0;c--){const d=u[c],f=this.hitTestMoveRecursive(d,this._isInteractive(t)?t:d.eventMode,i,s,r,a||r(e,i));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=e.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(e),f.push(e)),this._hitElements.length===0&&(this._hitElements=f),o=!0}}}const l=this._isInteractive(t),h=e.isInteractive();return l&&h&&this._allInteractiveElements.push(e),a||this._hitElements.length>0?null:o?this._hitElements:l&&!r(e,i)&&s(e,i)?h?[e]:[]:null}hitTestRecursive(e,t,i,s,r){if(this._interactivePrune(e)||r(e,i))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(li.pauseUpdate=!1),e.interactiveChildren&&e.children){const l=e.children;for(let h=l.length-1;h>=0;h--){const u=l[h],c=this.hitTestRecursive(u,this._isInteractive(t)?t:u.eventMode,i,s,r);if(c){if(c.length>0&&!c[c.length-1].parent)continue;const d=e.isInteractive();return(c.length>0||d)&&c.push(e),c}}}const a=this._isInteractive(t),o=e.isInteractive();return a&&s(e,i)?o?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!!(!e||e.isMask||!e.visible||!e.renderable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren||e.isMask)}hitPruneFn(e,t){var i;if(e.hitArea&&(e.worldTransform.applyInverse(t,uo),!e.hitArea.contains(uo.x,uo.y)))return!0;if(e._mask){const s=e._mask.isMaskData?e._mask.maskObject:e._mask;if(s&&!((i=s.containsPoint)!=null&&i.call(s,t)))return!0}return!1}hitTestFn(e,t){return e.eventMode==="passive"?!1:e.hitArea?!0:e.containsPoint?e.containsPoint(t):!1}notifyTarget(e,t){var i,s;t=t??e.type;const r=`on${t}`;(s=(i=e.currentTarget)[r])==null||s.call(i,e);const a=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,a),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof wt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),t.pointerType==="touch")this.dispatchEvent(t,"touchstart");else if(t.pointerType==="mouse"||t.pointerType==="pen"){const s=t.button===2;this.dispatchEvent(t,s?"rightdown":"mousedown")}const i=this.trackingData(e.pointerId);i.pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){var t,i;if(!(e instanceof wt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const s=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const r=s.pointerType==="mouse"||s.pointerType==="pen",a=this.trackingData(e.pointerId),o=this.findMountedTarget(a.overTargets);if(((t=a.overTargets)==null?void 0:t.length)>0&&o!==s.target){const u=e.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(e,u,o);if(this.dispatchEvent(c,"pointerout"),r&&this.dispatchEvent(c,"mouseout"),!s.composedPath().includes(o)){const d=this.createPointerEvent(e,"pointerleave",o);for(d.eventPhase=d.AT_TARGET;d.target&&!s.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),r&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(c)}if(o!==s.target){const u=e.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(s,u);this.dispatchEvent(c,"pointerover"),r&&this.dispatchEvent(c,"mouseover");let d=o?.parent;for(;d&&d!==this.rootTarget.parent&&d!==s.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const f=this.clonePointerEvent(s,"pointerenter");for(f.eventPhase=f.AT_TARGET;f.target&&f.target!==o&&f.target!==this.rootTarget.parent;)f.currentTarget=f.target,this.notifyTarget(f),r&&this.notifyTarget(f,"mouseenter"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(c)}const l=[],h=this.enableGlobalMoveEvents??!0;this.moveOnAll?l.push("pointermove"):this.dispatchEvent(s,"pointermove"),h&&l.push("globalpointermove"),s.pointerType==="touch"&&(this.moveOnAll?l.splice(1,0,"touchmove"):this.dispatchEvent(s,"touchmove"),h&&l.push("globaltouchmove")),r&&(this.moveOnAll?l.splice(1,0,"mousemove"):this.dispatchEvent(s,"mousemove"),h&&l.push("globalmousemove"),this.cursor=(i=s.target)==null?void 0:i.cursor),l.length>0&&this.all(s,l),this._allInteractiveElements.length=0,this._hitElements.length=0,a.overTargets=s.composedPath(),this.freeEvent(s)}mapPointerOver(e){var t;if(!(e instanceof wt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=this.trackingData(e.pointerId),s=this.createPointerEvent(e),r=s.pointerType==="mouse"||s.pointerType==="pen";this.dispatchEvent(s,"pointerover"),r&&this.dispatchEvent(s,"mouseover"),s.pointerType==="mouse"&&(this.cursor=(t=s.target)==null?void 0:t.cursor);const a=this.clonePointerEvent(s,"pointerenter");for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),r&&this.notifyTarget(a,"mouseenter"),a.target=a.target.parent;i.overTargets=s.composedPath(),this.freeEvent(s),this.freeEvent(a)}mapPointerOut(e){if(!(e instanceof wt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId);if(t.overTargets){const i=e.pointerType==="mouse"||e.pointerType==="pen",s=this.findMountedTarget(t.overTargets),r=this.createPointerEvent(e,"pointerout",s);this.dispatchEvent(r),i&&this.dispatchEvent(r,"mouseout");const a=this.createPointerEvent(e,"pointerleave",s);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),i&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;t.overTargets=null,this.freeEvent(r),this.freeEvent(a)}this.cursor=null}mapPointerUp(e){if(!(e instanceof wt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=performance.now(),i=this.createPointerEvent(e);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const o=i.button===2;this.dispatchEvent(i,o?"rightup":"mouseup")}const s=this.trackingData(e.pointerId),r=this.findMountedTarget(s.pressTargetsByButton[e.button]);let a=r;if(r&&!i.composedPath().includes(r)){let o=r;for(;o&&!i.composedPath().includes(o);){if(i.currentTarget=o,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const l=i.button===2;this.notifyTarget(i,l?"rightupoutside":"mouseupoutside")}o=o.parent}delete s.pressTargetsByButton[e.button],a=o}if(a){const o=this.clonePointerEvent(i,"click");o.target=a,o.path=null,s.clicksByButton[e.button]||(s.clicksByButton[e.button]={clickCount:0,target:o.target,timeStamp:t});const l=s.clicksByButton[e.button];if(l.target===o.target&&t-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=o.target,l.timeStamp=t,o.detail=l.clickCount,o.pointerType==="mouse"){const h=o.button===2;this.dispatchEvent(o,h?"rightclick":"click")}else o.pointerType==="touch"&&this.dispatchEvent(o,"tap");this.dispatchEvent(o,"pointertap"),this.freeEvent(o)}this.freeEvent(i)}mapPointerUpOutside(e){if(!(e instanceof wt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),i=this.findMountedTarget(t.pressTargetsByButton[e.button]),s=this.createPointerEvent(e);if(i){let r=i;for(;r;)s.currentTarget=r,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),r=r.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(s)}mapWheel(e){if(!(e instanceof _s)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let i=1;i<e.length&&e[i].parent===t;i++)t=e[i];return t}createPointerEvent(e,t,i){const s=this.allocateEvent(wt);return this.copyPointerData(e,s),this.copyMouseData(e,s),this.copyData(e,s),s.nativeEvent=e.nativeEvent,s.originalEvent=e,s.target=i??this.hitTest(s.global.x,s.global.y)??this._hitElements[0],typeof t=="string"&&(s.type=t),s}createWheelEvent(e){const t=this.allocateEvent(_s);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const i=this.allocateEvent(wt);return i.nativeEvent=e.nativeEvent,i.originalEvent=e.originalEvent,this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.target=e.target,i.path=e.composedPath().slice(),i.type=t??i.type,i}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof wt&&t instanceof wt&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof hr&&t instanceof hr&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const i=e.currentTarget._events[t];if(i&&e.currentTarget.isInteractive())if("fn"in i)i.once&&e.currentTarget.removeListener(t,i.fn,void 0,!0),i.fn.call(i.context,e);else for(let s=0,r=i.length;s<r&&!e.propagationImmediatelyStopped;s++)i[s].once&&e.currentTarget.removeListener(t,i[s].fn,void 0,!0),i[s].fn.call(i[s].context,e)}}const ny=1,ry={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},na=class ra{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new sy(null),li.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new wt(null),this.rootWheelEvent=new _s(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...ra.defaultEventFeatures},{set:(t,i,s)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=s),t[i]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:t,resolution:i}=this.renderer;this.setTargetElement(t),this.resolution=i,ra._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const i=this.cursorStyles[e];if(i)switch(typeof i){case"string":t&&(this.domElement.style.cursor=i);break;case"function":i(e);break;case"object":t&&Object.assign(this.domElement.style,i);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let i=0,s=t.length;i<s;i++){const r=t[i],a=this.bootstrapEvent(this.rootPointerEvent,r);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,li.pointerMoved();const t=this.normalizeToPointerData(e);for(let i=0,s=t.length;i<s;i++){const r=this.bootstrapEvent(this.rootPointerEvent,t[i]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const i=t!==this.domElement?"outside":"",s=this.normalizeToPointerData(e);for(let r=0,a=s.length;r<a;r++){const o=this.bootstrapEvent(this.rootPointerEvent,s[r]);o.type+=i,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);for(let i=0,s=t.length;i<s;i++){const r=this.bootstrapEvent(this.rootPointerEvent,t[i]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,li.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;li.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;li.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,i){const s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},r=1/this.resolution;e.x=(t-s.left)*(this.domElement.width/s.width)*r,e.y=(i-s.top)*(this.domElement.height/s.height)*r}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let i=0,s=e.changedTouches.length;i<s;i++){const r=e.changedTouches[i];typeof r.button>"u"&&(r.button=0),typeof r.buttons>"u"&&(r.buttons=1),typeof r.isPrimary>"u"&&(r.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof r.width>"u"&&(r.width=r.radiusX||1),typeof r.height>"u"&&(r.height=r.radiusY||1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="touch"),typeof r.pointerId>"u"&&(r.pointerId=r.identifier||0),typeof r.pressure>"u"&&(r.pressure=r.force||.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),typeof r.layerX>"u"&&(r.layerX=r.offsetX=r.clientX),typeof r.layerY>"u"&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=e.type,t.push(r)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){const i=e;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=ny),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,t.push(i)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=ry[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};na.extension={name:"events",type:[K.RendererSystem,K.CanvasRendererSystem]},na.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let oa=na;se.add(oa);function dh(n){return n==="dynamic"||n==="static"}const oy={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??dh(oa.defaultEventMode)},set interactive(n){xe("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=n,this.eventMode=n?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??oa.defaultEventMode},set eventMode(n){this._internalInteractive=dh(n),this._internalEventMode=n},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(n,e,t){const i=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,s=typeof t=="object"?t.signal:void 0,r=typeof t=="object"?t.once===!0:!1,a=typeof e=="function"?void 0:e;n=i?`${n}capture`:n;const o=typeof e=="function"?e:e.handleEvent,l=this;s&&s.addEventListener("abort",()=>{l.off(n,o,a)}),r?l.once(n,o,a):l.on(n,o,a)},removeEventListener(n,e,t){const i=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,s=typeof e=="function"?void 0:e;n=i?`${n}capture`:n,e=typeof e=="function"?e:e.handleEvent,this.off(n,e,s)},dispatchEvent(n){if(!(n instanceof un))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return n.defaultPrevented=!1,n.path=null,n.target=this,n.manager.dispatchEvent(n),!n.defaultPrevented}};He.mixin(oy);const ay={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};He.mixin(ay);const ly=9,An=100,hy=0,uy=0,fh=2,ph=1,cy=-1e3,dy=-1e3,fy=2;class Sc{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Xt.tablet||Xt.phone)&&this.createTouchHook();const t=document.createElement("div");t.style.width=`${An}px`,t.style.height=`${An}px`,t.style.position="absolute",t.style.top=`${hy}px`,t.style.left=`${uy}px`,t.style.zIndex=fh.toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width=`${ph}px`,e.style.height=`${ph}px`,e.style.position="absolute",e.style.top=`${cy}px`,e.style.left=`${dy}px`,e.style.zIndex=fy.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)==null||e.appendChild(this.div))}deactivate(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)==null||e.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let i=0;i<t.length;i++)this.updateAccessibleObjects(t[i])}update(){const e=performance.now();if(Xt.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:t,y:i,width:s,height:r}=this.renderer.view.getBoundingClientRect(),{width:a,height:o,resolution:l}=this.renderer,h=s/a*l,u=r/o*l;let c=this.div;c.style.left=`${t}px`,c.style.top=`${i}px`,c.style.width=`${a}px`,c.style.height=`${o}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,ys(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{c=f._accessibleDiv;let p=f.hitArea;const m=f.worldTransform;f.hitArea?(c.style.left=`${(m.tx+p.x*m.a)*h}px`,c.style.top=`${(m.ty+p.y*m.d)*u}px`,c.style.width=`${p.width*m.a*h}px`,c.style.height=`${p.height*m.d*u}px`):(p=f.getBounds(),this.capHitArea(p),c.style.left=`${p.x*h}px`,c.style.top=`${p.y*u}px`,c.style.width=`${p.width*h}px`,c.style.height=`${p.height*u}px`,c.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(c.title=f.accessibleTitle),c.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&c.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==c.title||f.tabIndex!==c.tabIndex)&&(c.title=f.accessibleTitle,c.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:i}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>i&&(e.height=i-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width=`${An}px`,t.style.height=`${An}px`,t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=fh.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:i}=e.target,s=this.renderer.events.rootBoundary,r=Object.assign(new un(s),{target:i});s.rootTarget=this.renderer.lastObjectRendered,t.forEach(a=>s.dispatchEvent(r,a))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===ly&&this.activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Sc.extension={name:"accessibility",type:[K.RendererPlugin,K.CanvasRendererPlugin]};se.add(Sc);const Ac=class aa{constructor(e){this.stage=new Rt,e=Object.assign({forceCanvas:!1},e),this.renderer=mc(e),aa._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){var e;return(e=this.renderer)==null?void 0:e.view}get screen(){var e;return(e=this.renderer)==null?void 0:e.screen}destroy(e,t){const i=aa._plugins.slice(0);i.reverse(),i.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Ac._plugins=[];let py=Ac;se.handleByList(K.Application,py._plugins);class Rc{static init(e){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let t,i;if(this._resizeTo===globalThis.window)t=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:r}=this._resizeTo;t=s,i=r}this.renderer.resize(t,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Rc.extension=K.Application;se.add(Rc);const mh={loader:K.LoadParser,resolver:K.ResolveParser,cache:K.CacheParser,detection:K.DetectionParser};se.handle(K.Asset,n=>{const e=n.ref;Object.entries(mh).filter(([t])=>!!e[t]).forEach(([t,i])=>se.add(Object.assign(e[t],{extension:e[t].extension??i})))},n=>{const e=n.ref;Object.keys(mh).filter(t=>!!e[t]).forEach(t=>se.remove(e[t]))});class my{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<t;i++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function Bs(n,e){if(Array.isArray(e)){for(const t of e)if(n.startsWith(`data:${t}`))return!0;return!1}return n.startsWith(`data:${e}`)}function Ti(n,e){const t=n.split("?")[0],i=Ze.extname(t).toLowerCase();return Array.isArray(e)?e.includes(i):i===e}const Et=(n,e,t=!1)=>(Array.isArray(n)||(n=[n]),e?n.map(i=>typeof i=="string"||t?e(i):i):n),la=(n,e)=>{const t=e.split("?")[1];return t&&(n+=`?${t}`),n};function Pc(n,e,t,i,s){const r=e[t];for(let a=0;a<r.length;a++){const o=r[a];t<e.length-1?Pc(n.replace(i[t],o),e,t+1,i,s):s.push(n.replace(i[t],o))}}function gy(n){const e=/\{(.*?)\}/g,t=n.match(e),i=[];if(t){const s=[];t.forEach(r=>{const a=r.substring(1,r.length-1).split(",");s.push(a)}),Pc(n,s,0,t,i)}else i.push(n);return i}const ur=n=>!Array.isArray(n);class vy{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const i=Et(e);let s;for(let o=0;o<this.parsers.length;o++){const l=this.parsers[o];if(l.test(t)){s=l.getCacheableAssets(i,t);break}}s||(s={},i.forEach(o=>{s[o]=t}));const r=Object.keys(s),a={cacheKeys:r,keys:i};if(i.forEach(o=>{this._cacheMap.set(o,a)}),r.forEach(o=>{this._cache.has(o)&&this._cache.get(o)!==t&&console.warn("[Cache] already has key:",o),this._cache.set(o,s[o])}),t instanceof ie){const o=t;i.forEach(l=>{o.baseTexture!==ie.EMPTY.baseTexture&&ge.addToCache(o.baseTexture,l),ie.addToCache(o,l)})}}remove(e){if(!this._cacheMap.has(e)){console.warn(`[Assets] Asset id ${e} was not found in the Cache`);return}const t=this._cacheMap.get(e);t.cacheKeys.forEach(i=>{this._cache.delete(i)}),t.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const Mi=new vy;class yy{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,i)=>(this._parsersValidated=!1,e[t]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const i={promise:null,parser:null};return i.promise=(async()=>{var s,r;let a=null,o=null;if(t.loadParser&&(o=this._parserHash[t.loadParser],o||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!o){for(let l=0;l<this.parsers.length;l++){const h=this.parsers[l];if(h.load&&(s=h.test)!=null&&s.call(h,e,t,this)){o=h;break}}if(!o)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}a=await o.load(e,t,this),i.parser=o;for(let l=0;l<this.parsers.length;l++){const h=this.parsers[l];h.parse&&h.parse&&await((r=h.testParse)==null?void 0:r.call(h,a,t,this))&&(a=await h.parse(a,t,this)||a,i.parser=h)}return a})(),i}async load(e,t){this._parsersValidated||this._validateParsers();let i=0;const s={},r=ur(e),a=Et(e,h=>({alias:[h],src:h})),o=a.length,l=a.map(async h=>{const u=Ze.toAbsolute(h.src);if(!s[h.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,h)),s[h.src]=await this.promiseCache[u].promise,t&&t(++i/o)}catch(c){throw delete this.promiseCache[u],delete s[h.src],new Error(`[Loader.load] Failed to load ${u}.
${c}`)}});return await Promise.all(l),r?s[a[0].src]:s}async unload(e){const t=Et(e,i=>({alias:[i],src:i})).map(async i=>{var s,r;const a=Ze.toAbsolute(i.src),o=this.promiseCache[a];if(o){const l=await o.promise;delete this.promiseCache[a],(r=(s=o.parser)==null?void 0:s.unload)==null||r.call(s,l,i,this)}});await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),{...e,[t.name]:t}),{})}}var It=(n=>(n[n.Low=0]="Low",n[n.Normal=1]="Normal",n[n.High=2]="High",n))(It||{});const xy=".json",_y="application/json",wy={extension:{type:K.LoadParser,priority:It.Low},name:"loadJson",test(n){return Bs(n,_y)||Ti(n,xy)},async load(n){return await(await te.ADAPTER.fetch(n)).json()}};se.add(wy);const Ty=".txt",Ey="text/plain",by={name:"loadTxt",extension:{type:K.LoadParser,priority:It.Low},test(n){return Bs(n,Ey)||Ti(n,Ty)},async load(n){return await(await te.ADAPTER.fetch(n)).text()}};se.add(by);const Sy=["normal","bold","100","200","300","400","500","600","700","800","900"],Ay=[".ttf",".otf",".woff",".woff2"],Ry=["font/ttf","font/otf","font/woff","font/woff2"],Py=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Cy(n){const e=Ze.extname(n),t=Ze.basename(n,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1));let i=t.length>0;for(const r of t)if(!r.match(Py)){i=!1;break}let s=t.join(" ");return i||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}const Iy=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function My(n){return Iy.test(n)?n:encodeURI(n)}const Dy={extension:{type:K.LoadParser,priority:It.Low},name:"loadWebFont",test(n){return Bs(n,Ry)||Ti(n,Ay)},async load(n,e){var t,i,s;const r=te.ADAPTER.getFontFaceSet();if(r){const a=[],o=((t=e.data)==null?void 0:t.family)??Cy(n),l=((s=(i=e.data)==null?void 0:i.weights)==null?void 0:s.filter(u=>Sy.includes(u)))??["normal"],h=e.data??{};for(let u=0;u<l.length;u++){const c=l[u],d=new FontFace(o,`url(${My(n)})`,{...h,weight:c});await d.load(),r.add(d),a.push(d)}return a.length===1?a[0]:a}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(n){(Array.isArray(n)?n:[n]).forEach(e=>te.ADAPTER.getFontFaceSet().delete(e))}};se.add(Dy);const By=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let ws=null,ha=class{constructor(){ws||(ws=URL.createObjectURL(new Blob([By],{type:"application/javascript"}))),this.worker=new Worker(ws)}};ha.revokeObjectURL=function(){ws&&(URL.revokeObjectURL(ws),ws=null)};const Oy=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let Ts=null;class Cc{constructor(){Ts||(Ts=URL.createObjectURL(new Blob([Oy],{type:"application/javascript"}))),this.worker=new Worker(Ts)}}Cc.revokeObjectURL=function(){Ts&&(URL.revokeObjectURL(Ts),Ts=null)};let gh=0,co;class Ly{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const{worker:t}=new ha;t.addEventListener("message",i=>{t.terminate(),ha.revokeObjectURL(),e(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){co===void 0&&(co=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<co&&(this._createdWorkers++,e=new Cc().worker,e.addEventListener("message",t=>{this.complete(t.data),this.returnWorker(t.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){e.error!==void 0?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const i=new Promise((s,r)=>{this.queue.push({id:e,arguments:t,resolve:s,reject:r})});return this.next(),i}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const t=this.queue.pop(),i=t.id;this.resolveHash[gh]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:gh++,id:i})}}const vh=new Ly;function cn(n,e,t){n.resource.internal=!0;const i=new ie(n),s=()=>{delete e.promiseCache[t],Mi.has(t)&&Mi.remove(t)};return i.baseTexture.once("destroyed",()=>{t in e.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())}),i.once("destroyed",()=>{n.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())}),i}const Fy=[".jpeg",".jpg",".png",".webp",".avif"],Ny=["image/jpeg","image/png","image/webp","image/avif"];async function ky(n){const e=await te.ADAPTER.fetch(n);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${n}: ${e.status} ${e.statusText}`);const t=await e.blob();return await createImageBitmap(t)}const Sr={name:"loadTextures",extension:{type:K.LoadParser,priority:It.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(n){return Bs(n,Ny)||Ti(n,Fy)},async load(n,e,t){var i;const s=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let r;s?this.config.preferWorkers&&await vh.isImageBitmapSupported()?r=await vh.loadImageBitmap(n):r=await ky(n):r=await new Promise((l,h)=>{const u=new Image;u.crossOrigin=this.config.crossOrigin,u.src=n,u.complete?l(u):(u.onload=()=>l(u),u.onerror=c=>h(c))});const a={...e.data};a.resolution??(a.resolution=Jt(n)),s&&((i=a.resourceOptions)==null?void 0:i.ownsImageBitmap)===void 0&&(a.resourceOptions={...a.resourceOptions},a.resourceOptions.ownsImageBitmap=!0);const o=new ge(r,a);return o.resource.src=n,cn(o,t,n)},unload(n){n.destroy(!0)}};se.add(Sr);const Uy=".svg",Hy="image/svg+xml",Gy={extension:{type:K.LoadParser,priority:It.High},name:"loadSVG",test(n){return Bs(n,Hy)||Ti(n,Uy)},async testParse(n){return Qo.test(n)},async parse(n,e,t){var i;const s=new Qo(n,(i=e?.data)==null?void 0:i.resourceOptions);await s.load();const r=new ge(s,{resolution:Jt(n),...e?.data});return r.resource.src=e.src,cn(r,t,e.src)},async load(n,e){return(await te.ADAPTER.fetch(n)).text()},unload:Sr.unload};se.add(Gy);const zy=[".mp4",".m4v",".webm",".ogv"],Vy=["video/mp4","video/webm","video/ogg"],Wy={name:"loadVideo",extension:{type:K.LoadParser,priority:It.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(n){return Bs(n,Vy)||Ti(n,zy)},async load(n,e,t){var i;let s;const r=await(await te.ADAPTER.fetch(n)).blob(),a=URL.createObjectURL(r);try{const o={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...(i=e?.data)==null?void 0:i.resourceOptions,autoLoad:!0},l=new Tc(a,o);await l.load();const h=new ge(l,{alphaMode:await Km(),resolution:Jt(n),...e?.data});h.resource.src=n,s=cn(h,t,n),s.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(a)})}catch(o){throw URL.revokeObjectURL(a),o}return s},unload(n){n.destroy(!0)}};se.add(Wy);class jy{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(t[i])}`).join("&")}}getAlias(e){const{alias:t,name:i,src:s,srcs:r}=e;return Et(t||i||s||r,a=>typeof a=="string"?a:Array.isArray(a)?a.map(o=>o?.src??o?.srcs??o):a!=null&&a.src||a!=null&&a.srcs?a.src??a.srcs:a,!0)}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(t=>{this.addBundle(t.name,t.assets)})}addBundle(e,t){const i=[];Array.isArray(t)?t.forEach(s=>{const r=s.src??s.srcs,a=s.alias??s.name;let o;if(typeof a=="string"){const l=this._createBundleAssetId(e,a);i.push(l),o=[a,l]}else{const l=a.map(h=>this._createBundleAssetId(e,h));i.push(...l),o=[...a,...l]}this.add({...s,alias:o,src:r})}):Object.keys(t).forEach(s=>{const r=[s,this._createBundleAssetId(e,s)];if(typeof t[s]=="string")this.add({alias:r,src:t[s]});else if(Array.isArray(t[s]))this.add({alias:r,src:t[s]});else{const a=t[s],o=a.src??a.srcs;this.add({...a,alias:r,src:Array.isArray(o)?o:[o]})}i.push(...r)}),this._bundles[e]=i}add(e,t,i,s,r){const a=[];typeof e=="string"||Array.isArray(e)&&typeof e[0]=="string"?(xe("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),a.push({alias:e,src:t,data:i,format:s,loadParser:r})):Array.isArray(e)?a.push(...e):a.push(e);let o;o=l=>{this.hasKey(l)&&console.warn(`[Resolver] already has key: ${l} overwriting`)},Et(a).forEach(l=>{const{src:h,srcs:u}=l;let{data:c,format:d,loadParser:f}=l;const p=Et(h||u).map(g=>typeof g=="string"?gy(g):Array.isArray(g)?g:[g]),m=this.getAlias(l);Array.isArray(m)?m.forEach(o):o(m);const v=[];p.forEach(g=>{g.forEach(T=>{let w={};if(typeof T!="object"){w.src=T;for(let E=0;E<this._parsers.length;E++){const P=this._parsers[E];if(P.test(T)){w=P.parse(T);break}}}else c=T.data??c,d=T.format??d,f=T.loadParser??f,w={...w,...T};if(!m)throw new Error(`[Resolver] alias is undefined for this asset: ${w.src}`);w=this.buildResolvedAsset(w,{aliases:m,data:c,format:d,loadParser:f}),v.push(w)})}),m.forEach(g=>{this._assetMap[g]=v})})}resolveBundle(e){const t=ur(e);e=Et(e);const i={};return e.forEach(s=>{const r=this._bundles[s];if(r){const a=this.resolve(r),o={};for(const l in a){const h=a[l];o[this._extractAssetIdFromBundle(s,l)]=h}i[s]=o}}),t?i[e[0]]:i}resolveUrl(e){const t=this.resolve(e);if(typeof e!="string"){const i={};for(const s in t)i[s]=t[s].src;return i}return t.src}resolve(e){const t=ur(e);e=Et(e);const i={};return e.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let r=this._assetMap[s];const a=r[0],o=this._getPreferredOrder(r);o?.priority.forEach(l=>{o.params[l].forEach(h=>{const u=r.filter(c=>c[l]?c[l]===h:!1);u.length&&(r=u)})}),this._resolverHash[s]=r[0]??a}else this._resolverHash[s]=this.buildResolvedAsset({alias:[s],src:s},{});i[s]=this._resolverHash[s]}),t?i[e[0]]:i}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const i=e[0],s=this._preferredOrder.find(r=>r.params.format.includes(i.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const t=/\?/.test(e)?"&":"?";return`${e}${t}${this._defaultSearchParams}`}buildResolvedAsset(e,t){const{aliases:i,data:s,loadParser:r,format:a}=t;return(this._basePath||this._rootPath)&&(e.src=Ze.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=i??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...s||{},...e.data},e.loadParser=r??e.loadParser,e.format=a??e.format??Ze.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}}class Xy{constructor(){this._detections=[],this._initialized=!1,this.resolver=new jy,this.loader=new yy,this.cache=Mi,this._backgroundLoader=new my(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){var t,i;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let o=e.manifest;typeof o=="string"&&(o=await this.load(o)),this.resolver.addManifest(o)}const s=((t=e.texturePreference)==null?void 0:t.resolution)??1,r=typeof s=="number"?[s]:s,a=await this._detectFormats({preferredFormats:(i=e.texturePreference)==null?void 0:i.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:a,resolution:r}}),e.preferences&&this.setPreferences(e.preferences)}add(e,t,i,s,r){this.resolver.add(e,t,i,s,r)}async load(e,t){this._initialized||await this.init();const i=ur(e),s=Et(e).map(o=>{if(typeof o!="string"){const l=this.resolver.getAlias(o);return l.some(h=>!this.resolver.hasKey(h))&&this.add(o),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(o)||this.add({alias:o,src:o}),o}),r=this.resolver.resolve(s),a=await this._mapLoadToResolve(r,t);return i?a[s[0]]:a}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let i=!1;typeof e=="string"&&(i=!0,e=[e]);const s=this.resolver.resolveBundle(e),r={},a=Object.keys(s);let o=0,l=0;const h=()=>{t?.(++o/l)},u=a.map(c=>{const d=s[c];return l+=Object.keys(d).length,this._mapLoadToResolve(d,h).then(f=>{r[c]=f})});return await Promise.all(u),i?r[e[0]]:r}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return Mi.get(e);const t={};for(let i=0;i<e.length;i++)t[i]=Mi.get(e[i]);return t}async _mapLoadToResolve(e,t){const i=Object.values(e),s=Object.keys(e);this._backgroundLoader.active=!1;const r=await this.loader.load(i,t);this._backgroundLoader.active=!0;const a={};return i.forEach((o,l)=>{const h=r[o.src],u=[o.src];o.alias&&u.push(...o.alias),a[s[l]]=h,Mi.set(u,h)}),a}async unload(e){this._initialized||await this.init();const t=Et(e).map(s=>typeof s!="string"?s.src:s),i=this.resolver.resolve(t);await this._unloadFromResolved(i)}async unloadBundle(e){this._initialized||await this.init(),e=Et(e);const t=this.resolver.resolveBundle(e),i=Object.keys(t).map(s=>this._unloadFromResolved(t[s]));await Promise.all(i)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(i=>{Mi.remove(i.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const i of e.detections)e.skipDetections||await i.test()?t=await i.add(t):e.skipDetections||(t=await i.remove(t));return t=t.filter((i,s)=>t.indexOf(i)===s),t}get detections(){return this._detections}get preferWorkers(){return Sr.config.preferWorkers}set preferWorkers(e){xe("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(i=>i in e).forEach(i=>{t.config[i]=e[i]})})}}const Rn=new Xy;se.handleByList(K.LoadParser,Rn.loader.parsers).handleByList(K.ResolveParser,Rn.resolver.parsers).handleByList(K.CacheParser,Rn.cache.parsers).handleByList(K.DetectionParser,Rn.detections);const Yy={extension:K.CacheParser,test:n=>Array.isArray(n)&&n.every(e=>e instanceof ie),getCacheableAssets:(n,e)=>{const t={};return n.forEach(i=>{e.forEach((s,r)=>{t[i+(r===0?"":r+1)]=s})}),t}};se.add(Yy);async function Ic(n){if("Image"in globalThis)return new Promise(e=>{const t=new Image;t.onload=()=>{e(!0)},t.onerror=()=>{e(!1)},t.src=n});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(n)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}const qy={extension:{type:K.DetectionParser,priority:1},test:async()=>Ic("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async n=>[...n,"avif"],remove:async n=>n.filter(e=>e!=="avif")};se.add(qy);const Zy={extension:{type:K.DetectionParser,priority:0},test:async()=>Ic("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async n=>[...n,"webp"],remove:async n=>n.filter(e=>e!=="webp")};se.add(Zy);const yh=["png","jpg","jpeg"],Ky={extension:{type:K.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async n=>[...n,...yh],remove:async n=>n.filter(e=>!yh.includes(e))};se.add(Ky);const Jy="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Oa(n){return Jy?!1:document.createElement("video").canPlayType(n)!==""}const Qy={extension:{type:K.DetectionParser,priority:0},test:async()=>Oa("video/webm"),add:async n=>[...n,"webm"],remove:async n=>n.filter(e=>e!=="webm")};se.add(Qy);const $y={extension:{type:K.DetectionParser,priority:0},test:async()=>Oa("video/mp4"),add:async n=>[...n,"mp4","m4v"],remove:async n=>n.filter(e=>e!=="mp4"&&e!=="m4v")};se.add($y);const ex={extension:{type:K.DetectionParser,priority:0},test:async()=>Oa("video/ogg"),add:async n=>[...n,"ogv"],remove:async n=>n.filter(e=>e!=="ogv")};se.add(ex);const tx={extension:K.ResolveParser,test:Sr.test,parse:n=>{var e;return{resolution:parseFloat(((e=te.RETINA_PREFIX.exec(n))==null?void 0:e[1])??"1"),format:Ze.extname(n).slice(1),src:n}}};se.add(tx);var Je=(n=>(n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n))(Je||{});const cr={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let Bt,hs;function xh(){hs={bptc:Bt.getExtension("EXT_texture_compression_bptc"),astc:Bt.getExtension("WEBGL_compressed_texture_astc"),etc:Bt.getExtension("WEBGL_compressed_texture_etc"),s3tc:Bt.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Bt.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:Bt.getExtension("WEBGL_compressed_texture_pvrtc")||Bt.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:Bt.getExtension("WEBGL_compressed_texture_etc1"),atc:Bt.getExtension("WEBGL_compressed_texture_atc")}}const ix={extension:{type:K.DetectionParser,priority:2},test:async()=>{const n=te.ADAPTER.createCanvas().getContext("webgl");return n?(Bt=n,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async n=>{hs||xh();const e=[];for(const t in hs)hs[t]&&e.push(t);return[...e,...n]},remove:async n=>(hs||xh(),n.filter(e=>!(e in hs)))};se.add(ix);class sx extends _r{constructor(e,t={width:1,height:1,autoLoad:!0}){let i,s;typeof e=="string"?(i=e,s=new Uint8Array):(i=null,s=e),super(s,t),this.origin=i,this.buffer=s?new Uo(s):null,this._load=null,this.loaded=!1,this.origin!==null&&t.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new Uo(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this)),this._load)}}class Gi extends sx{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=Gi._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||Gi._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,i){const s=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;s.pixelStorei(s.UNPACK_ALIGNMENT,4);for(let r=0,a=this.levels;r<a;r++){const{levelID:o,levelWidth:l,levelHeight:h,levelBuffer:u}=this._levelBuffers[r];s.compressedTexImage2D(s.TEXTURE_2D,o,this.format,l,h,0,u)}return!0}onBlobLoaded(){this._levelBuffers=Gi._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=35916&&e<=35919)return"s3tc_sRGB";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e===36196)return"etc1";if(e===35986||e===35987||e===34798)return"atc";if(e>=36492&&e<=36495)return"bptc";if(e===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,t,i,s,r,a,o){const l=new Array(i);let h=e.byteOffset,u=a,c=o,d=u+s-1&~(s-1),f=c+r-1&~(r-1),p=d*f*cr[t];for(let m=0;m<i;m++)l[m]={levelID:m,levelWidth:i>1?u:d,levelHeight:i>1?c:f,levelBuffer:new Uint8Array(e.buffer,h,p)},h+=p,u=u>>1||1,c=c>>1||1,d=u+s-1&~(s-1),f=c+r-1&~(r-1),p=d*f*cr[t];return l}}const fo=4,Pn=124,nx=32,_h=20,rx=542327876,Cn={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},ox={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},In={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},ax=1,lx=2,hx=4,ux=64,cx=512,dx=131072,fx=827611204,px=861165636,mx=894720068,gx=808540228,vx=4,yx={[fx]:Je.COMPRESSED_RGBA_S3TC_DXT1_EXT,[px]:Je.COMPRESSED_RGBA_S3TC_DXT3_EXT,[mx]:Je.COMPRESSED_RGBA_S3TC_DXT5_EXT},xx={70:Je.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Je.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Je.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Je.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Je.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Je.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Je.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Je.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Je.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:Je.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:Je.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:Je.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:Je.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function _x(n){const e=new Uint32Array(n);if(e[0]!==rx)throw new Error("Invalid DDS file magic word");const t=new Uint32Array(n,0,Pn/Uint32Array.BYTES_PER_ELEMENT),i=t[Cn.HEIGHT],s=t[Cn.WIDTH],r=t[Cn.MIPMAP_COUNT],a=new Uint32Array(n,Cn.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,nx/Uint32Array.BYTES_PER_ELEMENT),o=a[ax];if(o&hx){const l=a[ox.FOURCC];if(l!==gx){const T=yx[l],w=fo+Pn,E=new Uint8Array(n,w);return[new Gi(E,{format:T,width:s,height:i,levels:r})]}const h=fo+Pn,u=new Uint32Array(e.buffer,h,_h/Uint32Array.BYTES_PER_ELEMENT),c=u[In.DXGI_FORMAT],d=u[In.RESOURCE_DIMENSION],f=u[In.MISC_FLAG],p=u[In.ARRAY_SIZE],m=xx[c];if(m===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(f===vx)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");const v=new Array,g=fo+Pn+_h;if(p===1)v.push(new Uint8Array(n,g));else{const T=cr[m];let w=0,E=s,P=i;for(let D=0;D<r;D++){const B=Math.max(1,E+3&-4),H=Math.max(1,P+3&-4),I=B*H*T;w+=I,E=E>>>1,P=P>>>1}let C=g;for(let D=0;D<p;D++)v.push(new Uint8Array(n,C,w)),C+=w}return v.map(T=>new Gi(T,{format:m,width:s,height:i,levels:r}))}throw o&ux?new Error("DDSParser does not support uncompressed texture data."):o&cx?new Error("DDSParser does not supported YUV uncompressed texture data."):o&dx?new Error("DDSParser does not support single-channel (lumninance) texture data!"):o&lx?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const wh=[171,75,84,88,32,49,49,187,13,10,26,10],wx=67305985,xt={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},ua=64,Th={[oe.UNSIGNED_BYTE]:1,[oe.UNSIGNED_SHORT]:2,[oe.INT]:4,[oe.UNSIGNED_INT]:4,[oe.FLOAT]:4,[oe.HALF_FLOAT]:8},Tx={[j.RGBA]:4,[j.RGB]:3,[j.RG]:2,[j.RED]:1,[j.LUMINANCE]:1,[j.LUMINANCE_ALPHA]:2,[j.ALPHA]:1},Ex={[oe.UNSIGNED_SHORT_4_4_4_4]:2,[oe.UNSIGNED_SHORT_5_5_5_1]:2,[oe.UNSIGNED_SHORT_5_6_5]:2};function bx(n,e,t=!1){const i=new DataView(e);if(!Sx(n,i))return null;const s=i.getUint32(xt.ENDIANNESS,!0)===wx,r=i.getUint32(xt.GL_TYPE,s),a=i.getUint32(xt.GL_FORMAT,s),o=i.getUint32(xt.GL_INTERNAL_FORMAT,s),l=i.getUint32(xt.PIXEL_WIDTH,s),h=i.getUint32(xt.PIXEL_HEIGHT,s)||1,u=i.getUint32(xt.PIXEL_DEPTH,s)||1,c=i.getUint32(xt.NUMBER_OF_ARRAY_ELEMENTS,s)||1,d=i.getUint32(xt.NUMBER_OF_FACES,s),f=i.getUint32(xt.NUMBER_OF_MIPMAP_LEVELS,s),p=i.getUint32(xt.BYTES_OF_KEY_VALUE_DATA,s);if(h===0||u!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(c!==1)throw new Error("WebGL does not support array textures");const m=4,v=4,g=l+3&-4,T=h+3&-4,w=new Array(c);let E=l*h;r===0&&(E=g*T);let P;if(r!==0?Th[r]?P=Th[r]*Tx[a]:P=Ex[r]:P=cr[o],P===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const C=t?Rx(i,p,s):null;let D=E*P,B=l,H=h,I=g,N=T,M=ua+p;for(let R=0;R<f;R++){const F=i.getUint32(M,s);let L=M+4;for(let Z=0;Z<c;Z++){let V=w[Z];V||(V=w[Z]=new Array(f)),V[R]={levelID:R,levelWidth:f>1||r!==0?B:I,levelHeight:f>1||r!==0?H:N,levelBuffer:new Uint8Array(e,L,D)},L+=D}M+=F+4,M=M%4!==0?M+4-M%4:M,B=B>>1||1,H=H>>1||1,I=B+m-1&~(m-1),N=H+v-1&~(v-1),D=I*N*P}return r!==0?{uncompressed:w.map(R=>{let F=R[0].levelBuffer,L=!1;return r===oe.FLOAT?F=new Float32Array(R[0].levelBuffer.buffer,R[0].levelBuffer.byteOffset,R[0].levelBuffer.byteLength/4):r===oe.UNSIGNED_INT?(L=!0,F=new Uint32Array(R[0].levelBuffer.buffer,R[0].levelBuffer.byteOffset,R[0].levelBuffer.byteLength/4)):r===oe.INT&&(L=!0,F=new Int32Array(R[0].levelBuffer.buffer,R[0].levelBuffer.byteOffset,R[0].levelBuffer.byteLength/4)),{resource:new _r(F,{width:R[0].levelWidth,height:R[0].levelHeight}),type:r,format:L?Ax(a):a}}),kvData:C}:{compressed:w.map(R=>new Gi(null,{format:o,width:l,height:h,levels:f,levelBuffers:R})),kvData:C}}function Sx(n,e){for(let t=0;t<wh.length;t++)if(e.getUint8(t)!==wh[t])return console.error(`${n} is not a valid *.ktx file!`),!1;return!0}function Ax(n){switch(n){case j.RGBA:return j.RGBA_INTEGER;case j.RGB:return j.RGB_INTEGER;case j.RG:return j.RG_INTEGER;case j.RED:return j.RED_INTEGER;default:return n}}function Rx(n,e,t){const i=new Map;let s=0;for(;s<e;){const r=n.getUint32(ua+s,t),a=ua+s+4,o=3-(r+3)%4;if(r===0||r>e-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<r&&n.getUint8(a+l)!==0;l++);if(l===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const h=new TextDecoder().decode(new Uint8Array(n.buffer,a,l)),u=new DataView(n.buffer,a+l+1,r-l-1);i.set(h,u),s+=4+r+o}return i}const Px={extension:{type:K.LoadParser,priority:It.High},name:"loadDDS",test(n){return Ti(n,".dds")},async load(n,e,t){const i=await(await te.ADAPTER.fetch(n)).arrayBuffer(),s=_x(i).map(r=>{const a=new ge(r,{mipmap:Gt.OFF,alphaMode:at.NO_PREMULTIPLIED_ALPHA,resolution:Jt(n),...e.data});return cn(a,t,n)});return s.length===1?s[0]:s},unload(n){Array.isArray(n)?n.forEach(e=>e.destroy(!0)):n.destroy(!0)}};se.add(Px);const Cx={extension:{type:K.LoadParser,priority:It.High},name:"loadKTX",test(n){return Ti(n,".ktx")},async load(n,e,t){const i=await(await te.ADAPTER.fetch(n)).arrayBuffer(),{compressed:s,uncompressed:r,kvData:a}=bx(n,i),o=s??r,l={mipmap:Gt.OFF,alphaMode:at.NO_PREMULTIPLIED_ALPHA,resolution:Jt(n),...e.data},h=o.map(u=>{o===r&&Object.assign(l,{type:u.type,format:u.format});const c=u.resource??u,d=new ge(c,l);return d.ktxKeyValueData=a,cn(d,t,n)});return h.length===1?h[0]:h},unload(n){Array.isArray(n)?n.forEach(e=>e.destroy(!0)):n.destroy(!0)}};se.add(Cx);const Ix=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],Mx={extension:K.ResolveParser,test:n=>{const e=Ze.extname(n).slice(1);return["basis","ktx","dds"].includes(e)},parse:n=>{var e,t;const i=n.split("."),s=i.pop();if(["ktx","dds"].includes(s)){const r=i.pop();if(Ix.includes(r))return{resolution:parseFloat(((e=te.RETINA_PREFIX.exec(n))==null?void 0:e[1])??"1"),format:r,src:n}}return{resolution:parseFloat(((t=te.RETINA_PREFIX.exec(n))==null?void 0:t[1])??"1"),format:s,src:n}}};se.add(Mx);const Mn=new ve,Dx=4,Mc=class Ys{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(e,t,i,s){const r=new Image;return r.src=await this.base64(e,t,i,s),r}async base64(e,t,i,s){const r=this.canvas(e,s);if(r.toBlob!==void 0)return new Promise((a,o)=>{r.toBlob(l=>{if(!l){o(new Error("ICanvas.toBlob failed!"));return}const h=new FileReader;h.onload=()=>a(h.result),h.onerror=o,h.readAsDataURL(l)},t,i)});if(r.toDataURL!==void 0)return r.toDataURL(t,i);if(r.convertToBlob!==void 0){const a=await r.convertToBlob({type:t,quality:i});return new Promise((o,l)=>{const h=new FileReader;h.onload=()=>o(h.result),h.onerror=l,h.readAsDataURL(a)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,t){const{pixels:i,width:s,height:r,flipY:a,premultipliedAlpha:o}=this._rawPixels(e,t);a&&Ys._flipY(i,s,r),o&&Ys._unpremultiplyAlpha(i);const l=new dg(s,r,1),h=new ImageData(new Uint8ClampedArray(i.buffer),s,r);return l.context.putImageData(h,0,0),l.canvas}pixels(e,t){const{pixels:i,width:s,height:r,flipY:a,premultipliedAlpha:o}=this._rawPixels(e,t);return a&&Ys._flipY(i,s,r),o&&Ys._unpremultiplyAlpha(i),i}_rawPixels(e,t){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let s,r=!1,a=!1,o,l=!1;e&&(e instanceof Xi?o=e:(o=i.generateTexture(e,{region:t,resolution:i.resolution,multisample:i.multisample}),l=!0,t&&(Mn.width=t.width,Mn.height=t.height,t=Mn)));const h=i.gl;if(o){if(s=o.baseTexture.resolution,t=t??o.frame,r=!1,a=o.baseTexture.alphaMode>0&&o.baseTexture.format===j.RGBA,!l){i.renderTexture.bind(o);const f=o.framebuffer.glFramebuffers[i.CONTEXT_UID];f.blitFramebuffer&&i.framebuffer.bind(f.blitFramebuffer)}}else s=i.resolution,t||(t=Mn,t.width=i.width/s,t.height=i.height/s),r=!0,a=this._rendererPremultipliedAlpha,i.renderTexture.bind();const u=Math.max(Math.round(t.width*s),1),c=Math.max(Math.round(t.height*s),1),d=new Uint8Array(Dx*u*c);return h.readPixels(Math.round(t.x*s),Math.round(t.y*s),u,c,h.RGBA,h.UNSIGNED_BYTE,d),l&&o?.destroy(!0),{pixels:d,width:u,height:c,flipY:r,premultipliedAlpha:a}}destroy(){this.renderer=null}static _flipY(e,t,i){const s=t<<2,r=i>>1,a=new Uint8Array(s);for(let o=0;o<r;o++){const l=o*s,h=(i-o-1)*s;a.set(e.subarray(l,l+s)),e.copyWithin(l,h,h+s),e.set(a,h)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let i=0;i<t;i+=4){const s=e[i+3];if(s!==0){const r=255.001/s;e[i]=e[i]*r+.5,e[i+1]=e[i+1]*r+.5,e[i+2]=e[i+2]*r+.5}}}};Mc.extension={name:"extract",type:K.RendererSystem};let Bx=Mc;se.add(Bx);const dr={build(n){const e=n.points;let t,i,s,r,a,o;if(n.type===$e.CIRC){const p=n.shape;t=p.x,i=p.y,a=o=p.radius,s=r=0}else if(n.type===$e.ELIP){const p=n.shape;t=p.x,i=p.y,a=p.width,o=p.height,s=r=0}else{const p=n.shape,m=p.width/2,v=p.height/2;t=p.x+m,i=p.y+v,a=o=Math.max(0,Math.min(p.radius,Math.min(m,v))),s=m-a,r=v-o}if(!(a>=0&&o>=0&&s>=0&&r>=0)){e.length=0;return}const l=Math.ceil(2.3*Math.sqrt(a+o)),h=l*8+(s?4:0)+(r?4:0);if(e.length=h,h===0)return;if(l===0){e.length=8,e[0]=e[6]=t+s,e[1]=e[3]=i+r,e[2]=e[4]=t-s,e[5]=e[7]=i-r;return}let u=0,c=l*4+(s?2:0)+2,d=c,f=h;{const p=s+a,m=r,v=t+p,g=t-p,T=i+m;if(e[u++]=v,e[u++]=T,e[--c]=T,e[--c]=g,r){const w=i-m;e[d++]=g,e[d++]=w,e[--f]=w,e[--f]=v}}for(let p=1;p<l;p++){const m=Math.PI/2*(p/l),v=s+Math.cos(m)*a,g=r+Math.sin(m)*o,T=t+v,w=t-v,E=i+g,P=i-g;e[u++]=T,e[u++]=E,e[--c]=E,e[--c]=w,e[d++]=w,e[d++]=P,e[--f]=P,e[--f]=T}{const p=s,m=r+o,v=t+p,g=t-p,T=i+m,w=i-m;e[u++]=v,e[u++]=T,e[--f]=w,e[--f]=v,s&&(e[u++]=g,e[u++]=T,e[--f]=w,e[--f]=g)}},triangulate(n,e){const t=n.points,i=e.points,s=e.indices;if(t.length===0)return;let r=i.length/2;const a=r;let o,l;if(n.type!==$e.RREC){const u=n.shape;o=u.x,l=u.y}else{const u=n.shape;o=u.x+u.width/2,l=u.y+u.height/2}const h=n.matrix;i.push(n.matrix?h.a*o+h.c*l+h.tx:o,n.matrix?h.b*o+h.d*l+h.ty:l),r++,i.push(t[0],t[1]);for(let u=2;u<t.length;u+=2)i.push(t[u],t[u+1]),s.push(r++,a,r);s.push(a+1,a,r)}};function Eh(n,e=!1){const t=n.length;if(t<6)return;let i=0;for(let s=0,r=n[t-2],a=n[t-1];s<t;s+=2){const o=n[s],l=n[s+1];i+=(o-r)*(l+a),r=o,a=l}if(!e&&i>0||e&&i<=0){const s=t/2;for(let r=s+s%2;r<t;r+=2){const a=t-r-2,o=t-r-1,l=r,h=r+1;[n[a],n[l]]=[n[l],n[a]],[n[o],n[h]]=[n[h],n[o]]}}}const Dc={build(n){n.points=n.shape.points.slice()},triangulate(n,e){let t=n.points;const i=n.holes,s=e.points,r=e.indices;if(t.length>=6){Eh(t,!1);const a=[];for(let h=0;h<i.length;h++){const u=i[h];Eh(u.points,!0),a.push(t.length/2),t=t.concat(u.points)}const o=Vp(t,a,2);if(!o)return;const l=s.length/2;for(let h=0;h<o.length;h+=3)r.push(o[h]+l),r.push(o[h+1]+l),r.push(o[h+2]+l);for(let h=0;h<t.length;h++)s.push(t[h])}}},Ox={build(n){const e=n.shape,t=e.x,i=e.y,s=e.width,r=e.height,a=n.points;a.length=0,s>=0&&r>=0&&a.push(t,i,t+s,i,t+s,i+r,t,i+r)},triangulate(n,e){const t=n.points,i=e.points;if(t.length===0)return;const s=i.length/2;i.push(t[0],t[1],t[2],t[3],t[6],t[7],t[4],t[5]),e.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},Lx={build(n){dr.build(n)},triangulate(n,e){dr.triangulate(n,e)}};var ft=(n=>(n.MITER="miter",n.BEVEL="bevel",n.ROUND="round",n))(ft||{}),pi=(n=>(n.BUTT="butt",n.ROUND="round",n.SQUARE="square",n))(pi||{});const bs={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(n,e=20){if(!this.adaptive||!n||isNaN(n))return e;let t=Math.ceil(n/this.maxLength);return t<this.minSegments?t=this.minSegments:t>this.maxSegments&&(t=this.maxSegments),t}};class bh{static curveTo(e,t,i,s,r,a){const o=a[a.length-2],l=a[a.length-1]-t,h=o-e,u=s-t,c=i-e,d=Math.abs(l*c-h*u);if(d<1e-8||r===0)return(a[a.length-2]!==e||a[a.length-1]!==t)&&a.push(e,t),null;const f=l*l+h*h,p=u*u+c*c,m=l*u+h*c,v=r*Math.sqrt(f)/d,g=r*Math.sqrt(p)/d,T=v*m/f,w=g*m/p,E=v*c+g*h,P=v*u+g*l,C=h*(g+T),D=l*(g+T),B=c*(v+w),H=u*(v+w),I=Math.atan2(D-P,C-E),N=Math.atan2(H-P,B-E);return{cx:E+e,cy:P+t,radius:r,startAngle:I,endAngle:N,anticlockwise:h*u>c*l}}static arc(e,t,i,s,r,a,o,l,h){const u=o-a,c=bs._segmentsCount(Math.abs(u)*r,Math.ceil(Math.abs(u)/sr)*40),d=u/(c*2),f=d*2,p=Math.cos(d),m=Math.sin(d),v=c-1,g=v%1/v;for(let T=0;T<=v;++T){const w=T+g*T,E=d+a+f*w,P=Math.cos(E),C=-Math.sin(E);h.push((p*P+m*C)*r+i,(p*-C+m*P)*r+s)}}}class Fx{constructor(){this.reset()}begin(e,t,i){this.reset(),this.style=e,this.start=t,this.attribStart=i}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class La{static curveLength(e,t,i,s,r,a,o,l){let h=0,u=0,c=0,d=0,f=0,p=0,m=0,v=0,g=0,T=0,w=0,E=e,P=t;for(let C=1;C<=10;++C)u=C/10,c=u*u,d=c*u,f=1-u,p=f*f,m=p*f,v=m*e+3*p*u*i+3*f*c*r+d*o,g=m*t+3*p*u*s+3*f*c*a+d*l,T=E-v,w=P-g,E=v,P=g,h+=Math.sqrt(T*T+w*w);return h}static curveTo(e,t,i,s,r,a,o){const l=o[o.length-2],h=o[o.length-1];o.length-=2;const u=bs._segmentsCount(La.curveLength(l,h,e,t,i,s,r,a));let c=0,d=0,f=0,p=0,m=0;o.push(l,h);for(let v=1,g=0;v<=u;++v)g=v/u,c=1-g,d=c*c,f=d*c,p=g*g,m=p*g,o.push(f*l+3*d*g*e+3*c*p*i+m*r,f*h+3*d*g*t+3*c*p*s+m*a)}}function Sh(n,e,t,i,s,r,a,o){const l=n-t*s,h=e-i*s,u=n+t*r,c=e+i*r;let d,f;a?(d=i,f=-t):(d=-i,f=t);const p=l+d,m=h+f,v=u+d,g=c+f;return o.push(p,m,v,g),2}function bi(n,e,t,i,s,r,a,o){const l=t-n,h=i-e;let u=Math.atan2(l,h),c=Math.atan2(s-n,r-e);o&&u<c?u+=Math.PI*2:!o&&u>c&&(c+=Math.PI*2);let d=u;const f=c-u,p=Math.abs(f),m=Math.sqrt(l*l+h*h),v=(15*p*Math.sqrt(m)/Math.PI>>0)+1,g=f/v;if(d+=g,o){a.push(n,e,t,i);for(let T=1,w=d;T<v;T++,w+=g)a.push(n,e,n+Math.sin(w)*m,e+Math.cos(w)*m);a.push(n,e,s,r)}else{a.push(t,i,n,e);for(let T=1,w=d;T<v;T++,w+=g)a.push(n+Math.sin(w)*m,e+Math.cos(w)*m,n,e);a.push(s,r,n,e)}return v*2}function Nx(n,e){const t=n.shape;let i=n.points||t.points.slice();const s=e.closePointEps;if(i.length===0)return;const r=n.lineStyle,a=new Te(i[0],i[1]),o=new Te(i[i.length-2],i[i.length-1]),l=t.type!==$e.POLY||t.closeStroke,h=Math.abs(a.x-o.x)<s&&Math.abs(a.y-o.y)<s;if(l){i=i.slice(),h&&(i.pop(),i.pop(),o.set(i[i.length-2],i[i.length-1]));const V=(a.x+o.x)*.5,q=(o.y+a.y)*.5;i.unshift(V,q),i.push(V,q)}const u=e.points,c=i.length/2;let d=i.length;const f=u.length/2,p=r.width/2,m=p*p,v=r.miterLimit*r.miterLimit;let g=i[0],T=i[1],w=i[2],E=i[3],P=0,C=0,D=-(T-E),B=g-w,H=0,I=0,N=Math.sqrt(D*D+B*B);D/=N,B/=N,D*=p,B*=p;const M=r.alignment,R=(1-M)*2,F=M*2;l||(r.cap===pi.ROUND?d+=bi(g-D*(R-F)*.5,T-B*(R-F)*.5,g-D*R,T-B*R,g+D*F,T+B*F,u,!0)+2:r.cap===pi.SQUARE&&(d+=Sh(g,T,D,B,R,F,!0,u))),u.push(g-D*R,T-B*R,g+D*F,T+B*F);for(let V=1;V<c-1;++V){g=i[(V-1)*2],T=i[(V-1)*2+1],w=i[V*2],E=i[V*2+1],P=i[(V+1)*2],C=i[(V+1)*2+1],D=-(T-E),B=g-w,N=Math.sqrt(D*D+B*B),D/=N,B/=N,D*=p,B*=p,H=-(E-C),I=w-P,N=Math.sqrt(H*H+I*I),H/=N,I/=N,H*=p,I*=p;const q=w-g,pe=T-E,G=w-P,Y=C-E,de=q*G+pe*Y,J=pe*G-Y*q,ye=J<0;if(Math.abs(J)<.001*Math.abs(de)){u.push(w-D*R,E-B*R,w+D*F,E+B*F),de>=0&&(r.join===ft.ROUND?d+=bi(w,E,w-D*R,E-B*R,w-H*R,E-I*R,u,!1)+4:d+=2,u.push(w-H*F,E-I*F,w+H*R,E+I*R));continue}const he=(-D+g)*(-B+E)-(-D+w)*(-B+T),Re=(-H+P)*(-I+E)-(-H+w)*(-I+C),Me=(q*Re-G*he)/J,re=(Y*he-pe*Re)/J,$=(Me-w)*(Me-w)+(re-E)*(re-E),De=w+(Me-w)*R,we=E+(re-E)*R,Pe=w-(Me-w)*F,Ce=E-(re-E)*F,ot=Math.min(q*q+pe*pe,G*G+Y*Y),et=ye?R:F,ct=ot+et*et*m,y=$<=ct;let S=r.join;if(S===ft.MITER&&$/m>v&&(S=ft.BEVEL),y)switch(S){case ft.MITER:{u.push(De,we,Pe,Ce);break}case ft.BEVEL:{ye?u.push(De,we,w+D*F,E+B*F,De,we,w+H*F,E+I*F):u.push(w-D*R,E-B*R,Pe,Ce,w-H*R,E-I*R,Pe,Ce),d+=2;break}case ft.ROUND:{ye?(u.push(De,we,w+D*F,E+B*F),d+=bi(w,E,w+D*F,E+B*F,w+H*F,E+I*F,u,!0)+4,u.push(De,we,w+H*F,E+I*F)):(u.push(w-D*R,E-B*R,Pe,Ce),d+=bi(w,E,w-D*R,E-B*R,w-H*R,E-I*R,u,!1)+4,u.push(w-H*R,E-I*R,Pe,Ce));break}}else{switch(u.push(w-D*R,E-B*R,w+D*F,E+B*F),S){case ft.MITER:{ye?u.push(Pe,Ce,Pe,Ce):u.push(De,we,De,we),d+=2;break}case ft.ROUND:{ye?d+=bi(w,E,w+D*F,E+B*F,w+H*F,E+I*F,u,!0)+2:d+=bi(w,E,w-D*R,E-B*R,w-H*R,E-I*R,u,!1)+2;break}}u.push(w-H*R,E-I*R,w+H*F,E+I*F),d+=2}}g=i[(c-2)*2],T=i[(c-2)*2+1],w=i[(c-1)*2],E=i[(c-1)*2+1],D=-(T-E),B=g-w,N=Math.sqrt(D*D+B*B),D/=N,B/=N,D*=p,B*=p,u.push(w-D*R,E-B*R,w+D*F,E+B*F),l||(r.cap===pi.ROUND?d+=bi(w-D*(R-F)*.5,E-B*(R-F)*.5,w-D*R,E-B*R,w+D*F,E+B*F,u,!1)+2:r.cap===pi.SQUARE&&(d+=Sh(w,E,D,B,R,F,!1,u)));const L=e.indices,Z=bs.epsilon*bs.epsilon;for(let V=f;V<d+f-2;++V)g=u[V*2],T=u[V*2+1],w=u[(V+1)*2],E=u[(V+1)*2+1],P=u[(V+2)*2],C=u[(V+2)*2+1],!(Math.abs(g*(E-C)+w*(C-T)+P*(T-E))<Z)&&L.push(V,V+1,V+2)}function kx(n,e){let t=0;const i=n.shape,s=n.points||i.points,r=i.type!==$e.POLY||i.closeStroke;if(s.length===0)return;const a=e.points,o=e.indices,l=s.length/2,h=a.length/2;let u=h;for(a.push(s[0],s[1]),t=1;t<l;t++)a.push(s[t*2],s[t*2+1]),o.push(u,u+1),u++;r&&o.push(u,h)}function Ah(n,e){n.lineStyle.native?kx(n,e):Nx(n,e)}class Fa{static curveLength(e,t,i,s,r,a){const o=e-2*i+r,l=t-2*s+a,h=2*i-2*e,u=2*s-2*t,c=4*(o*o+l*l),d=4*(o*h+l*u),f=h*h+u*u,p=2*Math.sqrt(c+d+f),m=Math.sqrt(c),v=2*c*m,g=2*Math.sqrt(f),T=d/m;return(v*p+m*d*(p-g)+(4*f*c-d*d)*Math.log((2*m+T+p)/(T+g)))/(4*v)}static curveTo(e,t,i,s,r){const a=r[r.length-2],o=r[r.length-1],l=bs._segmentsCount(Fa.curveLength(a,o,e,t,i,s));let h=0,u=0;for(let c=1;c<=l;++c){const d=c/l;h=a+(e-a)*d,u=o+(t-o)*d,r.push(h+(e+(i-e)*d-h)*d,u+(t+(s-t)*d-u)*d)}}}const po={[$e.POLY]:Dc,[$e.CIRC]:dr,[$e.ELIP]:dr,[$e.RECT]:Ox,[$e.RREC]:Lx},Rh=[],Dn=[];class fr{constructor(e,t=null,i=null,s=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=i,this.fillStyle=t,this.matrix=s,this.type=e.type}clone(){return new fr(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const ts=new Te,Bc=class Oc extends ku{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new lr,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Dn.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),Rh.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,i=null,s=null){const r=new fr(e,t,i,s);return this.graphicsData.push(r),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const i=new fr(e,null,null,t),s=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=s.lineStyle,s.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let i=0;i<t.length;++i){const s=t[i];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(e,ts):ts.copyFrom(e),s.shape.contains(ts.x,ts.y))){let r=!1;if(s.holes){for(let a=0;a<s.holes.length;a++)if(s.holes[a].shape.contains(ts.x,ts.y)){r=!0;break}}if(!r)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let i=null,s=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],s=i.style);for(let l=this.shapeIndex;l<t.length;l++){this.shapeIndex++;const h=t[l],u=h.fillStyle,c=h.lineStyle;po[h.type].build(h),h.matrix&&this.transformPoints(h.points,h.matrix),(u.visible||c.visible)&&this.processHoles(h.holes);for(let d=0;d<2;d++){const f=d===0?u:c;if(!f.visible)continue;const p=f.texture.baseTexture,m=this.indices.length,v=this.points.length/2;p.wrapMode=mi.REPEAT,d===0?this.processFill(h):this.processLine(h);const g=this.points.length/2-v;g!==0&&(i&&!this._compareStyles(s,f)&&(i.end(m,v),i=null),i||(i=Rh.pop()||new Fx,i.begin(f,m,v),this.batches.push(i),s=f),this.addUvs(this.points,e,f.texture,v,g,f.matrix))}}const r=this.indices.length,a=this.points.length/2;if(i&&i.end(r,a),this.batches.length===0){this.batchable=!0;return}const o=a>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const i=this.graphicsData[e],s=i.fillStyle,r=i.lineStyle;if(s&&!s.texture.baseTexture.valid||r&&!r.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,i=e.length;t<i;t++){const s=e[t];for(let r=0;r<s.size;r++){const a=s.start+r;this.indicesUint16[a]=this.indicesUint16[a]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<Oc.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++ge._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),Dn.push(this.drawCalls[c]);this.drawCalls.length=0;const t=this.colors,i=this.textureIds;let s=Dn.pop();s||(s=new zo,s.texArray=new Xo),s.texArray.count=0,s.start=0,s.size=0,s.type=kt.TRIANGLES;let r=0,a=null,o=0,l=!1,h=kt.TRIANGLES,u=0;this.drawCalls.push(s);for(let c=0;c<this.batches.length;c++){const d=this.batches[c],f=8,p=d.style,m=p.texture.baseTexture;l!==!!p.native&&(l=!!p.native,h=l?kt.LINES:kt.TRIANGLES,a=null,r=f,e++),a!==m&&(a=m,m._batchEnabled!==e&&(r===f&&(e++,r=0,s.size>0&&(s=Dn.pop(),s||(s=new zo,s.texArray=new Xo),this.drawCalls.push(s)),s.start=u,s.size=0,s.texArray.count=0,s.type=h),m.touched=1,m._batchEnabled=e,m._batchLocation=r,m.wrapMode=mi.REPEAT,s.texArray.elements[s.texArray.count++]=m,r++)),s.size+=d.size,u+=d.size,o=m._batchLocation,this.addColors(t,p.color,p.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,o,d.attribSize,d.attribStart)}ge._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,i=this.colors,s=this.textureIds,r=new ArrayBuffer(e.length*3*4),a=new Float32Array(r),o=new Uint32Array(r);let l=0;for(let h=0;h<e.length/2;h++)a[l++]=e[h*2],a[l++]=e[h*2+1],a[l++]=t[h*2],a[l++]=t[h*2+1],o[l++]=i[h],a[l++]=s[h];this._buffer.update(r),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?Dc.triangulate(e,this):po[e.type].triangulate(e,this)}processLine(e){Ah(e,this);for(let t=0;t<e.holes.length;t++)Ah(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const i=e[t];po[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let i=0;i<e.length/2;i++){const s=e[i*2],r=e[i*2+1];e[i*2]=t.a*s+t.c*r+t.tx,e[i*2+1]=t.b*s+t.d*r+t.ty}}addColors(e,t,i,s,r=0){const a=Oe.shared.setValue(t).toLittleEndianNumber(),o=Oe.shared.setValue(a).toPremultiplied(i);e.length=Math.max(e.length,r+s);for(let l=0;l<s;l++)e[r+l]=o}addTextureIds(e,t,i,s=0){e.length=Math.max(e.length,s+i);for(let r=0;r<i;r++)e[s+r]=t}addUvs(e,t,i,s,r,a=null){let o=0;const l=t.length,h=i.frame;for(;o<r;){let c=e[(s+o)*2],d=e[(s+o)*2+1];if(a){const f=a.a*c+a.c*d+a.tx;d=a.b*c+a.d*d+a.ty,c=f}o++,t.push(c/h.width,d/h.height)}const u=i.baseTexture;(h.width<u.width||h.height<u.height)&&this.adjustUvs(t,i,l,r)}adjustUvs(e,t,i,s){const r=t.baseTexture,a=1e-6,o=i+s*2,l=t.frame,h=l.width/r.width,u=l.height/r.height;let c=l.x/l.width,d=l.y/l.height,f=Math.floor(e[i]+a),p=Math.floor(e[i+1]+a);for(let m=i+2;m<o;m+=2)f=Math.min(f,Math.floor(e[m]+a)),p=Math.min(p,Math.floor(e[m+1]+a));c-=f,d-=p;for(let m=i;m<o;m+=2)e[m]=(e[m]+c)*h,e[m+1]=(e[m+1]+d)*u}};Bc.BATCHABLE_SIZE=100;let Ux=Bc;class Ar{constructor(){this.color=16777215,this.alpha=1,this.texture=ie.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new Ar;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=ie.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Na extends Ar{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=pi.BUTT,this.join=ft.MITER,this.miterLimit=10}clone(){const e=new Na;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=pi.BUTT,this.join=ft.MITER,this.miterLimit=10}}const mo={},ca=class jn extends Rt{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Ar,this._lineStyle=new Na,this._matrix=null,this._holeMode=!1,this.state=zt.for2d(),this._geometry=e||new Ux,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Oe(16777215),this.blendMode=ce.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new jn(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,i,s=.5,r=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:i,alignment:s,native:r}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:ie.WHITE,color:e!=null&&e.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:pi.BUTT,join:ft.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.width>0&&e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:i},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Hi,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new Hi,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,s=i[i.length-2],r=i[i.length-1];return(s!==e||r!==t)&&i.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,i,s){this._initCurve();const r=this.currentPath.points;return r.length===0&&this.moveTo(0,0),Fa.curveTo(e,t,i,s,r),this}bezierCurveTo(e,t,i,s,r,a){return this._initCurve(),La.curveTo(e,t,i,s,r,a,this.currentPath.points),this}arcTo(e,t,i,s,r){this._initCurve(e,t);const a=this.currentPath.points,o=bh.curveTo(e,t,i,s,r,a);if(o){const{cx:l,cy:h,radius:u,startAngle:c,endAngle:d,anticlockwise:f}=o;this.arc(l,h,u,c,d,f)}return this}arc(e,t,i,s,r,a=!1){if(s===r)return this;if(!a&&r<=s?r+=sr:a&&s<=r&&(s+=sr),r-s===0)return this;const o=e+Math.cos(s)*i,l=t+Math.sin(s)*i,h=this._geometry.closePointEps;let u=this.currentPath?this.currentPath.points:null;if(u){const c=Math.abs(u[u.length-2]-o),d=Math.abs(u[u.length-1]-l);c<h&&d<h||u.push(o,l)}else this.moveTo(o,l),u=this.currentPath.points;return bh.arc(o,l,e,t,i,s,r,a,u),this}beginFill(e=0,t){return this.beginTextureFill({texture:ie.WHITE,color:e,alpha:t})}normalizeColor(e){const t=Oe.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:ie.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:i},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,i,s){return this.drawShape(new ve(e,t,i,s))}drawRoundedRect(e,t,i,s,r){return this.drawShape(new Er(e,t,i,s,r))}drawCircle(e,t,i){return this.drawShape(new wr(e,t,i))}drawEllipse(e,t,i,s){return this.drawShape(new Tr(e,t,i,s))}drawPolygon(...e){let t,i=!0;const s=e[0];s.points?(i=s.closeStroke,t=s.points):Array.isArray(e[0])?t=e[0]:t=e;const r=new Hi(t);return r.closeStroke=i,this.drawShape(r),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===$e.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,i=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(e.points);for(let s=0;s<i;s++){const r=e.batches[s],a=r.style.color,o=new Float32Array(this.vertexData.buffer,r.attribStart*4*2,r.attribSize*2),l=new Float32Array(e.uvsFloat32.buffer,r.attribStart*4*2,r.attribSize*2),h=new Uint16Array(e.indicesUint16.buffer,r.start*2,r.size),u={vertexData:o,blendMode:t,indices:h,uvs:l,_batchRGB:Oe.shared.setValue(a).toRgbArray(),_tintRGB:a,_texture:r.style.texture,alpha:r.style.alpha,worldAlpha:1};this.batches[s]=u}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,i=this.batches.length;t<i;t++){const s=this.batches[t];s.worldAlpha=this.worldAlpha*s.alpha,e.plugins[this.pluginName].render(s)}}}_renderDirect(e){const t=this._resolveDirectShader(e),i=this._geometry,s=this.worldAlpha,r=t.uniforms,a=i.drawCalls;r.translationMatrix=this.transform.worldTransform,Oe.shared.setValue(this._tintColor).premultiply(s).toArray(r.tint),e.shader.bind(t),e.geometry.bind(i,t),e.state.set(this.state);for(let o=0,l=a.length;o<l;o++)this._renderDrawCallDirect(e,i.drawCalls[o])}_renderDrawCallDirect(e,t){const{texArray:i,type:s,size:r,start:a}=t,o=i.count;for(let l=0;l<o;l++)e.texture.bind(i.elements[l],l);e.geometry.draw(s,r,a)}_resolveDirectShader(e){let t=this.shader;const i=this.pluginName;if(!t){if(!mo[i]){const{maxTextures:s}=e.plugins[i],r=new Int32Array(s);for(let l=0;l<s;l++)r[l]=l;const a={tint:new Float32Array([1,1,1,1]),translationMatrix:new Fe,default:At.from({uSamplers:r},!0)},o=e.plugins[i]._shader.program;mo[i]=new Ht(o,a)}t=mo[i]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:i,maxX:s,maxY:r}=e.bounds;this._bounds.addFrame(this.transform,t,i,s,r)}containsPoint(e){return this.worldTransform.applyInverse(e,jn._TEMP_POINT),this._geometry.containsPoint(jn._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=Oe.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,i=t.a,s=t.b,r=t.c,a=t.d,o=t.tx,l=t.ty,h=this._geometry.points,u=this.vertexData;let c=0;for(let d=0;d<h.length;d+=2){const f=h[d],p=h[d+1];u[c++]=i*f+r*p+o,u[c++]=a*p+s*f+l}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};ca.curves=bs,ca._TEMP_POINT=new Te;let on=ca;class Hx{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const go=new Te,Ph=new Hi,Lc=class Fc extends Rt{constructor(e,t,i,s=kt.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=i||zt.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=te.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===kt.TRIANGLES&&t.length<Fc.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const s=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[s]),e.plugins[s].render(this)}calculateVertices(){const e=this.geometry.buffers[0],t=e.data,i=e._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));const s=this.transform.worldTransform,r=s.a,a=s.b,o=s.c,l=s.d,h=s.tx,u=s.ty,c=this.vertexData;for(let d=0;d<c.length/2;d++){const f=t[d*2],p=t[d*2+1];c[d*2]=r*f+o*p+h,c[d*2+1]=a*f+l*p+u}if(this._roundPixels){const d=te.RESOLUTION;for(let f=0;f<c.length;++f)c[f]=Math.round(c[f]*d)/d}this.vertexDirty=i}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new Hx(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,go);const t=this.geometry.getBuffer("aVertexPosition").data,i=Ph.points,s=this.geometry.getIndex().data,r=s.length,a=this.drawMode===4?3:1;for(let o=0;o+2<r;o+=a){const l=s[o]*2,h=s[o+1]*2,u=s[o+2]*2;if(i[0]=t[l],i[1]=t[l+1],i[2]=t[h],i[3]=t[h+1],i[4]=t[u],i[5]=t[u+1],Ph.contains(go.x,go.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};Lc.BATCHABLE_SIZE=100;let Ch=Lc;class Gx extends vi{constructor(e,t,i){super();const s=new ze(e),r=new ze(t,!0),a=new ze(i,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,oe.FLOAT).addAttribute("aTextureCoord",r,2,!1,oe.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var zx=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,Vx=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Ih extends Ht{constructor(e,t){const i={uSampler:e,alpha:1,uTextureMatrix:Fe.IDENTITY,uColor:new Float32Array([1,1,1,1])};t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t),t.uniforms&&Object.assign(i,t.uniforms),super(t.program||qt.from(Vx,zx),i),this._colorDirty=!1,this.uvMatrix=new Qu(e),this.batchable=t.program===void 0,this.pluginName=t.pluginName,this._tintColor=new Oe(t.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;Oe.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Mh{constructor(e,t,i){this.geometry=new vi,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<e.length;++s){let r=e[s];r={attributeName:r.attributeName,size:r.size,uploadFunction:r.uploadFunction,type:r.type||oe.FLOAT,offset:r.offset},t[s]?this.dynamicProperties.push(r):this.staticProperties.push(r)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new ze(ug(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];o.offset=t,t+=o.size,this.dynamicStride+=o.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new ze(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];o.offset=s,s+=o.size,this.staticStride+=o.size}const r=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(r),this.staticDataUint32=new Uint32Array(r),this.staticBuffer=new ze(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];e.addAttribute(o.attributeName,this.dynamicBuffer,0,o.type===oe.UNSIGNED_BYTE,o.type,this.dynamicStride*4,o.offset*4)}for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];e.addAttribute(o.attributeName,this.staticBuffer,0,o.type===oe.UNSIGNED_BYTE,o.type,this.staticStride*4,o.offset*4)}}uploadDynamic(e,t,i){for(let s=0;s<this.dynamicProperties.length;s++){const r=this.dynamicProperties[s];r.uploadFunction(e,t,i,r.type===oe.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,r.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,i){for(let s=0;s<this.staticProperties.length;s++){const r=this.staticProperties[s];r.uploadFunction(e,t,i,r.type===oe.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,r.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var Wx=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,jx=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Nc extends br{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new Fe,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:oe.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Ht.from(jx,Wx,{}),this.state=zt.for2d()}render(e){const t=e.children,i=e._maxSize,s=e._batchSize,r=this.renderer;let a=t.length;if(a===0)return;a>i&&!e.autoResize&&(a=i);let o=e._buffers;o||(o=e._buffers=this.generateBuffers(e));const l=t[0]._texture.baseTexture,h=l.alphaMode>0;this.state.blendMode=Lu(e.blendMode,h),r.state.set(this.state);const u=r.gl,c=e.worldTransform.copyTo(this.tempMatrix);c.prepend(r.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=Oe.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<a;f+=s,p+=1){let m=a-f;m>s&&(m=s),p>=o.length&&o.push(this._generateOneMoreBuffer(e));const v=o[p];v.uploadDynamic(t,f,m);const g=e._bufferUpdateIDs[p]||0;d=d||v._updateID<g,d&&(v._updateID=e._updateID,v.uploadStatic(t,f,m)),r.geometry.bind(v.geometry),u.drawElements(u.TRIANGLES,m*6,u.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],i=e._maxSize,s=e._batchSize,r=e._properties;for(let a=0;a<i;a+=s)t.push(new Mh(this.properties,r,s));return t}_generateOneMoreBuffer(e){const t=e._batchSize,i=e._properties;return new Mh(this.properties,i,t)}uploadVertices(e,t,i,s,r,a){let o=0,l=0,h=0,u=0;for(let c=0;c<i;++c){const d=e[t+c],f=d._texture,p=d.scale.x,m=d.scale.y,v=f.trim,g=f.orig;v?(l=v.x-d.anchor.x*g.width,o=l+v.width,u=v.y-d.anchor.y*g.height,h=u+v.height):(o=g.width*(1-d.anchor.x),l=g.width*-d.anchor.x,h=g.height*(1-d.anchor.y),u=g.height*-d.anchor.y),s[a]=l*p,s[a+1]=u*m,s[a+r]=o*p,s[a+r+1]=u*m,s[a+r*2]=o*p,s[a+r*2+1]=h*m,s[a+r*3]=l*p,s[a+r*3+1]=h*m,a+=r*4}}uploadPosition(e,t,i,s,r,a){for(let o=0;o<i;o++){const l=e[t+o].position;s[a]=l.x,s[a+1]=l.y,s[a+r]=l.x,s[a+r+1]=l.y,s[a+r*2]=l.x,s[a+r*2+1]=l.y,s[a+r*3]=l.x,s[a+r*3+1]=l.y,a+=r*4}}uploadRotation(e,t,i,s,r,a){for(let o=0;o<i;o++){const l=e[t+o].rotation;s[a]=l,s[a+r]=l,s[a+r*2]=l,s[a+r*3]=l,a+=r*4}}uploadUvs(e,t,i,s,r,a){for(let o=0;o<i;++o){const l=e[t+o]._texture._uvs;l?(s[a]=l.x0,s[a+1]=l.y0,s[a+r]=l.x1,s[a+r+1]=l.y1,s[a+r*2]=l.x2,s[a+r*2+1]=l.y2,s[a+r*3]=l.x3,s[a+r*3+1]=l.y3,a+=r*4):(s[a]=0,s[a+1]=0,s[a+r]=0,s[a+r+1]=0,s[a+r*2]=0,s[a+r*2+1]=0,s[a+r*3]=0,s[a+r*3+1]=0,a+=r*4)}}uploadTint(e,t,i,s,r,a){for(let o=0;o<i;++o){const l=e[t+o],h=Oe.shared.setValue(l._tintRGB).toPremultiplied(l.alpha,l.texture.baseTexture.alphaMode>0);s[a]=h,s[a+r]=h,s[a+r*2]=h,s[a+r*3]=h,a+=r*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Nc.extension={name:"particle",type:K.RendererPlugin};se.add(Nc);var Rr=(n=>(n[n.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",n[n.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",n))(Rr||{});const Bn={willReadFrequently:!0},Ot=class ne{static get experimentalLetterSpacingSupported(){let e=ne._experimentalLetterSpacingSupported;if(e!==void 0){const t=te.ADAPTER.getCanvasRenderingContext2D().prototype;e=ne._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,i,s,r,a,o,l,h){this.text=e,this.style=t,this.width=i,this.height=s,this.lines=r,this.lineWidths=a,this.lineHeight=o,this.maxLineWidth=l,this.fontProperties=h}static measureText(e,t,i,s=ne._canvas){i=i??t.wordWrap;const r=t.toFontString(),a=ne.measureFont(r);a.fontSize===0&&(a.fontSize=t.fontSize,a.ascent=t.fontSize);const o=s.getContext("2d",Bn);o.font=r;const l=(i?ne.wordWrap(e,t,s):e).split(/(?:\r\n|\r|\n)/),h=new Array(l.length);let u=0;for(let p=0;p<l.length;p++){const m=ne._measureText(l[p],t.letterSpacing,o);h[p]=m,u=Math.max(u,m)}let c=u+t.strokeThickness;t.dropShadow&&(c+=t.dropShadowDistance);const d=t.lineHeight||a.fontSize+t.strokeThickness;let f=Math.max(d,a.fontSize+t.strokeThickness*2)+t.leading+(l.length-1)*(d+t.leading);return t.dropShadow&&(f+=t.dropShadowDistance),new ne(e,t,c,f,l,h,d+t.leading,u,a)}static _measureText(e,t,i){let s=!1;ne.experimentalLetterSpacingSupported&&(ne.experimentalLetterSpacing?(i.letterSpacing=`${t}px`,i.textLetterSpacing=`${t}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let r=i.measureText(e).width;return r>0&&(s?r-=t:r+=(ne.graphemeSegmenter(e).length-1)*t),r}static wordWrap(e,t,i=ne._canvas){const s=i.getContext("2d",Bn);let r=0,a="",o="";const l=Object.create(null),{letterSpacing:h,whiteSpace:u}=t,c=ne.collapseSpaces(u),d=ne.collapseNewlines(u);let f=!c;const p=t.wordWrapWidth+h,m=ne.tokenize(e);for(let v=0;v<m.length;v++){let g=m[v];if(ne.isNewline(g)){if(!d){o+=ne.addLine(a),f=!c,a="",r=0;continue}g=" "}if(c){const w=ne.isBreakingSpace(g),E=ne.isBreakingSpace(a[a.length-1]);if(w&&E)continue}const T=ne.getFromCache(g,h,l,s);if(T>p)if(a!==""&&(o+=ne.addLine(a),a="",r=0),ne.canBreakWords(g,t.breakWords)){const w=ne.wordWrapSplit(g);for(let E=0;E<w.length;E++){let P=w[E],C=P,D=1;for(;w[E+D];){const H=w[E+D];if(!ne.canBreakChars(C,H,g,E,t.breakWords))P+=H;else break;C=H,D++}E+=D-1;const B=ne.getFromCache(P,h,l,s);B+r>p&&(o+=ne.addLine(a),f=!1,a="",r=0),a+=P,r+=B}}else{a.length>0&&(o+=ne.addLine(a),a="",r=0);const w=v===m.length-1;o+=ne.addLine(g,!w),f=!1,a="",r=0}else T+r>p&&(f=!1,o+=ne.addLine(a),a="",r=0),(a.length>0||!ne.isBreakingSpace(g)||f)&&(a+=g,r+=T)}return o+=ne.addLine(a,!1),o}static addLine(e,t=!0){return e=ne.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,i,s){let r=i[e];return typeof r!="number"&&(r=ne._measureText(e,t,s)+t,i[e]=r),r}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const i=e[t];if(!ne.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:ne._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:ne._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let i="";if(typeof e!="string")return t;for(let s=0;s<e.length;s++){const r=e[s],a=e[s+1];if(ne.isBreakingSpace(r,a)||ne.isNewline(r)){i!==""&&(t.push(i),i=""),t.push(r);continue}i+=r}return i!==""&&t.push(i),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,i,s,r){return!0}static wordWrapSplit(e){return ne.graphemeSegmenter(e)}static measureFont(e){if(ne._fonts[e])return ne._fonts[e];const t={ascent:0,descent:0,fontSize:0},i=ne._canvas,s=ne._context;s.font=e;const r=ne.METRICS_STRING+ne.BASELINE_SYMBOL,a=Math.ceil(s.measureText(r).width);let o=Math.ceil(s.measureText(ne.BASELINE_SYMBOL).width);const l=Math.ceil(ne.HEIGHT_MULTIPLIER*o);if(o=o*ne.BASELINE_MULTIPLIER|0,a===0||l===0)return ne._fonts[e]=t,t;i.width=a,i.height=l,s.fillStyle="#f00",s.fillRect(0,0,a,l),s.font=e,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(r,0,o);const h=s.getImageData(0,0,a,l).data,u=h.length,c=a*4;let d=0,f=0,p=!1;for(d=0;d<o;++d){for(let m=0;m<c;m+=4)if(h[f+m]!==255){p=!0;break}if(!p)f+=c;else break}for(t.ascent=o-d,f=u-c,p=!1,d=l;d>o;--d){for(let m=0;m<c;m+=4)if(h[f+m]!==255){p=!0;break}if(!p)f-=c;else break}return t.descent=d-o,t.fontSize=t.ascent+t.descent,ne._fonts[e]=t,t}static clearMetrics(e=""){e?delete ne._fonts[e]:ne._fonts={}}static get _canvas(){var e;if(!ne.__canvas){let t;try{const i=new OffscreenCanvas(0,0);if((e=i.getContext("2d",Bn))!=null&&e.measureText)return ne.__canvas=i,i;t=te.ADAPTER.createCanvas()}catch{t=te.ADAPTER.createCanvas()}t.width=t.height=10,ne.__canvas=t}return ne.__canvas}static get _context(){return ne.__context||(ne.__context=ne._canvas.getContext("2d",Bn)),ne.__context}};Ot.METRICS_STRING="|q",Ot.BASELINE_SYMBOL="M",Ot.BASELINE_MULTIPLIER=1.4,Ot.HEIGHT_MULTIPLIER=2,Ot.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){const n=new Intl.Segmenter;return e=>[...n.segment(e)].map(t=>t.segment)}return n=>[...n]})(),Ot.experimentalLetterSpacing=!1,Ot._fonts={},Ot._newlines=[10,13],Ot._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let ai=Ot;const Xx=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],kc=class qs{constructor(e){this.styleID=0,this.reset(),yo(this,e,e)}clone(){const e={};return yo(e,this,qs.defaultStyle),new qs(e)}reset(){yo(this,qs.defaultStyle,qs.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=vo(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=vo(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){Yx(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=vo(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let i=t.length-1;i>=0;i--){let s=t[i].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!Xx.includes(s)&&(s=`"${s}"`),t[i]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};kc.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Rr.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let yi=kc;function vo(n){const e=Oe.shared,t=i=>{const s=e.setValue(i);return s.alpha===1?s.toHex():s.toRgbaString()};return Array.isArray(n)?n.map(t):t(n)}function Yx(n,e){if(!Array.isArray(n)||!Array.isArray(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}function yo(n,e,t){for(const i in t)Array.isArray(e[i])?n[i]=e[i].slice():n[i]=e[i]}const qx={texture:!0,children:!1,baseTexture:!0},Uc=class da extends Ds{constructor(e,t,i){let s=!1;i||(i=te.ADAPTER.createCanvas(),s=!0),i.width=3,i.height=3;const r=ie.from(i);r.orig=new ve,r.trim=new ve,super(r),this._ownCanvas=s,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=da.defaultResolution??te.RESOLUTION,this._autoResolution=da.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return ai.experimentalLetterSpacing}static set experimentalLetterSpacing(e){xe("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),ai.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const i=this.context,s=ai.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=s.width,a=s.height,o=s.lines,l=s.lineHeight,h=s.lineWidths,u=s.maxLineWidth,c=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,r)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,a)+t.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=t.strokeThickness,i.textBaseline=t.textBaseline,i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit;let d,f;const p=t.dropShadow?2:1;for(let m=0;m<p;++m){const v=t.dropShadow&&m===0,g=v?Math.ceil(Math.max(1,a)+t.padding*2):0,T=g*this._resolution;if(v){i.fillStyle="black",i.strokeStyle="black";const E=t.dropShadowColor,P=t.dropShadowBlur*this._resolution,C=t.dropShadowDistance*this._resolution;i.shadowColor=Oe.shared.setValue(E).setAlpha(t.dropShadowAlpha).toRgbaString(),i.shadowBlur=P,i.shadowOffsetX=Math.cos(t.dropShadowAngle)*C,i.shadowOffsetY=Math.sin(t.dropShadowAngle)*C+T}else i.fillStyle=this._generateFillStyle(t,o,s),i.strokeStyle=t.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let w=(l-c.fontSize)/2;l-c.fontSize<0&&(w=0);for(let E=0;E<o.length;E++)d=t.strokeThickness/2,f=t.strokeThickness/2+E*l+c.ascent+w,t.align==="right"?d+=u-h[E]:t.align==="center"&&(d+=(u-h[E])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(o[E],d+t.padding,f+t.padding-g,!0),t.fill&&this.drawLetterSpacing(o[E],d+t.padding,f+t.padding-g)}this.updateTexture()}drawLetterSpacing(e,t,i,s=!1){const r=this._style.letterSpacing;let a=!1;if(ai.experimentalLetterSpacingSupported&&(ai.experimentalLetterSpacing?(this.context.letterSpacing=`${r}px`,this.context.textLetterSpacing=`${r}px`,a=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),r===0||a){s?this.context.strokeText(e,t,i):this.context.fillText(e,t,i);return}let o=t;const l=ai.graphemeSegmenter(e);let h=this.context.measureText(e).width,u=0;for(let c=0;c<l.length;++c){const d=l[c];s?this.context.strokeText(d,o,i):this.context.fillText(d,o,i);let f="";for(let p=c+1;p<l.length;++p)f+=l[p];u=this.context.measureText(f).width,o+=h-u+r,h=u}}updateTexture(){const e=this.canvas;if(this._style.trim){const a=pg(e);a.data&&(e.width=a.width,e.height=a.height,this.context.putImageData(a.data,0,0))}const t=this._texture,i=this._style,s=i.trim?0:i.padding,r=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-s,t.trim.y=-s,t.orig.width=t._frame.width-s*2,t.orig.height=t._frame.height-s*2,this._onTextureUpdate(),r.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,i){const s=e.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let r;const a=e.dropShadow?e.dropShadowDistance:0,o=e.padding||0,l=this.canvas.width/this._resolution-a-o*2,h=this.canvas.height/this._resolution-a-o*2,u=s.slice(),c=e.fillGradientStops.slice();if(!c.length){const d=u.length+1;for(let f=1;f<d;++f)c.push(f/d)}if(u.unshift(s[0]),c.unshift(0),u.push(s[s.length-1]),c.push(1),e.fillGradientType===Rr.LINEAR_VERTICAL){r=this.context.createLinearGradient(l/2,o,l/2,h+o);const d=i.fontProperties.fontSize+e.strokeThickness;for(let f=0;f<t.length;f++){const p=i.lineHeight*(f-1)+d,m=i.lineHeight*f;let v=m;f>0&&p>m&&(v=(m+p)/2);const g=m+d,T=i.lineHeight*(f+1);let w=g;f+1<t.length&&T<g&&(w=(g+T)/2);const E=(w-v)/h;for(let P=0;P<u.length;P++){let C=0;typeof c[P]=="number"?C=c[P]:C=P/u.length;let D=Math.min(1,Math.max(0,v/h+C*E));D=Number(D.toFixed(5)),r.addColorStop(D,u[P])}}}else{r=this.context.createLinearGradient(o,h/2,l+o,h/2);const d=u.length+1;let f=1;for(let p=0;p<u.length;p++){let m;typeof c[p]=="number"?m=c[p]:m=f/d,r.addColorStop(m,u[p]),f++}}return r}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},qx,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=fi(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=fi(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof yi?this._style=e:this._style=new yi(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};Uc.defaultAutoResolution=!0;let Hc=Uc;class Zx{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Kx(n,e){var t;let i=!1;if((t=n?._textures)!=null&&t.length){for(let s=0;s<n._textures.length;s++)if(n._textures[s]instanceof ie){const r=n._textures[s].baseTexture;e.includes(r)||(e.push(r),i=!0)}}return i}function Jx(n,e){if(n.baseTexture instanceof ge){const t=n.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function Qx(n,e){if(n._texture&&n._texture instanceof ie){const t=n._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function $x(n,e){return e instanceof Hc?(e.updateText(!0),!0):!1}function e0(n,e){if(e instanceof yi){const t=e.toFontString();return ai.measureFont(t),!0}return!1}function t0(n,e){if(n instanceof Hc){e.includes(n.style)||e.push(n.style),e.includes(n)||e.push(n);const t=n._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function i0(n,e){return n instanceof yi?(e.includes(n)||e.push(n),!0):!1}const Gc=class zc{constructor(e){this.limiter=new Zx(zc.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(t0),this.registerFindHook(i0),this.registerFindHook(Kx),this.registerFindHook(Jx),this.registerFindHook(Qx),this.registerUploadHook($x),this.registerUploadHook(e0)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,ut.system.addOnce(this.tick,this,Wi.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let i=0,s=this.uploadHooks.length;i<s;i++)if(this.uploadHooks[i](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)ut.system.addOnce(this.tick,this,Wi.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,i=e.length;t<i;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,i=this.addHooks.length;t<i&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Rt)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&ut.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Gc.uploadsPerFrame=4;let fa=Gc;Object.defineProperties(te,{UPLOADS_PER_FRAME:{get(){return fa.uploadsPerFrame},set(n){xe("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),fa.uploadsPerFrame=n}}});function Vc(n,e){return e instanceof ge?(e._glTextures[n.CONTEXT_UID]||n.texture.bind(e),!0):!1}function s0(n,e){if(!(e instanceof on))return!1;const{geometry:t}=e;e.finishPoly(),t.updateBatches();const{batches:i}=t;for(let s=0;s<i.length;s++){const{texture:r}=i[s].style;r&&Vc(n,r.baseTexture)}return t.batchable||n.geometry.bind(t,e._resolveDirectShader(n)),!0}function n0(n,e){return n instanceof on?(e.push(n),!0):!1}class Wc extends fa{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(n0),this.registerUploadHook(Vc),this.registerUploadHook(s0)}}Wc.extension={name:"prepare",type:K.RendererSystem};se.add(Wc);var r0=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,o0=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,a0=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Dh=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,l0=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const On=new Fe;class jc extends br{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new qu,this.state=zt.for2d()}contextChange(){const e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=Ht.from(Dh,l0,t),this.shader=e.context.webGLVersion>1?Ht.from(o0,r0,t):Ht.from(Dh,a0,t)}render(e){const t=this.renderer,i=this.quad;let s=i.vertices;s[0]=s[6]=e._width*-e.anchor.x,s[1]=s[3]=e._height*-e.anchor.y,s[2]=s[4]=e._width*(1-e.anchor.x),s[5]=s[7]=e._height*(1-e.anchor.y);const r=e.uvRespectAnchor?e.anchor.x:0,a=e.uvRespectAnchor?e.anchor.y:0;s=i.uvs,s[0]=s[6]=-r,s[1]=s[3]=-a,s[2]=s[4]=1-r,s[5]=s[7]=1-a,i.invalidate();const o=e._texture,l=o.baseTexture,h=l.alphaMode>0,u=e.tileTransform.localTransform,c=e.uvMatrix;let d=l.isPowerOfTwo&&o.frame.width===l.width&&o.frame.height===l.height;d&&(l._glTextures[t.CONTEXT_UID]?d=l.wrapMode!==mi.CLAMP:l.wrapMode===mi.CLAMP&&(l.wrapMode=mi.REPEAT));const f=d?this.simpleShader:this.shader,p=o.width,m=o.height,v=e._width,g=e._height;On.set(u.a*p/v,u.b*p/g,u.c*m/v,u.d*m/g,u.tx/v,u.ty/g),On.invert(),d?On.prepend(c.mapCoord):(f.uniforms.uMapCoord=c.mapCoord.toArray(!0),f.uniforms.uClampFrame=c.uClampFrame,f.uniforms.uClampOffset=c.uClampOffset),f.uniforms.uTransform=On.toArray(!0),f.uniforms.uColor=Oe.shared.setValue(e.tint).premultiply(e.worldAlpha,h).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),f.uniforms.uSampler=o,t.shader.bind(f),t.geometry.bind(i),this.state.blendMode=Lu(e.blendMode,h),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}jc.extension={name:"tilingSprite",type:K.RendererPlugin};se.add(jc);const Xc=class Zs{constructor(e,t,i){this.linkedSheets=[],(e instanceof ge||e instanceof ie)&&(e={texture:e,data:t,resolutionFilename:i});const{texture:s,data:r,resolutionFilename:a=null,cachePrefix:o=""}=e;this.cachePrefix=o,this._texture=s instanceof ie?s:null,this.baseTexture=s instanceof ge?s:this._texture.baseTexture,this.textures={},this.animations={},this.data=r;const l=this.baseTexture.resource;this.resolution=this._updateResolution(a||(l?l.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let i=Jt(e,null);return i===null&&(i=typeof t=="number"?t:parseFloat(t??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Zs.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const i=Zs.BATCH_SIZE;for(;t-e<i&&t<this._frameKeys.length;){const s=this._frameKeys[t],r=this._frames[s],a=r.frame;if(a){let o=null,l=null;const h=r.trimmed!==!1&&r.sourceSize?r.sourceSize:r.frame,u=new ve(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);r.rotated?o=new ve(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):o=new ve(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),r.trimmed!==!1&&r.spriteSourceSize&&(l=new ve(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[s]=new ie(this.baseTexture,o,u,l,r.rotated?2:0,r.anchor,r.borders),ie.addToCache(this.textures[s],this.cachePrefix+s.toString())}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let i=0;i<e[t].length;i++){const s=e[t][i];this.animations[t].push(this.textures[s])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Zs.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Zs.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};Xc.BATCH_SIZE=1e3;let Bh=Xc;const h0=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function Yc(n,e,t){const i={};if(n.forEach(s=>{i[s]=e}),Object.keys(e.textures).forEach(s=>{i[`${e.cachePrefix}${s}`]=e.textures[s]}),!t){const s=Ze.dirname(n[0]);e.linkedSheets.forEach((r,a)=>{Object.assign(i,Yc([`${s}/${e.data.meta.related_multi_packs[a]}`],r,!0))})}return i}const u0={extension:K.Asset,cache:{test:n=>n instanceof Bh,getCacheableAssets:(n,e)=>Yc(n,e,!1)},resolver:{test:n=>{const e=n.split("?")[0].split("."),t=e.pop(),i=e.pop();return t==="json"&&h0.includes(i)},parse:n=>{var e;const t=n.split(".");return{resolution:parseFloat(((e=te.RETINA_PREFIX.exec(n))==null?void 0:e[1])??"1"),format:t[t.length-2],src:n}}},loader:{name:"spritesheetLoader",extension:{type:K.LoadParser,priority:It.Normal},async testParse(n,e){return Ze.extname(e.src).toLowerCase()===".json"&&!!n.frames},async parse(n,e,t){var i,s;const{texture:r,imageFilename:a,cachePrefix:o}=e?.data??{};let l=Ze.dirname(e.src);l&&l.lastIndexOf("/")!==l.length-1&&(l+="/");let h;if(r&&r.baseTexture)h=r;else{const d=la(l+(a??n.meta.image),e.src);h=(await t.load([d]))[d]}const u=new Bh({texture:h.baseTexture,data:n,resolutionFilename:e.src,cachePrefix:o});await u.parse();const c=(i=n?.meta)==null?void 0:i.related_multi_packs;if(Array.isArray(c)){const d=[];for(const p of c){if(typeof p!="string")continue;let m=l+p;(s=e.data)!=null&&s.ignoreMultiPack||(m=la(m,e.src),d.push(t.load({src:m,data:{ignoreMultiPack:!0}})))}const f=await Promise.all(d);u.linkedSheets=f,f.forEach(p=>{p.linkedSheets=[u].concat(u.linkedSheets.filter(m=>m!==p))})}return u},unload(n){n.destroy(!0)}}};se.add(u0);class pr{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Xn{static test(e){return typeof e=="string"&&e.startsWith("info face=")}static parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const r in t){const a=t[r].match(/^[a-z]+/gm)[0],o=t[r].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(const h in o){const u=o[h].split("="),c=u[0],d=u[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;l[c]=p}i[a].push(l)}const s=new pr;return i.info.forEach(r=>s.info.push({face:r.face,size:parseInt(r.size,10)})),i.common.forEach(r=>s.common.push({lineHeight:parseInt(r.lineHeight,10)})),i.page.forEach(r=>s.page.push({id:parseInt(r.id,10),file:r.file})),i.char.forEach(r=>s.char.push({id:parseInt(r.id,10),page:parseInt(r.page,10),x:parseInt(r.x,10),y:parseInt(r.y,10),width:parseInt(r.width,10),height:parseInt(r.height,10),xoffset:parseInt(r.xoffset,10),yoffset:parseInt(r.yoffset,10),xadvance:parseInt(r.xadvance,10)})),i.kerning.forEach(r=>s.kerning.push({first:parseInt(r.first,10),second:parseInt(r.second,10),amount:parseInt(r.amount,10)})),i.distanceField.forEach(r=>s.distanceField.push({distanceRange:parseInt(r.distanceRange,10),fieldType:r.fieldType})),s}}class pa{static test(e){const t=e;return typeof e!="string"&&"getElementsByTagName"in e&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(e){const t=new pr,i=e.getElementsByTagName("info"),s=e.getElementsByTagName("common"),r=e.getElementsByTagName("page"),a=e.getElementsByTagName("char"),o=e.getElementsByTagName("kerning"),l=e.getElementsByTagName("distanceField");for(let h=0;h<i.length;h++)t.info.push({face:i[h].getAttribute("face"),size:parseInt(i[h].getAttribute("size"),10)});for(let h=0;h<s.length;h++)t.common.push({lineHeight:parseInt(s[h].getAttribute("lineHeight"),10)});for(let h=0;h<r.length;h++)t.page.push({id:parseInt(r[h].getAttribute("id"),10)||0,file:r[h].getAttribute("file")});for(let h=0;h<a.length;h++){const u=a[h];t.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(let h=0;h<o.length;h++)t.kerning.push({first:parseInt(o[h].getAttribute("first"),10),second:parseInt(o[h].getAttribute("second"),10),amount:parseInt(o[h].getAttribute("amount"),10)});for(let h=0;h<l.length;h++)t.distanceField.push({fieldType:l[h].getAttribute("fieldType"),distanceRange:parseInt(l[h].getAttribute("distanceRange"),10)});return t}}class ma{static test(e){return typeof e=="string"&&e.includes("<font>")?pa.test(te.ADAPTER.parseXML(e)):!1}static parse(e){return pa.parse(te.ADAPTER.parseXML(e))}}const xo=[Xn,pa,ma];function c0(n){for(let e=0;e<xo.length;e++)if(xo[e].test(n))return xo[e];return null}function d0(n,e,t,i,s,r){const a=t.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;let o;const l=t.dropShadow?t.dropShadowDistance:0,h=t.padding||0,u=n.width/i-l-h*2,c=n.height/i-l-h*2,d=a.slice(),f=t.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let m=1;m<p;++m)f.push(m/p)}if(d.unshift(a[0]),f.unshift(0),d.push(a[a.length-1]),f.push(1),t.fillGradientType===Rr.LINEAR_VERTICAL){o=e.createLinearGradient(u/2,h,u/2,c+h);let p=0;const m=(r.fontProperties.fontSize+t.strokeThickness)/c;for(let v=0;v<s.length;v++){const g=r.lineHeight*v;for(let T=0;T<d.length;T++){let w=0;typeof f[T]=="number"?w=f[T]:w=T/d.length;const E=g/c+w*m;let P=Math.max(p,E);P=Math.min(P,1),o.addColorStop(P,d[T]),p=P}}}else{o=e.createLinearGradient(h,c/2,u+h,c/2);const p=d.length+1;let m=1;for(let v=0;v<d.length;v++){let g;typeof f[v]=="number"?g=f[v]:g=m/p,o.addColorStop(g,d[v]),m++}}return o}function f0(n,e,t,i,s,r,a){const o=t.text,l=t.fontProperties;e.translate(i,s),e.scale(r,r);const h=a.strokeThickness/2,u=-(a.strokeThickness/2);if(e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=d0(n,e,a,r,[o],t),e.strokeStyle=a.stroke,a.dropShadow){const c=a.dropShadowColor,d=a.dropShadowBlur*r,f=a.dropShadowDistance*r;e.shadowColor=Oe.shared.setValue(c).setAlpha(a.dropShadowAlpha).toRgbaString(),e.shadowBlur=d,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*f,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*f}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;a.stroke&&a.strokeThickness&&e.strokeText(o,h,u+t.lineHeight-l.descent),a.fill&&e.fillText(o,h,u+t.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function Yn(n){return n.codePointAt?n.codePointAt(0):n.charCodeAt(0)}function qc(n){return Array.from?Array.from(n):n.split("")}function p0(n){typeof n=="string"&&(n=[n]);const e=[];for(let t=0,i=n.length;t<i;t++){const s=n[t];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);const r=s[0].charCodeAt(0),a=s[1].charCodeAt(0);if(a<r)throw new Error("[BitmapFont]: Invalid character range.");for(let o=r,l=a;o<=l;o++)e.push(String.fromCharCode(o))}else e.push(...qc(s))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}const ri=class Lt{constructor(e,t,i){var s;const[r]=e.info,[a]=e.common,[o]=e.page,[l]=e.distanceField,h=Jt(o.file),u={};this._ownsTextures=i,this.font=r.face,this.size=r.size,this.lineHeight=a.lineHeight/h,this.chars={},this.pageTextures=u;for(let c=0;c<e.page.length;c++){const{id:d,file:f}=e.page[c];u[d]=t instanceof Array?t[c]:t[f],l!=null&&l.fieldType&&l.fieldType!=="none"&&(u[d].baseTexture.alphaMode=at.NO_PREMULTIPLIED_ALPHA,u[d].baseTexture.mipmap=Gt.OFF)}for(let c=0;c<e.char.length;c++){const{id:d,page:f}=e.char[c];let{x:p,y:m,width:v,height:g,xoffset:T,yoffset:w,xadvance:E}=e.char[c];p/=h,m/=h,v/=h,g/=h,T/=h,w/=h,E/=h;const P=new ve(p+u[f].frame.x/h,m+u[f].frame.y/h,v,g);this.chars[d]={xOffset:T,yOffset:w,xAdvance:E,kerning:{},texture:new ie(u[f].baseTexture,P),page:f}}for(let c=0;c<e.kerning.length;c++){let{first:d,second:f,amount:p}=e.kerning[c];d/=h,f/=h,p/=h,this.chars[f]&&(this.chars[f].kerning[d]=p)}this.distanceFieldRange=l?.distanceRange,this.distanceFieldType=((s=l?.fieldType)==null?void 0:s.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,i){let s;if(e instanceof pr)s=e;else{const a=c0(e);if(!a)throw new Error("Unrecognized data format for font.");s=a.parse(e)}t instanceof ie&&(t=[t]);const r=new Lt(s,t,i);return Lt.available[r.font]=r,r}static uninstall(e){const t=Lt.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete Lt.available[e]}static from(e,t,i){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:s,padding:r,resolution:a,textureWidth:o,textureHeight:l,...h}=Object.assign({},Lt.defaultOptions,i),u=p0(s),c=t instanceof yi?t:new yi(t),d=o,f=new pr;f.info[0]={face:c.fontFamily,size:c.fontSize},f.common[0]={lineHeight:c.fontSize};let p=0,m=0,v,g,T,w=0;const E=[];for(let C=0;C<u.length;C++){v||(v=te.ADAPTER.createCanvas(),v.width=o,v.height=l,g=v.getContext("2d"),T=new ge(v,{resolution:a,...h}),E.push(new ie(T)),f.page.push({id:E.length-1,file:""}));const D=u[C],B=ai.measureText(D,c,!1,v),H=B.width,I=Math.ceil(B.height),N=Math.ceil((c.fontStyle==="italic"?2:1)*H);if(m>=l-I*a){if(m===0)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${D}')`);--C,v=null,g=null,T=null,m=0,p=0,w=0;continue}if(w=Math.max(I+B.fontProperties.descent,w),N*a+p>=d){if(p===0)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${D}')`);--C,m+=w*a,m=Math.ceil(m),p=0,w=0;continue}f0(v,g,B,p,m,a,c);const M=Yn(B.text);f.char.push({id:M,page:E.length-1,x:p/a,y:m/a,width:N,height:I,xoffset:0,yoffset:0,xadvance:H-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),p+=(N+2*r)*a,p=Math.ceil(p)}if(!(i!=null&&i.skipKerning))for(let C=0,D=u.length;C<D;C++){const B=u[C];for(let H=0;H<D;H++){const I=u[H],N=g.measureText(B).width,M=g.measureText(I).width,R=g.measureText(B+I).width-(N+M);R&&f.kerning.push({first:Yn(B),second:Yn(I),amount:R})}}const P=new Lt(f,E,!0);return Lt.available[e]!==void 0&&Lt.uninstall(e),Lt.available[e]=P,P}};ri.ALPHA=[["a","z"],["A","Z"]," "],ri.NUMERIC=[["0","9"]],ri.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],ri.ASCII=[[" ","~"]],ri.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:ri.ALPHANUMERIC},ri.available={};let oi=ri;var m0=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,g0=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Oh=[],Lh=[],Fh=[],v0=class Zc extends Rt{constructor(e,t={}){super();const{align:i,tint:s,maxWidth:r,letterSpacing:a,fontName:o,fontSize:l}=Object.assign({},Zc.styleDefaults,t);if(!oi.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new Oe(s),this._font=void 0,this._fontName=o,this._fontSize=l,this.text=e,this._maxWidth=r,this._maxLineHeight=0,this._letterSpacing=a,this._anchor=new Yt(()=>{this.dirty=!0},this,0,0),this._roundPixels=te.ROUND_PIXELS,this.dirty=!0,this._resolution=te.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var e;const t=oi.available[this._fontName],i=this.fontSize,s=i/t.size,r=new Te,a=[],o=[],l=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",u=qc(h),c=this._maxWidth*t.size/i,d=t.distanceFieldType==="none"?Oh:Lh;let f=null,p=0,m=0,v=0,g=-1,T=0,w=0,E=0,P=0;for(let M=0;M<u.length;M++){const R=u[M],F=Yn(R);if(/(?:\s)/.test(R)&&(g=M,T=p,P++),R==="\r"||R===`
`){o.push(p),l.push(-1),m=Math.max(m,p),++v,++w,r.x=0,r.y+=t.lineHeight,f=null,P=0;continue}const L=t.chars[F];if(!L)continue;f&&L.kerning[f]&&(r.x+=L.kerning[f]);const Z=Fh.pop()||{texture:ie.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Te};Z.texture=L.texture,Z.line=v,Z.charCode=F,Z.position.x=Math.round(r.x+L.xOffset+this._letterSpacing/2),Z.position.y=Math.round(r.y+L.yOffset),Z.prevSpaces=P,a.push(Z),p=Z.position.x+Math.max(L.xAdvance-L.xOffset,L.texture.orig.width),r.x+=L.xAdvance+this._letterSpacing,E=Math.max(E,L.yOffset+L.texture.height),f=F,g!==-1&&c>0&&r.x>c&&(++w,ys(a,1+g-w,1+M-g),M=g,g=-1,o.push(T),l.push(a.length>0?a[a.length-1].prevSpaces:0),m=Math.max(m,T),v++,r.x=0,r.y+=t.lineHeight,f=null,P=0)}const C=u[u.length-1];C!=="\r"&&C!==`
`&&(/(?:\s)/.test(C)&&(p=T),o.push(p),m=Math.max(m,p),l.push(-1));const D=[];for(let M=0;M<=v;M++){let R=0;this._align==="right"?R=m-o[M]:this._align==="center"?R=(m-o[M])/2:this._align==="justify"&&(R=l[M]<0?0:(m-o[M])/l[M]),D.push(R)}const B=a.length,H={},I=[],N=this._activePagesMeshData;d.push(...N);for(let M=0;M<B;M++){const R=a[M].texture,F=R.baseTexture.uid;if(!H[F]){let L=d.pop();if(!L){const V=new Gx;let q,pe;t.distanceFieldType==="none"?(q=new Ih(ie.EMPTY),pe=ce.NORMAL):(q=new Ih(ie.EMPTY,{program:qt.from(g0,m0),uniforms:{uFWidth:0}}),pe=ce.NORMAL_NPM);const G=new Ch(V,q);G.blendMode=pe,L={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:G,vertices:null,uvs:null,indices:null}}L.index=0,L.indexCount=0,L.vertexCount=0,L.uvsCount=0,L.total=0;const{_textureCache:Z}=this;Z[F]=Z[F]||new ie(R.baseTexture),L.mesh.texture=Z[F],L.mesh.tint=this._tintColor.value,I.push(L),H[F]=L}H[F].total++}for(let M=0;M<N.length;M++)I.includes(N[M])||this.removeChild(N[M].mesh);for(let M=0;M<I.length;M++)I[M].mesh.parent!==this&&this.addChild(I[M].mesh);this._activePagesMeshData=I;for(const M in H){const R=H[M],F=R.total;if(!(((e=R.indices)==null?void 0:e.length)>6*F)||R.vertices.length<Ch.BATCHABLE_SIZE*2)R.vertices=new Float32Array(4*2*F),R.uvs=new Float32Array(4*2*F),R.indices=new Uint16Array(6*F);else{const L=R.total,Z=R.vertices;for(let V=L*4*2;V<Z.length;V++)Z[V]=0}R.mesh.size=6*F}for(let M=0;M<B;M++){const R=a[M];let F=R.position.x+D[R.line]*(this._align==="justify"?R.prevSpaces:1);this._roundPixels&&(F=Math.round(F));const L=F*s,Z=R.position.y*s,V=R.texture,q=H[V.baseTexture.uid],pe=V.frame,G=V._uvs,Y=q.index++;q.indices[Y*6+0]=0+Y*4,q.indices[Y*6+1]=1+Y*4,q.indices[Y*6+2]=2+Y*4,q.indices[Y*6+3]=0+Y*4,q.indices[Y*6+4]=2+Y*4,q.indices[Y*6+5]=3+Y*4,q.vertices[Y*8+0]=L,q.vertices[Y*8+1]=Z,q.vertices[Y*8+2]=L+pe.width*s,q.vertices[Y*8+3]=Z,q.vertices[Y*8+4]=L+pe.width*s,q.vertices[Y*8+5]=Z+pe.height*s,q.vertices[Y*8+6]=L,q.vertices[Y*8+7]=Z+pe.height*s,q.uvs[Y*8+0]=G.x0,q.uvs[Y*8+1]=G.y0,q.uvs[Y*8+2]=G.x1,q.uvs[Y*8+3]=G.y1,q.uvs[Y*8+4]=G.x2,q.uvs[Y*8+5]=G.y2,q.uvs[Y*8+6]=G.x3,q.uvs[Y*8+7]=G.y3}this._textWidth=m*s,this._textHeight=(r.y+t.lineHeight)*s;for(const M in H){const R=H[M];if(this.anchor.x!==0||this.anchor.y!==0){let V=0;const q=this._textWidth*this.anchor.x,pe=this._textHeight*this.anchor.y;for(let G=0;G<R.total;G++)R.vertices[V++]-=q,R.vertices[V++]-=pe,R.vertices[V++]-=q,R.vertices[V++]-=pe,R.vertices[V++]-=q,R.vertices[V++]-=pe,R.vertices[V++]-=q,R.vertices[V++]-=pe}this._maxLineHeight=E*s;const F=R.mesh.geometry.getBuffer("aVertexPosition"),L=R.mesh.geometry.getBuffer("aTextureCoord"),Z=R.mesh.geometry.getIndex();F.data=R.vertices,L.data=R.uvs,Z.data=R.indices,F.update(),L.update(),Z.update()}for(let M=0;M<a.length;M++)Fh.push(a[M]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:i,size:s}=oi.available[this._fontName];if(i!=="none"){const{a:r,b:a,c:o,d:l}=this.worldTransform,h=Math.sqrt(r*r+a*a),u=Math.sqrt(o*o+l*l),c=(Math.abs(h)+Math.abs(u))/2,d=this.fontSize/s,f=e._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=c*t*d*f}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=oi.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!oi.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??oi.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,i=oi.available[this._fontName].distanceFieldType==="none"?Oh:Lh;i.push(...this._activePagesMeshData);for(const s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],i.filter(s=>t[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=ie.EMPTY});for(const s in t)t[s].destroy(),delete t[s];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}};v0.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const y0=[".xml",".fnt"],x0={extension:{type:K.LoadParser,priority:It.Normal},name:"loadBitmapFont",test(n){return y0.includes(Ze.extname(n).toLowerCase())},async testParse(n){return Xn.test(n)||ma.test(n)},async parse(n,e,t){const i=Xn.test(n)?Xn.parse(n):ma.parse(n),{src:s}=e,{page:r}=i,a=[];for(let h=0;h<r.length;++h){const u=r[h].file;let c=Ze.join(Ze.dirname(s),u);c=la(c,s),a.push(c)}const o=await t.load(a),l=a.map(h=>o[h]);return oi.install(i,l,!0)},async load(n,e){return(await te.ADAPTER.fetch(n)).text()},unload(n){n.destroy()}};se.add(x0);const ga=class us extends yi{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new us(Object.keys(us.defaultOptions).reduce((t,i)=>({...t,[i]:e[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(e=>{URL.revokeObjectURL(e.src),e.refs--,e.refs===0&&(e.fontFace&&document.fonts.delete(e.fontFace),delete us.availableFonts[e.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,t={}){const{availableFonts:i}=us;if(i[e]){const s=i[e];return this._fonts.push(s),s.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return te.ADAPTER.fetch(e).then(s=>s.blob()).then(async s=>new Promise((r,a)=>{const o=URL.createObjectURL(s),l=new FileReader;l.onload=()=>r([o,l.result]),l.onerror=a,l.readAsDataURL(s)})).then(async([s,r])=>{const a=Object.assign({family:Ze.basename(e,Ze.extname(e)),weight:"normal",style:"normal",display:"auto",src:s,dataSrc:r,refs:1,originalUrl:e,fontFace:null},t);i[e]=a,this._fonts.push(a),this.styleID++;const o=new FontFace(a.family,`url(${a.src})`,{weight:a.weight,style:a.style,display:a.display});a.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...e){const t=e.filter(i=>!this._overrides.includes(i));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){const t=e.filter(i=>this._overrides.includes(i));t.length>0&&(this._overrides=this._overrides.filter(i=>!t.includes(i)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}
            @font-face {
                font-family: "${t.family}";
                src: url('${t.dataSrc}');
                font-weight: ${t.weight};
                font-style: ${t.style};
                font-display: ${t.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=lg(e)),typeof e=="number"?ag(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(t*255|0).toString(16).padStart(2,"0"));const r=`${i}px ${s}px`;return this.dropShadowBlur>0?`text-shadow: ${r} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${r} ${e}`}reset(){Object.assign(this,us.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(t=>setTimeout(t,100)):Promise.resolve()}get isSafari(){const{userAgent:e}=te.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};ga.availableFonts={},ga.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let _o=ga;const Ln=class cs extends Ds{constructor(e="",t={}){super(ie.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const i=new Image,s=ie.from(i,{scaleMode:te.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new ve,s.trim=new ve,this.texture=s;const r="http://www.w3.org/2000/svg",a="http://www.w3.org/1999/xhtml",o=document.createElementNS(r,"svg"),l=document.createElementNS(r,"foreignObject"),h=document.createElementNS(a,"div"),u=document.createElementNS(a,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",o.appendChild(l),this.maxWidth=cs.defaultMaxWidth,this.maxHeight=cs.defaultMaxHeight,this._domElement=h,this._styleElement=u,this._svgRoot=o,this._foreignObject=l,this._foreignObject.appendChild(u),this._foreignObject.appendChild(h),this._image=i,this._loadImage=new Image,this._autoResolution=cs.defaultAutoResolution,this._resolution=cs.defaultResolution??te.RESOLUTION,this.text=e,this.style=t}measureText(e){var t,i;const{text:s,style:r,resolution:a}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:s,style:r.toCSS(a)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);const o=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:l,height:h}=o;(l>this.maxWidth||h>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const u=Math.min(this.maxWidth,Math.ceil(l)),c=Math.min(this.maxHeight,Math.ceil(h));return this._svgRoot.setAttribute("width",u.toString()),this._svgRoot.setAttribute("height",c.toString()),s!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:(t=this._style)==null?void 0:t.toCSS(a)}),this._styleElement.textContent=(i=this._style)==null?void 0:i.toGlobalCSS()),{width:u+r.padding*2,height:c+r.padding*2}}async updateText(e=!0){const{style:t,_image:i,_loadImage:s}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:r,height:a}=this.measureText();i.width=s.width=Math.ceil(Math.max(1,r)),i.height=s.height=Math.ceil(Math.max(1,a)),this._updateID++;const o=this._updateID;await new Promise(l=>{s.onload=async()=>{if(o<this._updateID){l();return}await t.onBeforeDraw(),i.src=s.src,s.onload=null,s.src="",this.updateTexture(),l()};const h=new XMLSerializer().serializeToString(this._svgRoot);s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(h)}`})}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:i,resolution:s}=this,{padding:r}=e,{baseTexture:a}=t;t.trim.width=t._frame.width=i.width/s,t.trim.height=t._frame.height=i.height/s,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-r*2,t.orig.height=t._frame.height-r*2,this._onTextureUpdate(),a.setRealSize(i.width,i.height,s),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){var t,i,s,r,a;typeof e=="boolean"&&(e={children:e}),e=Object.assign({},cs.defaultDestroyOptions,e),super.destroy(e);const o=null;this.ownsStyle&&((t=this._style)==null||t.cleanFonts()),this._style=o,(i=this._svgRoot)==null||i.remove(),this._svgRoot=o,(s=this._domElement)==null||s.remove(),this._domElement=o,(r=this._foreignObject)==null||r.remove(),this._foreignObject=o,(a=this._styleElement)==null||a.remove(),this._styleElement=o,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=o,this._image.src="",this._image=o}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=fi(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=fi(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&(e=e||{},e instanceof _o?(this.ownsStyle=!1,this._style=e):e instanceof yi?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=_o.from(e)):(this.ownsStyle=!0,this._style=new _o(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(e===""||e===null||e===void 0?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};Ln.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Ln.defaultMaxWidth=2024,Ln.defaultMaxHeight=2024,Ln.defaultAutoResolution=!0;const _0=1733608,w0=.25;let hi=!1,mr;const va=n=>{const e={tint:n!=null&&n.fill?new Oe(n.fill).toNumber():_0,alpha:n?.fillOpacity===void 0?w0:Math.min(n.fillOpacity,1)},t={tint:n?.stroke&&new Oe(n.stroke).toNumber(),alpha:n?.strokeOpacity===void 0?n!=null&&n.stroke?1:0:Math.min(n.strokeOpacity,1),lineWidth:n!=null&&n.stroke?n?.strokeWidth||1:0};return{fillStyle:e,strokeStyle:t}},ka=n=>(e,t,i)=>{const{fillStyle:s,strokeStyle:r}=va(i),a=new on;a.beginFill(16777215),n(t,a),a.endFill(),a.tint=s.tint,a.alpha=s.alpha,e.addChild(a);const o=new on,l=r.lineWidth===1?1:r.lineWidth/mr;return o.lineStyle(l,16777215,1,.5,r.lineWidth===1),n(t,o),o.tint=r.tint||16777215,o.alpha=r.alpha,e.addChild(o),{fill:a,stroke:o,strokeWidth:r.lineWidth}},T0=ka((n,e)=>{const{cx:t,cy:i,rx:s,ry:r}=n.geometry;e.drawEllipse(t,i,s,r)}),E0=ka((n,e)=>{const t=n.geometry.points.reduce((i,s)=>[...i,...s],[]);e.drawPolygon(t)}),b0=ka((n,e)=>{const{x:t,y:i,w:s,h:r}=n.geometry;e.drawRect(t,i,s,r)}),Kc=n=>{const e=n.viewport.getContainerSize().x;return n.viewport.getZoom(!0)*e/n.world.getContentFactor()},S0=(n,e,t,i)=>()=>{const s=n.viewport.viewportToImageRectangle(n.viewport.getBounds(!0)),r=Kc(n);r!==mr&&!hi&&(hi=!0,t.forEach(({stroke:d,strokeWidth:f})=>{const{lineStyle:p}=d.geometry.graphicsData[0];f>1?(hi=!1,p.width=f/r,d.geometry.invalidate()):f===1&&!p.native&&(p.width=1,p.native=!0,d.geometry.invalidate())})),mr=r;const a=n.viewport.getFlip();let o=Math.PI*n.viewport.getRotation(!0)/180;o<0&&(o+=2*Math.PI),o>2*Math.PI&&(o-=2*Math.PI);const l=a?n.viewport._containerInnerSize.x+s.x*r:-s.x*r,h=-s.y*r;let u,c;o>0&&o<=Math.PI/2?(u=s.height*r,c=0):o>Math.PI/2&&o<=Math.PI?(u=s.width*r,c=s.height*r):o>Math.PI&&o<=Math.PI*1.5?(u=0,c=s.width*r):(u=0,c=0),e.position.x=u+l*Math.cos(o)-h*Math.sin(o),e.position.y=c+l*Math.sin(o)+h*Math.cos(o),e.scale.set(a?-r:r,r),e.rotation=o,i.render(e)},A0=(n,e)=>{const t=new on,i=mc({width:e.width,height:e.height,backgroundAlpha:0,view:e,antialias:!0,resolution:2}),s=new Map;let r=new Set,a,o;mr=Kc(n);const l=(T,w)=>{hi=!1;const{selector:E}=T.target,P=typeof o=="function"?o(T,w):o;let C;E.type===rt.RECTANGLE?C=b0(t,E,P):E.type===rt.POLYGON?C=E0(t,E,P):E.type===rt.ELLIPSE?C=T0(t,E,P):console.warn(`Unsupported shape type: ${E.type}`),C&&s.set(T.id,{annotation:T,...C})},h=T=>{const w=s.get(T.id);w&&(s.delete(T.id),w.fill.destroy(),w.stroke.destroy())},u=(T,w,E)=>{hi=!1;const P=s.get(T.id);P&&(s.delete(T.id),P.fill.destroy(),P.stroke.destroy(),l(w,E))},c=(T,w)=>{const E=s.get(T);E&&(s.delete(T),E.fill.destroy(),E.stroke.destroy(),l(E.annotation,w))},d=(T,w)=>{i.resize(T,w),i.render(t)},f=T=>{hi=!1;const{children:w}=t;s.forEach(({fill:E,stroke:P,annotation:C})=>{const D=T?r.has(C.id)||T(C):!0;D&&!w.includes(E)?(t.addChild(E),t.addChild(P)):!D&&w.includes(E)&&(t.removeChild(E),t.removeChild(P))}),i.render(t)},p=T=>{a!==T&&(a&&c(a,{selected:r.has(a)}),T&&c(T,{selected:r.has(T),hovered:!0}),a=T,i.render(t))},m=T=>{const w=T.selected.map(C=>C.id),E=w.filter(C=>!r.has(C)),P=[...r].filter(C=>!w.includes(C));[...E,...P].forEach(C=>c(C,{selected:w.includes(C),hovered:C===a})),r=new Set(w),i.render(t)},v=T=>{if(typeof T=="function")s.forEach(({annotation:w,fill:E,stroke:P,strokeWidth:C},D)=>{C>1&&(hi=!1);const B={selected:r.has(w.id),hovered:a===w.id},{fillStyle:H,strokeStyle:I}=va(T(w,B));E.tint=H.tint,E.alpha=H.alpha,P.tint=I.tint||16777215,P.alpha=I.alpha,s.set(w.id,{annotation:w,fill:E,stroke:P,strokeWidth:C})});else{const{fillStyle:w,strokeStyle:E}=va(T);E.lineWidth>1&&(hi=!1),s.forEach(({annotation:P,fill:C,stroke:D,strokeWidth:B},H)=>{C.tint=w.tint,C.alpha=w.alpha,D.tint=E.tint||16777215,D.alpha=E.alpha,s.set(P.id,{annotation:P,fill:C,stroke:D,strokeWidth:B})})}o=T,i.render(t)},g=T=>{T?e.classList.remove("hidden"):e.classList.add("hidden")};return{addAnnotation:l,destroy:()=>i.destroy(),redraw:S0(n,t,s,i),removeAnnotation:h,resize:d,setFilter:f,setHovered:p,setSelected:m,setStyle:v,setVisible:g,updateAnnotation:u}};function R0(n,e,t){let i,s,{filter:r}=e,{state:a}=e,{style:o}=e,{viewer:l}=e,{visible:h=!0}=e;const{store:u,hover:c,selection:d,viewport:f}=a;Ro(n,c,C=>t(11,i=C)),Ro(n,d,C=>t(8,s=C));const p=Aa();let m,v;const g=C=>{const D=new Li.Point(C.x,C.y),{x:B,y:H}=l.viewport.pointFromPixel(D);return l.viewport.viewportToImageCoordinates(B,H)},T=C=>{const{x:D,y:B}=C.position;v={x:D,y:B}},w=C=>D=>{const{x:B,y:H}=g(new Li.Point(D.offsetX,D.offsetY)),I=u.getAt(B,H);I&&(!r||r(I))?(C.classList.add("hover"),i!==I.id&&(c.set(I.id),m.setHovered(I.id))):(C.classList.remove("hover"),i&&(c.set(void 0),m.setHovered(void 0)))},E=C=>{const D=C.originalEvent,{x:B,y:H}=C.position,I=B-v.x,N=H-v.y;if(Math.sqrt(I*I+N*N)<5){const{x:M,y:R}=g(C.position),F=u.getAt(M,R);F?p("click",{originalEvent:D,annotation:F}):p("click",{originalEvent:D})}v=void 0};let P;return gr(()=>{var C;const{offsetWidth:D,offsetHeight:B}=l.canvas,H=document.createElement("canvas");H.width=D,H.height=B,H.className="a9s-gl-canvas",(C=l.element.querySelector(".openseadragon-canvas"))==null||C.appendChild(H),t(7,m=A0(l,H));const I=w(H);H.addEventListener("pointermove",I);const N=new ResizeObserver(F=>{try{const{width:L,height:Z}=F[0].contentRect;H.width=L,H.height=Z,m.resize(L,Z)}catch{console.warn("WebGL canvas already disposed")}});N.observe(H);const M=()=>{const F=l.viewport.getBounds();P=l.viewport.viewportToImageRectangle(F);const{x:L,y:Z,width:V,height:q}=P,pe=u.getIntersecting(L,Z,V,q);f.set(pe.map(G=>G.id))};l.addHandler("canvas-press",T),l.addHandler("canvas-release",E),l.addHandler("update-viewport",m.redraw),l.addHandler("animation-finish",M);const R=F=>{const{created:L,updated:Z,deleted:V}=F.changes;if((L||[]).forEach(q=>m.addAnnotation(q)),(Z||[]).forEach(({oldValue:q,newValue:pe})=>m.updateAnnotation(q,pe)),(V||[]).forEach(q=>m.removeAnnotation(q)),P){const{x:q,y:pe,width:G,height:Y}=P,de=u.getIntersecting(q,pe,G,Y);f.set(de.map(J=>J.id))}else f.set(u.all().map(q=>q.id));m.redraw()};return u.observe(R),()=>{var F;H.removeEventListener("pointermove",I),N.disconnect(),l.removeHandler("canvas-press",T),l.removeHandler("canvas-release",E),l.removeHandler("update-viewport",m.redraw),l.removeHandler("animation-finish",M),u.unobserve(R),m.destroy(),(F=H.parentNode)==null||F.removeChild(H)}}),n.$$set=C=>{"filter"in C&&t(2,r=C.filter),"state"in C&&t(3,a=C.state),"style"in C&&t(4,o=C.style),"viewer"in C&&t(5,l=C.viewer),"visible"in C&&t(6,h=C.visible)},n.$$.update=()=>{n.$$.dirty&132&&m?.setFilter(r),n.$$.dirty&384&&m?.setSelected(s),n.$$.dirty&144&&m?.setStyle(o),n.$$.dirty&192&&m?.setVisible(h)},[c,d,r,a,o,l,h,m,s]}class P0 extends si{constructor(e){super(),ii(this,e,R0,null,Pt,{filter:2,state:3,style:4,viewer:5,visible:6})}}var Ke=[];for(var wo=0;wo<256;++wo)Ke.push((wo+256).toString(16).slice(1));function C0(n,e=0){return(Ke[n[e+0]]+Ke[n[e+1]]+Ke[n[e+2]]+Ke[n[e+3]]+"-"+Ke[n[e+4]]+Ke[n[e+5]]+"-"+Ke[n[e+6]]+Ke[n[e+7]]+"-"+Ke[n[e+8]]+Ke[n[e+9]]+"-"+Ke[n[e+10]]+Ke[n[e+11]]+Ke[n[e+12]]+Ke[n[e+13]]+Ke[n[e+14]]+Ke[n[e+15]]).toLowerCase()}var Fn,I0=new Uint8Array(16);function M0(){if(!Fn&&(Fn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Fn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Fn(I0)}var D0=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Nh={randomUUID:D0};function B0(n,e,t){if(Nh.randomUUID&&!e&&!n)return Nh.randomUUID();n=n||{};var i=n.random||(n.rng||M0)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,C0(i)}var Ss=(n=>(n.ELLIPSE="ELLIPSE",n.POLYGON="POLYGON",n.RECTANGLE="RECTANGLE",n))(Ss||{});const Ua=(n,e)=>e,O0={area:n=>Math.PI*n.geometry.rx*n.geometry.ry,intersects:(n,e,t)=>{const{cx:i,cy:s,rx:r,ry:a}=n.geometry,o=0,l=Math.cos(o),h=Math.sin(o),u=e-i,c=t-s,d=l*u+h*c,f=h*u-l*c;return d*d/(r*r)+f*f/(a*a)<=1}};Ua(Ss.ELLIPSE,O0);const L0={area:n=>{const{points:e}=n.geometry;let t=0,i=e.length-1;for(let s=0;s<e.length;s++)t+=(e[i][0]+e[s][0])*(e[i][1]-e[s][1]),i=s;return Math.abs(.5*t)},intersects:(n,e,t)=>{const{points:i}=n.geometry;let s=!1;for(let r=0,a=i.length-1;r<i.length;a=r++){const o=i[r][0],l=i[r][1],h=i[a][0],u=i[a][1];l>t!=u>t&&e<(h-o)*(t-l)/(u-l)+o&&(s=!s)}return s}};Ua(Ss.POLYGON,L0);const F0={area:n=>n.geometry.w*n.geometry.h,intersects:(n,e,t)=>e>=n.geometry.x&&e<=n.geometry.x+n.geometry.w&&t>=n.geometry.y&&t<=n.geometry.y+n.geometry.h};Ua(Ss.RECTANGLE,F0);Ss.RECTANGLE,Ss.POLYGON;const N0=(n,e)=>{const t=typeof e=="function"?e(n):e;if(t){const{fill:i,fillOpacity:s}=t;let r="";return i&&(r+=`fill:${i};stroke:${i};`),r+=`fill-opacity:${s||"0.25"};`,r}};function k0(n,e,t){let i;const s=Aa();let{annotation:r}=e,{editor:a}=e,{style:o}=e,{target:l}=e,{transform:h}=e,{viewportScale:u}=e,c;return gr(()=>(t(6,c=new a({target:l,props:{shape:r.target.selector,computedStyle:i,transform:h,viewportScale:u}})),c.$on("change",d=>{c.$$set({shape:d.detail}),s("change",d.detail)}),c.$on("grab",d=>s("grab",d.detail)),c.$on("release",d=>s("release",d.detail)),()=>{c.$destroy()})),n.$$set=d=>{"annotation"in d&&t(0,r=d.annotation),"editor"in d&&t(1,a=d.editor),"style"in d&&t(2,o=d.style),"target"in d&&t(3,l=d.target),"transform"in d&&t(4,h=d.transform),"viewportScale"in d&&t(5,u=d.viewportScale)},n.$$.update=()=>{n.$$.dirty&5&&(i=N0(r,o)),n.$$.dirty&65&&r&&c?.$set({shape:r.target.selector}),n.$$.dirty&80&&c&&c.$set({transform:h}),n.$$.dirty&96&&c&&c.$set({viewportScale:u})},[r,a,o,l,h,u,c]}class U0 extends si{constructor(e){super(),ii(this,e,k0,null,Pt,{annotation:0,editor:1,style:2,target:3,transform:4,viewportScale:5})}}navigator.userAgent.indexOf("Mac OS X");const H0=n=>({transform:n&2,scale:n&1}),kh=n=>({transform:n[1],scale:n[0]});function G0(n){let e;const t=n[4].default,i=ap(t,n,n[3],kh);return{c(){i&&i.c()},m(s,r){i&&i.m(s,r),e=!0},p(s,[r]){i&&i.p&&(!e||r&11)&&hp(i,t,s,s[3],e?lp(t,s[3],r,H0):up(s[3]),kh)},i(s){e||(Ae(i,s),e=!0)},o(s){Ne(i,s),e=!1},d(s){i&&i.d(s)}}}function z0(n,e,t){let{$$slots:i={},$$scope:s}=e,{viewer:r}=e,a=1,o;const l=()=>{const h=r.viewport.getContainerSize().x,u=r.viewport.getZoom(!0),c=r.viewport.getFlip(),d=r.viewport.pixelFromPoint(new Li.Point(0,0),!0);c&&(d.x=h-d.x);const f=u*h/r.world.getContentFactor(),p=c?-f:f,m=r.viewport.getRotation(!0);t(1,o=`translate(${d.x}, ${d.y}) scale(${p}, ${f}) rotate(${m})`),t(0,a=u*h/r.world.getContentFactor())};return gr(()=>(r.addHandler("update-viewport",l),()=>{r.removeHandler("update-viewport",l)})),n.$$set=h=>{"viewer"in h&&t(2,r=h.viewer),"$$scope"in h&&t(3,s=h.$$scope)},[a,o,r,s,i]}class Jc extends si{constructor(e){super(),ii(this,e,z0,G0,Pt,{viewer:2})}}function V0(n,e,t){const i=Aa();let{drawingMode:s}=e,{target:r}=e,{tool:a}=e,{transform:o}=e,{viewer:l}=e,{viewportScale:h}=e,u;return gr(()=>{const c=r.closest("svg"),d=[],f=(p,m,v)=>{if(c?.addEventListener(p,m,v),d.push(()=>c?.removeEventListener(p,m,v)),p==="pointerup"||p==="dblclick"){const g=w=>{const{originalEvent:E}=w;m(E)},T=p==="pointerup"?"canvas-click":"canvas-double-click";l.addHandler(T,g),d.push(()=>l.removeHandler(T,g))}else if(p==="pointermove"){const g=T=>{const{originalEvent:w}=T;m(w)};l.addHandler("canvas-drag",g),d.push(()=>l.removeHandler("canvas-drag",g))}};return t(6,u=new a({target:r,props:{addEventListener:f,drawingMode:s,transform:o,viewportScale:h}})),u.$on("create",p=>i("create",p.detail)),()=>{d.forEach(p=>p()),u.$destroy()}}),n.$$set=c=>{"drawingMode"in c&&t(0,s=c.drawingMode),"target"in c&&t(1,r=c.target),"tool"in c&&t(2,a=c.tool),"transform"in c&&t(3,o=c.transform),"viewer"in c&&t(4,l=c.viewer),"viewportScale"in c&&t(5,h=c.viewportScale)},n.$$.update=()=>{n.$$.dirty&72&&u&&u.$set({transform:o}),n.$$.dirty&96&&u&&u.$set({viewportScale:h})},[s,r,a,o,l,h,u]}class W0 extends si{constructor(e){super(),ii(this,e,V0,null,Pt,{drawingMode:0,target:1,tool:2,transform:3,viewer:4,viewportScale:5})}}function Uh(n,e,t){const i=n.slice();return i[30]=e[t],i}function j0(n){let e=n[2],t,i,s=Hh(n);return{c(){s.c(),t=Cs()},m(r,a){s.m(r,a),Ct(r,t,a),i=!0},p(r,a){a[0]&4&&Pt(e,e=r[2])?(xi(),Ne(s,1,1,gi),_i(),s=Hh(r),s.c(),Ae(s,1),s.m(t.parentNode,t)):s.p(r,a)},i(r){i||(Ae(s),i=!0)},o(r){Ne(s),i=!1},d(r){r&&vt(t),s.d(r)}}}function X0(n){let e,t,i=Jn(n[6]),s=[];for(let a=0;a<i.length;a+=1)s[a]=zh(Uh(n,i,a));const r=a=>Ne(s[a],1,1,()=>{s[a]=null});return{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=Cs()},m(a,o){for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(a,o);Ct(a,e,o),t=!0},p(a,o){if(o[0]&536895074){i=Jn(a[6]);let l;for(l=0;l<i.length;l+=1){const h=Uh(a,i,l);s[l]?(s[l].p(h,o),Ae(s[l],1)):(s[l]=zh(h),s[l].c(),Ae(s[l],1),s[l].m(e.parentNode,e))}for(xi(),l=i.length;l<s.length;l+=1)r(l);_i()}},i(a){if(!t){for(let o=0;o<i.length;o+=1)Ae(s[o]);t=!0}},o(a){s=s.filter(Boolean);for(let o=0;o<s.length;o+=1)Ne(s[o]);t=!1},d(a){a&&vt(e),du(s,a)}}}function Hh(n){let e,t;return e=new W0({props:{target:n[5],tool:n[7],drawingMode:n[4],transform:{elementToImage:n[9]},viewer:n[3],viewportScale:n[29]}}),e.$on("create",n[13]),{c(){wi(e.$$.fragment)},m(i,s){ei(e,i,s),t=!0},p(i,s){const r={};s[0]&32&&(r.target=i[5]),s[0]&128&&(r.tool=i[7]),s[0]&16&&(r.drawingMode=i[4]),s[0]&8&&(r.viewer=i[3]),s[0]&536870912&&(r.viewportScale=i[29]),e.$set(r)},i(i){t||(Ae(e.$$.fragment,i),t=!0)},o(i){Ne(e.$$.fragment,i),t=!1},d(i){ti(e,i)}}}function Gh(n){let e,t;return e=new U0({props:{target:n[5],editor:n[14](n[30].target.selector),annotation:n[30],style:n[1],transform:{elementToImage:n[9]},viewportScale:n[29]}}),e.$on("grab",n[10]),e.$on("change",function(){ba(n[12](n[30]))&&n[12](n[30]).apply(this,arguments)}),e.$on("release",n[11]),{c(){wi(e.$$.fragment)},m(i,s){ei(e,i,s),t=!0},p(i,s){n=i;const r={};s[0]&32&&(r.target=n[5]),s[0]&64&&(r.editor=n[14](n[30].target.selector)),s[0]&64&&(r.annotation=n[30]),s[0]&2&&(r.style=n[1]),s[0]&536870912&&(r.viewportScale=n[29]),e.$set(r)},i(i){t||(Ae(e.$$.fragment,i),t=!0)},o(i){Ne(e.$$.fragment,i),t=!1},d(i){ti(e,i)}}}function zh(n){let e=n[30].id,t,i,s=Gh(n);return{c(){s.c(),t=Cs()},m(r,a){s.m(r,a),Ct(r,t,a),i=!0},p(r,a){a[0]&64&&Pt(e,e=r[30].id)?(xi(),Ne(s,1,1,gi),_i(),s=Gh(r),s.c(),Ae(s,1),s.m(t.parentNode,t)):s.p(r,a)},i(r){i||(Ae(s),i=!0)},o(r){Ne(s),i=!1},d(r){r&&vt(t),s.d(r)}}}function Y0(n){let e,t,i,s,r,a;const o=[X0,j0],l=[];function h(u,c){return u[5]&&u[6]?0:u[5]&&u[7]&&u[0]?1:-1}return~(i=h(n))&&(s=l[i]=o[i](n)),{c(){e=bt("svg"),t=bt("g"),s&&s.c(),fe(t,"transform",r=n[28]),fe(t,"class","svelte-190cqdf"),fe(e,"class","a9s-annotationlayer a9s-osd-drawinglayer svelte-190cqdf"),dl(e,"drawing",n[0])},m(u,c){Ct(u,e,c),Ni(e,t),~i&&l[i].m(t,null),n[21](t),a=!0},p(u,c){let d=i;i=h(u),i===d?~i&&l[i].p(u,c):(s&&(xi(),Ne(l[d],1,1,()=>{l[d]=null}),_i()),~i?(s=l[i],s?s.p(u,c):(s=l[i]=o[i](u),s.c()),Ae(s,1),s.m(t,null)):s=null),(!a||c[0]&268435456&&r!==(r=u[28]))&&fe(t,"transform",r),(!a||c[0]&1)&&dl(e,"drawing",u[0])},i(u){a||(Ae(s),a=!0)},o(u){Ne(s),a=!1},d(u){u&&vt(e),~i&&l[i].d(),n[21](null)}}}function q0(n){let e,t;return e=new Jc({props:{viewer:n[3],$$slots:{default:[Y0,({transform:i,scale:s})=>({28:i,29:s}),({transform:i,scale:s})=>[(i?268435456:0)|(s?536870912:0)]]},$$scope:{ctx:n}}}),{c(){wi(e.$$.fragment)},m(i,s){ei(e,i,s),t=!0},p(i,s){const r={};s[0]&8&&(r.viewer=i[3]),s[0]&805306623|s[1]&4&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(Ae(e.$$.fragment,i),t=!0)},o(i){Ne(e.$$.fragment,i),t=!1},d(i){ti(e,i)}}}function Z0(n,e,t){let i,s,r,a,{drawingEnabled:o}=e,{filter:l}=e,{preferredDrawingMode:h}=e,{state:u}=e,{style:c=void 0}=e,{toolName:d=au()[0]}=e,{user:f}=e,{viewer:p}=e;const m=navigator.userAgent.match(/firefox|fxios/i);let v;const{store:g,selection:T,hover:w}=u;Ro(n,T,L=>t(20,a=L));let E,P,C;const D=L=>{g.unobserve(E);const Z=L.filter(({editable:V})=>V).map(({id:V})=>V);if(Z.length>0){if(t(6,P=Z.map(V=>g.getAnnotation(V))),E=V=>{const{updated:q}=V.changes;t(6,P=(q||[]).map(pe=>pe.newValue))},g.observe(E,{annotations:Z}),m){const{width:V}=p.viewport.viewerElementToViewportRectangle(new Li.Rect(0,0,1,1));p.viewport.panBy(new Li.Point(Math.abs(V/10),0))}}else t(6,P=void 0)},B=(L,Z)=>{const{x:V,y:q}=p.viewport.viewerElementToImageCoordinates(new Li.Point(L,Z));return[V,q]},H=L=>{p.setMouseNavEnabled(!1),C=L.timeStamp},I=L=>{if(p.setMouseNavEnabled(!0),performance.now()-(C||0)<300){const{offsetX:Z,offsetY:V}=L.detail,[q,pe]=B(Z,V),G=g.getAt(q,pe);G&&(!l||l(G))&&!P.find(Y=>Y.id===G.id)&&(w.set(G.id),T.setSelected(G.id))}},N=L=>Z=>{var V;const{target:q}=L,pe=10*60*1e3,G=((V=q.creator)==null?void 0:V.id)!==f.id||!q.created||new Date().getTime()-q.created.getTime()>pe;g.updateTarget({...q,selector:Z.detail,created:G?q.created:new Date,updated:G?new Date:void 0,updatedBy:G?f:void 0})},M=L=>{const Z=B0(),V={id:Z,bodies:[],target:{annotation:Z,selector:L.detail,creator:f,created:new Date}};g.addAnnotation(V),T.setSelected(V.id),p.setMouseNavEnabled(!0)},R=L=>If(L);function F(L){Kn[L?"unshift":"push"](()=>{v=L,t(5,v)})}return n.$$set=L=>{"drawingEnabled"in L&&t(0,o=L.drawingEnabled),"filter"in L&&t(15,l=L.filter),"preferredDrawingMode"in L&&t(16,h=L.preferredDrawingMode),"state"in L&&t(17,u=L.state),"style"in L&&t(1,c=L.style),"toolName"in L&&t(2,d=L.toolName),"user"in L&&t(18,f=L.user),"viewer"in L&&t(3,p=L.viewer)},n.$$.update=()=>{n.$$.dirty[0]&4&&t(7,{tool:i,opts:s}=lu(d)||{tool:void 0,opts:void 0},i,(t(19,s),t(2,d))),n.$$.dirty[0]&589824&&t(4,r=s?.drawingMode||h),n.$$.dirty[0]&25&&(o&&r==="drag"?p.setMouseNavEnabled(!1):p.setMouseNavEnabled(!0)),n.$$.dirty[0]&1&&o&&T.clear(),n.$$.dirty[0]&1048601&&a.selected.length===0&&r==="drag"&&o&&p.setMouseNavEnabled(!1),n.$$.dirty[0]&1048576&&D(a.selected)},[o,c,d,p,r,v,P,i,T,B,H,I,N,M,R,l,h,u,f,s,a,F]}class K0 extends si{constructor(e){super(),ii(this,e,Z0,q0,Pt,{drawingEnabled:0,filter:15,preferredDrawingMode:16,state:17,style:1,toolName:2,user:18,viewer:3},null,[-1,-1])}}function J0(n){let e,t,i,s,r,a,o,l=n[2].appearance.label+"",h,u,c,d;return{c(){e=bt("g"),t=bt("rect"),o=bt("text"),h=fu(l),fe(t,"class","a9s-presence-label-bg svelte-1rehw2p"),fe(t,"x",n[0]),fe(t,"y",i=n[1]-18/n[3]),fe(t,"height",s=18/n[3]),fe(t,"fill",r=n[2].appearance.color),fe(t,"stroke",a=n[2].appearance.color),fe(o,"font-size",u=12/n[3]),fe(o,"x",c=n[0]+Math.round(5/n[3])),fe(o,"y",d=n[1]-5/n[3]),fe(o,"class","svelte-1rehw2p"),fe(e,"class","a9s-presence-label")},m(f,p){Ct(f,e,p),Ni(e,t),Ni(e,o),Ni(o,h),n[6](e)},p(f,[p]){p&1&&fe(t,"x",f[0]),p&10&&i!==(i=f[1]-18/f[3])&&fe(t,"y",i),p&8&&s!==(s=18/f[3])&&fe(t,"height",s),p&4&&r!==(r=f[2].appearance.color)&&fe(t,"fill",r),p&4&&a!==(a=f[2].appearance.color)&&fe(t,"stroke",a),p&4&&l!==(l=f[2].appearance.label+"")&&fp(h,l),p&8&&u!==(u=12/f[3])&&fe(o,"font-size",u),p&9&&c!==(c=f[0]+Math.round(5/f[3]))&&fe(o,"x",c),p&10&&d!==(d=f[1]-5/f[3])&&fe(o,"y",d)},i:gi,o:gi,d(f){f&&vt(e),n[6](null)}}}function Q0(n,e,t){let{x:i}=e,{y:s}=e,{user:r}=e,{scale:a}=e,{hAlign:o=null}=e,l;const h=c=>{const d=l.querySelector("text"),f=l.querySelector("rect"),p=d.getBBox().width+10/c;o==="CENTER"&&l.setAttribute("style",`transform: translateX(-${p/2}px)`),f.setAttribute("width",`${p}`)};function u(c){Kn[c?"unshift":"push"](()=>{l=c,t(4,l)})}return n.$$set=c=>{"x"in c&&t(0,i=c.x),"y"in c&&t(1,s=c.y),"user"in c&&t(2,r=c.user),"scale"in c&&t(3,a=c.scale),"hAlign"in c&&t(5,o=c.hAlign)},n.$$.update=()=>{n.$$.dirty&24&&l&&h(a)},[i,s,r,a,l,o,u]}class Qc extends si{constructor(e){super(),ii(this,e,Q0,J0,Pt,{x:0,y:1,user:2,scale:3,hAlign:5})}}function $0(n){let e,t,i,s,r,a;return t=new Qc({props:{scale:n[1],user:n[0],x:n[3][0],y:n[3][1],hAlign:"CENTER"}}),{c(){e=bt("g"),wi(t.$$.fragment),i=bt("polygon"),fe(i,"class","a9s-presence-shape a9s-presence-polygon svelte-fgq4n0"),fe(i,"stroke",s=n[0].appearance.color),fe(i,"fill","transparent"),fe(i,"points",r=n[2].points.map(Vh).join(" ")),fe(e,"class","a9s-presence-overlay")},m(o,l){Ct(o,e,l),ei(t,e,null),Ni(e,i),a=!0},p(o,[l]){const h={};l&2&&(h.scale=o[1]),l&1&&(h.user=o[0]),l&8&&(h.x=o[3][0]),l&8&&(h.y=o[3][1]),t.$set(h),(!a||l&1&&s!==(s=o[0].appearance.color))&&fe(i,"stroke",s),(!a||l&4&&r!==(r=o[2].points.map(Vh).join(" ")))&&fe(i,"points",r)},i(o){a||(Ae(t.$$.fragment,o),a=!0)},o(o){Ne(t.$$.fragment,o),a=!1},d(o){o&&vt(e),ti(t)}}}const Vh=n=>n.join(",");function e_(n,e,t){let i,s,{annotation:r}=e,{user:a}=e,{scale:o}=e;const l=h=>{let[u,...c]=h.points;return c.forEach(([d,f])=>{f<u[1]&&(u=[d,f])}),u};return n.$$set=h=>{"annotation"in h&&t(4,r=h.annotation),"user"in h&&t(0,a=h.user),"scale"in h&&t(1,o=h.scale)},n.$$.update=()=>{n.$$.dirty&16&&t(2,i=r.target.selector.geometry),n.$$.dirty&4&&t(3,s=l(i))},[a,o,i,s,r]}class t_ extends si{constructor(e){super(),ii(this,e,e_,$0,Pt,{annotation:4,user:0,scale:1})}}function i_(n){let e,t,i,s,r,a,o,l,h;return t=new Qc({props:{scale:n[1],user:n[0],x:n[2].x,y:n[2].y}}),{c(){e=bt("g"),wi(t.$$.fragment),i=bt("rect"),fe(i,"class","a9s-presence-shape a9s-presence-rectangle svelte-gze948"),fe(i,"stroke",s=n[0].appearance.color),fe(i,"fill","transparent"),fe(i,"x",r=n[2].x),fe(i,"y",a=n[2].y),fe(i,"width",o=n[2].w),fe(i,"height",l=n[2].h),fe(e,"class","a9s-presence-overlay")},m(u,c){Ct(u,e,c),ei(t,e,null),Ni(e,i),h=!0},p(u,[c]){const d={};c&2&&(d.scale=u[1]),c&1&&(d.user=u[0]),c&4&&(d.x=u[2].x),c&4&&(d.y=u[2].y),t.$set(d),(!h||c&1&&s!==(s=u[0].appearance.color))&&fe(i,"stroke",s),(!h||c&4&&r!==(r=u[2].x))&&fe(i,"x",r),(!h||c&4&&a!==(a=u[2].y))&&fe(i,"y",a),(!h||c&4&&o!==(o=u[2].w))&&fe(i,"width",o),(!h||c&4&&l!==(l=u[2].h))&&fe(i,"height",l)},i(u){h||(Ae(t.$$.fragment,u),h=!0)},o(u){Ne(t.$$.fragment,u),h=!1},d(u){u&&vt(e),ti(t)}}}function s_(n,e,t){let i,{annotation:s}=e,{user:r}=e,{scale:a}=e;return n.$$set=o=>{"annotation"in o&&t(3,s=o.annotation),"user"in o&&t(0,r=o.user),"scale"in o&&t(1,a=o.scale)},n.$$.update=()=>{n.$$.dirty&8&&t(2,i=s.target.selector.geometry)},[r,a,i,s]}class n_ extends si{constructor(e){super(),ii(this,e,s_,i_,Pt,{annotation:3,user:0,scale:1})}}const{Boolean:r_}=cp;function Wh(n,e,t){const i=n.slice();return i[8]=e[t],i}function jh(n){let e,t;return e=new Jc({props:{viewer:n[0],$$slots:{default:[l_,({transform:i,scale:s})=>({6:i,7:s}),({transform:i,scale:s})=>(i?64:0)|(s?128:0)]},$$scope:{ctx:n}}}),{c(){wi(e.$$.fragment)},m(i,s){ei(e,i,s),t=!0},p(i,s){const r={};s&1&&(r.viewer=i[0]),s&2244&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(Ae(e.$$.fragment,i),t=!0)},o(i){Ne(e.$$.fragment,i),t=!1},d(i){ti(e,i)}}}function Xh(n){let e,t,i=Jn(n[2]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Yh(Wh(n,i,a));const r=a=>Ne(s[a],1,1,()=>{s[a]=null});return{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=Cs()},m(a,o){for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(a,o);Ct(a,e,o),t=!0},p(a,o){if(o&132){i=Jn(a[2]);let l;for(l=0;l<i.length;l+=1){const h=Wh(a,i,l);s[l]?(s[l].p(h,o),Ae(s[l],1)):(s[l]=Yh(h),s[l].c(),Ae(s[l],1),s[l].m(e.parentNode,e))}for(xi(),l=i.length;l<s.length;l+=1)r(l);_i()}},i(a){if(!t){for(let o=0;o<i.length;o+=1)Ae(s[o]);t=!0}},o(a){s=s.filter(r_);for(let o=0;o<s.length;o+=1)Ne(s[o]);t=!1},d(a){a&&vt(e),du(s,a)}}}function o_(n){let e,t;return e=new t_({props:{annotation:n[8].annotation,user:n[8].selectedBy,scale:n[7]}}),{c(){wi(e.$$.fragment)},m(i,s){ei(e,i,s),t=!0},p(i,s){const r={};s&4&&(r.annotation=i[8].annotation),s&4&&(r.user=i[8].selectedBy),s&128&&(r.scale=i[7]),e.$set(r)},i(i){t||(Ae(e.$$.fragment,i),t=!0)},o(i){Ne(e.$$.fragment,i),t=!1},d(i){ti(e,i)}}}function a_(n){let e,t;return e=new n_({props:{annotation:n[8].annotation,user:n[8].selectedBy,scale:n[7]}}),{c(){wi(e.$$.fragment)},m(i,s){ei(e,i,s),t=!0},p(i,s){const r={};s&4&&(r.annotation=i[8].annotation),s&4&&(r.user=i[8].selectedBy),s&128&&(r.scale=i[7]),e.$set(r)},i(i){t||(Ae(e.$$.fragment,i),t=!0)},o(i){Ne(e.$$.fragment,i),t=!1},d(i){ti(e,i)}}}function Yh(n){let e,t,i,s;const r=[a_,o_],a=[];function o(l,h){return l[8].annotation.target.selector.type===rt.RECTANGLE?0:l[8].annotation.target.selector.type===rt.POLYGON?1:-1}return~(e=o(n))&&(t=a[e]=r[e](n)),{c(){t&&t.c(),i=Cs()},m(l,h){~e&&a[e].m(l,h),Ct(l,i,h),s=!0},p(l,h){let u=e;e=o(l),e===u?~e&&a[e].p(l,h):(t&&(xi(),Ne(a[u],1,1,()=>{a[u]=null}),_i()),~e?(t=a[e],t?t.p(l,h):(t=a[e]=r[e](l),t.c()),Ae(t,1),t.m(i.parentNode,i)):t=null)},i(l){s||(Ae(t),s=!0)},o(l){Ne(t),s=!1},d(l){l&&vt(i),~e&&a[e].d(l)}}}function l_(n){let e,t,i,s,r=n[2].length>0&&Xh(n);return{c(){e=bt("svg"),t=bt("g"),r&&r.c(),fe(t,"transform",i=n[6]),fe(e,"class","a9s-osd-presencelayer svelte-1krwc4m")},m(a,o){Ct(a,e,o),Ni(e,t),r&&r.m(t,null),s=!0},p(a,o){a[2].length>0?r?(r.p(a,o),o&4&&Ae(r,1)):(r=Xh(a),r.c(),Ae(r,1),r.m(t,null)):r&&(xi(),Ne(r,1,1,()=>{r=null}),_i()),(!s||o&64&&i!==(i=a[6]))&&fe(t,"transform",i)},i(a){s||(Ae(r),s=!0)},o(a){Ne(r),s=!1},d(a){a&&vt(e),r&&r.d()}}}function h_(n){let e=!!n[1],t,i,s=e&&jh(n);return{c(){s&&s.c(),t=Cs()},m(r,a){s&&s.m(r,a),Ct(r,t,a),i=!0},p(r,[a]){a&2&&(e=!!r[1]),e?s?(s.p(r,a),a&2&&Ae(s,1)):(s=jh(r),s.c(),Ae(s,1),s.m(t.parentNode,t)):s&&(xi(),Ne(s,1,1,()=>{s=null}),_i())},i(r){i||(Ae(s),i=!0)},o(r){Ne(s),i=!1},d(r){r&&vt(t),s&&s.d(r)}}}function u_(n,e,t){let{store:i}=e,{viewer:s}=e,{provider:r}=e,a=[],o;const l=(h,u)=>{t(2,a=[...a.filter(({selectedBy:c})=>c.presenceKey!==h.presenceKey),...(u||[]).map(c=>({annotation:i.getAnnotation(c),selectedBy:h}))].filter(({annotation:c})=>(c||console.warn("Selection event on unknown annotation"),!!c))),o&&i.unobserve(o),o=c=>{const{deleted:d,updated:f}=c.changes,p=new Set((d||[]).map(v=>v.id)),m=a.filter(({annotation:v})=>!p.has(v.id)).map(v=>{const g=(f||[]).find(T=>T.oldValue.id===v.annotation.id);return g?{selectedBy:v.selectedBy,annotation:g.newValue}:v});t(2,a=m)},i.observe(o,{annotations:a.map(c=>c.annotation.id)})};return mp(()=>{o&&i.unobserve(o)}),n.$$set=h=>{"store"in h&&t(3,i=h.store),"viewer"in h&&t(0,s=h.viewer),"provider"in h&&t(1,r=h.provider)},n.$$.update=()=>{n.$$.dirty&2&&r&&r.on("selectionChange",l)},[s,r,a,i]}class c_ extends si{constructor(e){super(),ii(this,e,u_,h_,Pt,{store:3,viewer:0,provider:1})}}const qh=(n,e)=>{e==="auto"?n.addHandler("open",t=>{const i=n.world.getItemCount();n.world.getItemAt(i-1).addOnceHandler("fully-loaded-change",s=>{const{fullyLoaded:r}=s;if(r){const a=n.canvas.querySelector("canvas"),o=tp(a);n.element.setAttribute("data-theme",o)}})}):n.element.setAttribute("data-theme",e)},$c=(n,e,t)=>(i,s={})=>{const r=typeof i=="string"?i:i.id,a=e.getAnnotation(r);if(!a)return;const o=n.container.getBoundingClientRect(),{padding:l}=s;let[h,u,c,d]=l?Array.isArray(l)?l:[l,l,l,l]:[0,0,0,0];h=h/o.height,u=u/o.width,c=c/o.height,d=d/o.width;const{minX:f,minY:p,maxX:m,maxY:v}=a.target.selector.geometry.bounds,g=m-f,T=v-p,w=f-d*g,E=p-h*T,P=g+(u+d)*g,C=T+(h+c)*T,D=n.viewport.imageToViewportRectangle(w,E,P,C);n.viewport[t](D,s.immediately)},d_=(n,e)=>$c(n,e,"fitBounds"),f_=(n,e)=>$c(n,e,"fitBoundsWithConstraints"),p_=(n,e={})=>{const t=ip(e,{drawingEnabled:!1,drawingMode:nu?"drag":"click",userSelectAction:Jh.EDIT,theme:"light"}),i=$f(t),{hover:s,selection:r,store:a}=i,o=Ed(a),l=bd(i,o,t.adapter,t.autoSave);let h=Dd(),u=t.drawingEnabled,c=t.drawingMode;const d=sp(o,n.element),f=new P0({target:n.element,props:{state:i,viewer:n,style:t.style,filter:void 0}}),p=new c_({target:n.element.querySelector(".openseadragon-canvas"),props:{provider:void 0,store:a,viewer:n}}),m=new K0({target:n.element.querySelector(".openseadragon-canvas"),props:{drawingEnabled:!!u,filter:void 0,preferredDrawingMode:c,state:i,style:t.style,user:h,viewer:n}});f.$on("click",L=>{const{originalEvent:Z,annotation:V}=L.detail;V&&!(c==="click"&&u)?r.userSelect(V.id,Z):r.isEmpty()||r.clear()}),n.element.addEventListener("pointerdown",L=>{if(s.current){const Z=a.getAnnotation(s.current);l.emit("clickAnnotation",Z,L)}}),qh(n,t.theme);const v=Ad(i,o,t.adapter),g=()=>{f.$destroy(),p.$destroy(),m.$destroy(),d.destroy(),o.destroy()},T=d_(n,a),w=f_(n,a),E=()=>h,P=(L,Z,V)=>Vf(L,Z,V),C=(L,Z)=>Mf(L,Z),D=L=>{if(!lu(L))throw`No drawing tool named ${L}`;m.$set({toolName:L})},B=L=>{u=L,m.$set({drawingEnabled:u})},H=L=>{f.$set({filter:L}),m.$set({filter:L})},I=L=>{f.$set({style:L}),m.$set({style:L})},N=L=>p.$set({provider:L}),M=L=>qh(n,L),R=L=>{h=L,m.$set({user:L})},F=L=>f.$set({visible:L});return{...v,destroy:g,fitBounds:T,fitBoundsWithConstraints:w,getUser:E,listDrawingTools:au,on:l.on,off:l.off,registerDrawingTool:P,registerShapeEditor:C,setDrawingEnabled:B,setDrawingTool:D,setFilter:H,setPresenceProvider:N,setStyle:I,setTheme:M,setUser:R,setVisible:F,state:i,viewer:n}},ed=st.createContext({viewer:null,setViewer:null}),m_=n=>{const{children:e,tool:t,...i}=n,[s,r]=st.useState(),{anno:a,setAnno:o}=st.useContext(id);return st.useEffect(()=>{if(s){const l=p_(s,i);return n.drawingEnabled!==void 0&&l.setDrawingEnabled(n.drawingEnabled),n.filter&&l.setFilter(n.filter),n.style&&l.setStyle(n.style),n.tool&&l.setDrawingTool(n.tool),o(l),()=>{l.destroy(),o(void 0)}}},[s]),st.useEffect(()=>{a&&a.setDrawingEnabled(n.drawingEnabled)},[n.drawingEnabled]),st.useEffect(()=>{a&&a.setFilter(n.filter)},[n.filter]),st.useEffect(()=>{a&&a.setStyle(n.style)},[n.style]),st.useEffect(()=>{a&&a.setDrawingTool(t)},[t]),Zh.jsx(ed.Provider,{value:{viewer:s,setViewer:r},children:n.children})},g_=st.forwardRef((n,e)=>{const{className:t,options:i}=n,s=st.useRef(null),{viewer:r,setViewer:a}=st.useContext(ed);return st.useEffect(()=>{if(s.current){const o=Li({...i,element:s.current});return a&&a(o),()=>{a&&a(void 0),o.destroy()}}},[JSON.stringify(i)]),st.useImperativeHandle(e,()=>r),Zh.jsx("div",{className:t,ref:s})}),v_={id:"4c4ee2bf-50e0-4bad-8176-76372b6ccf4b",bodies:[],target:{annotation:"4c4ee2bf-50e0-4bad-8176-76372b6ccf4b",selector:{type:sd.RECTANGLE,geometry:{bounds:{minX:4713,minY:1859,maxX:4845,maxY:1956},x:4713,y:1859,w:132,h:97}}}},y_={prefixUrl:"https://cdn.jsdelivr.net/npm/openseadragon@latest/build/openseadragon/images/",tileSources:{type:"image",url:"/images/schoenbrunn.jpg"},gestureSettingsMouse:{clickToZoom:!1,dblClickToZoom:!1},minZoomLevel:.8,visibilityRatio:.2,preserveImageSizeOnResize:!0},x_=()=>{const[n,e]=st.useState(),t=rd();return st.useEffect(()=>{if(t)return t.addAnnotation(v_),()=>{t.clearAnnotations()}},[t]),dt.jsxs("div",{className:"openseadragon-example",children:[dt.jsx(m_,{drawingEnabled:n!==void 0,tool:n||"rectangle",children:dt.jsx(g_,{className:"osd-container",options:y_})}),dt.jsxs("div",{className:"actions",children:[dt.jsxs("button",{className:n===void 0?"active":void 0,onClick:()=>e(void 0),children:[dt.jsx(ud,{size:15})," Move Image"]}),dt.jsxs("button",{className:n==="rectangle"?"rectangle active":"rectangle",onClick:()=>e("rectangle"),children:[dt.jsx(od,{size:15})," Rectangle"]}),dt.jsxs("button",{className:n==="polygon"?"polygon active":"polygon",onClick:()=>e("polygon"),children:[dt.jsx(ad,{size:15})," Polygon"]})]})]})},T_=()=>dt.jsx(nd,{children:dt.jsx(x_,{})});export{T_ as OpenSeadragonExample};
